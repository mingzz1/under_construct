<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>[MeePwn2018] WHITE SNOW, BLACK SHADOW / ESOR / EZCHALLZ Write up | mingzzi</title>
	<meta name="description" content="ì§€ë‚œ ì£¼ë§ì— MeePwn CTFê°€ ìˆì—ˆë‹¤.ë‹¤ë¥¸ ì¼ì´ ìˆì–´ í’€íƒ€ì„ìœ¼ë¡œ ì°¸ì—¬í•˜ì§„ ëª»í–ˆëŠ”ë°, ê·¸ë˜ë„ ì‰¬ìš´ ëª‡ ë¬¸ì œë¥¼ í’€ì–´ Write-upì„ ì‘ì„± í•´ ë³´ì•˜ë‹¤.">

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" /> 

	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/ctf/2018/2018/07/17/ctf-meepwn2018-writeup.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="mingzzi" href="/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:400,700" rel="stylesheet">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.js"></script>
	

	<!-- jquery -->
	<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130304424-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-130304424-1');
	</script>
	
	<!-- Google AdSense -->
	<script data-ad-client="ca-pub-1587587893565234" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		var flag = false;
		$(function() {
			$(".menu_btn").click(function() {
				$(this).toggleClass("on")
				if(flag) {
					console.log(flag);
					$(".cat1").css("display", "none");
					flag = false;
				} else {
					console.log(flag);
					$(".cat1").css("display", "block");
					flag = true;
				}
			})
		})
	</script>
</head>

  <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/assets/img/blogmark.png" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">mingzzi</a>
		</h1>
		<nav class="site-nav">
				<ul>
					<li> <a class="page-link" href="/about">About</a> </li>					
					<li> <a class="page-link" href="/archive">Archive</a> </li>
					<li> <a class="page-link" href="/tags">Tags</a> </li>

					<!-- Search bar -->
					
					<li>
					<form action="/search.html" method="get">
						<input type="text" id="search-box" name="query" placeholder="Search" class="">
						<button type="submit" class="">
							<i class="fa fa-fw fa-search"></i>
						</button>
					</form>
					</li>
					
				</ul>
		</nav>
	</div>
	
	<div class="menu_btn">
		<span></span>
		<span></span>
		<span></span>
	</div>

	<div class="site-category">
			<ul class='cat1'>
				<li><a href="/">Home</a></li>
				<li><a href="/">Pentesting</a>
					<ul>
						<li><a href="/Pentest/iOS">iOS</a></li>
						<li><a href="/Pentest/Android">Android</a></li>
						<li><a href="/Pentest/PWeb">Web</a></li>
					</ul>
				</li>

				<li><a href="/">Wargame</a>
					<ul>
						<li><a href="/Wargame/LoS">Load of SQL Injection</a></li>
						<li><a href="/Wargame/Pwnkr">Pwnable.kr</a></li>
						<li><a href="/Wargame/Warkr">Wargame.kr</a></li>
						<li><a href="/Wargame/XG">XSS Game</a></li>
					</ul>
				</li>

				<li><a href="/">CTF</a>
					<ul>
						<li><a href="/CTF/2018">2018</a></li>
						<li><a href="/CTF/2019">2019</a></li>
					</ul>
				</li>

				<li><a href="/">Error</a>
					<ul>
						<li><a href="/Error/Linux">Linux</a></li>
						<li><a href="/Error/Python">Python</a></li>
					</ul>
				</li>

				<li><a href="/">Development</a>
					<ul>
						<li><a href="/Develop/Database">Database</a></li>
						<li><a href="/Develop/Blog">Github Blog</a></li>
						<li><a href="/Develop/DWeb">Web</a></li>
						<li><a href="/Develop/Docker">Docker</a></li>
						<li><a href="/Develop/Basic">Basic</a></li>
					</ul>
				</li>
			</ul>
		</div>

</header>

  <body>
    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">[MeePwn2018] WHITE SNOW, BLACK SHADOW / ESOR / EZCHALLZ Write up</h1>
    
    <p class="meta">
      July 17, 2018
      
    </p>
  </header>
  <section class="post-content"><p>ì§€ë‚œ ì£¼ë§ì— <code class="highlighter-rouge">MeePwn CTF</code>ê°€ ìˆì—ˆë‹¤.</p>

<p>ë‹¤ë¥¸ ì¼ì´ ìˆì–´ í’€íƒ€ì„ìœ¼ë¡œ ì°¸ì—¬í•˜ì§„ ëª»í–ˆëŠ”ë°, ê·¸ë˜ë„ ì‰¬ìš´ ëª‡ ë¬¸ì œë¥¼ í’€ì–´ Write-upì„ ì‘ì„± í•´ ë³´ì•˜ë‹¤.</p>

<!--more-->

<h3 id="misc-white-snow-black-shadow">[MISC] WHITE SNOW, BLACK SHADOW</h3>

<p>ì²« ë²ˆì§¸ë¡œ í’€ì–´ë³¸ ë¬¸ì œëŠ” <code class="highlighter-rouge">WHITE SNOW, BLACK SHADOW</code> ë¬¸ì œì´ë‹¤.</p>

<p>ë¬¸ì œ ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Finally we caught the image in criminal communication.
But Holmes, why are they crying?
</code></pre></div></div>

<p>ë¬¸ì œ ì •ë³´ì™€ í•¨ê»˜ ì²¨ë¶€ íŒŒì¼ì„ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆë‹¤.</p>

<p>íŒŒì¼ì„ ë‹¤ìš´ë°›ì•„ ì••ì¶•ì„ í’€ë©´ <code class="highlighter-rouge">evidence.jpg</code>ë¼ëŠ” ì‚¬ì§„ íŒŒì¼ì„ í•˜ë‚˜ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_01.jpg" alt="" /></p>

<p>ì‚¬ì§„ì—ëŠ” ë”±íˆ ì´ìƒì´ ì—†ì–´ë³´ì—¬, <code class="highlighter-rouge">Hex Editor</code>ë¥¼ ì‚¬ìš© í•´ í—¥ìŠ¤ ê°’ì„ í™•ì¸ í•´ ë³´ì•˜ë‹¤.</p>

<p>íŒŒì¼ì˜ ì²« ë¶€ë¶„ì€ ì •ìƒì ì¸ <code class="highlighter-rouge">JPG</code> íŒŒì¼ì˜ í—¤ë”ê°€ ìˆì—ˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_02.png" alt="" /></p>

<p>ê·¸ëŸ°ë° ë§¨ ë§ˆì§€ë§‰ ë¶€ë¶„ì—ì„œ ì•„ë˜ì™€ ê°™ì´ <code class="highlighter-rouge">message.pdf</code>ë¼ëŠ” ë¬¸ìì—´ê³¼ <code class="highlighter-rouge">PK</code>ê°€ ìˆëŠ” ê²ƒì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_03.png" alt="" /></p>

<p><code class="highlighter-rouge">PK</code>ë¼ëŠ” íŒŒì¼ í—¤ë”ë¥¼ ì–´ë”˜ê°€ì—ì„œ ë³¸ ê¸°ì–µì´ ë‚˜ ì¸í„°ë„·ì— ê²€ìƒ‰ì„ í•´ ë³´ì•˜ë”ë‹ˆ <code class="highlighter-rouge">ZIP</code> íŒŒì¼ì˜ í—¤ë”ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_04.png" alt="" /></p>

<p>ì‚¬ì§„ê³¼ ê°™ì´, <code class="highlighter-rouge">ZIP</code> íŒŒì¼ì˜ í—¤ë”ëŠ” <code class="highlighter-rouge">50 4b 03 04</code>ë¡œ ì‹œì‘í•˜ê²Œ ëœë‹¤.</p>

<p>ì‚¬ì§„ íŒŒì¼ì—ì„œ <code class="highlighter-rouge">ZIP</code> íŒŒì¼ì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´, <code class="highlighter-rouge">50 4b 03 04</code>ë¥¼ ì°¾ì•„ ë³´ì•˜ë‹¤.</p>

<p>ê·¸ëŸ°ë° ì°¾ì•„ë³´ë‹ˆ <code class="highlighter-rouge">50 4b 05 06</code>ì€ ìˆì—ˆì§€ë§Œ <code class="highlighter-rouge">50 4b 03 04</code>ëŠ” ì°¾ì„ ìˆ˜ ì—†ì—ˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_05.png" alt="" /></p>

<p>ì•„ë§ˆë„ íŒŒì¼ í—¤ë”ë¥¼ ì‚´ì§ ìˆ˜ì •í•´ ë‘” ê²ƒ ê°™ì•˜ë‹¤.</p>

<p>ê·¸ë˜ì„œ <code class="highlighter-rouge">evidence.jpg</code> íŒŒì¼ì—ì„œ <code class="highlighter-rouge">50 4b 05 06</code>ì„ <code class="highlighter-rouge">50 4b 03 04</code>ë¡œ íŒ¨ì¹˜í•´ ì¤€ ë’¤, <code class="highlighter-rouge">WinHex</code> ë¼ëŠ” íˆ´ì„ ì´ìš© í•´ íŒŒì¼ì„ ì¶”ì¶œ í•´ ë³´ì•˜ë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_06.png" alt="" /></p>

<p>ê·¸ ê²°ê³¼ ë‹¤ìŒê³¼ ê°™ì´ ì••ì¶• íŒŒì¼ì„ ì¶”ì¶œí•  ìˆ˜ ìˆì—ˆê³ , ì••ì¶• íŒŒì¼ ì•ˆì—ëŠ” <code class="highlighter-rouge">message.pdf</code> íŒŒì¼ì´ ìˆì—ˆë‹¤.</p>

<p><code class="highlighter-rouge">message.pdf</code>ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â€œWhen you have eliminated the impossible, whatever remains, however improbable, must be the truth.â€

â€“ Sir Arthur Conan Doyle

What does that mean?
To me, this is all about logic. If you start with everything you can think of, and then eliminate those that are impossible, you are well on your way to a solution. Thatâ€™s the first stage of solving any mystery, whether itâ€™s a murder mystery in a book (or TV, or movie, orâ€¦) or somethingMeeyou expected to work, but didnâ€™t. You have to eliminate all the things that it couldnâ€™t possibly be, or you will have too many distractions. 

Once we clear out all the distractions, we can focus on what remains. Sometimes what is left is easy to believe, other times it can seem highly improbable. However, with the impossible eliminated, whatPwnremains are the only possible solutions. And oneCTFof them must be the truth.

Why is clearing out the impossible solutions important?
Sometimes, it can be hard to solve a{T3challenging situation even under the best of circumstances. A problem with lotsxt_of shiny things to look at can be distracting, and waste a great deal of our time.
While some impossibilities might be obvious, sometimesUndwe can be sucked in by an idea that3r_intrigues us, despite being impossible. Other times, it is only in close examination that the impossibility is revealed.

However, once we clear the clutter by removing all that is impossible, we are left with an easier solution. Gone are the impossibilities, botht3Xobvious and subtle. What is left can be gone over more quickly, and evaluated for probability or even likelihood.

This may be an iterative process, starting with the really obvious impossibilities, and then moving to the shiny distractions. Finally, as wet!!!!}work our way through the last of the options, we may still find ourselves weeding out additional impossibilities.
</code></pre></div></div>

<p>ì²˜ìŒì—” ë”±íˆ ì´ìƒí•œ ì ì„ ëª»ëŠê¼ˆëŠ”ë°, ìì„¸íˆ ì½ì–´ë³´ë‹ˆ ë„ì–´ì“°ê¸°ê°€ ìˆì–´ì•¼ í•˜ëŠ” ë¶€ë¶„ì— ë¬¸ìì—´ì´ ì¡°ê¸ˆì”© ë“¤ì–´ìˆëŠ” ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<blockquote>
  <p>ex) or something<code class="highlighter-rouge">Mee</code>you expected to work,</p>
</blockquote>

<p>ë¬¸ì¥ì„ í•˜ë‚˜í•˜ë‚˜ ì½ì–´ë³´ë©° ë„ì–´ì“°ê¸°ê°€ ìˆì–´ì•¼ í•˜ëŠ” ìë¦¬ì— ë“¤ì–´ ìˆëŠ” ë¬¸ìì—´ì„ ì˜ë¼ ì´ì–´ë³´ë©´ flagë¥¼ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FLAG : MeePwnCTF{T3xt_Und3r_t3Xt!!!!}
</code></pre></div></div>

<hr />

<h3 id="crypto-esor">[CRYPTO] ESOR</h3>

<p>ë¬¸ì œ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Howdy, howdy...
nc 206.189.92.209 12345
</code></pre></div></div>

<p>ë˜í•œ í•¨ê»˜ ì•„ë˜ì™€ ê°™ì€ íŒŒì´ì¬ ì½”ë“œë¥¼ ì¤€ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python2</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">hmac</span><span class="p">,</span> <span class="n">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">menu</span> <span class="o">=</span> <span class="s">"""Choose one:
1. encrypt data
2. decrypt data
3. quit
"""</span>

<span class="k">class</span> <span class="nc">Unbuffered</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">Unbuffered</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">encrypt_key</span> <span class="o">=</span> <span class="s">'</span><span class="se">\xff</span><span class="s">'</span> <span class="o">*</span> <span class="mi">32</span>
<span class="n">secret</span> <span class="o">=</span> <span class="s">'MeePwnCTF{#flag_here#}'</span>
<span class="n">hmac_secret</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">blocksize</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">hmac_size</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="n">padlen</span> <span class="o">=</span> <span class="n">blocksize</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">%</span> <span class="n">blocksize</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">padlen</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">padlen</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">unpad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">compute_hmac</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hmac_secret</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
	<span class="n">_enc</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">secret</span> <span class="o">+</span> <span class="n">suffix</span>
	<span class="n">_enc</span><span class="o">+=</span> <span class="n">compute_hmac</span><span class="p">(</span><span class="n">_enc</span><span class="p">)</span>
	<span class="n">_enc</span><span class="o">+=</span> <span class="n">pad</span><span class="p">(</span><span class="n">_enc</span><span class="p">)</span>
	<span class="n">iv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
	<span class="n">_aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">encrypt_key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">iv</span> <span class="o">+</span> <span class="n">_aes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">_enc</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">iv</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">blocksize</span><span class="p">]</span>
		<span class="n">_aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">encrypt_key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">_aes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">blocksize</span><span class="p">:])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">plaintext</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">hmac_size</span><span class="p">]</span>
		<span class="n">mac</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">hmac_size</span><span class="p">:]</span>
		<span class="k">if</span> <span class="n">mac</span> <span class="o">==</span> <span class="n">compute_hmac</span><span class="p">(</span><span class="n">plaintext</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
	<span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

<span class="k">print</span> <span class="s">"""Welcome to our super secure enc/dec server. 
We use hmac, so, plz don't hack us (and you can't). Thanks."""</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="n">menu</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">_pre</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">'prefix: '</span><span class="p">)</span>
		<span class="n">_suf</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">'suffix: '</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">_pre</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">_suf</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
		<span class="n">_data</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">'data: '</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">_data</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">'OK'</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">'KO'</span>
	<span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="n">menu</span><span class="p">))</span>
</code></pre></div></div>

<p>ì„œë²„ì— ì‹¤ì œë¡œ ì €ì¥ë˜ì–´ ìˆëŠ” <code class="highlighter-rouge">secret</code>ì˜ ê°’ì„ ì°¾ì•„ì•¼ í•˜ëŠ” ë¬¸ì œì´ë‹¤.</p>

<p>ncë¥¼ í†µí•´ ë¬¸ì œì— ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nc 206.189.92.209 12345
Welcome to our super secure enc/dec server. 
We use hmac, so, plz don't hack us (and you can't). Thanks.
Choose one:
1. encrypt data
2. decrypt data
3. quit
1
prefix: aaa
suffix: bbb
d9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907b
Choose one:
1. encrypt data
2. decrypt data
3. quit
2
data: d9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907b
OK
Choose one:
1. encrypt data
2. decrypt data
3. quit
</code></pre></div></div>

<p><code class="highlighter-rouge">encrypt data</code>, <code class="highlighter-rouge">decrypt data</code>, <code class="highlighter-rouge">quit</code> 3 ê°œì˜ ë©”ë‰´ê°€ ìˆê³ , <code class="highlighter-rouge">encrypt data</code>ë¥¼ ì„ íƒ í•  ê²½ìš° <code class="highlighter-rouge">prefix</code>ì™€ <code class="highlighter-rouge">suffix</code>ë¥¼ ì…ë ¥ í•´ ì£¼ì–´ì•¼ í•œë‹¤.</p>

<p>ë˜í•œ <code class="highlighter-rouge">decrypt data</code>ë¥¼ ì„ íƒ í•  ê²½ìš°ì—ëŠ” ë³µí˜¸í™” í•  ë°ì´í„°ë¥¼ ì…ë ¥ë°›ê³  ë³µí˜¸í™” ì„±ê³µ ì‹œ <code class="highlighter-rouge">OK</code>ë¥¼, ë³µí˜¸í™”ë¥¼ ì‹¤íŒ¨ í•  ê²½ìš°ì—ëŠ” <code class="highlighter-rouge">KO</code>ë¥¼ ì¶œë ¥ í•´ ì¤€ë‹¤.</p>

<p>ì†ŒìŠ¤ì½”ë“œë¥¼ í™•ì¸ í•´ ë³´ë©´ <code class="highlighter-rouge">decrypt</code> í•¨ìˆ˜ë¥¼ ì œê³µ í•´ ì£¼ì—ˆìœ¼ë©°, <code class="highlighter-rouge">encrypt_key</code>ê°€ <code class="highlighter-rouge">0xff * 32</code>ë¡œ ë˜ì–´ ìˆë‹¤.</p>

<p>ê·¸ë˜ì„œ í˜¹ì‹œë‚˜ í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì œê³µí•´ ì¤€ <code class="highlighter-rouge">decrypt</code> í•¨ìˆ˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ exploit ì½”ë“œë¥¼ ì§  í›„ ëŒë ¤ ë³´ì•˜ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python2</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">hmac</span><span class="p">,</span> <span class="n">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Unbuffered</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">Unbuffered</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">encrypt_key</span> <span class="o">=</span> <span class="s">'</span><span class="se">\xff</span><span class="s">'</span> <span class="o">*</span> <span class="mi">32</span>
<span class="n">hmac_secret</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">blocksize</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">hmac_size</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">def</span> <span class="nf">unpad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">compute_hmac</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hmac_secret</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">iv</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">blocksize</span><span class="p">]</span>
		<span class="n">_aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">encrypt_key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">_aes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">blocksize</span><span class="p">:])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">unpad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">plaintext</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">hmac_size</span><span class="p">]</span>
		<span class="n">mac</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">hmac_size</span><span class="p">:]</span>
		<span class="k">if</span> <span class="n">mac</span> <span class="o">==</span> <span class="n">compute_hmac</span><span class="p">(</span><span class="n">plaintext</span><span class="p">):</span>
			<span class="k">print</span> <span class="n">plaintext</span>
			<span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
	<span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

<span class="k">print</span> <span class="s">"[+] ESOR exploit start"</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"206.189.92.209"</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"[+] Connect OK with ESOR"</span> 

<span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"3. quit"</span><span class="p">)</span>

<span class="n">s</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>

<span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"prefix: "</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"aaa"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"suffix: "</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"bbb"</span><span class="p">)</span>

<span class="n">recv_data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"3. quit"</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">recv_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"Choose one:"</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">192</span><span class="p">]</span>

<span class="k">print</span> <span class="n">data</span>

<span class="k">print</span> <span class="s">"[+] Check Encrypted data OK"</span>

<span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>ncë¡œ ì ‘ì†í•œ í›„, ì•”í˜¸í™” ëœ ë°ì´í„°ë¥¼ ë°›ì•„ ì œê³µí•´ ì¤€ <code class="highlighter-rouge">decrypt</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš© í•´ ë³µí˜¸í™” í•œ í›„ <code class="highlighter-rouge">print plaintext</code>ë§Œ ì¶”ê°€ í•´ ì£¼ì—ˆë‹¤.</p>

<p>ê·¸ ê²°ê³¼ ì• ë’¤ë¡œ ë‚´ê°€ ì…ë ¥ í•œ <code class="highlighter-rouge">prefix</code>ì™€ <code class="highlighter-rouge">suffix</code>ê°€ ìˆëŠ” flagë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FLAG : MeePwnCTF{pooDL3-this-is-la-vie-en-rose-P00dle!}
</code></pre></div></div>

<p>ì•„ë¬´ë˜ë„ ì´ ë¬¸ì œëŠ” ì¶œì œìê°€ ì˜ëª» ë‚¸ ë¬¸ì œê°™ë‹¤.</p>

<p>flagì˜ ë‚´ìš©ìœ¼ë¡œ ì¶”ì¸¡í•˜ê±´ë°, ì•„ë§ˆë„ <code class="highlighter-rouge">POODLE</code> ê³µê²©ì„ í•´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ì•„ë‹ˆì—ˆë‚˜ ì‹¶ë‹¤.</p>

<p>ê·¸ëŸ°ë°, ì˜¤ëŠ˜ ë‹¤ì‹œ ì½”ë“œë¥¼ ëŒë ¤ë³´ë‹ˆ ì´ì œëŠ” ë¬¸ì œê°€ í’€ë¦¬ì§€ ì•Šì•˜ë‹¤.</p>

<p>ëŒ€íšŒ ë„ì¤‘ ì¶œì œìê°€ ì˜ëª»ëœ ê²ƒì„ ê¹¨ë‹«ê³  ë¬¸ì œë¥¼ ìˆ˜ì •í•œ ê²ƒ ê°™ë‹¤.</p>

<p><del>IRCëŠ” ëª¨ë¥´ê² ì§€ë§Œ í™ˆí˜ì´ì§€ì—ëŠ” ê³µì§€ê°€ ì—†ì—ˆë‹¤â€¦ ì ìˆ˜í•¨ íŒ¨ì¹˜ ì¼â€¦</del></p>

<hr />

<h3 id="crypto-ezchallz">[CRYPTO] EZCHALLZ</h3>

<p>ë¬¸ì œ ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://206.189.92.209/ezchallz/
</code></pre></div></div>

<p>í™ˆí˜ì´ì§€ì— ì ‘ì† í•´ ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ë§Œ ìˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_07.png" alt="" /></p>

<p><code class="highlighter-rouge">Homepage</code>ì™€ <code class="highlighter-rouge">Free register</code>, ë”± ë‘ê°œì˜ ë©”ë‰´ë§Œ ìˆì„ ë¿ì´ì—ˆë‹¤.</p>

<p><code class="highlighter-rouge">Homepage</code>ë¥¼ ëˆ„ë¥´ë©´ ìœ„ì™€ ë™ì¼í•œ í™”ë©´ì´ ë‚˜íƒ€ë‚œë‹¤.</p>

<p><code class="highlighter-rouge">Free register</code>ë¥¼ ëˆ„ë¥¼ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°’ì„ ì…ë ¥í•  ìˆ˜ ìˆìœ¼ë©°, <code class="highlighter-rouge">Register</code> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê°€ì§œ flagë¥¼ ì¶œë ¥ í•´ ì¤€ë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_08.png" alt="" /></p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_09.png" alt="" /></p>

<p>ì†ŒìŠ¤ì½”ë“œë¥¼ ë´ë„ ë”±íˆ ëˆˆì— ë„ëŠ”ê²ƒì´ ì—†ì–´ <code class="highlighter-rouge">URL</code>ì„ ì‚´í´ ë³´ì•˜ë‹¤.</p>

<p>ê°ê° ë²„íŠ¼ì„ ëˆ„ë¥¼ ê²½ìš° ì´ë™í•˜ëŠ” URLì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<blockquote>
  <p>Homepageë¥¼ ëˆ„ë¥¼ ê²½ìš° : http://206.189.92.209/ezchallz/index.php<br />
Free registerë¥¼ ëˆ„ë¥¼ ê²½ìš° : http://206.189.92.209/ezchallz/index.php?page=register<br />
ê°’ ì…ë ¥ í›„ Register ë²„íŠ¼ì„ ëˆ„ë¥¼ ê²½ìš° : http://206.189.92.209/ezchallz/users/b8240bb93fb5c4321196ff675b7f98eb/flag.php</p>
</blockquote>

<p>ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì—ì„œ <code class="highlighter-rouge">page</code>ë¥¼ ì¸ìë¡œ ë°›ì•„ í˜ì´ì§€ë¥¼ ì´ë™í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° ì´ ê²½ìš° <code class="highlighter-rouge">LFI</code> ê³µê²©ì— ì·¨ì•½í•  ìˆ˜ ìˆë‹¤.</p>

<p><code class="highlighter-rouge">page</code>ì˜ ê°’ì— ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•œë‹¤ë©´, í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=php://filter/convert.base64-encode/resource=index
</code></pre></div></div>

<p>ê·¸ ê²°ê³¼ ì•„ë˜ì™€ ê°™ì´ <code class="highlighter-rouge">base64</code>ë¡œ ì¸ì½”ë”© ëœ ì†ŒìŠ¤ì½”ë“œë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_10.png" alt="" /></p>

<p><code class="highlighter-rouge">index</code>ì™€ <code class="highlighter-rouge">register</code> í˜ì´ì§€ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì–»ì–´ <code class="highlighter-rouge">base64</code>ë¡œ ë””ì½”ë”© í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.</p>

<ul>
  <li>index.php</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"index.php"</span><span class="nt">&gt;</span>Homepage<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?page=register"</span><span class="nt">&gt;</span>Free register<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>

<span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"page"</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"page"</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"page"</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$page</span><span class="p">),</span> <span class="s1">'secret'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">'No no no!'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="c1">//    else if(strpos($page, 'php') !== false) {</span>
 <span class="c1">//       die("N0 n0 n0!");</span>
<span class="c1">//    }</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">include</span><span class="p">(</span><span class="nv">$page</span> <span class="o">.</span> <span class="s1">'.php'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<ul>
  <li>register.php</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="cp">&lt;?php</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">gendirandshowflag</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">include</span><span class="p">(</span><span class="s1">'secret.php'</span><span class="p">);</span>
	<span class="nv">$dname</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nv">$intro</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nv">$_username</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$raw_output</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$salt</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$dname</span><span class="o">.=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$salt</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$_username</span><span class="p">[</span><span class="nv">$i</span><span class="p">]));</span>
	<span class="p">};</span>
	<span class="nv">$dname</span> <span class="o">=</span> <span class="s2">"users/"</span> <span class="o">.</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$dname</span><span class="p">);</span>
	<span class="k">echo</span> <span class="s1">'You have successfully register as '</span> <span class="o">.</span> <span class="nv">$username</span> <span class="o">.</span> <span class="s1">'!\n'</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$_username</span> <span class="o">===</span> <span class="nb">hex2bin</span><span class="p">(</span><span class="s1">'21232f297a57a5a743894a0e4a801fc3'</span><span class="p">))</span> <span class="p">{</span>
		<span class="nv">$intro</span> <span class="o">=</span> <span class="s2">"Here is your flag:"</span> <span class="o">.</span> <span class="nv">$flag</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="nv">$intro</span> <span class="o">=</span> <span class="s2">"Here is your flag, but I'm not sure ğŸ¤”: </span><span class="se">\n</span><span class="s2">MeePwnCTF{"</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">.</span> <span class="nv">$username</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"}"</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dname</span><span class="p">);</span>
	<span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$dname</span> <span class="o">.</span> <span class="s1">'/flag.php'</span><span class="p">,</span> <span class="nv">$intro</span><span class="p">);</span>
	<span class="nb">header</span><span class="p">(</span><span class="s2">"Location: "</span><span class="o">.</span> <span class="nv">$dname</span> <span class="o">.</span> <span class="s2">"/flag.php"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'admin'</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">die</span><span class="p">(</span><span class="s1">'Username is not allowed!'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="nx">gendirandshowflag</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"?page=register"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Register"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶„ì„í•´ ë³¸ ê²°ê³¼, usernameì˜ md5 í•´ì‰¬ ê°’ì´ <code class="highlighter-rouge">21232f297a57a5a743894a0e4a801fc3</code>ë¼ë©´ ì§„ì§œ flagë¥¼ <code class="highlighter-rouge">$dname/flag.php</code>ì— ì €ì¥í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>ì¦‰, md5 í•´ì‰¬ ê°’ì´ <code class="highlighter-rouge">21232f297a57a5a743894a0e4a801fc3</code>ì¸ usernameì„ ì°¾ì•„ í•´ë‹¹ <code class="highlighter-rouge">username</code>ì˜ <code class="highlighter-rouge">$dname</code>ì„ êµ¬í•´ <code class="highlighter-rouge">$dname/flag.php</code>ì— ë“¤ì–´ê°€ë©´ flagë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>

<p><code class="highlighter-rouge">$dname</code>ì„ ë§Œë“œëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$salt</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$dname</span><span class="o">.=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$salt</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$_username</span><span class="p">[</span><span class="nv">$i</span><span class="p">]));</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ë”°ë¼ì„œ <code class="highlighter-rouge">$dname</code>ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” <code class="highlighter-rouge">$salt</code>ì˜ ê°’ê³¼ <code class="highlighter-rouge">$_username</code>ì˜ ê°’ì„ ì•Œì•„ì•¼ í•œë‹¤.</p>

<p>ì¸í„°ë„·ì˜ í•´ì‰¬ ê°’ì„ í¬ë™í•´ ì£¼ëŠ” ì‚¬ì´íŠ¸ì—ì„œ <code class="highlighter-rouge">21232f297a57a5a743894a0e4a801fc3</code>ì˜ í‰ë¬¸ì€ <code class="highlighter-rouge">admin</code>ì´ë¼ëŠ” ê²ƒì„ ì•Œì•„ë‚´ì–´, <code class="highlighter-rouge">$_username</code>ì€ <code class="highlighter-rouge">admin</code>ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>ë¬¸ì œëŠ” <code class="highlighter-rouge">$salt</code> ê°’ì¸ë°, ë³€ìˆ˜ë¥¼ ìƒˆë¡œ ì„ ì–¸ë„ ì•ˆí•œ ê²ƒìœ¼ë¡œ ë³´ì•„ <code class="highlighter-rouge">$salt</code>ì˜ ê°’ì€ <code class="highlighter-rouge">secret.php</code>ì— ìˆëŠ” ê²ƒ ê°™ë‹¤.</p>

<p>í•˜ì§€ë§Œ <code class="highlighter-rouge">index.php</code>ì—ì„œ <code class="highlighter-rouge">secret</code>ë¼ëŠ” ë¬¸ìì— ëŒ€í•œ í•„í„°ë§ì„ ê±¸ì–´ ë‘ì—ˆìœ¼ë¯€ë¡œ, <code class="highlighter-rouge">secret.php</code>ì˜ ì†ŒìŠ¤ì½”ë“œëŠ” ì•Œì•„ë‚¼ ìˆ˜ ì—†ë‹¤.</p>

<p>í•˜ì§€ë§Œ <code class="highlighter-rouge">$dname</code>ì„ ë§Œë“¤ ë•Œ <code class="highlighter-rouge">XOR</code> ì—°ì‚°ì„ ì‚¬ìš©í•˜ë©°, í™ˆí˜ì´ì§€ì—ì„œ ë‚´ê°€ ì…ë ¥í•œ ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“¤ì–´ ì§€ëŠ” <code class="highlighter-rouge">$dname</code>ì˜ ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p>ë”°ë¼ì„œ ì´ë¥¼ ì—­ ì—°ì‚°í•˜ë©´ <code class="highlighter-rouge">$salt</code>ì˜ ê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ ìˆë‹¤.</p>

<p><code class="highlighter-rouge">$salt</code>ì˜ ê°’ì„ êµ¬í•˜ê³ , <code class="highlighter-rouge">admin</code>ì˜ <code class="highlighter-rouge">$dname</code>ì„ êµ¬í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ì†ŒìŠ¤ì½”ë“œë¥¼ êµ¬í˜„ í–ˆë‹¤.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$_username</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="s2">"test"</span><span class="p">,</span> <span class="nv">$raw_output</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">);</span>

	<span class="nv">$_dname</span> <span class="o">=</span> <span class="nb">hex2bin</span><span class="p">(</span><span class="s2">"b8240bb93fb5c4321196ff675b7f98eb"</span><span class="p">);</span>

	<span class="nv">$salt</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_username</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$salt</span> <span class="o">.=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$_dname</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$_username</span><span class="p">[</span><span class="nv">$i</span><span class="p">]));</span>
	<span class="p">}</span>

	<span class="nv">$_username</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="s2">"admin"</span><span class="p">,</span> <span class="nv">$raw_output</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">);</span>
	<span class="nv">$dname</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_username</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$dname</span><span class="o">.=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$salt</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$_username</span><span class="p">[</span><span class="nv">$i</span><span class="p">]));</span>
    <span class="p">}</span>
	<span class="k">echo</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$dname</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>ê·¸ ê²°ê³¼ <code class="highlighter-rouge">90884f5d03c3b2e698c1fbea37d833de</code>ë¼ëŠ” <code class="highlighter-rouge">$dname</code> ê°’ì„ êµ¬í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><code class="highlighter-rouge">90884f5d03c3b2e698c1fbea37d833de/flag.php</code>ë¡œ ì ‘ì† í•´ ì£¼ì„ì„ í™•ì¸ í•´ë³´ë©´ flagë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>

<p><img src="/images/CTF/MeePwn2018/solved/meepwn_11.png" alt="" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FLAG : MeePwnCTF{just-a-warmup-challenge-are-you-ready-for-hacking-others-challz?}
</code></pre></div></div>
</section>
  
<footer>
  <div class="tags">
    
    <a class="tag" href="/tags#Write-up">#Write-up</a>
    
    <a class="tag" href="/tags#CTF">#CTF</a>
    
    <a class="tag" href="/tags#MeePwn2018">#MeePwn2018</a>
    
  </div>
</footer>


</article>
<!-- Disqus -->
<a href="https://mingzz1.github.io/ctf/2018/2018/07/17/ctf-meepwn2018-writeup.html#disqus_thread"></a>

<div class="comments">
    
<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'mingzzis-blog';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view comments.</noscript>

</div>


<!-- Post navigation -->

  <div id="post-nav">
  
  <div id="previous-post" class="post-nav-post">
      <p>Previous post</p>
      <a href="/wargame/xss%20game/2018/06/27/xssgame-writeup.html">
        [XSS Game] Write up
      </a>
  </div>
  
  
  <div id="next-post" class="post-nav-post">
      <p>Next post</p>
      <a href="/ctf/2018/2018/07/18/ctf-meepwn2018-omegasector.html">
        [MeePwn2018] OMEGASECTOR Write up
      </a>
  </div>
  
</div>



    </div>
    <!-- Social icons from Font Awesome, if enabled  -->

<ul class='social'>
	

	
	<li>
		<a href="mailto:mingzzi87@gmail.com" title="Email">
			<i class="fa fa-fw fa-envelope"></i>
		</a>
	</li>
	

	

	

	

	

	

	
	<li>
		<a href="https://github.com/mingzz1" title="Follow on GitHub">
			<i class="fa fa-fw fa-github"></i>
		</a>
	</li>
	

	

	

	
	<li>
		<a href="https://www.linkedin.com/in/minji-kim-12986a145/" title="Follow on LinkedIn">
			<i class="fa fa-fw fa-linkedin"></i>
		</a>
	</li>
	

	

	

	

	

	

	

	

	

	

	
</ul>


<script src="/assets/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/rohanchandra/type-theme">Type Theme</a>
</p>
</footer>


    <script id="dsq-count-scr" src="//.disqus.com/count.js" async></script>

    <!-- Google Analytics Tracking code -->
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

  </body>
</html>
